TEXT_GAMEOVER="GAME OVER";TEXT_PLAY="PLAY";TEXT_PLAYAGAIN="PLAY AGAIN";TEXT_PL1_VICTORY="PLAYER 1\n WINS!!!";TEXT_PL2_VICTORY="PLAYER 2\n WINS!!!";TEXT_DRAW="DRAW!!!";TEXT_BUT1PLAYER="1 Player";TEXT_BUT2PLAYERS="2 Players";TEXT_ACTIVEPLAYER={pt1:"Player ",pt2:" to move"};TEXT_AIACTIVEPLAYER={pt1:"AI ",pt2:" to move"};TEXT_THREE_IN_ROW="PLACE 3 IN A ROW!";TEXT_FOUR_IN_ROW="PLACE 4 IN A ROW!";
function CInterface(g){var m,k,e,l,n,q,h,a,p;this._init=function(g){q=createBitmap(s_oSpriteLibrary.getSprite("bg_game"));s_oStage.addChild(q);var d=s_oSpriteLibrary.getSprite("but_exit");e=CANVAS_WIDTH-d.height/2-20;l=d.height/2+10;h=new CGfxButton(e,l,d,s_oStage);h.addEventListener(ON_MOUSE_UP,this._onExit,this);m=CANVAS_WIDTH-d.width/2-175;k=d.height/2+10;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)d=s_oSpriteLibrary.getSprite("audio_icon"),n=new CToggle(m,k,d,s_bAudioActive),n.addEventListener(ON_MOUSE_UP,
this._onAudioToggle,this);d=TEXT_ACTIVEPLAYER.pt1+s_oGame.getActivePlayer()+TEXT_ACTIVEPLAYER.pt2;a=new createjs.Text(d,"bold 100px aachen_btroman","#008df0");a.x=40;a.y=440;a.textBaseline="alphabetic";a.textAlign="left";s_oStage.addChild(a);p=new createjs.Text(3<g?TEXT_FOUR_IN_ROW:TEXT_THREE_IN_ROW,"bold 60px aachen_btroman","#008df0");p.x=CANVAS_WIDTH/2;p.y=CANVAS_HEIGHT-300;p.textBaseline="alphabetic";p.textAlign="center";s_oStage.addChild(p);this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.unload=
function(){s_oStage.removeChild(q);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||n.unload();h.unload();s_oStage.removeChild(a)};this.refreshButtonPos=function(a,d){h.setPosition(e-a,d+l);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||n.setPosition(m-a,d+k)};this.update=function(){var e=TEXT_ACTIVEPLAYER.pt1+s_oGame.getActivePlayer()+TEXT_ACTIVEPLAYER.pt2;createjs.Tween.get(a).to({scaleX:.1,scaleY:1.2,alpha:.5},250,createjs.Ease.cubicOut).call(function(){a.text=e;createjs.Tween.get(a).to({scaleX:1,scaleY:1,
alpha:1},250,createjs.Ease.cubicIn)})};this._onExit=function(){this.unload();s_oGame.unload()};s_oInterface=this;this._init(g);return this}var s_oInterface=null;
function CGfxButton(g,m,k){var e,l,n,q,h,a=[],p;this._init=function(a,d,b){e=!1;q=[];h=[];l=b.width;n=b.height;p=createBitmap(b);p.x=a;p.y=d;p.regX=b.width/2;p.regY=b.height/2;s_oStage.addChild(p);this._initListener()};this.unload=function(){p.off("mousedown",this.buttonDown);p.off("pressup",this.buttonRelease);s_oStage.removeChild(p)};this.setVisible=function(a){p.visible=a};this._initListener=function(){p.on("mousedown",this.buttonDown);p.on("pressup",this.buttonRelease)};this.addEventListener=
function(a,d,b){q[a]=d;h[a]=b};this.addEventListenerWithParams=function(e,d,b,c){q[e]=d;h[e]=b;a=c};this.buttonRelease=function(){e||(!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||createjs.Sound.play("press_but"),p.scaleX=1,p.scaleY=1,q[ON_MOUSE_UP]&&q[ON_MOUSE_UP].call(h[ON_MOUSE_UP],a))};this.buttonDown=function(){e||(p.scaleX=.9,p.scaleY=.9,q[ON_MOUSE_DOWN]&&q[ON_MOUSE_DOWN].call(h[ON_MOUSE_DOWN],a))};this.setPosition=function(a,d){p.x=a;p.y=d};this.setX=function(a){p.x=a};this.setY=function(a){p.y=
a};this.enable=function(){e=!1;p.filters=[];p.cache(0,0,l,n)};this.disable=function(){e=!0;var a=(new createjs.ColorMatrix).adjustSaturation(-100).adjustBrightness(40);p.filters=[new createjs.ColorMatrixFilter(a)];p.cache(0,0,l,n)};this.getButtonImage=function(){return p};this.getX=function(){return p.x};this.getY=function(){return p.y};this._init(g,m,k);return this}
function CGameModeMenu(){var g,m,k,e,l;this._init=function(){g=createBitmap(s_oSpriteLibrary.getSprite("bg_mode_menu"));s_oStage.addChild(g);var n=createBitmap(s_oSpriteLibrary.getSprite("choose_text"));n.x=40;n.y=240;s_oStage.addChild(n);n=s_oSpriteLibrary.getSprite("but_3x3");m=createBitmap(n);m.x=CANVAS_WIDTH/2-n.width/2;m.y=440;s_oStage.addChild(m);m.on("click",function(){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||createjs.Sound.play("press_but");this._onBut3x3()},this);k=createBitmap(s_oSpriteLibrary.getSprite("but_5x5"));
k.x=CANVAS_WIDTH/2-n.width/2;k.y=880;s_oStage.addChild(k);k.on("click",function(){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||createjs.Sound.play("press_but");this._onBut5x5()},this);e=createBitmap(s_oSpriteLibrary.getSprite("but_7x7"));e.x=CANVAS_WIDTH/2-n.width/2;e.y=1320;s_oStage.addChild(e);e.on("click",function(){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||createjs.Sound.play("press_but");this._onBut7x7()},this);l=new createjs.Shape;l.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);
s_oStage.addChild(l);createjs.Tween.get(l).to({alpha:0},500).call(function(){l.visible=!1})};this.unload=function(){m.removeAllEventListeners();k.removeAllEventListeners();e.removeAllEventListeners();s_oStage.removeAllChildren()};this._onBut3x3=function(){this.unload();s_oMain.gotoGame(3)};this._onBut5x5=function(){this.unload();s_oMain.gotoGame(5)};this._onBut7x7=function(){this.unload();s_oMain.gotoGame(7)};this._init()}
function CGame(g){var m=!1,k,e,l=1,n=0,q=0,h=[],a=[],p=[],r;this._init=function(a){k=a.b2Players;e=a.iMatrixSize;r=new CInterface(e);this.initMatrix();this._initWinCellsArray()};this.unload=function(){for(var a=0;a<e;a++)for(var b=0;b<e;b++)p[a][b].unload();r.unload();s_oMain.gotoMenu()};this.initMatrix=function(){for(var d=0;d<e;d++){p[d]=[];a[d]=[];for(var b=0;b<e;b++){var c,f,h,g=MATRIX_YOFFSET;3===e?h=CELL_SCALING_3x3:5===e?h=CELL_SCALING_5x5:7===e&&(h=CELL_SCALING_7x7);c=b*(CELL_SIZE+CELL_PADDING)*
h;f=Y_START_GRID+d*(CELL_SIZE+CELL_PADDING)*h;c+=(CANVAS_WIDTH-CELL_SIZE*h*e)/2-30*h;f+=g;p[d][b]=new CCell(c,f,h,b,d);a[d][b]=0}}};this._initWinCellsArray=function(){if(3===e)for(var a=0;3>a;a++)h[a]={x:0,y:0};else for(a=0;4>a;a++)h[a]={x:0,y:0}};this.getActivePlayer=function(){return l};this.updateGameStatus=function(d,b){if(!m){a[b][d]=l;n++;3===e&&(5<=n?this.checkTris():this._switchPlayer());if(5===e||7===e)7<=n?this.checkQuad():this._switchPlayer();r.update()}};this._switchPlayer=function(){1===
l?!0===k?l=2:(l=2,this._AINext()):l=1};this._checkWinningCouples=function(d){for(var b={x:void 0,y:void 0},c=0;c<e;c++)for(var f=0;f<e;f++){if(a[c][f]===d){if(c<=e-3&&a[c][f]===a[c+1][f]&&0===a[c+2][f])return b.x=f,b.y=c+2,b;if(f<=e-3&&a[c][f]===a[c][f+1]&&0===a[c][f+2])return b.x=f+2,b.y=c,b;if(f<=e-3&&c<=e-3&&a[c][f]===a[c+1][f+1]&&0===a[c+2][f+2])return b.x=f+2,b.y=c+2,b}if(f<=e-3&&c<=e-3&&a[c+2][f]===d&&a[c+2][f]===a[c+1][f+1]&&0===a[c][f+2])return b.x=f+2,b.y=c,b;if(0===a[c][f]&&(c<=e-3&&d===
a[c+1][f]&&d===a[c+2][f]||f<=e-3&&d===a[c][f+1]&&d===a[c][f+2]||f<=e-3&&c<=e-3&&d===a[c+1][f+1]&&d===a[c+2][f+2]))return b.x=f,b.y=c,b;if(f<=e-3&&c<=e-3&&0===a[c+2][f]&&d===a[c+1][f+1]&&d===a[c][f+2])return b.x=f,b.y=c+2,b;if(a[c][f]===d){if(c<=e-3&&0===a[c+1][f]&&d===a[c+2][f])return b.x=f,b.y=c+1,b;if(f<=e-3&&0===a[c][f+1]&&d===a[c][f+2])return b.x=f+1,b.y=c,b;if(f<=e-3&&c<=e-3&&0===a[c+1][f+1]&&d===a[c+2][f+2])return b.x=f+1,b.y=c+1,b}if(f<=e-3&&c<=e-3&&a[c+2][f]===d&&0===a[c+1][f+1]&&d===a[c][f+
2])return b.x=f+1,b.y=c+1,b}return b};this._checkWinningTriples=function(d){for(var b={x:void 0,y:void 0},c=0;c<e;c++)for(var f=0;f<e;f++){if(a[c][f]===d){if(c<=e-4&&a[c][f]===a[c+1][f]&&a[c][f]===a[c+2][f]&&0===a[c+3][f])return b.x=f,b.y=c+3,b;if(f<=e-4&&a[c][f]===a[c][f+1]&&a[c][f]===a[c][f+2]&&0===a[c][f+3])return b.x=f+3,b.y=c,b;if(f<=e-4&&c<=e-4&&a[c][f]===a[c+1][f+1]&&a[c][f]===a[c+2][f+2]&&0===a[c+3][f+3])return b.x=f+3,b.y=c+3,b}if(f<=e-4&&c<=e-4&&a[c+3][f]===d&&a[c+3][f]===a[c+2][f+1]&&a[c+
3][f]===a[c+1][f+2]&&0===a[c][f+3])return b.x=f+3,b.y=c,b;if(0===a[c][f]&&(c<=e-4&&d===a[c+1][f]&&d===a[c+2][f]&&d===a[c+3][f]||f<=e-4&&d===a[c][f+1]&&d===a[c][f+2]&&d===a[c][f+3]||f<=e-4&&c<=e-4&&d===a[c+1][f+1]&&d===a[c+2][f+2]&&d===a[c+3][f+3]))return b.x=f,b.y=c,b;if(f<=e-4&&c<=e-4&&0===a[c+3][f]&&d===a[c+2][f+1]&&d===a[c+1][f+2]&&d===a[c][f+3])return b.x=f,b.y=c+3,b;if(a[c][f]===d){if(c<=e-4&&0===a[c+1][f]&&d===a[c+2][f]&&d===a[c+3][f])return b.x=f,b.y=c+1,b;if(f<=e-4&&0===a[c][f+1]&&d===a[c][f+
2]&&d===a[c][f+3])return b.x=f+1,b.y=c,b;if(f<=e-4&&c<=e-4&&0===a[c+1][f+1]&&d===a[c+2][f+2]&&d===a[c+3][f+3])return b.x=f+1,b.y=c+1,b}if(f<=e-4&&c<=e-4&&a[c+3][f]===d&&0===a[c+2][f+1]&&d===a[c+1][f+2]&&d===a[c][f+3])return b.x=f+1,b.y=c+2,b}return b};this._checkForks=function(){for(var d={x:void 0,y:void 0},b=0;b<e;b++)for(var c=0;c<e;c++)if(b<=e-3&&c<=e-3&&2===a[b+2][c]&&2===a[b][c+2]&&0===a[b+1][c]&&0===a[b][c+1]||2<=b&&c<=e-3&&2===a[b-2][c]&&2===a[b][c+2]&&0===a[b-1][c]&&0===a[b][c+1]||2<=b&&
2<=c&&2===a[b-2][c]&&2===a[b][c-2]&&0===a[b-1][c]&&0===a[b][c-1]||b<=e-3&&2<=c&&2===a[b+2][c]&&2===a[b][c-2]&&0===a[b+1][c]&&0===a[b][c-1])return d.x=c,d.y=b,d;return d};this._checkWinningSingletons=function(d){for(var b={x:void 0,y:void 0},c=0;c<e;c++)for(var f=0;f<e;f++){if(a[c][f]===d){if(c<=e-3&&0===a[c+1][f])return b.x=f,b.y=c+1,b;if(f<=e-3&&0===a[c][f+1])return b.x=f+1,b.y=c,b;if(f<=e-3&&c<=e-3&&0===a[c+1][f+1])return b.x=f+1,b.y=c+1,b}if(f<=e-3&&c<=e-3&&a[c+1][f]===d&&0===a[c][f+1])return b.x=
f+1,b.y=c,b}return b};this.checkTris=function(){for(var d=0;d<e;d++)for(var b=0;b<e;b++){if(0!==a[d][b]){if(d<=e-3&&a[d][b]===a[d+1][b]&&a[d][b]===a[d+2][b]){h[0].x=b;h[0].y=d;h[1].x=b;h[1].y=d+1;h[2].x=b;h[2].y=d+2;this.endGame();return}if(b<=e-3&&a[d][b]===a[d][b+1]&&a[d][b]===a[d][b+2]){h[0].x=b;h[0].y=d;h[1].x=b+1;h[1].y=d;h[2].x=b+2;h[2].y=d;this.endGame();return}if(b<=e-3&&d<=e-3&&a[d][b]===a[d+1][b+1]&&a[d][b]===a[d+2][b+2]){h[0].x=b;h[0].y=d;h[1].x=b+1;h[1].y=d+1;h[2].x=b+2;h[2].y=d+2;this.endGame();
return}}if(b<=e-3&&d<=e-3&&0!==a[d+2][b]&&a[d+2][b]===a[d+1][b+1]&&a[d+2][b]===a[d][b+2]){h[0].x=b;h[0].y=d+2;h[1].x=b+1;h[1].y=d+1;h[2].x=b+2;h[2].y=d;this.endGame();return}}n===e*e&&(l=0,this.showEndPanel());this._switchPlayer()};this.checkQuad=function(){for(var d=0;d<e;d++)for(var b=0;b<e;b++){if(0!==a[d][b]){if(d<=e-4&&a[d][b]===a[d+1][b]&&a[d][b]===a[d+2][b]&&a[d][b]===a[d+3][b]){h[0].x=b;h[0].y=d;h[1].x=b;h[1].y=d+1;h[2].x=b;h[2].y=d+2;h[3].x=b;h[3].y=d+3;this.endGame();return}if(b<=e-4&&a[d][b]===
a[d][b+1]&&a[d][b]===a[d][b+2]&&a[d][b]===a[d][b+3]){h[0].x=b;h[0].y=d;h[1].x=b+1;h[1].y=d;h[2].x=b+2;h[2].y=d;h[3].x=b+3;h[3].y=d;this.endGame();return}if(b<=e-4&&d<=e-4&&a[d][b]===a[d+1][b+1]&&a[d][b]===a[d+2][b+2]&&a[d][b]===a[d+3][b+3]){h[0].x=b;h[0].y=d;h[1].x=b+1;h[1].y=d+1;h[2].x=b+2;h[2].y=d+2;h[3].x=b+3;h[3].y=d+3;this.endGame();return}}if(b<=e-4&&d<=e-4&&0!==a[d+3][b]&&a[d+3][b]===a[d+2][b+1]&&a[d+3][b]===a[d+1][b+2]&&a[d+3][b]===a[d][b+3]){h[0].x=b;h[0].y=d+3;h[1].x=b+1;h[1].y=d+2;h[2].x=
b+2;h[2].y=d+1;h[3].x=b+3;h[3].y=d;this.endGame();return}}n===e*e&&(l=0,this.showEndPanel());this._switchPlayer()};this._AINext=function(){var d={};3===e&&(d=this._checkWinningCouples(2),void 0===d.x&&(d=this._checkWinningCouples(1),void 0===d.x&&(d=this._checkForks())));if(5===e||7===e)d=this._checkWinningTriples(2),void 0===d.x&&(d=this._checkWinningTriples(1),void 0===d.x&&(d=this._checkWinningCouples(2),void 0===d.x&&(d=this._checkWinningCouples(1),void 0===d.x&&(d=this._checkWinningSingletons(2)))));
if(void 0===d.x)for(;;){var b=Math.floor(Math.random()*e),c=Math.floor(Math.random()*e);if(0===a[c][b]){d.x=b;d.y=c;break}}p[d.y][d.x].AIMove()};this.endGame=function(){for(var a=0;a<h.length;a++)p[h[a].y][h[a].x].EndAnim(),q++};this.showEndPanel=function(){if(1<q)q--;else if(1===q||0===l)new CEndPanel(l),k?!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||createjs.Sound.play("win"):0===l?!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||createjs.Sound.play("draw"):1===l?!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||
createjs.Sound.play("win"):!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||createjs.Sound.play("gameover")};this.onExit=function(){this.unload();s_oMain.gotoMenu();$(s_oMain).trigger("restart")};this.isFrozen=function(){return m};this.freeze=function(){m=!0};this.unFreeze=function(){m=!1};s_oGame=this;this._init(g)}var s_oGame;
function CEndPanel(g){var m,k,e,l,n;this._init=function(g){m=createBitmap(s_oSpriteLibrary.getSprite("panel"));s_oStage.addChild(m);1===g?(k=createBitmap(s_oSpriteLibrary.getSprite("tokenX")),e=new createjs.Text(TEXT_PL1_VICTORY,"bold 100px aachen_btroman","White"),k.x=150,k.y=800,e.x=CANVAS_WIDTH/2+70):2===g?(k=createBitmap(s_oSpriteLibrary.getSprite("tokenO")),e=new createjs.Text(TEXT_PL2_VICTORY,"bold 100px aachen_btroman","White"),k.x=150,k.y=800,e.x=CANVAS_WIDTH/2+70):(e=new createjs.Text(TEXT_DRAW,
"bold 100px aachen_btroman","White"),e.x=CANVAS_WIDTH/2);e.y=CANVAS_HEIGHT/2-60;e.textBaseline="alphabetic";e.textAlign="center";e.shadow=new createjs.Shadow("#000000",6,6,2);s_oStage.addChild(k);s_oStage.addChild(e);var h=s_oSpriteLibrary.getSprite("but_box_2");l=new CTextButton(CANVAS_WIDTH/2,CANVAS_HEIGHT/2+200,h,TEXT_PLAYAGAIN,"aachen_btroman","#008df0",60,s_oStage);l.addEventListener(ON_MOUSE_UP,this._onButPlayAgain,this);if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)h=s_oSpriteLibrary.getSprite("audio_icon"),
n=new CToggle(CANVAS_WIDTH-h.width/2+5,h.height/2+20,h),n.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);_oFade=new createjs.Shape;_oFade.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(_oFade);$(s_oMain).trigger("end_game",[g]);createjs.Tween.get(_oFade).to({alpha:0},1E3).call(function(){_oFade.visible=!1})};this.unload=function(){l.unload();l=null;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)n.unload(),n=null;s_oStage.removeChild(m,k,e,_oFade)};this._onButPlayAgain=
function(){this.unload();s_oGame.unload()};this._onAudioToggle=function(){createjs.Sound.setMute(!s_bAudioActive)};this._init(g)}
function CCell(g,m,k,e,l){var n,q,h,a,p,r,d,b,c;this._init=function(e,g,k,l,m){n=0;q=l;h=m;a=k;l=s_oSpriteLibrary.getSprite("cell");d=createBitmap(l);d.scaleX=d.scaleY=k;m=s_oSpriteLibrary.getSprite("tokenX");p=createBitmap(m);p.x=l.width/2*k;p.y=l.height/2*k;p.regX=m.width/2;p.regY=m.height/2;p.scaleX=p.scaleY=k;p.alpha=0;m=s_oSpriteLibrary.getSprite("tokenO");r=createBitmap(m);r.x=l.width/2*k;r.y=l.height/2*k;r.regX=m.width/2;r.regY=m.height/2;r.scaleX=r.scaleY=k;r.alpha=0;b=new createjs.Shape;
b.graphics.beginFill("black").drawRect(0,0,CELL_SIZE*k,CELL_SIZE*k);b.alpha=.05;c=new createjs.Container;c.x=e;c.y=g;c.addChild(d,p,r,b);c.on("click",function(){this.clicked()},this);s_oStage.addChild(c)};this.unload=function(){c.removeAllEventListeners();s_oStage.removeChild(c)};this.clicked=function(){s_oGame.isFrozen()||(c.removeAllEventListeners(),s_oGame.freeze(),this.showToken())};this.showToken=function(){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||createjs.Sound.play("place_mark");1===s_oGame.getActivePlayer()?
(n=1,p.scaleX=p.scaleY=.5,p.alpha=.1,p.visible=!0,createjs.Tween.get(p).to({scaleX:1.2*a,scaleY:1.2*a,alpha:1},200,createjs.Ease.cubicOut).call(function(){createjs.Tween.get(p).to({scaleX:1*a,scaleY:1*a},200,createjs.Ease.cubicIn).call(function(){s_oGame.unFreeze();s_oGame.updateGameStatus(q,h)})})):(n=2,r.scaleX=p.scaleY=.5,r.alpha=.1,r.visible=!0,createjs.Tween.get(r).to({scaleX:1.2*a,scaleY:1.2*a,alpha:1},200,createjs.Ease.cubicOut).call(function(){createjs.Tween.get(r).to({scaleX:1*a,scaleY:1*
a},200,createjs.Ease.cubicIn).call(function(){s_oGame.unFreeze();s_oGame.updateGameStatus(q,h)})}))};this.AIMove=function(){c.removeAllEventListeners();s_oGame.freeze();n=2;r.alpha=0;createjs.Tween.get(r).wait(1E3).to({scaleX:1.2*a,scaleY:1.2*a,alpha:1},250,createjs.Ease.cubicOut).call(function(){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||createjs.Sound.play("place_mark");createjs.Tween.get(r).to({scaleX:1*a,scaleY:1*a},250,createjs.Ease.cubicIn).call(function(){s_oGame.unFreeze();s_oGame.updateGameStatus(q,
h)})})};this.EndAnim=function(){s_oGame.freeze();1===n?createjs.Tween.get(p).to({scaleX:1.5*a,scaleY:1.5*a,alpha:.8},1E3,createjs.Ease.cubicInOut).call(function(){createjs.Tween.get(p).to({scaleX:1*a,scaleY:1*a,alpha:1},1500,createjs.Ease.bounceOut).call(function(){s_oGame.showEndPanel()})}):createjs.Tween.get(r).to({scaleX:1.5*a,scaleY:1.5*a,alpha:.8},1E3,createjs.Ease.cubicInOut).call(function(){createjs.Tween.get(r).to({scaleX:1*a,scaleY:1*a,alpha:1},1500,createjs.Ease.bounceOut).call(function(){s_oGame.showEndPanel()})})};
this._init(g,m,k,e,l)}
function CSpriteLibrary(){var g,m,k,e,l,n;this.init=function(q,h,a){k=m=0;e=q;l=h;n=a;g={}};this.addSprite=function(e,h){g.hasOwnProperty(e)||(g[e]={szPath:h,oSprite:new Image},m++)};this.getSprite=function(e){return g.hasOwnProperty(e)?g[e].oSprite:null};this._onSpritesLoaded=function(){l.call(n)};this._onSpriteLoaded=function(){e.call(n);++k===m&&this._onSpritesLoaded()};this.loadSprites=function(){for(var e in g)g[e].oSprite.oSpriteLibrary=this,g[e].oSprite.onload=function(){this.oSpriteLibrary._onSpriteLoaded()},g[e].oSprite.src=
g[e].szPath};this.getNumSprites=function(){return m}}var CANVAS_WIDTH=1080,CANVAS_HEIGHT=1920,DISABLE_SOUND_MOBILE=!1,STATE_LOADING=0,STATE_MENU=1,STATE_HELP=1,STATE_GAME=3,ON_MOUSE_DOWN=0,ON_MOUSE_UP=1,ON_MOUSE_OVER=2,ON_MOUSE_OUT=3,ON_DRAG_START=4,ON_DRAG_END=5,EDGEBOARD_X=25,EDGEBOARD_Y=200,CELL_SIZE=300,CELL_PADDING=15,CELL_SCALING_3x3=1,CELL_SCALING_5x5=.6,CELL_SCALING_7x7=.44,MATRIX_YOFFSET=200,Y_START_GRID=320;
function CToggle(g,m,k){var e,l,n;this._init=function(g,h,a){e=[];l=[];var k=new createjs.SpriteSheet({images:[a],frames:{width:a.width/2,height:a.height,regX:a.width/2/2,regY:a.height/2},animations:{on:[0,1],off:[1,2]}});n=s_bAudioActive?createSprite(k,"on",a.width/2/2,a.height/2,a.width/2,a.height):createSprite(k,"off",a.width/2/2,a.height/2,a.width/2,a.height);n.x=g;n.y=h;n.stop();s_oStage.addChild(n);this._initListener()};this.unload=function(){n.off("mousedown",this.buttonDown);n.off("pressup",
this.buttonRelease);s_oStage.removeChild(n)};this._initListener=function(){n.on("mousedown",this.buttonDown);n.on("pressup",this.buttonRelease)};this.addEventListener=function(g,h,a){e[g]=h;l[g]=a};this.buttonRelease=function(){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||createjs.Sound.play("press_but");n.scaleX=1;n.scaleY=1;(s_bAudioActive=!s_bAudioActive)?n.gotoAndStop("on"):n.gotoAndStop("off");e[ON_MOUSE_UP]&&e[ON_MOUSE_UP].call(l[ON_MOUSE_UP])};this.buttonDown=function(){n.scaleX=.9;n.scaleY=
.9;e[ON_MOUSE_DOWN]&&e[ON_MOUSE_DOWN].call(l[ON_MOUSE_DOWN])};this.setPosition=function(e,g){n.x=e;n.y=g};this._init(g,m,k)}var s_iScaleFactor=1,s_oCanvasLeft,s_oCanvasTop;
(function(g){(jQuery.browser=jQuery.browser||{}).mobile=/android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(ad|hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|tablet|treo|up\.(browser|link)|vodafone|wap|webos|windows (ce|phone)|xda|xiino/i.test(g)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(g.substr(0,
4))})(navigator.userAgent||navigator.vendor||window.opera);$(window).resize(function(){sizeHandler()});function trace(g){console.log(g)}
function getSize(g){var m=g.toLowerCase(),k=window.document,e=k.documentElement;if(void 0===window["inner"+g])g=e["client"+g];else if(window["inner"+g]!=e["client"+g]){var l=k.createElement("body");l.id="vpw-test-b";l.style.cssText="overflow:scroll";var n=k.createElement("div");n.id="vpw-test-d";n.style.cssText="position:absolute;top:-1000px";n.innerHTML="<style>@media("+m+":"+e["client"+g]+"px){body#vpw-test-b div#vpw-test-d{"+m+":7px!important}}</style>";l.appendChild(n);e.insertBefore(l,k.head);
g=7==n["offset"+g]?e["client"+g]:window["inner"+g];e.removeChild(l)}else g=window["inner"+g];return g}$(window).ready(function(){sizeHandler()});window.addEventListener("orientationchange",onOrientationChange);function onOrientationChange(){window.matchMedia("(orientation: portrait)").matches&&sizeHandler();window.matchMedia("(orientation: landscape)").matches&&sizeHandler()}function getIOSWindowHeight(){return document.documentElement.clientWidth/window.innerWidth*window.innerHeight}
function getHeightOfIOSToolbars(){var g=(0===window.orientation?screen.height:screen.width)-getIOSWindowHeight();return 1<g?g:0}
function sizeHandler(){window.scrollTo(0,1);if($("#canvas")){var g;g=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?getIOSWindowHeight():getSize("Height");var m=getSize("Width"),k=Math.min(g/CANVAS_HEIGHT,m/CANVAS_WIDTH),e=CANVAS_WIDTH*k,k=CANVAS_HEIGHT*k,l=0;k<g?(l=g-k,k+=l,e+=CANVAS_WIDTH/CANVAS_HEIGHT*l):e<m&&(l=m-e,e+=l,k+=CANVAS_HEIGHT/CANVAS_WIDTH*l);var l=g/2-k/2,n=m/2-e/2,q=CANVAS_WIDTH/e;if(n*q<-EDGEBOARD_X||l*q<-EDGEBOARD_Y)k=Math.min(g/(CANVAS_HEIGHT-2*EDGEBOARD_Y),m/(CANVAS_WIDTH-2*
EDGEBOARD_X)),e=CANVAS_WIDTH*k,k*=CANVAS_HEIGHT,l=(g-k)/2,n=(m-e)/2,q=CANVAS_WIDTH/e;s_iOffsetX=-1*n*q;s_iOffsetY=-1*l*q;0<=l&&(s_iOffsetY=0);0<=n&&(s_iOffsetX=0);null!==s_oInterface&&s_oInterface.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oMenu&&s_oMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);$("#canvas").css("width",e+"px");$("#canvas").css("height",k+"px");0>l?$("#canvas").css("top",l+"px"):$("#canvas").css("top","0px");$("#canvas").css("left",n+"px")}}
function createBitmap(g,m,k){var e=new createjs.Bitmap(g),l=new createjs.Shape;m&&k?l.graphics.beginFill("#fff").drawRect(0,0,m,k):l.graphics.beginFill("#ff0").drawRect(0,0,g.width,g.height);e.hitArea=l;return e}function createSprite(g,m,k,e,l,n){g=null!==m?new createjs.Sprite(g,m):new createjs.Sprite(g);m=new createjs.Shape;m.graphics.beginFill("#000000").drawRect(-k,-e,l,n);g.hitArea=m;return g}
function randomFloatBetween(g,m,k){"undefined"===typeof k&&(k=2);return parseFloat(Math.min(g+Math.random()*(m-g),m).toFixed(k))}function formatTime(g){g/=1E3;var m=Math.floor(g/60);g=Math.floor(g-60*m);var k="",k=10>m?k+("0"+m+":"):k+(m+":");return 10>g?k+("0"+g):k+g}function NoClickDelay(g){this.element=g;window.Touch&&this.element.addEventListener("touchstart",this,!1)}function shuffle(g){for(var m=g.length,k,e;0<m;)e=Math.floor(Math.random()*m),m--,k=g[m],g[m]=g[e],g[e]=k;return g}
NoClickDelay.prototype={handleEvent:function(g){switch(g.type){case "touchstart":this.onTouchStart(g);break;case "touchmove":this.onTouchMove(g);break;case "touchend":this.onTouchEnd(g)}},onTouchStart:function(g){g.preventDefault();this.moved=!1;this.element.addEventListener("touchmove",this,!1);this.element.addEventListener("touchend",this,!1)},onTouchMove:function(g){this.moved=!0},onTouchEnd:function(g){this.element.removeEventListener("touchmove",this,!1);this.element.removeEventListener("touchend",
this,!1);if(!this.moved){g=document.elementFromPoint(g.changedTouches[0].clientX,g.changedTouches[0].clientY);3==g.nodeType&&(g=g.parentNode);var m=document.createEvent("MouseEvents");m.initEvent("click",!0,!0);g.dispatchEvent(m)}}};
function CTextButton(g,m,k,e,l,n,q,h){var a,p,r,d,b,c,f,t,u,v;this._init=function(e,g,h,k,l,m,n,q){a=!1;d=[];b=[];v=q;f=createBitmap(h);p=h.width;r=h.height;q=Math.ceil(n/20);t=new createjs.Text(k,"bold "+n+"px "+l,"#000000");var w=t.getBounds();t.textAlign="center";t.textBaseline="alphabetic";t.x=h.width/2+q;t.y=Math.floor(h.height/2)+w.height/3+q;u=new createjs.Text(k,"bold "+n+"px "+l,m);u.textAlign="center";u.textBaseline="alphabetic";u.x=h.width/2;u.y=Math.floor(h.height/2)+w.height/3;c=new createjs.Container;
c.x=e;c.y=g;c.regX=h.width/2;c.regY=h.height/2;c.addChild(f,t,u);v.addChild(c);this._initListener()};this.unload=function(){c.off("mousedown");c.off("pressup");v.removeChild(c)};this.setVisible=function(a){c.visible=a};this.enable=function(){a=!1;f.filters=[];f.cache(0,0,p,r)};this.disable=function(){a=!0;var b=(new createjs.ColorMatrix).adjustSaturation(-100);f.filters=[new createjs.ColorMatrixFilter(b)];f.cache(0,0,p,r)};this._initListener=function(){oParent=this;c.on("mousedown",this.buttonDown);
c.on("pressup",this.buttonRelease)};this.addEventListener=function(a,c,e){d[a]=c;b[a]=e};this.buttonRelease=function(){a||(!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||createjs.Sound.play("press_but"),c.scaleX=1,c.scaleY=1,d[ON_MOUSE_UP]&&d[ON_MOUSE_UP].call(b[ON_MOUSE_UP]))};this.buttonDown=function(){a||(c.scaleX=.9,c.scaleY=.9,d[ON_MOUSE_DOWN]&&d[ON_MOUSE_DOWN].call(b[ON_MOUSE_DOWN]))};this.setPosition=function(a,b){c.x=a;c.y=b};this.changeText=function(a){u.text=a;t.text=a};this.setX=function(a){c.x=
a};this.setY=function(a){c.y=a};this.getButtonImage=function(){return c};this.getX=function(){return c.x};this.getY=function(){return c.y};this._init(g,m,k,e,l,n,q,h);return this}
function CPreloader(){var g,m,k,e,l,n,q;this._init=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("bg_menu","./static/bg_menu.jpg");s_oSpriteLibrary.addSprite("progress_bar","./static/progress_bar.png");s_oSpriteLibrary.loadSprites();q=new createjs.Container;s_oStage.addChild(q)};this.unload=function(){q.removeAllChildren()};this.hide=function(){var e=this;setTimeout(function(){createjs.Tween.get(n).to({alpha:1},500).call(function(){e.unload();
s_oMain.gotoMenu()})},1E3)};this._onImagesLoaded=function(){};this._onAllImagesLoaded=function(){this.attachSprites();s_oMain.preloaderReady()};this.attachSprites=function(){var h=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));q.addChild(h);h=s_oSpriteLibrary.getSprite("progress_bar");e=createBitmap(h);e.x=CANVAS_WIDTH/2-h.width/2;e.y=CANVAS_HEIGHT-350;q.addChild(e);g=h.width;m=h.height;l=new createjs.Shape;l.graphics.beginFill("rgba(255,255,255,0.01)").drawRect(e.x,e.y,1,m);q.addChild(l);e.mask=
l;k=new createjs.Text("","40px Arial","#008df0");k.x=CANVAS_WIDTH/2;k.y=CANVAS_HEIGHT-375;k.textBaseline="alphabetic";k.textAlign="center";q.addChild(k);n=new createjs.Shape;n.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);n.alpha=0;q.addChild(n)};this.refreshLoader=function(h){k.text=h+"%";l.graphics.clear();h=Math.floor(h*g/100);l.graphics.beginFill("rgba(255,255,255,0.01)").drawRect(e.x,e.y,h,m)};this._init()}
function CMenu(){var g,m,k,e,l,n,q,h,a,p,r;this._init=function(){q=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));s_oStage.addChild(q);k=CANVAS_WIDTH/2;e=CANVAS_HEIGHT-340;var d=s_oSpriteLibrary.getSprite("but_box_1");h=new CTextButton(k,e,d,TEXT_BUT1PLAYER,"aachen_btroman","#ffffff",60,s_oStage);h.addEventListener(ON_MOUSE_UP,this._onBut1Player,this);g=CANVAS_WIDTH/2;m=CANVAS_HEIGHT-150;a=new CTextButton(g,m,d,TEXT_BUT2PLAYERS,"aachen_btroman","#ffffff",60,s_oStage);a.addEventListener(ON_MOUSE_UP,
this._onBut2Players,this);if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)d=s_oSpriteLibrary.getSprite("audio_icon"),l=CANVAS_WIDTH-d.width/4-20,n=d.height/2+10,p=new CToggle(l,n,d,s_bAudioActive),p.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);r=new createjs.Shape;r.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(r);createjs.Tween.get(r).to({alpha:0},500).call(function(){r.visible=!1});this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.unload=function(){h.unload();
h=null;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)p.unload(),p=null;s_oStage.removeAllChildren();s_oMenu=null};this.refreshButtonPos=function(d,b){h.setPosition(k-d,e-b);a.setPosition(g-d,m-b);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||p.setPosition(l-d,b+n)};this._onBut1Player=function(){this.unload();s_oMain.gotoGameModeMenu(!1)};this._onBut2Players=function(){this.unload();s_oMain.gotoGameModeMenu(!0)};this._onAudioToggle=function(){createjs.Sound.setMute(!s_bAudioActive)};s_oMenu=this;this._init()}
var s_oMenu=null;
function CMain(g){var m=0,k=0,e={},l,n=!1;this.initContainer=function(){s_oStage=new createjs.Stage("canvas");createjs.Touch.enable(s_oStage);s_bMobile=jQuery.browser.mobile;!1===s_bMobile&&s_oStage.enableMouseOver(20);s_iPrevTime=(new Date).getTime();createjs.Ticker.setFPS(30);createjs.Ticker.addEventListener("tick",this._update);navigator.userAgent.match(/Windows Phone/i)&&(DISABLE_SOUND_MOBILE=!0);s_oSpriteLibrary=new CSpriteLibrary;l=new CPreloader};this.preloaderReady=function(){!1!==DISABLE_SOUND_MOBILE&&
!1!==s_bMobile||this._initSounds();this._loadImages()};this.soundLoaded=function(){m++;m===k&&(l.unload(),this.gotoMenu())};this._initSounds=function(){createjs.Sound.initializeDefaultPlugins()&&(0<navigator.userAgent.indexOf("Opera")||0<navigator.userAgent.indexOf("OPR")?(createjs.Sound.alternateExtensions=["mp3"],createjs.Sound.addEventListener("fileload",createjs.proxy(this.soundLoaded,this)),createjs.Sound.registerSound("./sounds/gameover.ogg","gameover"),createjs.Sound.registerSound("./sounds/place_mark.ogg",
"place_mark"),createjs.Sound.registerSound("./static/press_but.ogg","press_but"),createjs.Sound.registerSound("./sounds/win.ogg","win"),createjs.Sound.registerSound("./sounds/draw.ogg","draw")):(createjs.Sound.alternateExtensions=["ogg"],createjs.Sound.addEventListener("fileload",createjs.proxy(this.soundLoaded,this)),createjs.Sound.registerSound("./static/gameover.mp3","gameover"),createjs.Sound.registerSound("./static/place_mark.mp3","place_mark"),createjs.Sound.registerSound("./static/press_but.mp3",
"press_but"),createjs.Sound.registerSound("./static/win.mp3","win"),createjs.Sound.registerSound("./static/draw.mp3","draw")),k+=5)};this._loadImages=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("bg_game","./static/bg_game.jpg");s_oSpriteLibrary.addSprite("bg_menu","./static/bg_menu.jpg");s_oSpriteLibrary.addSprite("but_box_1","./static/but_box_1.png");s_oSpriteLibrary.addSprite("but_box_2","./static/but_box_2.png");s_oSpriteLibrary.addSprite("but_exit",
"./static/but_exit.png");s_oSpriteLibrary.addSprite("cell","./static/cell.png");s_oSpriteLibrary.addSprite("choose_text","./static/choose_text.png");s_oSpriteLibrary.addSprite("but_3x3","./static/layout_3x3.png");s_oSpriteLibrary.addSprite("but_5x5","./static/layout_5x5.png");s_oSpriteLibrary.addSprite("but_7x7","./static/layout_7x7.png");s_oSpriteLibrary.addSprite("panel","./static/panel.png");s_oSpriteLibrary.addSprite("tokenX","./static/player_1.png");s_oSpriteLibrary.addSprite("tokenO",
"./static/player_2.png");s_oSpriteLibrary.addSprite("audio_icon","./static/audio_icon.png");s_oSpriteLibrary.addSprite("tris_line","./static/tris_line.png");s_oSpriteLibrary.addSprite("bg_mode_menu","./static/bg_mode_menu.jpg");k+=s_oSpriteLibrary.getNumSprites();s_oSpriteLibrary.loadSprites()};this._onImagesLoaded=function(){m++;l.refreshLoader(Math.floor(m/k*100));m===k&&(l.unload(),this.gotoMenu())};this._onAllImagesLoaded=function(){};this.onAllPreloaderImagesLoaded=function(){this._loadImages()};
this.gotoMenu=function(){new CMenu};this.gotoGameModeMenu=function(e){n=e?!0:!1;new CGameModeMenu};this.gotoGame=function(g){e.iMatrixSize=g;e.b2Players=n;new CGame(e);$(s_oMain).trigger("game_start")};this.gotoHelp=function(){new CHelp};this._update=function(e){var g=(new Date).getTime();s_iTimeElaps=g-s_iPrevTime;s_iCntTime+=s_iTimeElaps;s_iCntFps++;s_iPrevTime=g;1E3<=s_iCntTime&&(s_iCurFps=s_iCntFps,s_iCntTime-=1E3,s_iCntFps=0);s_oStage.update(e)};s_oMain=this;e=g;this.initContainer()}
var s_bMobile,s_bAudioActive=!0,s_iCntTime=0,s_iTimeElaps=0,s_iPrevTime=0,s_iCntFps=0,s_iCurFps=0,s_oDrawLayer,s_oStage,s_oMain,s_oSpriteLibrary,s_oGameSettings;