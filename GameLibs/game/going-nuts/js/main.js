function CMain(a){var l,f=0,d=0,e=STATE_LOADING,k,p,b;this.initContainer=function(){s_oCanvas=document.getElementById("canvas");s_oStage=new createjs.Stage(s_oCanvas);createjs.Touch.enable(s_oStage);s_bMobile=jQuery.browser.mobile;!1===s_bMobile&&(s_oStage.enableMouseOver(20),$("body").on("contextmenu","#canvas",function(b){return!1}));s_iPrevTime=(new Date).getTime();createjs.Ticker.addEventListener("tick",this._update);createjs.Ticker.setFPS(FPS);navigator.userAgent.match(/Windows Phone/i)&&(DISABLE_SOUND_MOBILE=
!0);s_oSpriteLibrary=new CSpriteLibrary;p=new CPreloader;s_oRollingTextManager=new CRollingTextManager};this.preloaderReady=function(){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||this._initSounds();this._loadImages();l=!0};this.soundLoaded=function(){f++;p.refreshLoader(Math.floor(f/d*100));f===d&&(p.unload(),s_oSoundtrack=playSound("soundtrack",1,-1,s_oSoundtrack),this.gotoMenu())};this._initSounds=function(){createjs.Sound.initializeDefaultPlugins()&&(0<navigator.userAgent.indexOf("Opera")||0<navigator.userAgent.indexOf("OPR")?
(createjs.Sound.alternateExtensions=["mp3"],createjs.Sound.addEventListener("fileload",createjs.proxy(this.soundLoaded,this)),createjs.Sound.registerSound("./sounds/but_press.ogg","press_button"),createjs.Sound.registerSound("./sounds/hit_basket.ogg","hit_basket"),createjs.Sound.registerSound("./sounds/hit_obstacles.ogg","hit_obstacles"),createjs.Sound.registerSound("./sounds/pick_object.ogg","pick_object"),createjs.Sound.registerSound("./sounds/game_over.ogg","game_over"),createjs.Sound.registerSound("./sounds/next_level.ogg",
"next_level"),createjs.Sound.registerSound("./sounds/soundtrack.ogg","soundtrack")):(createjs.Sound.alternateExtensions=["ogg"],createjs.Sound.addEventListener("fileload",createjs.proxy(this.soundLoaded,this)),createjs.Sound.registerSound("./sounds/but_press.mp3","press_button"),createjs.Sound.registerSound("./sounds/hit_basket.mp3","hit_basket"),createjs.Sound.registerSound("./sounds/hit_obstacles.mp3","hit_obstacles"),createjs.Sound.registerSound("./sounds/pick_object.mp3","pick_object"),createjs.Sound.registerSound("./sounds/game_over.mp3",
"game_over"),createjs.Sound.registerSound("./sounds/next_level.mp3","next_level"),createjs.Sound.registerSound("./sounds/soundtrack.mp3","soundtrack")),d+=5)};this._loadImages=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("but_play","./sprites/but_play.png");s_oSpriteLibrary.addSprite("but_continue","./sprites/but_continue.png");s_oSpriteLibrary.addSprite("but_restart","./sprites/but_restart.png");s_oSpriteLibrary.addSprite("but_home",
"./sprites/but_home.png");s_oSpriteLibrary.addSprite("msg_box_game_over","./sprites/msg_box_game_over.png");s_oSpriteLibrary.addSprite("msg_box","./sprites/msg_box.png");s_oSpriteLibrary.addSprite("curtain","./sprites/curtain.png");s_oSpriteLibrary.addSprite("curtain_bg","./sprites/curtain_bg.jpg");for(var b=1;87>b;b++)s_oSpriteLibrary.addSprite("msg_box_animation_"+b,"./sprites/msg_box/"+b+"-msg-box-animation.png");s_oSpriteLibrary.addSprite("bg_menu","./sprites/bg_menu.jpg");for(b=0;22>b;b++)s_oSpriteLibrary.addSprite("bg_menu_animation_"+
b,"./sprites/bg_menu_animation/"+b+"-main-menu-animation.png");s_oSpriteLibrary.addSprite("bg_game","./sprites/bg_game.jpg");s_oSpriteLibrary.addSprite("cursor_help","./sprites/cursor_help.png");s_oSpriteLibrary.addSprite("but_exit","./sprites/but_exit.png");s_oSpriteLibrary.addSprite("but_restart","./sprites/but_restart.png");s_oSpriteLibrary.addSprite("audio_icon","./sprites/audio_icon.png");s_oSpriteLibrary.addSprite("but_next","./sprites/but_next.png");s_oSpriteLibrary.addSprite("level_sprite",
"./sprites/LevelSprite.png");s_oSpriteLibrary.addSprite("target","./sprites/target.png");s_oSpriteLibrary.addSprite("ball_0","./sprites/ball_0.png");s_oSpriteLibrary.addSprite("ball_1","./sprites/ball_1.png");s_oSpriteLibrary.addSprite("player","./sprites/player.png");s_oSpriteLibrary.addSprite("object_to_pick","./sprites/object_to_pick.png");s_oSpriteLibrary.addSprite("rectangle_0","./sprites/rectangle_0.png");s_oSpriteLibrary.addSprite("rectangle_1","./sprites/rectangle_1.png");s_oSpriteLibrary.addSprite("rectangle_2",
"./sprites/rectangle_2.png");s_oSpriteLibrary.addSprite("rectangle_3","./sprites/rectangle_3.png");s_oSpriteLibrary.addSprite("revolute_rectangle_0","./sprites/revolute_rectangle_0.png");s_oSpriteLibrary.addSprite("revolute_rectangle_1","./sprites/revolute_rectangle_1.png");s_oSpriteLibrary.addSprite("unhappy","./sprites/player_unhappy.png");s_oSpriteLibrary.addSprite("almost_happy","./sprites/player_almost_happy.png");s_oSpriteLibrary.addSprite("happy","./sprites/player_happy.png");s_oSpriteLibrary.addSprite("logo_credits",
"./sprites/logo_credits.png");s_oSpriteLibrary.addSprite("but_credits","./sprites/but_info.png");s_oSpriteLibrary.addSprite("wall","./sprites/wall.png");s_oSpriteLibrary.addSprite("basket_back","./sprites/basket_back.png");s_oSpriteLibrary.addSprite("basket_front","./sprites/basket_front.png");s_oSpriteLibrary.addSprite("multiplier_25","./sprites/multiplier_25.png");s_oSpriteLibrary.addSprite("multiplier_50","./sprites/multiplier_50.png");s_oSpriteLibrary.addSprite("multiplier_100","./sprites/multiplier_100.png");
d+=s_oSpriteLibrary.getNumSprites();s_oSpriteLibrary.loadSprites()};this._onImagesLoaded=function(){f++;p.refreshLoader(Math.floor(f/d*100));if(f===d){p.unload();if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)s_oSoundtrack=createjs.Sound.play("soundtrack",{loop:-1});this.gotoMenu()}};this._onAllImagesLoaded=function(){};this.onAllPreloaderImagesLoaded=function(){this._loadImages()};this.gotoMenu=function(){new CMenu;e=STATE_MENU};this.gotoGame=function(a){b=new CGame(k,a);e=STATE_GAME};this.gotoLevelMenu=
function(){new CLevelMenu;e=STATE_MENU};this.gotoHelp=function(){new CHelp;e=STATE_HELP};this.stopUpdate=function(){l=!1;createjs.Ticker.paused=!0;$("#block_game").css("display","block")};this.startUpdate=function(){s_iPrevTime=(new Date).getTime();l=!0;createjs.Ticker.paused=!1;$("#block_game").css("display","none")};this._update=function(a){if(!1!==l){var d=(new Date).getTime();s_iTimeElaps=d-s_iPrevTime;s_iCntTime+=s_iTimeElaps;s_iCntFps++;s_iPrevTime=d;1E3<=s_iCntTime&&(s_iCurFps=s_iCntFps,s_iCntTime-=
1E3,s_iCntFps=0);e===STATE_GAME&&b.update();s_oStage.update(a)}};s_oMain=this;k=a;this.initContainer()}var s_bMobile,s_bAudioActive=!0,s_iCntTime=0,s_iTimeElaps=0,s_iPrevTime=0,s_iCntFps=0,s_iCurFps=0,s_oPhysicsController,s_iLevelReached=1,s_aScores=[0,0,0,0,0,0,0,0,0,0],s_oRollingTextManager,s_oDrawLayer,s_oStage,s_oMain,s_oSpriteLibrary,s_oSoundPlayerDead,s_oSoundtrack,s_oCanvas;
(function(a){(jQuery.browser=jQuery.browser||{}).mobile=/android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(ad|hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|tablet|treo|up\.(browser|link)|vodafone|wap|webos|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(a.substr(0,
4))})(navigator.userAgent||navigator.vendor||window.opera);function trace(a){console.log(a)}function isIOS(){for(var a="iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";");a.length;)if(navigator.platform===a.pop())return s_bIsIphone=!0;return s_bIsIphone=!1}function playSound(a,l,f){return!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?createjs.Sound.play(a,{loop:f,volume:l}):null}function stopSound(a){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||a.stop()}
function setVolume(a,l){if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)a.volume=l}function setMute(a,l){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||a.setMute(l)}$(window).resize(function(){sizeHandler()});
function getSize(a){var l=a.toLowerCase(),f=window.document,d=f.documentElement;if(void 0===window["inner"+a])a=d["client"+a];else if(window["inner"+a]!=d["client"+a]){var e=f.createElement("body");e.id="vpw-test-b";e.style.cssText="overflow:scroll";var k=f.createElement("div");k.id="vpw-test-d";k.style.cssText="position:absolute;top:-1000px";k.innerHTML="<style>@media("+l+":"+d["client"+a]+"px){body#vpw-test-b div#vpw-test-d{"+l+":7px!important}}</style>";e.appendChild(k);d.insertBefore(e,f.head);
a=7==k["offset"+a]?d["client"+a]:window["inner"+a];d.removeChild(e)}else a=window["inner"+a];return a}window.addEventListener("orientationchange",onOrientationChange);function onOrientationChange(){window.matchMedia("(orientation: portrait)").matches&&sizeHandler();window.matchMedia("(orientation: landscape)").matches&&sizeHandler()}function getIOSWindowHeight(){return document.documentElement.clientWidth/window.innerWidth*window.innerHeight}
function getHeightOfIOSToolbars(){var a=(0===window.orientation?screen.height:screen.width)-getIOSWindowHeight();return 1<a?a:0}
function sizeHandler(){window.scrollTo(0,1);if($("#canvas")){var a;a=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?getIOSWindowHeight():getSize("Height");var l=getSize("Width"),f=Math.min(a/CANVAS_HEIGHT,l/CANVAS_WIDTH),d=CANVAS_WIDTH*f,f=CANVAS_HEIGHT*f,e=0;f<a?(e=a-f,f+=e,d+=CANVAS_WIDTH/CANVAS_HEIGHT*e):d<l&&(e=l-d,d+=e,f+=CANVAS_HEIGHT/CANVAS_WIDTH*e);var e=a/2-f/2,k=l/2-d/2,p=CANVAS_WIDTH/d;if(k*p<-EDGEBOARD_X||e*p<-EDGEBOARD_Y)f=Math.min(a/(CANVAS_HEIGHT-2*EDGEBOARD_Y),l/(CANVAS_WIDTH-2*
EDGEBOARD_X)),d=CANVAS_WIDTH*f,f*=CANVAS_HEIGHT,e=(a-f)/2,k=(l-d)/2,p=CANVAS_WIDTH/d;s_iOffsetX=-1*k*p;s_iOffsetY=-1*e*p;0<=e&&(s_iOffsetY=0);0<=k&&(s_iOffsetX=0);null!==s_oInterface&&s_oInterface.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oMenu&&s_oMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);$("#canvas").css("width",d+"px");$("#canvas").css("height",f+"px");0>e?$("#canvas").css("top",e+"px"):$("#canvas").css("top","0px");$("#canvas").css("left",k+"px")}}
function createBitmap(a,l,f){var d=new createjs.Bitmap(a),e=new createjs.Shape;l&&f?e.graphics.beginFill("#fff").drawRect(0,0,l,f):e.graphics.beginFill("#ff0").drawRect(0,0,a.width,a.height);d.hitArea=e;return d}function createSprite(a,l,f,d,e,k){a=null!==l?new createjs.Sprite(a,l):new createjs.Sprite(a);l=new createjs.Shape;l.graphics.beginFill("#000000").drawRect(-f,-d,e,k);a.hitArea=l;return a}
function randomFloatBetween(a,l,f){"undefined"===typeof f&&(f=2);return parseFloat(Math.min(a+Math.random()*(l-a),l).toFixed(f))}function rotateVector2D(a,l){var f=l.getX()*Math.cos(a)+l.getY()*Math.sin(a),d=l.getX()*-Math.sin(a)+l.getY()*Math.cos(a);l.set(f,d)}function tweenVectorsOnX(a,l,f){return a+f*(l-a)}function shuffle(a){for(var l=a.length,f,d;0!==l;)d=Math.floor(Math.random()*l),--l,f=a[l],a[l]=a[d],a[d]=f;return a}
function bubbleSort(a){var l;do{l=!1;for(var f=0;f<a.length-1;f++)a[f]>a[f+1]&&(l=a[f],a[f]=a[f+1],a[f+1]=l,l=!0)}while(l)}function compare(a,l){return a.index>l.index?-1:a.index<l.index?1:0}function easeLinear(a,l,f,d){return f*a/d+l}function easeInQuad(a,l,f,d){return f*(a/=d)*a+l}function easeInSine(a,l,f,d){return-f*Math.cos(a/d*(Math.PI/2))+f+l}function easeInCubic(a,l,f,d){return f*(a/=d)*a*a+l}
function getTrajectoryPoint(a,l){var f=new createjs.Point,d=(1-a)*(1-a),e=a*a;f.x=d*l.start.x+2*(1-a)*a*l.traj.x+e*l.end.x;f.y=d*l.start.y+2*(1-a)*a*l.traj.y+e*l.end.y;return f}function formatTime(a){a/=1E3;var l=Math.floor(a/60);a=Math.floor(a-60*l);var f="",f=10>l?f+("0"+l+":"):f+(l+":");return 10>a?f+("0"+a):f+a}function degreesToRadians(a){return a*Math.PI/180}function checkRectCollision(a,l){var f,d;f=getBounds(a,.9);d=getBounds(l,.98);return calculateIntersection(f,d)}
function calculateIntersection(a,l){var f,d,e,k,p,b,q,n;f=a.x+(e=a.width/2);d=a.y+(k=a.height/2);p=l.x+(b=l.width/2);q=l.y+(n=l.height/2);f=Math.abs(f-p)-(e+b);d=Math.abs(d-q)-(k+n);return 0>f&&0>d?(f=Math.min(Math.min(a.width,l.width),-f),d=Math.min(Math.min(a.height,l.height),-d),{x:Math.max(a.x,l.x),y:Math.max(a.y,l.y),width:f,height:d,rect1:a,rect2:l}):null}
function getBounds(a,l){var f={x:Infinity,y:Infinity,width:0,height:0};if(a instanceof createjs.Container){f.x2=-Infinity;f.y2=-Infinity;var d=a.children,e=d.length,k,p;for(p=0;p<e;p++)k=getBounds(d[p],1),k.x<f.x&&(f.x=k.x),k.y<f.y&&(f.y=k.y),k.x+k.width>f.x2&&(f.x2=k.x+k.width),k.y+k.height>f.y2&&(f.y2=k.y+k.height);Infinity==f.x&&(f.x=0);Infinity==f.y&&(f.y=0);Infinity==f.x2&&(f.x2=0);Infinity==f.y2&&(f.y2=0);f.width=f.x2-f.x;f.height=f.y2-f.y;delete f.x2;delete f.y2}else{var b,q;a instanceof createjs.Bitmap?
(e=a.sourceRect||a.image,p=e.width*l,b=e.height*l):a instanceof createjs.Sprite?a.spriteSheet._frames&&a.spriteSheet._frames[a.currentFrame]&&a.spriteSheet._frames[a.currentFrame].image?(e=a.spriteSheet.getFrame(a.currentFrame),p=e.rect.width,b=e.rect.height,d=e.regX,q=e.regY):(f.x=a.x||0,f.y=a.y||0):(f.x=a.x||0,f.y=a.y||0);d=d||0;p=p||0;q=q||0;b=b||0;f.regX=d;f.regY=q;e=a.localToGlobal(0-d,0-q);k=a.localToGlobal(p-d,b-q);p=a.localToGlobal(p-d,0-q);d=a.localToGlobal(0-d,b-q);f.x=Math.min(Math.min(Math.min(e.x,
k.x),p.x),d.x);f.y=Math.min(Math.min(Math.min(e.y,k.y),p.y),d.y);f.width=Math.max(Math.max(Math.max(e.x,k.x),p.x),d.x)-f.x;f.height=Math.max(Math.max(Math.max(e.y,k.y),p.y),d.y)-f.y}return f}function NoClickDelay(a){this.element=a;window.Touch&&this.element.addEventListener("touchstart",this,!1)}function shuffle(a){for(var l=a.length,f,d;0<l;)d=Math.floor(Math.random()*l),l--,f=a[l],a[l]=a[d],a[d]=f;return a}
NoClickDelay.prototype={handleEvent:function(a){switch(a.type){case "touchstart":this.onTouchStart(a);break;case "touchmove":this.onTouchMove(a);break;case "touchend":this.onTouchEnd(a)}},onTouchStart:function(a){a.preventDefault();this.moved=!1;this.element.addEventListener("touchmove",this,!1);this.element.addEventListener("touchend",this,!1)},onTouchMove:function(a){this.moved=!0},onTouchEnd:function(a){this.element.removeEventListener("touchmove",this,!1);this.element.removeEventListener("touchend",
this,!1);if(!this.moved){a=document.elementFromPoint(a.changedTouches[0].clientX,a.changedTouches[0].clientY);3==a.nodeType&&(a=a.parentNode);var l=document.createEvent("MouseEvents");l.initEvent("click",!0,!0);a.dispatchEvent(l)}}};
(function(){function a(a){var d={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};a=a||window.event;a.type in d?document.body.className=d[a.type]:(document.body.className=this[l]?"hidden":"visible","hidden"===document.body.className?s_oMain.stopUpdate():s_oMain.startUpdate())}var l="hidden";l in document?document.addEventListener("visibilitychange",a):(l="mozHidden")in document?document.addEventListener("mozvisibilitychange",a):(l="webkitHidden")in
document?document.addEventListener("webkitvisibilitychange",a):(l="msHidden")in document?document.addEventListener("msvisibilitychange",a):"onfocusin"in document?document.onfocusin=document.onfocusout=a:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=a})();function ctlArcadeResume(){null!==s_oMain&&s_oMain.startUpdate()}function ctlArcadePause(){null!==s_oMain&&s_oMain.stopUpdate()}
function getParamValue(a){for(var l=window.location.search.substring(1).split("&"),f=0;f<l.length;f++){var d=l[f].split("=");if(d[0]==a)return d[1]}}
function CSpriteLibrary(){var a,l,f,d,e,k;this.init=function(p,b,q){f=l=0;d=p;e=b;k=q;a={}};this.addSprite=function(d,b){a.hasOwnProperty(d)||(a[d]={szPath:b,oSprite:new Image},l++)};this.getSprite=function(d){return a.hasOwnProperty(d)?a[d].oSprite:null};this._onSpritesLoaded=function(){e.call(k)};this._onSpriteLoaded=function(){d.call(k);++f==l&&this._onSpritesLoaded()};this.loadSprites=function(){for(var d in a)a[d].oSprite.oSpriteLibrary=this,a[d].oSprite.onload=function(){this.oSpriteLibrary._onSpriteLoaded()},
a[d].oSprite.src=a[d].szPath};this.getNumSprites=function(){return l}}
var CANVAS_WIDTH=640,CANVAS_HEIGHT=960,FONT="survivantregular",EDGEBOARD_X=20,EDGEBOARD_Y=95,FPS=30,FPS_TIME=1E3/FPS,DISABLE_SOUND_MOBILE=!1,LEVEL_NUM=10,WORLD_SCALE=100,BASKET_Y=CANVAS_HEIGHT-135,DISTANCE_BEETWEEN_BASKETS=120,BASKETS_X_START=82,NUM_OBJ_TO_PICK_IN_ROW=6,EPSILON=1E-5,WALL=0,CIRCLE=1,RECTANGLE=2,RECTANGLE_MOVING=3,REVOLUTE_RECTANGLE=4,REVOLUTE_RECTANGLE_MOVING=5,PARTICULAR_REVOLUTE_RECTANGLE=6,BASKET=0,CONFIRMATION_EXIT=0,CONFIRMATION_RESET=1,POLIGON_POINTS=[];
POLIGON_POINTS.push([{x:"-20.5000",y:"15.0000"},{x:"-39.5000",y:"11.0000"},{x:"-57.5000",y:"-57.0000"},{x:"-35.5000",y:"-50.0000"}]);POLIGON_POINTS.push([{x:"59.0000",y:"-57.0000"},{x:"40.5000",y:"12.0000"},{x:"22.5000",y:"12.0000"},{x:"32.5000",y:"-50.0000"}]);
var STATE_LOADING=0,STATE_MENU=1,STATE_HELP=1,STATE_GAME=3,ON_MOUSE_DOWN=0,ON_MOUSE_UP=1,ON_MOUSE_OVER=2,ON_MOUSE_OUT=3,ON_DRAG_START=4,ON_DRAG_END=5,ON_BUT_NO_DOWN=6,ON_BUT_YES_DOWN=7,ON_CONTROLLER_END=8,ON_CONTROLLER_REMOVE=9,ON_TWEEN_ENDED=10;TEXT_LEVEL="SELECT LEVEL";TEXT_RESET="ARE YOU SURE? ALL YOUR PREVIOUS SCORES WILL BE DELETED!";TEXT_EXIT="ARE YOU SURE?";TEXT_CREDITS_DEVELOPED="Developed by";TEXT_LINK1="www.codethislab.com";TEXT_GAMEOVER="GAME OVER";TEXT_SCORE="YOUR SCORE IS: ";
TEXT_PAUSE="PAUSE";TEXT_HELP_PANEL_MOVE="MOVE YOUR SQUIRREL ON THE LEFT OR THE RIGHT OF THE SCREEN";TEXT_HELP_PANEL_RELEASE="THEN DROP IT TO COLLECT AS MANY POINTS AND ACORNS TO REACH THE TARGET";TEXT_LEVEL_COMPLETED="LEVEL COMPLETED!";TEXT_SHARE_IMAGE="200x200.jpg";TEXT_SHARE_TITLE="Congratulations!";TEXT_SHARE_MSG1="You collected <strong>";TEXT_SHARE_MSG2=" points</strong>!<br><br>Share your score with your friends!";TEXT_SHARE_SHARE1="My score is ";TEXT_SHARE_SHARE2=" points! Can you do better?";
function CPreloader(){var a,l,f,d,e,k,p;this._init=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("bg_preloader","./sprites/bg_preloader.jpg");s_oSpriteLibrary.addSprite("progress_bar","./sprites/progress_bar.png");s_oSpriteLibrary.loadSprites();p=new createjs.Container;s_oStage.addChild(p)};this.unload=function(){p.removeAllChildren()};this.hide=function(){var b=this;setTimeout(function(){createjs.Tween.get(k).to({alpha:1},500).call(function(){b.unload();
s_oMain.gotoMenu()})},1E3)};this._onImagesLoaded=function(){};this._onAllImagesLoaded=function(){this.attachSprites();s_oMain.preloaderReady()};this.attachSprites=function(){var b=createBitmap(s_oSpriteLibrary.getSprite("bg_preloader"));p.addChild(b);b=s_oSpriteLibrary.getSprite("progress_bar");d=createBitmap(b);d.x=CANVAS_WIDTH/2-b.width/2;d.y=CANVAS_HEIGHT-150;p.addChild(d);a=b.width;l=b.height;e=new createjs.Shape;e.graphics.beginFill("rgba(255,255,255,0.01)").drawRect(d.x,d.y,1,l);p.addChild(e);
d.mask=e;f=new createjs.Text("","30px "+FONT,"#fff");f.x=CANVAS_WIDTH/2;f.y=CANVAS_HEIGHT-150;f.shadow=new createjs.Shadow("#000",2,2,2);f.textBaseline="alphabetic";f.textAlign="center";p.addChild(f);k=new createjs.Shape;k.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);k.alpha=0;p.addChild(k)};this.refreshLoader=function(b){f.text=b+"%";e.graphics.clear();b=Math.floor(b*a/100);e.graphics.beginFill("rgba(255,255,255,0.01)").drawRect(d.x,d.y,b,l)};this._init()}
function CToggle(a,l,f,d,e){var k=e,p,b,q,n=[],z;this._init=function(a,d,e,f){b=[];q=[];var l=new createjs.SpriteSheet({images:[e],frames:{width:e.width/2,height:e.height,regX:e.width/2/2,regY:e.height/2},animations:{state_true:[0],state_false:[1]}});p=f;z=createSprite(l,"state_"+p,e.width/2/2,e.height/2,e.width/2,e.height);z.x=a;z.y=d;z.stop();z.cursor="pointer";k||(k=s_oStage);k.addChild(z);this._initListener()};this.unload=function(){z.off("mousedown",this.buttonDown);z.off("pressup",this.buttonRelease);
k.removeChild(z)};this._initListener=function(){z.on("mousedown",this.buttonDown);z.on("pressup",this.buttonRelease)};this.addEventListener=function(a,d,e){b[a]=d;q[a]=e};this.addEventListenerWithParams=function(a,d,e,k){b[a]=d;q[a]=e;n=k};this.setActive=function(b){p=b;z.gotoAndStop("state_"+p)};this.buttonRelease=function(){z.scaleX=1;z.scaleY=1;!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||createjs.Sound.play("click");p=!p;z.gotoAndStop("state_"+p);b[ON_MOUSE_UP]&&b[ON_MOUSE_UP].call(q[ON_MOUSE_UP],
n)};this.buttonDown=function(){z.scaleX=.9;z.scaleY=.9;playSound("press_button",1,0);b[ON_MOUSE_DOWN]&&b[ON_MOUSE_DOWN].call(q[ON_MOUSE_DOWN],n)};this.setPosition=function(b,a){z.x=b;z.y=a};this.setVisible=function(b){z.visible=b};this._init(a,l,f,d)}
function CGfxButton(a,l,f,d){var e,k=d,p,b,q=[],n,z=null,u=this;this._init=function(a,d,f){e=1;p=[];b=[];n=createBitmap(f);n.x=a;n.y=d;n.regX=f.width/2;n.regY=f.height/2;n.cursor="pointer";k||(k=s_oStage);k.addChild(n);this._initListener()};this.unload=function(){n.off("mousedown",this.buttonDown);n.off("pressup",this.buttonRelease);z&&createjs.Tween.removeTweens(z);k.removeChild(n)};this.setVisible=function(b){n.visible=b};this._initListener=function(){n.on("mousedown",this.buttonDown);n.on("pressup",
this.buttonRelease)};this.addEventListener=function(a,d,e){p[a]=d;b[a]=e};this.addEventListenerWithParams=function(a,d,e,k){p[a]=d;b[a]=e;q=k};this.buttonRelease=function(){n.scaleX=e;n.scaleY=e;p[ON_MOUSE_UP]&&p[ON_MOUSE_UP].call(b[ON_MOUSE_UP],q)};this.buttonDown=function(){n.scaleX=.9*e;n.scaleY=.9*e;playSound("press_button",1,0);p[ON_MOUSE_DOWN]&&p[ON_MOUSE_DOWN].call(b[ON_MOUSE_DOWN],q)};this.setScale=function(b){e=b;n.scaleX=b;n.scaleY=b};this.setPosition=function(b,a){n.x=b;n.y=a};this.moveInPosition=
function(b,a){createjs.Tween.get(n).to({x:b,y:a},1E3,createjs.Ease.quadOut).call(function(){})};this.setX=function(b){n.x=b};this.setY=function(b){n.y=b};this.getButtonImage=function(){return n};this.pulseAnimation=function(){z=createjs.Tween.get(n).to({scaleX:.9*e,scaleY:.9*e},850,createjs.Ease.quadOut).to({scaleX:e,scaleY:e},650,createjs.Ease.quadIn).call(function(){u.pulseAnimation()})};this.trebleAnimation=function(){z=createjs.Tween.get(n).to({rotation:5},75,createjs.Ease.quadOut).to({rotation:-5},
140,createjs.Ease.quadIn).to({rotation:0},75,createjs.Ease.quadIn).wait(750).call(function(){u.trebleAnimation()})};this.getX=function(){return n.x};this.getY=function(){return n.y};this._init(a,l,f);return this}
function CMenu(){var a,l,f,d,e,k=null,p,b,q,n,z,u,x=[];this._init=function(){setVolume(s_oSoundtrack,1);p=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));s_oStage.addChild(p);null!==localStorage.getItem("LevelReached")&&(s_iLevelReached=localStorage.getItem("LevelReached"),s_aScores=JSON.parse(localStorage.getItem("Scores")));if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile){var b=s_oSpriteLibrary.getSprite("audio_icon");f=CANVAS_WIDTH-b.height/2-10;d=b.height/2+10;z=new CToggle(f,d,b,s_bAudioActive);
z.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this)}b=s_oSpriteLibrary.getSprite("but_credits");a=b.height/2+10;l=b.height/2+10;u=new CGfxButton(a,l,b);u.addEventListener(ON_MOUSE_UP,this._onCredits,this);for(b=1;22>b;b++)x.push(createBitmap(s_oSpriteLibrary.getSprite("bg_menu_animation_"+b))),s_oStage.addChild(x[b-1]),x[b-1].visible=!1;this.playAnimation(0);n=new createjs.Shape;n.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(n);createjs.Tween.get(n).to({alpha:0},
1E3).call(function(){n.visible=!1});this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.playAnimation=function(a){if(0===a)if(x[a].visible=!0,null===localStorage.getItem("LevelReached")){var d=s_oSpriteLibrary.getSprite("but_play");b=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT+100,d);b.moveInPosition(CANVAS_WIDTH/2,CANVAS_HEIGHT-225);b.addEventListener(ON_MOUSE_UP,this._onButPlayRelease,this);b.pulseAnimation()}else d=s_oSpriteLibrary.getSprite("but_play"),b=new CGfxButton(CANVAS_WIDTH/2-125,CANVAS_HEIGHT+
100,d),b.moveInPosition(CANVAS_WIDTH/2-125,CANVAS_HEIGHT-225),b.addEventListener(ON_MOUSE_UP,this._onButPlayRelease,this),d=s_oSpriteLibrary.getSprite("but_continue"),q=new CGfxButton(CANVAS_WIDTH/2+125,CANVAS_HEIGHT+100,d),q.moveInPosition(CANVAS_WIDTH/2+125,CANVAS_HEIGHT-225),q.addEventListener(ON_MOUSE_UP,this._onButContinueRelease,this),q.pulseAnimation();0<a&&(x[a-1].visible=!1,x[a].visible=!0);a<x.length-1&&(e=setTimeout(function(){s_oMenu.playAnimation(a+1)},100))};this.unload=function(){b.unload();
q&&q.unload();b=null;n.visible=!1;clearTimeout(e);if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)z.unload(),z=null;s_oStage.removeAllChildren();s_oMenu=null};this.refreshButtonPos=function(b,e){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||z.setPosition(f-b,e+d);u.setPosition(a+b,e+l)};this._onAudioToggle=function(){createjs.Sound.setMute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onButPlayRelease=function(){$(s_oMain).trigger("start_session");null===localStorage.getItem("LevelReached")?(this.unload(),
s_oMain.gotoLevelMenu()):null===k&&(k=new CConfirmPanel(TEXT_RESET,CONFIRMATION_RESET),k.addEventListener(ON_BUT_NO_DOWN,this._onButReset,this),k.addEventListener(ON_BUT_YES_DOWN,this._onButContinue,this))};this._onCredits=function(){new CCreditsPanel};this._onButReset=function(){k.unload();k=null};this._onButContinue=function(){this.removeLocalStorage();this.unload();s_oMain.gotoLevelMenu()};this._onButContinueRelease=function(){this.unload();s_oMain.gotoLevelMenu()};this.unloadVariousHelp=function(){k.unload();
k=null};this.removeLocalStorage=function(){localStorage.removeItem("LevelReached");localStorage.removeItem("Scores");s_iLevelReached=1;s_aScores=[0,0,0,0,0,0,0,0,0,0]};s_oMenu=this;this._init()}var s_oMenu=null;
function CTextButton(a,l,f,d,e,k,p){var b,q,n,z,u;this._init=function(a,d,e,k,h,f,l){b=[];q=[];var p=createBitmap(e),H=Math.ceil(l/20);u=new createjs.Text(k,"bold "+l+"px "+h,"#000000");u.textAlign="center";u.textBaseline="alphabetic";var M=u.getBounds();u.x=e.width/2+H;u.y=Math.floor(e.height/2)+M.height/3+H;z=new createjs.Text(k,"bold "+l+"px "+h,f);z.textAlign="center";z.textBaseline="alphabetic";M=z.getBounds();z.x=e.width/2;z.y=Math.floor(e.height/2)+M.height/3;n=new createjs.Container;n.x=a;
n.y=d;n.regX=e.width/2;n.regY=e.height/2;n.addChild(p,u,z);s_oStage.addChild(n);this._initListener()};this.unload=function(){n.off("mousedown");n.off("pressup");s_oStage.removeChild(n)};this.setVisible=function(b){n.visible=b};this._initListener=function(){oParent=this;n.on("mousedown",this.buttonDown);n.on("pressup",this.buttonRelease)};this.addEventListener=function(a,d,e){b[a]=d;q[a]=e};this.buttonRelease=function(){n.scaleX=1;n.scaleY=1;b[ON_MOUSE_UP]&&b[ON_MOUSE_UP].call(q[ON_MOUSE_UP])};this.buttonDown=
function(){n.scaleX=.9;n.scaleY=.9;b[ON_MOUSE_DOWN]&&b[ON_MOUSE_DOWN].call(q[ON_MOUSE_DOWN])};this.setTextPosition=function(b){z.y=b;u.y=b+2};this.setPosition=function(b,a){n.x=b;n.y=a};this.setX=function(b){n.x=b};this.setY=function(b){n.y=b};this.getButtonImage=function(){return n};this.getX=function(){return n.x};this.getY=function(){return n.y};this._init(a,l,f,d,e,k,p);return this}
function CGame(a,l){var f=0,d=0,e=0,k=0,p=0,b=0,q=0,n,z=null,u=this,x,v,B,A,h,E,I,N=!1,H=!1,M=!1,G=!1,Q=[],J=[],K=[],R=[],O=[],g=[],r=[],w=[],t=[],F=[],L=[],C=[],c=[],m=[],y=[],D=[],P=[],S=[],U,T;this._init=function(){for(var c=0;c<s_aScores.length;c++)c!==l&&(f+=s_aScores[c]);$(s_oMain).trigger("start_level",l);setVolume(s_oSoundtrack,1);h=new createjs.Container;s_oStage.addChild(h);A=createBitmap(s_oSpriteLibrary.getSprite("curtain_bg"));A.alpha=0;s_oStage.addChild(A);B=createBitmap(s_oSpriteLibrary.getSprite("curtain"));
B.y=CANVAS_HEIGHT;s_oStage.addChild(B);createjs.Tween.get(B).to({y:0},1E3,createjs.Ease.backOut).wait(400).call(function(){u._levelInit();createjs.Tween.get(B).to({y:CANVAS_HEIGHT},500,createjs.Ease.backIn).call(function(){u._removeCurtain()})});createjs.Tween.get(A).to({alpha:1},1E3,createjs.Ease.backOut).wait(400).call(function(){createjs.Tween.get(A).to({alpha:0},500,createjs.Ease.backIn).call(function(){})})};this._levelInit=function(){var c=createBitmap(s_oSpriteLibrary.getSprite("bg_game"));
h.addChild(c);s_oPhysicsController=new CPhysicsController;T=new CPhysicsObject;U=LEVELS;k=U[l].num_balls;b=U[l].objects_to_pick_to_win;for(c=0;c<U[l].objects.length;c++){var D=U[l].objects[c];switch(D.type){case WALL:this._createParticleWall(D.x,D.y,D.wall_type,D.angle,D.density,D.friction,D.restitution);break;case CIRCLE:this._createCircle(s_oSpriteLibrary.getSprite("ball_"+D.sprite),D.x,D.y,D.density,D.friction,D.restitution,!1);break;case RECTANGLE:this._createRectangle(s_oSpriteLibrary.getSprite("rectangle_"+
D.sprite),D.x,D.y,D.angle,D.density,D.friction,D.restitution);0===D.sprite&&this._createCircle(s_oSpriteLibrary.getSprite("rectangle_"+D.sprite),D.x,D.y,D.density,D.friction,D.restitution,!0);break;case RECTANGLE_MOVING:this._createMovingRectangle(s_oSpriteLibrary.getSprite("rectangle_"+D.sprite),D.x,D.y,D.angle,D.density,D.friction,D.restitution);break;case REVOLUTE_RECTANGLE:this._createRevoluteRectangle(s_oSpriteLibrary.getSprite("revolute_rectangle_"+D.sprite),D.x,D.y,D.density,D.friction,D.restitution);
break;case REVOLUTE_RECTANGLE_MOVING:this._createMovingRevoluteRectangle(s_oSpriteLibrary.getSprite("revolute_rectangle_"+D.sprite),D.x,D.y,D.density,D.friction,D.restitution)}}this._spawnWall(-77,CANVAS_HEIGHT/2,0,3,10,.3);this._spawnWall(CANVAS_WIDTH+77,CANVAS_HEIGHT/2,0,3,10,.3);this._spawnWall(CANVAS_WIDTH/2,CANVAS_HEIGHT-28,90,3,10,.3);this._spawnObjectsToPick(U[l].objectsToPick);this._spawnBasketsBack();E=new createjs.Container;h.addChild(E);v=new CPlayer(s_oSpriteLibrary.getSprite("player"),
300,250,3,10,.3,E,T);I=new createjs.Container;h.addChild(I);this._spawnBasketsFront();n=new CInterface(b,f,k,l+1,h);x=new createjs.Shape;x.graphics.beginFill("White").drawRect(0,160,CANVAS_WIDTH,CANVAS_HEIGHT-160);x.alpha=.01;h.addChild(x);s_oStage.on("stagemousemove",this._movingMouse);setTimeout(function(){x.on("pressup",u._onClick)},200);N=!0};this._removeCurtain=function(){s_oStage.removeChild(B);s_oStage.removeChild(A)};this._movingMouse=function(c){p=c.stageX;H||35<p&&p<CANVAS_WIDTH-35&&v.movePlayer(c.stageX)};
this._onClick=function(c){H||(p=c.stageX,v.movePlayer(c.stageX),v.activatePlayer(),H=!0)};this._spawnWall=function(c,D,m,g,P,b){var t=s_oSpriteLibrary.getSprite("wall");r.push(T.addWall(t.width/2,t.height/2,c,D,m,g,P,b));g=createBitmap(t);g.x=c;g.y=D;g.rotation=m;g.regX=t.width/2;g.regY=t.height/2;h.addChild(g)};this._spawnBasketsBack=function(){for(var c=BASKETS_X_START,D=BASKET_Y,m=0;5>m;m++)P.push(new CBasket(c,D,h)),c+=DISTANCE_BEETWEEN_BASKETS};this._spawnBasketsFront=function(){for(var c=0;5>
c;c++){P[c].spawnFront();var D=0,D=0===c||4===c?25:1===c||3===c?50:100;P[c].setMultiplier(D,I);P[c].spawnBasketMultiplier(D)}};this._spawnObjectsToPick=function(c){for(var D=0;D<c.length;D++)S.push(new CObjectToPick(c[D].x,c[D].y,c[D].type,h))};this._createCircle=function(c,D,m,g,P,b,h){h?w.push(T.addStaticCircle(c.height/2,D,m-c.width/2,g,P,b)):w.push(T.addStaticCircle(c.width/2,D,m,g,P,b));D=s_oPhysicsController.getElementPosition(w[w.length-1]);h||(t.push(createBitmap(c)),this.addObjectToStage(t,
t.length-1,D,c))};this._createRectangle=function(c,D,m,g,P,b,r){F.push(T.addRectangle(c.width/2,c.height/2,D,m,g,P,b,r));D=s_oPhysicsController.getElementPosition(F[F.length-1]);m=createBitmap(c);m.x=D.x;m.y=D.y;m.rotation=D.angle;m.regX=c.width/2;m.regY=c.height/2;h.addChild(m)};this._createMovingRectangle=function(c,D,g,P,b,h){L.push(T.addRectangle(c.width/2,c.height/2,D,g,P,b,h));D=s_oPhysicsController.getElementPosition(L[L.length-1]);O.push(c.width/2);K.push(D.x);J.push(!1);1===Math.round(Math.random())?
J.push(!0):J.push(!1);m.push(createBitmap(c));this.addObjectToStage(m,m.length-1,D,c)};this._createRevoluteRectangle=function(c,D,m,g,P,b){C.push(T.addRevoluteRectangle(c.width/2,c.height/2,D,m,g,P,b,!1));D=s_oPhysicsController.getElementPosition(C[C.length-1].fixture1);y.push(createBitmap(c));this.addObjectToStage(y,y.length-1,D,c)};this._createMovingRevoluteRectangle=function(m,P,b,h,r,t){c.push(T.addRevoluteRectangle(m.width/2,m.height/2,P,b,h,r,t,!0));P=s_oPhysicsController.getElementPosition(c[c.length-
1].fixture2);g.push(m.width/2);R.push(P.x);1===Math.round(Math.random())?Q.push(!0):Q.push(!1);D.push(createBitmap(m));this.addObjectToStage(D,D.length-1,P,m)};this.addObjectToStage=function(c,D,m,g){c[D].x=m.x;c[D].y=m.y;c[D].rotation=m.angle;c[D].regX=g.width/2;c[D].regY=g.height/2;h.addChild(c[D])};this.removeObject=function(c){c<S.length-1?S.splice(c,1):S.pop();b<=q&&(G=!0)};this.moveBasket=function(){for(var c=s_oSpriteLibrary.getSprite("basket_front"),D=v.getX(),m=0;5>=m;m++)D<BASKETS_X_START+
m*DISTANCE_BEETWEEN_BASKETS+c.width/2&&D>BASKETS_X_START+m*DISTANCE_BEETWEEN_BASKETS-c.width/2&&(P[m].applyTremble(),m=10)};this.checkInWichBasketBallHasFallen=function(){for(var c=s_oSpriteLibrary.getSprite("basket_front"),D=v.getX(),m=0;5>=m;m++)if(D<BASKETS_X_START+m*DISTANCE_BEETWEEN_BASKETS+c.width/2&&D>BASKETS_X_START+m*DISTANCE_BEETWEEN_BASKETS-c.width/2){P[m].applyScaleMultiplier();c=d*P[m].getMultiplier();e+=c;n.refreshScore(c);d=0;break}};this._checkIfPlayerHasStopped=function(){v.checkIfPlayerHasStopped(H)&&
(v.unload(),0<k&&k--,n.refrashNumPlayerLeft(k),M||this.checkInWichBasketBallHasFallen(),0<k?(v=new CPlayer(s_oSpriteLibrary.getSprite("player"),p,250,3,1,.5,E,T),H=!1):M||(G?setTimeout(function(){u.allObjectsTaken()},500):setTimeout(function(){u.gameOver()},500),M=!0))};this._checkIfPlayerHasCollidedWithObjectToPick=function(){for(var c=v.getRectangle(),D=0;D<S.length;D++)S[D].checkIfPlayerHasCollided(c)&&(q++,d+=1,S[D].addEventListenerWithParams(ON_TWEEN_ENDED,this.refreshScoreInfos,this,q),S[D].moveToGUI(n.getTargetY()),
this.removeObject(D),D=S.length,playSound("pick_object"))};this.refreshScoreInfos=function(c){n.refreshGoal(c,b);n.applyScaleToTarget(c,b)};this._moveRectangle=function(){for(var c=0;c<L.length;c++){var D=s_oPhysicsController.getElementPosition(L[c]);m[c].x=D.x;var g=0;J[c]?(g=D.x+1,D.x>K[c]+O[c]&&(J[c]=!1)):(g=D.x-1,D.x<K[c]-O[c]&&(J[c]=!0));s_oPhysicsController.moveObject(L[c],g,D.y)}};this._rotateRevoluteRectangle=function(){for(var c=0;c<C.length;c++){var D=s_oPhysicsController.getElementAngle(C[c].fixture1);
y[c].rotation=D;s_oPhysicsController.decreaseSpeedRotation(C[c].fixture1)}};this._moveRevoluteRectangle=function(){for(var m=0;m<c.length;m++){var P=s_oPhysicsController.getElementPosition(c[m].fixture2),b=s_oPhysicsController.getElementAngle(c[m].fixture1);D[m].x=P.x;D[m].rotation=b;b=0;Q[m]?(b=P.x+1,P.x>R[m]+g[m]&&(Q[m]=!1)):(b=P.x-1,P.x<R[m]-g[m]&&(Q[m]=!0));3<s_oPhysicsController.getSpeedRotation(c[m].fixture1)&&s_oPhysicsController.decreaseSpeedRotation(c[m].fixture1);s_oPhysicsController.moveObject(c[m].fixture2,
b,P.y)}};this.unload=function(){n.unload();createjs.Tween.removeAllTweens();s_oStage.removeAllChildren()};this.onExit=function(){this.unload();s_oMain.gotoMenu();$(s_oMain).trigger("end_level",l);$(s_oMain).trigger("show_interlevel_ad");$(s_oMain).trigger("end_session")};this.onRestart=function(){this.unload();$(s_oMain).trigger("restart_level",l);s_oMain.gotoGame(l)};this.gameOver=function(){z=CEndPanel(s_oSpriteLibrary.getSprite("msg_box_game_over"));z.show(f+e)};this.allObjectsTaken=function(){s_iLevelReached=
l+2;z=CEndPanel(s_oSpriteLibrary.getSprite("msg_box"));z.nextLevel(f+e);e>s_aScores[l]&&(s_aScores[l]=e);localStorage.setItem("LevelReached",s_iLevelReached);localStorage.setItem("Scores",JSON.stringify(s_aScores))};this.onNextLevel=function(){this.unload();l+1<U.length?s_oMain.gotoGame(l+1):s_oMain.gotoMenu()};this.update=function(){N&&(v.refreshPosition(),this._checkIfPlayerHasCollidedWithObjectToPick(),this._checkIfPlayerHasStopped(),this._rotateRevoluteRectangle(),this._moveRevoluteRectangle(),
this._moveRectangle(),s_oPhysicsController.update(),s_oRollingTextManager.update())};s_oGame=this;LEVELS=a.levels;u=this;this._init()}var s_oGame;
function CInterface(a,l,f,d,e){var k,p,b,q,n,z,u,x=null,v=!1,B=CANVAS_WIDTH-115,A,h=CANVAS_WIDTH/2-263,E,I,N=CANVAS_WIDTH/2-240,H,M,G=CANVAS_WIDTH-300,Q=CANVAS_HEIGHT-8,J,K,R=CANVAS_WIDTH-150,O=CANVAS_HEIGHT-8,g,r=CANVAS_WIDTH/2-280,w,t,F=CANVAS_WIDTH/2-240,L,C,c=CANVAS_HEIGHT-8;this._init=function(m,y,D,P){var S=s_oSpriteLibrary.getSprite("but_exit");b=CANVAS_WIDTH-S.width/2-10;q=S.height/2+10;z=new CGfxButton(b,q,S,e);z.addEventListener(ON_MOUSE_UP,this._showConfirmPanelOnExit,this);S=s_oSpriteLibrary.getSprite("but_restart");
u=new CGfxButton(B,45,S,e);u.addEventListener(ON_MOUSE_UP,this._showConfirmPanelOnRestart,this);k=B-70;p=S.height/2+10;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)S=s_oSpriteLibrary.getSprite("audio_icon"),n=new CToggle(k,p,S,s_bAudioActive,e),n.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);S=s_oSpriteLibrary.getSprite("target");A=createBitmap(S);A.x=h;A.y=42;A.regX=S.width/2;A.regY=S.height/2;A.scaleX=A.scaleY=.5;e.addChild(A);I=new createjs.Text("0/"+m," 30px "+FONT,"#000");I.x=N+2;I.y=
50;I.textAlign="left";I.textBaseline="alphabetic";I.lineWidth=650;e.addChild(I);E=new createjs.Text("0/"+m," 30px "+FONT,"#ffc949");E.x=N;E.y=50;E.textAlign="left";E.textBaseline="alphabetic";E.lineWidth=650;e.addChild(E);M=new createjs.Text("SCORE: "," 25px "+FONT,"#000");M.x=G+2;M.y=Q+2;M.textAlign="left";M.textBaseline="alphabetic";M.lineWidth=650;e.addChild(M);H=new createjs.Text("SCORE: "," 25px "+FONT,"#ffc949");H.x=G;H.y=Q;H.textAlign="left";H.textBaseline="alphabetic";H.lineWidth=650;e.addChild(H);
K=new createjs.Text(y," 25px "+FONT,"#000");K.x=R+2;K.y=O+2;K.textAlign="left";K.textBaseline="alphabetic";K.lineWidth=650;e.addChild(K);J=new createjs.Text(y," 25px "+FONT,"#ffc949");J.x=R;J.y=O;J.textAlign="left";J.textBaseline="alphabetic";J.lineWidth=650;e.addChild(J);g=createBitmap(s_oSpriteLibrary.getSprite("player"));g.x=r;g.y=75;e.addChild(g);t=new createjs.Text("x"+D," 30px "+FONT,"#000");t.x=F+2;t.y=100;t.textAlign="left";t.textBaseline="alphabetic";t.lineWidth=650;e.addChild(t);w=new createjs.Text("x"+
D," 30px "+FONT,"#ffc949");w.x=F;w.y=100;w.textAlign="left";w.textBaseline="alphabetic";w.lineWidth=650;e.addChild(w);C=new createjs.Text("Level: "+P," 25px "+FONT,"#000");C.x=62;C.y=c+2;C.textAlign="left";C.textBaseline="alphabetic";C.lineWidth=650;e.addChild(C);L=new createjs.Text("Level: "+P," 25px "+FONT,"#ffc949");L.x=60;L.y=c;L.textAlign="left";L.textBaseline="alphabetic";L.lineWidth=650;e.addChild(L);this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.unload=function(){if(!1===DISABLE_SOUND_MOBILE||
!1===s_bMobile)n.unload(),n=null;z.unload();u.unload();s_oInterface=null};this.applyScaleToTarget=function(){v||(v=!0,createjs.Tween.get(A).to({scaleX:.9,scaleY:.9},200).call(function(){createjs.Tween.get(A).to({scaleX:.5,scaleY:.5},200).call(function(){v=!1})}))};this.refreshButtonPos=function(m,h){z.setPosition(b-m,h+q);u.setPosition(B-m,h+45);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||n.setPosition(k-m,h+p);A.y=42+h;I.y=50+h;E.y=50+h;M.y=Q-h;H.y=Q-h;K.y=O-h;J.y=O-h;g.y=75+h;t.y=100+h;w.y=100+h;
C.y=c-h;L.y=c-h};this.refreshGoal=function(c,g){I.text=c+"/"+g;E.text=c+"/"+g};this.refreshScore=function(c){s_oRollingTextManager.add(J,K,c,1E3,EASE_CUBIC_IN,null)};this.refrashNumPlayerLeft=function(c){t.text="x"+c;w.text="x"+c};this._onAudioToggle=function(){createjs.Sound.setMute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._showConfirmPanelOnExit=function(){x=new CConfirmPanel(TEXT_EXIT,CONFIRMATION_EXIT);x.addEventListener(ON_BUT_NO_DOWN,this._onUnloadPanel,this);x.addEventListener(ON_BUT_YES_DOWN,
this._onExit,this)};this._showConfirmPanelOnRestart=function(){x=new CConfirmPanel(TEXT_EXIT,CONFIRMATION_EXIT);x.addEventListener(ON_BUT_NO_DOWN,this._onUnloadPanel,this);x.addEventListener(ON_BUT_YES_DOWN,this._onRestart,this)};this.getTargetY=function(){return A.y};this._onUnloadPanel=function(){x.unload();x=null};this._onExit=function(){s_oGame.onExit()};this._onRestart=function(){s_oGame.onRestart()};s_oInterface=this;this._init(a,l,f,d);return this}var s_oInterface=null,Box2D={};
(function(a,l){function f(){}!(Object.prototype.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function&&(Object.defineProperty=function(a,e,k){k.get instanceof Function&&a.__defineGetter__(e,k.get);k.set instanceof Function&&a.__defineSetter__(e,k.set)});a.inherit=function(a,e){f.prototype=e.prototype;a.prototype=new f;a.prototype.constructor=a};a.generateCallback=function(a,e){return function(){e.apply(a,arguments)}};
a.NVector=function(a){a===l&&(a=0);for(var e=Array(a||0),k=0;k<a;++k)e[k]=0;return e};a.is=function(a,e){return null===a?!1:e instanceof Function&&a instanceof e||a.constructor.__implements!=l&&a.constructor.__implements[e]?!0:!1};a.parseUInt=function(a){return Math.abs(parseInt(a))}})(Box2D);var Vector=Array,Vector_a2j_Number=Box2D.NVector;"undefined"===typeof Box2D&&(Box2D={});"undefined"===typeof Box2D.Collision&&(Box2D.Collision={});
"undefined"===typeof Box2D.Collision.Shapes&&(Box2D.Collision.Shapes={});"undefined"===typeof Box2D.Common&&(Box2D.Common={});"undefined"===typeof Box2D.Common.Math&&(Box2D.Common.Math={});"undefined"===typeof Box2D.Dynamics&&(Box2D.Dynamics={});"undefined"===typeof Box2D.Dynamics.Contacts&&(Box2D.Dynamics.Contacts={});"undefined"===typeof Box2D.Dynamics.Controllers&&(Box2D.Dynamics.Controllers={});"undefined"===typeof Box2D.Dynamics.Joints&&(Box2D.Dynamics.Joints={});
(function(){function a(){a.b2AABB.apply(this,arguments)}function l(){l.b2Bound.apply(this,arguments)}function f(){f.b2BoundValues.apply(this,arguments);this.constructor===f&&this.b2BoundValues.apply(this,arguments)}function d(){d.b2Collision.apply(this,arguments)}function e(){e.b2ContactID.apply(this,arguments);this.constructor===e&&this.b2ContactID.apply(this,arguments)}function k(){k.b2ContactPoint.apply(this,arguments)}function p(){p.b2Distance.apply(this,arguments)}function b(){b.b2DistanceInput.apply(this,
arguments)}function q(){q.b2DistanceOutput.apply(this,arguments)}function n(){n.b2DistanceProxy.apply(this,arguments)}function z(){z.b2DynamicTree.apply(this,arguments);this.constructor===z&&this.b2DynamicTree.apply(this,arguments)}function u(){u.b2DynamicTreeBroadPhase.apply(this,arguments)}function x(){x.b2DynamicTreeNode.apply(this,arguments)}function v(){v.b2DynamicTreePair.apply(this,arguments)}function B(){B.b2Manifold.apply(this,arguments);this.constructor===B&&this.b2Manifold.apply(this,arguments)}
function A(){A.b2ManifoldPoint.apply(this,arguments);this.constructor===A&&this.b2ManifoldPoint.apply(this,arguments)}function h(){h.b2Point.apply(this,arguments)}function E(){E.b2RayCastInput.apply(this,arguments);this.constructor===E&&this.b2RayCastInput.apply(this,arguments)}function I(){I.b2RayCastOutput.apply(this,arguments)}function N(){N.b2Segment.apply(this,arguments)}function H(){H.b2SeparationFunction.apply(this,arguments)}function M(){M.b2Simplex.apply(this,arguments);this.constructor===
M&&this.b2Simplex.apply(this,arguments)}function G(){G.b2SimplexCache.apply(this,arguments)}function Q(){Q.b2SimplexVertex.apply(this,arguments)}function J(){J.b2TimeOfImpact.apply(this,arguments)}function K(){K.b2TOIInput.apply(this,arguments)}function R(){R.b2WorldManifold.apply(this,arguments);this.constructor===R&&this.b2WorldManifold.apply(this,arguments)}function O(){O.ClipVertex.apply(this,arguments)}function g(){g.Features.apply(this,arguments)}function r(){r.b2CircleShape.apply(this,arguments);
this.constructor===r&&this.b2CircleShape.apply(this,arguments)}function w(){w.b2EdgeChainDef.apply(this,arguments);this.constructor===w&&this.b2EdgeChainDef.apply(this,arguments)}function t(){t.b2EdgeShape.apply(this,arguments);this.constructor===t&&this.b2EdgeShape.apply(this,arguments)}function F(){F.b2MassData.apply(this,arguments)}function L(){L.b2PolygonShape.apply(this,arguments);this.constructor===L&&this.b2PolygonShape.apply(this,arguments)}function C(){C.b2Shape.apply(this,arguments);this.constructor===
C&&this.b2Shape.apply(this,arguments)}function c(){c.b2Color.apply(this,arguments);this.constructor===c&&this.b2Color.apply(this,arguments)}function m(){m.b2Settings.apply(this,arguments)}function y(){y.b2Mat22.apply(this,arguments);this.constructor===y&&this.b2Mat22.apply(this,arguments)}function D(){D.b2Mat33.apply(this,arguments);this.constructor===D&&this.b2Mat33.apply(this,arguments)}function P(){P.b2Math.apply(this,arguments)}function S(){S.b2Sweep.apply(this,arguments)}function U(){U.b2Transform.apply(this,
arguments);this.constructor===U&&this.b2Transform.apply(this,arguments)}function T(){T.b2Vec2.apply(this,arguments);this.constructor===T&&this.b2Vec2.apply(this,arguments)}function V(){V.b2Vec3.apply(this,arguments);this.constructor===V&&this.b2Vec3.apply(this,arguments)}function W(){W.b2Body.apply(this,arguments);this.constructor===W&&this.b2Body.apply(this,arguments)}function X(){X.b2BodyDef.apply(this,arguments);this.constructor===X&&this.b2BodyDef.apply(this,arguments)}function Ea(){Ea.b2ContactFilter.apply(this,
arguments)}function Fa(){Fa.b2ContactImpulse.apply(this,arguments)}function Ga(){Ga.b2ContactListener.apply(this,arguments)}function Y(){Y.b2ContactManager.apply(this,arguments);this.constructor===Y&&this.b2ContactManager.apply(this,arguments)}function Z(){Z.b2DebugDraw.apply(this,arguments);this.constructor===Z&&this.b2DebugDraw.apply(this,arguments)}function Ha(){Ha.b2DestructionListener.apply(this,arguments)}function Ia(){Ia.b2FilterData.apply(this,arguments)}function aa(){aa.b2Fixture.apply(this,
arguments);this.constructor===aa&&this.b2Fixture.apply(this,arguments)}function ba(){ba.b2FixtureDef.apply(this,arguments);this.constructor===ba&&this.b2FixtureDef.apply(this,arguments)}function ca(){ca.b2Island.apply(this,arguments);this.constructor===ca&&this.b2Island.apply(this,arguments)}function Ja(){Ja.b2TimeStep.apply(this,arguments)}function da(){da.b2World.apply(this,arguments);this.constructor===da&&this.b2World.apply(this,arguments)}function Ka(){Ka.b2CircleContact.apply(this,arguments)}
function ea(){ea.b2Contact.apply(this,arguments);this.constructor===ea&&this.b2Contact.apply(this,arguments)}function fa(){fa.b2ContactConstraint.apply(this,arguments);this.constructor===fa&&this.b2ContactConstraint.apply(this,arguments)}function La(){La.b2ContactConstraintPoint.apply(this,arguments)}function Ma(){Ma.b2ContactEdge.apply(this,arguments)}function ga(){ga.b2ContactFactory.apply(this,arguments);this.constructor===ga&&this.b2ContactFactory.apply(this,arguments)}function Na(){Na.b2ContactRegister.apply(this,
arguments)}function Oa(){Oa.b2ContactResult.apply(this,arguments)}function ha(){ha.b2ContactSolver.apply(this,arguments);this.constructor===ha&&this.b2ContactSolver.apply(this,arguments)}function Pa(){Pa.b2EdgeAndCircleContact.apply(this,arguments)}function ia(){ia.b2NullContact.apply(this,arguments);this.constructor===ia&&this.b2NullContact.apply(this,arguments)}function Qa(){Qa.b2PolyAndCircleContact.apply(this,arguments)}function Ra(){Ra.b2PolyAndEdgeContact.apply(this,arguments)}function Sa(){Sa.b2PolygonContact.apply(this,
arguments)}function ja(){ja.b2PositionSolverManifold.apply(this,arguments);this.constructor===ja&&this.b2PositionSolverManifold.apply(this,arguments)}function Ta(){Ta.b2BuoyancyController.apply(this,arguments)}function Ua(){Ua.b2ConstantAccelController.apply(this,arguments)}function Va(){Va.b2ConstantForceController.apply(this,arguments)}function Wa(){Wa.b2Controller.apply(this,arguments)}function Xa(){Xa.b2ControllerEdge.apply(this,arguments)}function Ya(){Ya.b2GravityController.apply(this,arguments)}
function Za(){Za.b2TensorDampingController.apply(this,arguments)}function ka(){ka.b2DistanceJoint.apply(this,arguments);this.constructor===ka&&this.b2DistanceJoint.apply(this,arguments)}function la(){la.b2DistanceJointDef.apply(this,arguments);this.constructor===la&&this.b2DistanceJointDef.apply(this,arguments)}function ma(){ma.b2FrictionJoint.apply(this,arguments);this.constructor===ma&&this.b2FrictionJoint.apply(this,arguments)}function na(){na.b2FrictionJointDef.apply(this,arguments);this.constructor===
na&&this.b2FrictionJointDef.apply(this,arguments)}function oa(){oa.b2GearJoint.apply(this,arguments);this.constructor===oa&&this.b2GearJoint.apply(this,arguments)}function pa(){pa.b2GearJointDef.apply(this,arguments);this.constructor===pa&&this.b2GearJointDef.apply(this,arguments)}function $a(){$a.b2Jacobian.apply(this,arguments)}function qa(){qa.b2Joint.apply(this,arguments);this.constructor===qa&&this.b2Joint.apply(this,arguments)}function ra(){ra.b2JointDef.apply(this,arguments);this.constructor===
ra&&this.b2JointDef.apply(this,arguments)}function ab(){ab.b2JointEdge.apply(this,arguments)}function sa(){sa.b2LineJoint.apply(this,arguments);this.constructor===sa&&this.b2LineJoint.apply(this,arguments)}function ta(){ta.b2LineJointDef.apply(this,arguments);this.constructor===ta&&this.b2LineJointDef.apply(this,arguments)}function ua(){ua.b2MouseJoint.apply(this,arguments);this.constructor===ua&&this.b2MouseJoint.apply(this,arguments)}function va(){va.b2MouseJointDef.apply(this,arguments);this.constructor===
va&&this.b2MouseJointDef.apply(this,arguments)}function wa(){wa.b2PrismaticJoint.apply(this,arguments);this.constructor===wa&&this.b2PrismaticJoint.apply(this,arguments)}function xa(){xa.b2PrismaticJointDef.apply(this,arguments);this.constructor===xa&&this.b2PrismaticJointDef.apply(this,arguments)}function ya(){ya.b2PulleyJoint.apply(this,arguments);this.constructor===ya&&this.b2PulleyJoint.apply(this,arguments)}function za(){za.b2PulleyJointDef.apply(this,arguments);this.constructor===za&&this.b2PulleyJointDef.apply(this,
arguments)}function Aa(){Aa.b2RevoluteJoint.apply(this,arguments);this.constructor===Aa&&this.b2RevoluteJoint.apply(this,arguments)}function Ba(){Ba.b2RevoluteJointDef.apply(this,arguments);this.constructor===Ba&&this.b2RevoluteJointDef.apply(this,arguments)}function Ca(){Ca.b2WeldJoint.apply(this,arguments);this.constructor===Ca&&this.b2WeldJoint.apply(this,arguments)}function Da(){Da.b2WeldJointDef.apply(this,arguments);this.constructor===Da&&this.b2WeldJointDef.apply(this,arguments)}Box2D.Collision.IBroadPhase=
"Box2D.Collision.IBroadPhase";Box2D.Collision.b2AABB=a;Box2D.Collision.b2Bound=l;Box2D.Collision.b2BoundValues=f;Box2D.Collision.b2Collision=d;Box2D.Collision.b2ContactID=e;Box2D.Collision.b2ContactPoint=k;Box2D.Collision.b2Distance=p;Box2D.Collision.b2DistanceInput=b;Box2D.Collision.b2DistanceOutput=q;Box2D.Collision.b2DistanceProxy=n;Box2D.Collision.b2DynamicTree=z;Box2D.Collision.b2DynamicTreeBroadPhase=u;Box2D.Collision.b2DynamicTreeNode=x;Box2D.Collision.b2DynamicTreePair=v;Box2D.Collision.b2Manifold=
B;Box2D.Collision.b2ManifoldPoint=A;Box2D.Collision.b2Point=h;Box2D.Collision.b2RayCastInput=E;Box2D.Collision.b2RayCastOutput=I;Box2D.Collision.b2Segment=N;Box2D.Collision.b2SeparationFunction=H;Box2D.Collision.b2Simplex=M;Box2D.Collision.b2SimplexCache=G;Box2D.Collision.b2SimplexVertex=Q;Box2D.Collision.b2TimeOfImpact=J;Box2D.Collision.b2TOIInput=K;Box2D.Collision.b2WorldManifold=R;Box2D.Collision.ClipVertex=O;Box2D.Collision.Features=g;Box2D.Collision.Shapes.b2CircleShape=r;Box2D.Collision.Shapes.b2EdgeChainDef=
w;Box2D.Collision.Shapes.b2EdgeShape=t;Box2D.Collision.Shapes.b2MassData=F;Box2D.Collision.Shapes.b2PolygonShape=L;Box2D.Collision.Shapes.b2Shape=C;Box2D.Common.b2internal="Box2D.Common.b2internal";Box2D.Common.b2Color=c;Box2D.Common.b2Settings=m;Box2D.Common.Math.b2Mat22=y;Box2D.Common.Math.b2Mat33=D;Box2D.Common.Math.b2Math=P;Box2D.Common.Math.b2Sweep=S;Box2D.Common.Math.b2Transform=U;Box2D.Common.Math.b2Vec2=T;Box2D.Common.Math.b2Vec3=V;Box2D.Dynamics.b2Body=W;Box2D.Dynamics.b2BodyDef=X;Box2D.Dynamics.b2ContactFilter=
Ea;Box2D.Dynamics.b2ContactImpulse=Fa;Box2D.Dynamics.b2ContactListener=Ga;Box2D.Dynamics.b2ContactManager=Y;Box2D.Dynamics.b2DebugDraw=Z;Box2D.Dynamics.b2DestructionListener=Ha;Box2D.Dynamics.b2FilterData=Ia;Box2D.Dynamics.b2Fixture=aa;Box2D.Dynamics.b2FixtureDef=ba;Box2D.Dynamics.b2Island=ca;Box2D.Dynamics.b2TimeStep=Ja;Box2D.Dynamics.b2World=da;Box2D.Dynamics.Contacts.b2CircleContact=Ka;Box2D.Dynamics.Contacts.b2Contact=ea;Box2D.Dynamics.Contacts.b2ContactConstraint=fa;Box2D.Dynamics.Contacts.b2ContactConstraintPoint=
La;Box2D.Dynamics.Contacts.b2ContactEdge=Ma;Box2D.Dynamics.Contacts.b2ContactFactory=ga;Box2D.Dynamics.Contacts.b2ContactRegister=Na;Box2D.Dynamics.Contacts.b2ContactResult=Oa;Box2D.Dynamics.Contacts.b2ContactSolver=ha;Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=Pa;Box2D.Dynamics.Contacts.b2NullContact=ia;Box2D.Dynamics.Contacts.b2PolyAndCircleContact=Qa;Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=Ra;Box2D.Dynamics.Contacts.b2PolygonContact=Sa;Box2D.Dynamics.Contacts.b2PositionSolverManifold=
ja;Box2D.Dynamics.Controllers.b2BuoyancyController=Ta;Box2D.Dynamics.Controllers.b2ConstantAccelController=Ua;Box2D.Dynamics.Controllers.b2ConstantForceController=Va;Box2D.Dynamics.Controllers.b2Controller=Wa;Box2D.Dynamics.Controllers.b2ControllerEdge=Xa;Box2D.Dynamics.Controllers.b2GravityController=Ya;Box2D.Dynamics.Controllers.b2TensorDampingController=Za;Box2D.Dynamics.Joints.b2DistanceJoint=ka;Box2D.Dynamics.Joints.b2DistanceJointDef=la;Box2D.Dynamics.Joints.b2FrictionJoint=ma;Box2D.Dynamics.Joints.b2FrictionJointDef=
na;Box2D.Dynamics.Joints.b2GearJoint=oa;Box2D.Dynamics.Joints.b2GearJointDef=pa;Box2D.Dynamics.Joints.b2Jacobian=$a;Box2D.Dynamics.Joints.b2Joint=qa;Box2D.Dynamics.Joints.b2JointDef=ra;Box2D.Dynamics.Joints.b2JointEdge=ab;Box2D.Dynamics.Joints.b2LineJoint=sa;Box2D.Dynamics.Joints.b2LineJointDef=ta;Box2D.Dynamics.Joints.b2MouseJoint=ua;Box2D.Dynamics.Joints.b2MouseJointDef=va;Box2D.Dynamics.Joints.b2PrismaticJoint=wa;Box2D.Dynamics.Joints.b2PrismaticJointDef=xa;Box2D.Dynamics.Joints.b2PulleyJoint=
ya;Box2D.Dynamics.Joints.b2PulleyJointDef=za;Box2D.Dynamics.Joints.b2RevoluteJoint=Aa;Box2D.Dynamics.Joints.b2RevoluteJointDef=Ba;Box2D.Dynamics.Joints.b2WeldJoint=Ca;Box2D.Dynamics.Joints.b2WeldJointDef=Da})();Box2D.postDefs=[];
(function(){var a=Box2D.Collision.Shapes.b2CircleShape,l=Box2D.Collision.Shapes.b2PolygonShape,f=Box2D.Collision.Shapes.b2Shape,d=Box2D.Common.b2Settings,e=Box2D.Common.Math.b2Math,k=Box2D.Common.Math.b2Sweep,p=Box2D.Common.Math.b2Transform,b=Box2D.Common.Math.b2Vec2,q=Box2D.Collision.b2AABB,n=Box2D.Collision.b2Bound,z=Box2D.Collision.b2BoundValues,u=Box2D.Collision.b2Collision,x=Box2D.Collision.b2ContactID,v=Box2D.Collision.b2ContactPoint,B=Box2D.Collision.b2Distance,A=Box2D.Collision.b2DistanceInput,
h=Box2D.Collision.b2DistanceOutput,E=Box2D.Collision.b2DistanceProxy,I=Box2D.Collision.b2DynamicTree,N=Box2D.Collision.b2DynamicTreeBroadPhase,H=Box2D.Collision.b2DynamicTreeNode,M=Box2D.Collision.b2DynamicTreePair,G=Box2D.Collision.b2Manifold,Q=Box2D.Collision.b2ManifoldPoint,J=Box2D.Collision.b2Point,K=Box2D.Collision.b2RayCastInput,R=Box2D.Collision.b2RayCastOutput,O=Box2D.Collision.b2Segment,g=Box2D.Collision.b2SeparationFunction,r=Box2D.Collision.b2Simplex,w=Box2D.Collision.b2SimplexCache,t=
Box2D.Collision.b2SimplexVertex,F=Box2D.Collision.b2TimeOfImpact,L=Box2D.Collision.b2TOIInput,C=Box2D.Collision.b2WorldManifold,c=Box2D.Collision.ClipVertex,m=Box2D.Collision.Features,y=Box2D.Collision.IBroadPhase;q.b2AABB=function(){this.lowerBound=new b;this.upperBound=new b};q.prototype.IsValid=function(){var c=this.upperBound.y-this.lowerBound.y;return 0<=this.upperBound.x-this.lowerBound.x&&0<=c&&this.lowerBound.IsValid()&&this.upperBound.IsValid()};q.prototype.GetCenter=function(){return new b((this.lowerBound.x+
this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)};q.prototype.GetExtents=function(){return new b((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)};q.prototype.Contains=function(c){var m;return m=(m=(m=(m=this.lowerBound.x<=c.lowerBound.x)&&this.lowerBound.y<=c.lowerBound.y)&&c.upperBound.x<=this.upperBound.x)&&c.upperBound.y<=this.upperBound.y};q.prototype.RayCast=function(c,m){var g=-Number.MAX_VALUE,b=Number.MAX_VALUE,h=m.p1.x,r=m.p1.y,t=m.p2.x-m.p1.x,
y=m.p2.y-m.p1.y,a=Math.abs(y),w=c.normal,d=0,C=0,e=d=0,e=0;if(Math.abs(t)<Number.MIN_VALUE){if(h<this.lowerBound.x||this.upperBound.x<h)return!1}else if(d=1/t,C=(this.lowerBound.x-h)*d,d*=this.upperBound.x-h,e=-1,C>d&&(e=C,C=d,d=e,e=1),C>g&&(w.x=e,w.y=0,g=C),b=Math.min(b,d),g>b)return!1;if(a<Number.MIN_VALUE){if(r<this.lowerBound.y||this.upperBound.y<r)return!1}else if(d=1/y,C=(this.lowerBound.y-r)*d,d*=this.upperBound.y-r,e=-1,C>d&&(e=C,C=d,d=e,e=1),C>g&&(w.y=e,w.x=0,g=C),b=Math.min(b,d),g>b)return!1;
c.fraction=g;return!0};q.prototype.TestOverlap=function(c){var m=c.lowerBound.y-this.upperBound.y,g=this.lowerBound.y-c.upperBound.y;return 0<c.lowerBound.x-this.upperBound.x||0<m||0<this.lowerBound.x-c.upperBound.x||0<g?!1:!0};q.Combine=function(c,m){var g=new q;g.Combine(c,m);return g};q.prototype.Combine=function(c,m){this.lowerBound.x=Math.min(c.lowerBound.x,m.lowerBound.x);this.lowerBound.y=Math.min(c.lowerBound.y,m.lowerBound.y);this.upperBound.x=Math.max(c.upperBound.x,m.upperBound.x);this.upperBound.y=
Math.max(c.upperBound.y,m.upperBound.y)};n.b2Bound=function(){};n.prototype.IsLower=function(){return 0==(this.value&1)};n.prototype.IsUpper=function(){return 1==(this.value&1)};n.prototype.Swap=function(c){var m=this.value,g=this.proxy,b=this.stabbingCount;this.value=c.value;this.proxy=c.proxy;this.stabbingCount=c.stabbingCount;c.value=m;c.proxy=g;c.stabbingCount=b};z.b2BoundValues=function(){};z.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number;this.lowerValues[0]=0;this.lowerValues[1]=
0;this.upperValues=new Vector_a2j_Number;this.upperValues[0]=0;this.upperValues[1]=0};u.b2Collision=function(){};u.ClipSegmentToLine=function(c,m,g,b){void 0===b&&(b=0);var h,r=0;h=m[0];var t=h.v;h=m[1];var y=h.v,a=g.x*t.x+g.y*t.y-b;h=g.x*y.x+g.y*y.y-b;0>=a&&c[r++].Set(m[0]);0>=h&&c[r++].Set(m[1]);0>a*h&&(g=a/(a-h),h=c[r],h=h.v,h.x=t.x+g*(y.x-t.x),h.y=t.y+g*(y.y-t.y),h=c[r],h.id=(0<a?m[0]:m[1]).id,++r);return r};u.EdgeSeparation=function(c,m,g,b,h){void 0===g&&(g=0);parseInt(c.m_vertexCount);var r=
c.m_vertices;c=c.m_normals;var t=parseInt(b.m_vertexCount),y=b.m_vertices,a,d;a=m.R;d=c[g];c=a.col1.x*d.x+a.col2.x*d.y;b=a.col1.y*d.x+a.col2.y*d.y;a=h.R;var w=a.col1.x*c+a.col1.y*b;a=a.col2.x*c+a.col2.y*b;for(var C=0,e=Number.MAX_VALUE,F=0;F<t;++F)d=y[F],d=d.x*w+d.y*a,d<e&&(e=d,C=F);d=r[g];a=m.R;g=m.position.x+(a.col1.x*d.x+a.col2.x*d.y);m=m.position.y+(a.col1.y*d.x+a.col2.y*d.y);d=y[C];a=h.R;r=h.position.x+(a.col1.x*d.x+a.col2.x*d.y);h=h.position.y+(a.col1.y*d.x+a.col2.y*d.y);return(r-g)*c+(h-m)*
b};u.FindMaxSeparation=function(c,m,g,b,h){var r=parseInt(m.m_vertexCount),t=m.m_normals,a,y;y=h.R;a=b.m_centroid;var d=h.position.x+(y.col1.x*a.x+y.col2.x*a.y),w=h.position.y+(y.col1.y*a.x+y.col2.y*a.y);y=g.R;a=m.m_centroid;d-=g.position.x+(y.col1.x*a.x+y.col2.x*a.y);w-=g.position.y+(y.col1.y*a.x+y.col2.y*a.y);y=d*g.R.col1.x+w*g.R.col1.y;for(var w=d*g.R.col2.x+w*g.R.col2.y,d=0,C=-Number.MAX_VALUE,e=0;e<r;++e)a=t[e],a=a.x*y+a.y*w,a>C&&(C=a,d=e);t=u.EdgeSeparation(m,g,d,b,h);a=parseInt(0<=d-1?d-1:
r-1);y=u.EdgeSeparation(m,g,a,b,h);var w=parseInt(d+1<r?d+1:0),C=u.EdgeSeparation(m,g,w,b,h),F=e=0,k=0;if(y>t&&y>C)k=-1,e=a,F=y;else if(C>t)k=1,e=w,F=C;else return c[0]=d,t;for(;;)if(d=-1==k?0<=e-1?e-1:r-1:e+1<r?e+1:0,t=u.EdgeSeparation(m,g,d,b,h),t>F)e=d,F=t;else break;c[0]=e;return F};u.FindIncidentEdge=function(c,m,g,b,h,r){void 0===b&&(b=0);parseInt(m.m_vertexCount);var t=m.m_normals,a=parseInt(h.m_vertexCount);m=h.m_vertices;h=h.m_normals;var y;y=g.R;g=t[b];var t=y.col1.x*g.x+y.col2.x*g.y,d=
y.col1.y*g.x+y.col2.y*g.y;y=r.R;g=y.col1.x*t+y.col1.y*d;d=y.col2.x*t+y.col2.y*d;t=g;y=0;for(var w=Number.MAX_VALUE,e=0;e<a;++e)g=h[e],g=t*g.x+d*g.y,g<w&&(w=g,y=e);h=parseInt(y);t=parseInt(h+1<a?h+1:0);a=c[0];g=m[h];y=r.R;a.v.x=r.position.x+(y.col1.x*g.x+y.col2.x*g.y);a.v.y=r.position.y+(y.col1.y*g.x+y.col2.y*g.y);a.id.features.referenceEdge=b;a.id.features.incidentEdge=h;a.id.features.incidentVertex=0;a=c[1];g=m[t];y=r.R;a.v.x=r.position.x+(y.col1.x*g.x+y.col2.x*g.y);a.v.y=r.position.y+(y.col1.y*
g.x+y.col2.y*g.y);a.id.features.referenceEdge=b;a.id.features.incidentEdge=t;a.id.features.incidentVertex=1};u.MakeClipPointVector=function(){var D=new Vector(2);D[0]=new c;D[1]=new c;return D};u.CollidePolygons=function(c,m,g,b,h){var r;c.m_pointCount=0;var t=m.m_radius+b.m_radius;u.s_edgeAO[0]=0;var a=u.FindMaxSeparation(u.s_edgeAO,m,g,b,h);r=u.s_edgeAO[0];if(!(a>t)){var y;u.s_edgeBO[0]=0;var w=u.FindMaxSeparation(u.s_edgeBO,b,h,m,g);y=u.s_edgeBO[0];if(!(w>t)){var e=0,C=0;w>.98*a+.001?(a=b,b=m,
m=h,e=y,c.m_type=G.e_faceB,C=1):(a=m,m=g,g=h,e=r,c.m_type=G.e_faceA,C=0);r=u.s_incidentEdge;u.FindIncidentEdge(r,a,m,e,b,g);y=parseInt(a.m_vertexCount);h=a.m_vertices;var a=h[e],F;F=e+1<y?h[parseInt(e+1)]:h[0];e=u.s_localTangent;e.Set(F.x-a.x,F.y-a.y);e.Normalize();h=u.s_localNormal;h.x=e.y;h.y=-e.x;b=u.s_planePoint;b.Set(.5*(a.x+F.x),.5*(a.y+F.y));w=u.s_tangent;y=m.R;w.x=y.col1.x*e.x+y.col2.x*e.y;w.y=y.col1.y*e.x+y.col2.y*e.y;var k=u.s_tangent2;k.x=-w.x;k.y=-w.y;e=u.s_normal;e.x=w.y;e.y=-w.x;var f=
u.s_v11,L=u.s_v12;f.x=m.position.x+(y.col1.x*a.x+y.col2.x*a.y);f.y=m.position.y+(y.col1.y*a.x+y.col2.y*a.y);L.x=m.position.x+(y.col1.x*F.x+y.col2.x*F.y);L.y=m.position.y+(y.col1.y*F.x+y.col2.y*F.y);m=e.x*f.x+e.y*f.y;y=w.x*L.x+w.y*L.y+t;F=u.s_clipPoints1;a=u.s_clipPoints2;L=0;L=u.ClipSegmentToLine(F,r,k,-w.x*f.x-w.y*f.y+t);if(!(2>L||(L=u.ClipSegmentToLine(a,F,w,y),2>L))){c.m_localPlaneNormal.SetV(h);c.m_localPoint.SetV(b);for(b=h=0;b<d.b2_maxManifoldPoints;++b)r=a[b],e.x*r.v.x+e.y*r.v.y-m<=t&&(w=c.m_points[h],
y=g.R,k=r.v.x-g.position.x,f=r.v.y-g.position.y,w.m_localPoint.x=k*y.col1.x+f*y.col1.y,w.m_localPoint.y=k*y.col2.x+f*y.col2.y,w.m_id.Set(r.id),w.m_id.features.flip=C,++h);c.m_pointCount=h}}}};u.CollideCircles=function(c,m,g,b,h){c.m_pointCount=0;var r,y;r=g.R;y=m.m_p;var a=g.position.x+(r.col1.x*y.x+r.col2.x*y.y);g=g.position.y+(r.col1.y*y.x+r.col2.y*y.y);r=h.R;y=b.m_p;a=h.position.x+(r.col1.x*y.x+r.col2.x*y.y)-a;h=h.position.y+(r.col1.y*y.x+r.col2.y*y.y)-g;r=m.m_radius+b.m_radius;a*a+h*h>r*r||(c.m_type=
G.e_circles,c.m_localPoint.SetV(m.m_p),c.m_localPlaneNormal.SetZero(),c.m_pointCount=1,c.m_points[0].m_localPoint.SetV(b.m_p),c.m_points[0].m_id.key=0)};u.CollidePolygonAndCircle=function(c,m,g,b,h){var r=c.m_pointCount=0,y=0,a,t;t=h.R;a=b.m_p;var d=h.position.y+(t.col1.y*a.x+t.col2.y*a.y),r=h.position.x+(t.col1.x*a.x+t.col2.x*a.y)-g.position.x,y=d-g.position.y;t=g.R;g=r*t.col1.x+y*t.col1.y;t=r*t.col2.x+y*t.col2.y;var w=0,d=-Number.MAX_VALUE;h=m.m_radius+b.m_radius;var e=parseInt(m.m_vertexCount),
C=m.m_vertices;m=m.m_normals;for(var F=0;F<e;++F){a=C[F];r=g-a.x;y=t-a.y;a=m[F];r=a.x*r+a.y*y;if(r>h)return;r>d&&(d=r,w=F)}r=parseInt(w);y=parseInt(r+1<e?r+1:0);a=C[r];C=C[y];d<Number.MIN_VALUE?(c.m_pointCount=1,c.m_type=G.e_faceA,c.m_localPlaneNormal.SetV(m[w]),c.m_localPoint.x=.5*(a.x+C.x),c.m_localPoint.y=.5*(a.y+C.y),c.m_points[0].m_localPoint.SetV(b.m_p),c.m_points[0].m_id.key=0):(d=(g-C.x)*(a.x-C.x)+(t-C.y)*(a.y-C.y),0>=(g-a.x)*(C.x-a.x)+(t-a.y)*(C.y-a.y)?(g-a.x)*(g-a.x)+(t-a.y)*(t-a.y)>h*h||
(c.m_pointCount=1,c.m_type=G.e_faceA,c.m_localPlaneNormal.x=g-a.x,c.m_localPlaneNormal.y=t-a.y,c.m_localPlaneNormal.Normalize(),c.m_localPoint.SetV(a),c.m_points[0].m_localPoint.SetV(b.m_p),c.m_points[0].m_id.key=0):0>=d?(g-C.x)*(g-C.x)+(t-C.y)*(t-C.y)>h*h||(c.m_pointCount=1,c.m_type=G.e_faceA,c.m_localPlaneNormal.x=g-C.x,c.m_localPlaneNormal.y=t-C.y,c.m_localPlaneNormal.Normalize(),c.m_localPoint.SetV(C),c.m_points[0].m_localPoint.SetV(b.m_p),c.m_points[0].m_id.key=0):(w=.5*(a.x+C.x),a=.5*(a.y+C.y),
d=(g-w)*m[r].x+(t-a)*m[r].y,d>h||(c.m_pointCount=1,c.m_type=G.e_faceA,c.m_localPlaneNormal.x=m[r].x,c.m_localPlaneNormal.y=m[r].y,c.m_localPlaneNormal.Normalize(),c.m_localPoint.Set(w,a),c.m_points[0].m_localPoint.SetV(b.m_p),c.m_points[0].m_id.key=0)))};u.TestOverlap=function(c,m){var g=m.lowerBound,b=c.upperBound,h=g.x-b.x,r=g.y-b.y,g=c.lowerBound,b=m.upperBound,a=g.y-b.y;return 0<h||0<r||0<g.x-b.x||0<a?!1:!0};Box2D.postDefs.push(function(){Box2D.Collision.b2Collision.s_incidentEdge=u.MakeClipPointVector();
Box2D.Collision.b2Collision.s_clipPoints1=u.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints2=u.MakeClipPointVector();Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_localTangent=new b;Box2D.Collision.b2Collision.s_localNormal=new b;Box2D.Collision.b2Collision.s_planePoint=new b;Box2D.Collision.b2Collision.s_normal=new b;Box2D.Collision.b2Collision.s_tangent=new b;Box2D.Collision.b2Collision.s_tangent2=
new b;Box2D.Collision.b2Collision.s_v11=new b;Box2D.Collision.b2Collision.s_v12=new b;Box2D.Collision.b2Collision.b2CollidePolyTempVec=new b;Box2D.Collision.b2Collision.b2_nullFeature=255});x.b2ContactID=function(){this.features=new m};x.prototype.b2ContactID=function(){this.features._m_id=this};x.prototype.Set=function(c){this.key=c._key};x.prototype.Copy=function(){var c=new x;c.key=this.key;return c};Object.defineProperty(x.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}});
Object.defineProperty(x.prototype,"key",{enumerable:!1,configurable:!0,set:function(c){void 0===c&&(c=0);this._key=c;this.features._referenceEdge=this._key&255;this.features._incidentEdge=(this._key&65280)>>8&255;this.features._incidentVertex=(this._key&16711680)>>16&255;this.features._flip=(this._key&4278190080)>>24&255}});v.b2ContactPoint=function(){this.position=new b;this.velocity=new b;this.normal=new b;this.id=new x};B.b2Distance=function(){};B.Distance=function(c,m,g){++B.b2_gjkCalls;var h=
g.proxyA,r=g.proxyB,a=g.transformA,y=g.transformB,t=B.s_simplex;t.ReadCache(m,h,a,r,y);var w=t.m_vertices,C=B.s_saveA,F=B.s_saveB,k=0;t.GetClosestPoint().LengthSquared();for(var f=0,L,l=0;20>l;){k=t.m_count;for(f=0;f<k;f++)C[f]=w[f].indexA,F[f]=w[f].indexB;switch(t.m_count){case 1:break;case 2:t.Solve2();break;case 3:t.Solve3();break;default:d.b2Assert(!1)}if(3==t.m_count)break;L=t.GetClosestPoint();L.LengthSquared();f=t.GetSearchDirection();if(f.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;
L=w[t.m_count];L.indexA=h.GetSupport(e.MulTMV(a.R,f.GetNegative()));L.wA=e.MulX(a,h.GetVertex(L.indexA));L.indexB=r.GetSupport(e.MulTMV(y.R,f));L.wB=e.MulX(y,r.GetVertex(L.indexB));L.w=e.SubtractVV(L.wB,L.wA);++l;++B.b2_gjkIters;for(var q=!1,f=0;f<k;f++)if(L.indexA==C[f]&&L.indexB==F[f]){q=!0;break}if(q)break;++t.m_count}B.b2_gjkMaxIters=e.Max(B.b2_gjkMaxIters,l);t.GetWitnessPoints(c.pointA,c.pointB);c.distance=e.SubtractVV(c.pointA,c.pointB).Length();c.iterations=l;t.WriteCache(m);g.useRadii&&(m=
h.m_radius,r=r.m_radius,c.distance>m+r&&c.distance>Number.MIN_VALUE?(c.distance-=m+r,g=e.SubtractVV(c.pointB,c.pointA),g.Normalize(),c.pointA.x+=m*g.x,c.pointA.y+=m*g.y,c.pointB.x-=r*g.x,c.pointB.y-=r*g.y):(L=new b,L.x=.5*(c.pointA.x+c.pointB.x),L.y=.5*(c.pointA.y+c.pointB.y),c.pointA.x=c.pointB.x=L.x,c.pointA.y=c.pointB.y=L.y,c.distance=0))};Box2D.postDefs.push(function(){Box2D.Collision.b2Distance.s_simplex=new r;Box2D.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3);Box2D.Collision.b2Distance.s_saveB=
new Vector_a2j_Number(3)});A.b2DistanceInput=function(){};h.b2DistanceOutput=function(){this.pointA=new b;this.pointB=new b};E.b2DistanceProxy=function(){};E.prototype.Set=function(c){switch(c.GetType()){case f.e_circleShape:c=c instanceof a?c:null;this.m_vertices=new Vector(1,!0);this.m_vertices[0]=c.m_p;this.m_count=1;this.m_radius=c.m_radius;break;case f.e_polygonShape:c=c instanceof l?c:null;this.m_vertices=c.m_vertices;this.m_count=c.m_vertexCount;this.m_radius=c.m_radius;break;default:d.b2Assert(!1)}};
E.prototype.GetSupport=function(c){for(var m=0,g=this.m_vertices[0].x*c.x+this.m_vertices[0].y*c.y,b=1;b<this.m_count;++b){var h=this.m_vertices[b].x*c.x+this.m_vertices[b].y*c.y;h>g&&(m=b,g=h)}return m};E.prototype.GetSupportVertex=function(c){for(var m=0,g=this.m_vertices[0].x*c.x+this.m_vertices[0].y*c.y,b=1;b<this.m_count;++b){var h=this.m_vertices[b].x*c.x+this.m_vertices[b].y*c.y;h>g&&(m=b,g=h)}return this.m_vertices[m]};E.prototype.GetVertexCount=function(){return this.m_count};E.prototype.GetVertex=
function(c){void 0===c&&(c=0);d.b2Assert(0<=c&&c<this.m_count);return this.m_vertices[c]};I.b2DynamicTree=function(){};I.prototype.b2DynamicTree=function(){this.m_freeList=this.m_root=null;this.m_insertionCount=this.m_path=0};I.prototype.CreateProxy=function(c,m){var g=this.AllocateNode(),b=d.b2_aabbExtension,h=d.b2_aabbExtension;g.aabb.lowerBound.x=c.lowerBound.x-b;g.aabb.lowerBound.y=c.lowerBound.y-h;g.aabb.upperBound.x=c.upperBound.x+b;g.aabb.upperBound.y=c.upperBound.y+h;g.userData=m;this.InsertLeaf(g);
return g};I.prototype.DestroyProxy=function(c){this.RemoveLeaf(c);this.FreeNode(c)};I.prototype.MoveProxy=function(c,m,g){d.b2Assert(c.IsLeaf());if(c.aabb.Contains(m))return!1;this.RemoveLeaf(c);var b=d.b2_aabbExtension+d.b2_aabbMultiplier*(0<g.x?g.x:-g.x);g=d.b2_aabbExtension+d.b2_aabbMultiplier*(0<g.y?g.y:-g.y);c.aabb.lowerBound.x=m.lowerBound.x-b;c.aabb.lowerBound.y=m.lowerBound.y-g;c.aabb.upperBound.x=m.upperBound.x+b;c.aabb.upperBound.y=m.upperBound.y+g;this.InsertLeaf(c);return!0};I.prototype.Rebalance=
function(c){void 0===c&&(c=0);if(null!=this.m_root)for(var m=0;m<c;m++){for(var g=this.m_root,b=0;0==g.IsLeaf();)g=this.m_path>>b&1?g.child2:g.child1,b=b+1&31;++this.m_path;this.RemoveLeaf(g);this.InsertLeaf(g)}};I.prototype.GetFatAABB=function(c){return c.aabb};I.prototype.GetUserData=function(c){return c.userData};I.prototype.Query=function(c,m){if(null!=this.m_root){var g=new Vector,b=0;for(g[b++]=this.m_root;0<b;){var h=g[--b];if(h.aabb.TestOverlap(m))if(h.IsLeaf()){if(!c(h))break}else g[b++]=
h.child1,g[b++]=h.child2}}};I.prototype.RayCast=function(c,m){if(null!=this.m_root){var g=m.p1,b=m.p2,h=e.SubtractVV(g,b);h.Normalize();var h=e.CrossFV(1,h),r=e.AbsV(h),a=m.maxFraction,t=new q,y=0,d=0,y=g.x+a*(b.x-g.x),d=g.y+a*(b.y-g.y);t.lowerBound.x=Math.min(g.x,y);t.lowerBound.y=Math.min(g.y,d);t.upperBound.x=Math.max(g.x,y);t.upperBound.y=Math.max(g.y,d);var w=new Vector,C=0;for(w[C++]=this.m_root;0<C;)if(a=w[--C],0!=a.aabb.TestOverlap(t)&&(y=a.aabb.GetCenter(),d=a.aabb.GetExtents(),!(0<Math.abs(h.x*
(g.x-y.x)+h.y*(g.y-y.y))-r.x*d.x-r.y*d.y)))if(a.IsLeaf()){y=new K;y.p1=m.p1;y.p2=m.p2;y.maxFraction=m.maxFraction;a=c(y,a);if(0==a)break;0<a&&(y=g.x+a*(b.x-g.x),d=g.y+a*(b.y-g.y),t.lowerBound.x=Math.min(g.x,y),t.lowerBound.y=Math.min(g.y,d),t.upperBound.x=Math.max(g.x,y),t.upperBound.y=Math.max(g.y,d))}else w[C++]=a.child1,w[C++]=a.child2}};I.prototype.AllocateNode=function(){if(this.m_freeList){var c=this.m_freeList;this.m_freeList=c.parent;c.parent=null;c.child1=null;c.child2=null;return c}return new H};
I.prototype.FreeNode=function(c){c.parent=this.m_freeList;this.m_freeList=c};I.prototype.InsertLeaf=function(c){++this.m_insertionCount;if(null==this.m_root)this.m_root=c,this.m_root.parent=null;else{var g=c.aabb.GetCenter(),m=this.m_root;if(0==m.IsLeaf()){do var b=m.child1,m=m.child2,m=Math.abs((b.aabb.lowerBound.x+b.aabb.upperBound.x)/2-g.x)+Math.abs((b.aabb.lowerBound.y+b.aabb.upperBound.y)/2-g.y)<Math.abs((m.aabb.lowerBound.x+m.aabb.upperBound.x)/2-g.x)+Math.abs((m.aabb.lowerBound.y+m.aabb.upperBound.y)/
2-g.y)?b:m;while(0==m.IsLeaf())}g=m.parent;b=this.AllocateNode();b.parent=g;b.userData=null;b.aabb.Combine(c.aabb,m.aabb);if(g){m.parent.child1==m?g.child1=b:g.child2=b;b.child1=m;b.child2=c;m.parent=b;c.parent=b;do{if(g.aabb.Contains(b.aabb))break;g.aabb.Combine(g.child1.aabb,g.child2.aabb);b=g;g=g.parent}while(g)}else b.child1=m,b.child2=c,m.parent=b,this.m_root=c.parent=b}};I.prototype.RemoveLeaf=function(c){if(c==this.m_root)this.m_root=null;else{var g=c.parent,m=g.parent;c=g.child1==c?g.child2:
g.child1;if(m)for(m.child1==g?m.child1=c:m.child2=c,c.parent=m,this.FreeNode(g);m;){g=m.aabb;m.aabb=q.Combine(m.child1.aabb,m.child2.aabb);if(g.Contains(m.aabb))break;m=m.parent}else this.m_root=c,c.parent=null,this.FreeNode(g)}};N.b2DynamicTreeBroadPhase=function(){this.m_tree=new I;this.m_moveBuffer=new Vector;this.m_pairBuffer=new Vector;this.m_pairCount=0};N.prototype.CreateProxy=function(c,g){var m=this.m_tree.CreateProxy(c,g);++this.m_proxyCount;this.BufferMove(m);return m};N.prototype.DestroyProxy=
function(c){this.UnBufferMove(c);--this.m_proxyCount;this.m_tree.DestroyProxy(c)};N.prototype.MoveProxy=function(c,g,m){this.m_tree.MoveProxy(c,g,m)&&this.BufferMove(c)};N.prototype.TestOverlap=function(c,g){var m=this.m_tree.GetFatAABB(c),b=this.m_tree.GetFatAABB(g);return m.TestOverlap(b)};N.prototype.GetUserData=function(c){return this.m_tree.GetUserData(c)};N.prototype.GetFatAABB=function(c){return this.m_tree.GetFatAABB(c)};N.prototype.GetProxyCount=function(){return this.m_proxyCount};N.prototype.UpdatePairs=
function(c){for(var g=this,m=g.m_pairCount=0,b,m=0;m<g.m_moveBuffer.length;++m){b=g.m_moveBuffer[m];var h=g.m_tree.GetFatAABB(b);g.m_tree.Query(function(c){if(c==b)return!0;g.m_pairCount==g.m_pairBuffer.length&&(g.m_pairBuffer[g.m_pairCount]=new M);var m=g.m_pairBuffer[g.m_pairCount];m.proxyA=c<b?c:b;m.proxyB=c>=b?c:b;++g.m_pairCount;return!0},h)}for(m=g.m_moveBuffer.length=0;m<g.m_pairCount;){var h=g.m_pairBuffer[m],a=g.m_tree.GetUserData(h.proxyA),r=g.m_tree.GetUserData(h.proxyB);c(a,r);for(++m;m<
g.m_pairCount;){a=g.m_pairBuffer[m];if(a.proxyA!=h.proxyA||a.proxyB!=h.proxyB)break;++m}}};N.prototype.Query=function(c,g){this.m_tree.Query(c,g)};N.prototype.RayCast=function(c,g){this.m_tree.RayCast(c,g)};N.prototype.Validate=function(){};N.prototype.Rebalance=function(c){void 0===c&&(c=0);this.m_tree.Rebalance(c)};N.prototype.BufferMove=function(c){this.m_moveBuffer[this.m_moveBuffer.length]=c};N.prototype.UnBufferMove=function(c){c=parseInt(this.m_moveBuffer.indexOf(c));this.m_moveBuffer.splice(c,
1)};N.prototype.ComparePairs=function(c,g){return 0};N.__implements={};N.__implements[y]=!0;H.b2DynamicTreeNode=function(){this.aabb=new q};H.prototype.IsLeaf=function(){return null==this.child1};M.b2DynamicTreePair=function(){};G.b2Manifold=function(){this.m_pointCount=0};G.prototype.b2Manifold=function(){this.m_points=new Vector(d.b2_maxManifoldPoints);for(var c=0;c<d.b2_maxManifoldPoints;c++)this.m_points[c]=new Q;this.m_localPlaneNormal=new b;this.m_localPoint=new b};G.prototype.Reset=function(){for(var c=
0;c<d.b2_maxManifoldPoints;c++)(this.m_points[c]instanceof Q?this.m_points[c]:null).Reset();this.m_localPlaneNormal.SetZero();this.m_localPoint.SetZero();this.m_pointCount=this.m_type=0};G.prototype.Set=function(c){this.m_pointCount=c.m_pointCount;for(var g=0;g<d.b2_maxManifoldPoints;g++)(this.m_points[g]instanceof Q?this.m_points[g]:null).Set(c.m_points[g]);this.m_localPlaneNormal.SetV(c.m_localPlaneNormal);this.m_localPoint.SetV(c.m_localPoint);this.m_type=c.m_type};G.prototype.Copy=function(){var c=
new G;c.Set(this);return c};Box2D.postDefs.push(function(){Box2D.Collision.b2Manifold.e_circles=1;Box2D.Collision.b2Manifold.e_faceA=2;Box2D.Collision.b2Manifold.e_faceB=4});Q.b2ManifoldPoint=function(){this.m_localPoint=new b;this.m_id=new x};Q.prototype.b2ManifoldPoint=function(){this.Reset()};Q.prototype.Reset=function(){this.m_localPoint.SetZero();this.m_tangentImpulse=this.m_normalImpulse=0;this.m_id.key=0};Q.prototype.Set=function(c){this.m_localPoint.SetV(c.m_localPoint);this.m_normalImpulse=
c.m_normalImpulse;this.m_tangentImpulse=c.m_tangentImpulse;this.m_id.Set(c.m_id)};J.b2Point=function(){this.p=new b};J.prototype.Support=function(c,g,m){return this.p};J.prototype.GetFirstVertex=function(c){return this.p};K.b2RayCastInput=function(){this.p1=new b;this.p2=new b};K.prototype.b2RayCastInput=function(c,g,m){void 0===c&&(c=null);void 0===g&&(g=null);void 0===m&&(m=1);c&&this.p1.SetV(c);g&&this.p2.SetV(g);this.maxFraction=m};R.b2RayCastOutput=function(){this.normal=new b};O.b2Segment=function(){this.p1=
new b;this.p2=new b};O.prototype.TestSegment=function(c,g,m,b){void 0===b&&(b=0);var h=m.p1,a=m.p2.x-h.x,r=m.p2.y-h.y;m=this.p2.y-this.p1.y;var t=-(this.p2.x-this.p1.x),y=100*Number.MIN_VALUE,d=-(a*m+r*t);if(d>y){var w=h.x-this.p1.x,C=h.y-this.p1.y,h=w*m+C*t;if(0<=h&&h<=b*d&&(b=-a*C+r*w,-y*d<=b&&b<=d*(1+y)))return b=Math.sqrt(m*m+t*t),c[0]=h/d,g.Set(m/b,t/b),!0}return!1};O.prototype.Extend=function(c){this.ExtendForward(c);this.ExtendBackward(c)};O.prototype.ExtendForward=function(c){var g=this.p2.x-
this.p1.x,m=this.p2.y-this.p1.y;c=Math.min(0<g?(c.upperBound.x-this.p1.x)/g:0>g?(c.lowerBound.x-this.p1.x)/g:Number.POSITIVE_INFINITY,0<m?(c.upperBound.y-this.p1.y)/m:0>m?(c.lowerBound.y-this.p1.y)/m:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+g*c;this.p2.y=this.p1.y+m*c};O.prototype.ExtendBackward=function(c){var g=-this.p2.x+this.p1.x,m=-this.p2.y+this.p1.y;c=Math.min(0<g?(c.upperBound.x-this.p2.x)/g:0>g?(c.lowerBound.x-this.p2.x)/g:Number.POSITIVE_INFINITY,0<m?(c.upperBound.y-this.p2.y)/m:0>
m?(c.lowerBound.y-this.p2.y)/m:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+g*c;this.p1.y=this.p2.y+m*c};g.b2SeparationFunction=function(){this.m_localPoint=new b;this.m_axis=new b};g.prototype.Initialize=function(c,m,h,a,r){this.m_proxyA=m;this.m_proxyB=a;var t=parseInt(c.count);d.b2Assert(0<t&&3>t);var y,w,C,F,f=F=C=a=m=0,k=0,f=0;1==t?(this.m_type=g.e_points,y=this.m_proxyA.GetVertex(c.indexA[0]),w=this.m_proxyB.GetVertex(c.indexB[0]),t=y,c=h.R,m=h.position.x+(c.col1.x*t.x+c.col2.x*t.y),a=h.position.y+
(c.col1.y*t.x+c.col2.y*t.y),t=w,c=r.R,C=r.position.x+(c.col1.x*t.x+c.col2.x*t.y),F=r.position.y+(c.col1.y*t.x+c.col2.y*t.y),this.m_axis.x=C-m,this.m_axis.y=F-a,this.m_axis.Normalize()):c.indexB[0]==c.indexB[1]?(this.m_type=g.e_faceA,m=this.m_proxyA.GetVertex(c.indexA[0]),a=this.m_proxyA.GetVertex(c.indexA[1]),w=this.m_proxyB.GetVertex(c.indexB[0]),this.m_localPoint.x=.5*(m.x+a.x),this.m_localPoint.y=.5*(m.y+a.y),this.m_axis=e.CrossVF(e.SubtractVV(a,m),1),this.m_axis.Normalize(),t=this.m_axis,c=h.R,
f=c.col1.x*t.x+c.col2.x*t.y,k=c.col1.y*t.x+c.col2.y*t.y,t=this.m_localPoint,c=h.R,m=h.position.x+(c.col1.x*t.x+c.col2.x*t.y),a=h.position.y+(c.col1.y*t.x+c.col2.y*t.y),t=w,c=r.R,C=r.position.x+(c.col1.x*t.x+c.col2.x*t.y),F=r.position.y+(c.col1.y*t.x+c.col2.y*t.y),0>(C-m)*f+(F-a)*k&&this.m_axis.NegativeSelf()):c.indexA[0]==c.indexA[0]?(this.m_type=g.e_faceB,C=this.m_proxyB.GetVertex(c.indexB[0]),F=this.m_proxyB.GetVertex(c.indexB[1]),y=this.m_proxyA.GetVertex(c.indexA[0]),this.m_localPoint.x=.5*(C.x+
F.x),this.m_localPoint.y=.5*(C.y+F.y),this.m_axis=e.CrossVF(e.SubtractVV(F,C),1),this.m_axis.Normalize(),t=this.m_axis,c=r.R,f=c.col1.x*t.x+c.col2.x*t.y,k=c.col1.y*t.x+c.col2.y*t.y,t=this.m_localPoint,c=r.R,C=r.position.x+(c.col1.x*t.x+c.col2.x*t.y),F=r.position.y+(c.col1.y*t.x+c.col2.y*t.y),t=y,c=h.R,m=h.position.x+(c.col1.x*t.x+c.col2.x*t.y),a=h.position.y+(c.col1.y*t.x+c.col2.y*t.y),0>(m-C)*f+(a-F)*k&&this.m_axis.NegativeSelf()):(m=this.m_proxyA.GetVertex(c.indexA[0]),a=this.m_proxyA.GetVertex(c.indexA[1]),
C=this.m_proxyB.GetVertex(c.indexB[0]),F=this.m_proxyB.GetVertex(c.indexB[1]),e.MulX(h,y),y=e.MulMV(h.R,e.SubtractVV(a,m)),e.MulX(r,w),f=e.MulMV(r.R,e.SubtractVV(F,C)),r=y.x*y.x+y.y*y.y,w=f.x*f.x+f.y*f.y,c=e.SubtractVV(f,y),h=y.x*c.x+y.y*c.y,c=f.x*c.x+f.y*c.y,y=y.x*f.x+y.y*f.y,k=r*w-y*y,f=0,0!=k&&(f=e.Clamp((y*c-h*w)/k,0,1)),0>(y*f+c)/w&&(f=e.Clamp((y-h)/r,0,1)),y=new b,y.x=m.x+f*(a.x-m.x),y.y=m.y+f*(a.y-m.y),w=new b,w.x=C.x+f*(F.x-C.x),w.y=C.y+f*(F.y-C.y),0==f||1==f?(this.m_type=g.e_faceB,this.m_axis=
e.CrossVF(e.SubtractVV(F,C),1),this.m_axis.Normalize(),this.m_localPoint=w):(this.m_type=g.e_faceA,this.m_axis=e.CrossVF(e.SubtractVV(a,m),1),this.m_localPoint=y),0>f&&this.m_axis.NegativeSelf())};g.prototype.Evaluate=function(c,m){var b,h,t=0;switch(this.m_type){case g.e_points:return b=e.MulTMV(c.R,this.m_axis),h=e.MulTMV(m.R,this.m_axis.GetNegative()),b=this.m_proxyA.GetSupportVertex(b),h=this.m_proxyB.GetSupportVertex(h),b=e.MulX(c,b),h=e.MulX(m,h),t=(h.x-b.x)*this.m_axis.x+(h.y-b.y)*this.m_axis.y;
case g.e_faceA:return t=e.MulMV(c.R,this.m_axis),b=e.MulX(c,this.m_localPoint),h=e.MulTMV(m.R,t.GetNegative()),h=this.m_proxyB.GetSupportVertex(h),h=e.MulX(m,h),t=(h.x-b.x)*t.x+(h.y-b.y)*t.y;case g.e_faceB:return t=e.MulMV(m.R,this.m_axis),h=e.MulX(m,this.m_localPoint),b=e.MulTMV(c.R,t.GetNegative()),b=this.m_proxyA.GetSupportVertex(b),b=e.MulX(c,b),t=(b.x-h.x)*t.x+(b.y-h.y)*t.y;default:return d.b2Assert(!1),0}};Box2D.postDefs.push(function(){Box2D.Collision.b2SeparationFunction.e_points=1;Box2D.Collision.b2SeparationFunction.e_faceA=
2;Box2D.Collision.b2SeparationFunction.e_faceB=4});r.b2Simplex=function(){this.m_v1=new t;this.m_v2=new t;this.m_v3=new t;this.m_vertices=new Vector(3)};r.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1;this.m_vertices[1]=this.m_v2;this.m_vertices[2]=this.m_v3};r.prototype.ReadCache=function(c,m,g,b,h){d.b2Assert(0<=c.count&&3>=c.count);var t,a;this.m_count=c.count;for(var r=this.m_vertices,y=0;y<this.m_count;y++){var w=r[y];w.indexA=c.indexA[y];w.indexB=c.indexB[y];t=m.GetVertex(w.indexA);
a=b.GetVertex(w.indexB);w.wA=e.MulX(g,t);w.wB=e.MulX(h,a);w.w=e.SubtractVV(w.wB,w.wA);w.a=0}1<this.m_count&&(c=c.metric,t=this.GetMetric(),t<.5*c||2*c<t||t<Number.MIN_VALUE)&&(this.m_count=0);0==this.m_count&&(w=r[0],w.indexA=0,w.indexB=0,t=m.GetVertex(0),a=b.GetVertex(0),w.wA=e.MulX(g,t),w.wB=e.MulX(h,a),w.w=e.SubtractVV(w.wB,w.wA),this.m_count=1)};r.prototype.WriteCache=function(c){c.metric=this.GetMetric();c.count=Box2D.parseUInt(this.m_count);for(var m=this.m_vertices,g=0;g<this.m_count;g++)c.indexA[g]=
Box2D.parseUInt(m[g].indexA),c.indexB[g]=Box2D.parseUInt(m[g].indexB)};r.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var c=e.SubtractVV(this.m_v2.w,this.m_v1.w);return 0<e.CrossVV(c,this.m_v1.w.GetNegative())?e.CrossFV(1,c):e.CrossVF(c,1);default:return d.b2Assert(!1),new b}};r.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return d.b2Assert(!1),new b;case 1:return this.m_v1.w;case 2:return new b(this.m_v1.a*this.m_v1.w.x+
this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return d.b2Assert(!1),new b}};r.prototype.GetWitnessPoints=function(c,m){switch(this.m_count){case 0:d.b2Assert(!1);break;case 1:c.SetV(this.m_v1.wA);m.SetV(this.m_v1.wB);break;case 2:c.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x;c.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y;m.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x;m.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;
break;case 3:m.x=c.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x;m.y=c.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:d.b2Assert(!1)}};r.prototype.GetMetric=function(){switch(this.m_count){case 0:return d.b2Assert(!1),0;case 1:return 0;case 2:return e.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return e.CrossVV(e.SubtractVV(this.m_v2.w,this.m_v1.w),e.SubtractVV(this.m_v3.w,this.m_v1.w));default:return d.b2Assert(!1),
0}};r.prototype.Solve2=function(){var c=this.m_v1.w,m=this.m_v2.w,g=e.SubtractVV(m,c),c=-(c.x*g.x+c.y*g.y);0>=c?this.m_count=this.m_v1.a=1:(m=m.x*g.x+m.y*g.y,0>=m?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):(g=1/(m+c),this.m_v1.a=m*g,this.m_v2.a=c*g,this.m_count=2))};r.prototype.Solve3=function(){var c=this.m_v1.w,m=this.m_v2.w,g=this.m_v3.w,b=e.SubtractVV(m,c),h=e.Dot(c,b),t=e.Dot(m,b),h=-h,a=e.SubtractVV(g,c),r=e.Dot(c,a),y=e.Dot(g,a),r=-r,w=e.SubtractVV(g,m),d=e.Dot(m,w),w=e.Dot(g,w),
d=-d,a=e.CrossVV(b,a),b=a*e.CrossVV(m,g),g=a*e.CrossVV(g,c),c=a*e.CrossVV(c,m);0>=h&&0>=r?this.m_count=this.m_v1.a=1:0<t&&0<h&&0>=c?(y=1/(t+h),this.m_v1.a=t*y,this.m_v2.a=h*y,this.m_count=2):0<y&&0<r&&0>=g?(t=1/(y+r),this.m_v1.a=y*t,this.m_v3.a=r*t,this.m_count=2,this.m_v2.Set(this.m_v3)):0>=t&&0>=d?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):0>=y&&0>=w?(this.m_count=this.m_v3.a=1,this.m_v1.Set(this.m_v3)):0<w&&0<d&&0>=b?(t=1/(w+d),this.m_v2.a=w*t,this.m_v3.a=d*t,this.m_count=2,this.m_v1.Set(this.m_v3)):
(t=1/(b+g+c),this.m_v1.a=b*t,this.m_v2.a=g*t,this.m_v3.a=c*t,this.m_count=3)};w.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3);this.indexB=new Vector_a2j_Number(3)};t.b2SimplexVertex=function(){};t.prototype.Set=function(c){this.wA.SetV(c.wA);this.wB.SetV(c.wB);this.w.SetV(c.w);this.a=c.a;this.indexA=c.indexA;this.indexB=c.indexB};F.b2TimeOfImpact=function(){};F.TimeOfImpact=function(c){++F.b2_toiCalls;var m=c.proxyA,g=c.proxyB,b=c.sweepA,h=c.sweepB;d.b2Assert(b.t0==h.t0);d.b2Assert(1-
b.t0>Number.MIN_VALUE);var t=m.m_radius+g.m_radius;c=c.tolerance;var a=0,r=0,y=0;F.s_cache.count=0;for(F.s_distanceInput.useRadii=!1;;){b.GetTransform(F.s_xfA,a);h.GetTransform(F.s_xfB,a);F.s_distanceInput.proxyA=m;F.s_distanceInput.proxyB=g;F.s_distanceInput.transformA=F.s_xfA;F.s_distanceInput.transformB=F.s_xfB;B.Distance(F.s_distanceOutput,F.s_cache,F.s_distanceInput);if(0>=F.s_distanceOutput.distance){a=1;break}F.s_fcn.Initialize(F.s_cache,m,F.s_xfA,g,F.s_xfB);var w=F.s_fcn.Evaluate(F.s_xfA,
F.s_xfB);if(0>=w){a=1;break}0==r&&(y=w>t?e.Max(t-c,.75*t):e.Max(w-c,.02*t));if(w-y<.5*c){if(0==r){a=1;break}break}var C=a,f=a,k=1;b.GetTransform(F.s_xfA,k);h.GetTransform(F.s_xfB,k);var L=F.s_fcn.Evaluate(F.s_xfA,F.s_xfB);if(L>=y){a=1;break}for(var l=0;;){var q=0,q=l&1?f+(y-w)*(k-f)/(L-w):.5*(f+k);b.GetTransform(F.s_xfA,q);h.GetTransform(F.s_xfB,q);var n=F.s_fcn.Evaluate(F.s_xfA,F.s_xfB);if(e.Abs(n-y)<.025*c){C=q;break}n>y?(f=q,w=n):(k=q,L=n);++l;++F.b2_toiRootIters;if(50==l)break}F.b2_toiMaxRootIters=
e.Max(F.b2_toiMaxRootIters,l);if(C<(1+100*Number.MIN_VALUE)*a)break;a=C;r++;++F.b2_toiIters;if(1E3==r)break}F.b2_toiMaxIters=e.Max(F.b2_toiMaxIters,r);return a};Box2D.postDefs.push(function(){Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0;Box2D.Collision.b2TimeOfImpact.b2_toiIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0;Box2D.Collision.b2TimeOfImpact.s_cache=new w;Box2D.Collision.b2TimeOfImpact.s_distanceInput=
new A;Box2D.Collision.b2TimeOfImpact.s_xfA=new p;Box2D.Collision.b2TimeOfImpact.s_xfB=new p;Box2D.Collision.b2TimeOfImpact.s_fcn=new g;Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new h});L.b2TOIInput=function(){this.proxyA=new E;this.proxyB=new E;this.sweepA=new k;this.sweepB=new k};C.b2WorldManifold=function(){this.m_normal=new b};C.prototype.b2WorldManifold=function(){this.m_points=new Vector(d.b2_maxManifoldPoints);for(var c=0;c<d.b2_maxManifoldPoints;c++)this.m_points[c]=new b};C.prototype.Initialize=
function(c,m,g,b,h){void 0===g&&(g=0);void 0===h&&(h=0);if(0!=c.m_pointCount){var t=0,a,r,y=0,w=0,d=0,C=0,e=0;a=0;switch(c.m_type){case G.e_circles:r=m.R;a=c.m_localPoint;t=m.position.x+r.col1.x*a.x+r.col2.x*a.y;m=m.position.y+r.col1.y*a.x+r.col2.y*a.y;r=b.R;a=c.m_points[0].m_localPoint;c=b.position.x+r.col1.x*a.x+r.col2.x*a.y;b=b.position.y+r.col1.y*a.x+r.col2.y*a.y;a=c-t;r=b-m;y=a*a+r*r;y>Number.MIN_VALUE*Number.MIN_VALUE?(y=Math.sqrt(y),this.m_normal.x=a/y,this.m_normal.y=r/y):(this.m_normal.x=
1,this.m_normal.y=0);a=m+g*this.m_normal.y;b-=h*this.m_normal.y;this.m_points[0].x=.5*(t+g*this.m_normal.x+(c-h*this.m_normal.x));this.m_points[0].y=.5*(a+b);break;case G.e_faceA:r=m.R;a=c.m_localPlaneNormal;y=r.col1.x*a.x+r.col2.x*a.y;w=r.col1.y*a.x+r.col2.y*a.y;r=m.R;a=c.m_localPoint;d=m.position.x+r.col1.x*a.x+r.col2.x*a.y;C=m.position.y+r.col1.y*a.x+r.col2.y*a.y;this.m_normal.x=y;this.m_normal.y=w;for(t=0;t<c.m_pointCount;t++)r=b.R,a=c.m_points[t].m_localPoint,e=b.position.x+r.col1.x*a.x+r.col2.x*
a.y,a=b.position.y+r.col1.y*a.x+r.col2.y*a.y,this.m_points[t].x=e+.5*(g-(e-d)*y-(a-C)*w-h)*y,this.m_points[t].y=a+.5*(g-(e-d)*y-(a-C)*w-h)*w;break;case G.e_faceB:for(r=b.R,a=c.m_localPlaneNormal,y=r.col1.x*a.x+r.col2.x*a.y,w=r.col1.y*a.x+r.col2.y*a.y,r=b.R,a=c.m_localPoint,d=b.position.x+r.col1.x*a.x+r.col2.x*a.y,C=b.position.y+r.col1.y*a.x+r.col2.y*a.y,this.m_normal.x=-y,this.m_normal.y=-w,t=0;t<c.m_pointCount;t++)r=m.R,a=c.m_points[t].m_localPoint,e=m.position.x+r.col1.x*a.x+r.col2.x*a.y,a=m.position.y+
r.col1.y*a.x+r.col2.y*a.y,this.m_points[t].x=e+.5*(h-(e-d)*y-(a-C)*w-g)*y,this.m_points[t].y=a+.5*(h-(e-d)*y-(a-C)*w-g)*w}}};c.ClipVertex=function(){this.v=new b;this.id=new x};c.prototype.Set=function(c){this.v.SetV(c.v);this.id.Set(c.id)};m.Features=function(){};Object.defineProperty(m.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}});Object.defineProperty(m.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(c){void 0===c&&(c=
0);this._referenceEdge=c;this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255}});Object.defineProperty(m.prototype,"incidentEdge",{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}});Object.defineProperty(m.prototype,"incidentEdge",{enumerable:!1,configurable:!0,set:function(c){void 0===c&&(c=0);this._incidentEdge=c;this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}});Object.defineProperty(m.prototype,"incidentVertex",{enumerable:!1,configurable:!0,
get:function(){return this._incidentVertex}});Object.defineProperty(m.prototype,"incidentVertex",{enumerable:!1,configurable:!0,set:function(c){void 0===c&&(c=0);this._incidentVertex=c;this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680}});Object.defineProperty(m.prototype,"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}});Object.defineProperty(m.prototype,"flip",{enumerable:!1,configurable:!0,set:function(c){void 0===c&&(c=0);this._flip=c;this._m_id._key=
this._m_id._key&16777215|this._flip<<24&4278190080}})})();
(function(){var a=Box2D.Common.b2Settings,l=Box2D.Collision.Shapes.b2CircleShape,f=Box2D.Collision.Shapes.b2EdgeChainDef,d=Box2D.Collision.Shapes.b2EdgeShape,e=Box2D.Collision.Shapes.b2MassData,k=Box2D.Collision.Shapes.b2PolygonShape,p=Box2D.Collision.Shapes.b2Shape,b=Box2D.Common.Math.b2Mat22,q=Box2D.Common.Math.b2Math,n=Box2D.Common.Math.b2Transform,z=Box2D.Common.Math.b2Vec2,u=Box2D.Collision.b2Distance,x=Box2D.Collision.b2DistanceInput,v=Box2D.Collision.b2DistanceOutput,B=Box2D.Collision.b2DistanceProxy,
A=Box2D.Collision.b2SimplexCache;Box2D.inherit(l,Box2D.Collision.Shapes.b2Shape);l.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;l.b2CircleShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.m_p=new z};l.prototype.Copy=function(){var b=new l;b.Set(this);return b};l.prototype.Set=function(b){this.__super.Set.call(this,b);Box2D.is(b,l)&&this.m_p.SetV((b instanceof l?b:null).m_p)};l.prototype.TestPoint=function(b,a){var d=b.R,e=b.position.x+(d.col1.x*this.m_p.x+
d.col2.x*this.m_p.y),d=b.position.y+(d.col1.y*this.m_p.x+d.col2.y*this.m_p.y),e=a.x-e,d=a.y-d;return e*e+d*d<=this.m_radius*this.m_radius};l.prototype.RayCast=function(b,a,d){var e=d.R,f=a.p1.x-(d.position.x+(e.col1.x*this.m_p.x+e.col2.x*this.m_p.y));d=a.p1.y-(d.position.y+(e.col1.y*this.m_p.x+e.col2.y*this.m_p.y));var e=a.p2.x-a.p1.x,k=a.p2.y-a.p1.y,l=f*e+d*k,q=e*e+k*k,n=l*l-q*(f*f+d*d-this.m_radius*this.m_radius);if(0>n||q<Number.MIN_VALUE)return!1;l=-(l+Math.sqrt(n));return 0<=l&&l<=a.maxFraction*
q?(l/=q,b.fraction=l,b.normal.x=f+l*e,b.normal.y=d+l*k,b.normal.Normalize(),!0):!1};l.prototype.ComputeAABB=function(b,a){var d=a.R,e=a.position.x+(d.col1.x*this.m_p.x+d.col2.x*this.m_p.y),d=a.position.y+(d.col1.y*this.m_p.x+d.col2.y*this.m_p.y);b.lowerBound.Set(e-this.m_radius,d-this.m_radius);b.upperBound.Set(e+this.m_radius,d+this.m_radius)};l.prototype.ComputeMass=function(b,d){void 0===d&&(d=0);b.mass=d*a.b2_pi*this.m_radius*this.m_radius;b.center.SetV(this.m_p);b.I=b.mass*(.5*this.m_radius*
this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))};l.prototype.ComputeSubmergedArea=function(b,a,d,e){void 0===a&&(a=0);d=q.MulX(d,this.m_p);var f=-(q.Dot(b,d)-a);if(f<-this.m_radius+Number.MIN_VALUE)return 0;if(f>this.m_radius)return e.SetV(d),Math.PI*this.m_radius*this.m_radius;a=this.m_radius*this.m_radius;var k=f*f,f=a*(Math.asin(f/this.m_radius)+Math.PI/2)+f*Math.sqrt(a-k);a=-2/3*Math.pow(a-k,1.5)/f;e.x=d.x+b.x*a;e.y=d.y+b.y*a;return f};l.prototype.GetLocalPosition=function(){return this.m_p};
l.prototype.SetLocalPosition=function(b){this.m_p.SetV(b)};l.prototype.GetRadius=function(){return this.m_radius};l.prototype.SetRadius=function(b){void 0===b&&(b=0);this.m_radius=b};l.prototype.b2CircleShape=function(b){void 0===b&&(b=0);this.__super.b2Shape.call(this);this.m_type=p.e_circleShape;this.m_radius=b};f.b2EdgeChainDef=function(){};f.prototype.b2EdgeChainDef=function(){this.vertexCount=0;this.isALoop=!0;this.vertices=[]};Box2D.inherit(d,Box2D.Collision.Shapes.b2Shape);d.prototype.__super=
Box2D.Collision.Shapes.b2Shape.prototype;d.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.s_supportVec=new z;this.m_v1=new z;this.m_v2=new z;this.m_coreV1=new z;this.m_coreV2=new z;this.m_normal=new z;this.m_direction=new z;this.m_cornerDir1=new z;this.m_cornerDir2=new z};d.prototype.TestPoint=function(b,a){return!1};d.prototype.RayCast=function(b,a,d){var e,f=a.p2.x-a.p1.x,k=a.p2.y-a.p1.y;e=d.R;var l=d.position.x+(e.col1.x*this.m_v1.x+e.col2.x*this.m_v1.y),
q=d.position.y+(e.col1.y*this.m_v1.x+e.col2.y*this.m_v1.y),n=d.position.y+(e.col1.y*this.m_v2.x+e.col2.y*this.m_v2.y)-q;d=-(d.position.x+(e.col1.x*this.m_v2.x+e.col2.x*this.m_v2.y)-l);e=100*Number.MIN_VALUE;var v=-(f*n+k*d);if(v>e){var l=a.p1.x-l,x=a.p1.y-q,q=l*n+x*d;if(0<=q&&q<=a.maxFraction*v&&(a=-f*x+k*l,-e*v<=a&&a<=v*(1+e)))return b.fraction=q/v,a=Math.sqrt(n*n+d*d),b.normal.x=n/a,b.normal.y=d/a,!0}return!1};d.prototype.ComputeAABB=function(b,a){var d=a.R,e=a.position.x+(d.col1.x*this.m_v1.x+
d.col2.x*this.m_v1.y),f=a.position.y+(d.col1.y*this.m_v1.x+d.col2.y*this.m_v1.y),k=a.position.x+(d.col1.x*this.m_v2.x+d.col2.x*this.m_v2.y),d=a.position.y+(d.col1.y*this.m_v2.x+d.col2.y*this.m_v2.y);e<k?(b.lowerBound.x=e,b.upperBound.x=k):(b.lowerBound.x=k,b.upperBound.x=e);f<d?(b.lowerBound.y=f,b.upperBound.y=d):(b.lowerBound.y=d,b.upperBound.y=f)};d.prototype.ComputeMass=function(b,a){b.mass=0;b.center.SetV(this.m_v1);b.I=0};d.prototype.ComputeSubmergedArea=function(b,a,d,e){void 0===a&&(a=0);var f=
new z(b.x*a,b.y*a),k=q.MulX(d,this.m_v1);d=q.MulX(d,this.m_v2);var l=q.Dot(b,k)-a;b=q.Dot(b,d)-a;if(0<l){if(0<b)return 0;k.x=-b/(l-b)*k.x+l/(l-b)*d.x;k.y=-b/(l-b)*k.y+l/(l-b)*d.y}else 0<b&&(d.x=-b/(l-b)*k.x+l/(l-b)*d.x,d.y=-b/(l-b)*k.y+l/(l-b)*d.y);e.x=(f.x+k.x+d.x)/3;e.y=(f.y+k.y+d.y)/3;return.5*((k.x-f.x)*(d.y-f.y)-(k.y-f.y)*(d.x-f.x))};d.prototype.GetLength=function(){return this.m_length};d.prototype.GetVertex1=function(){return this.m_v1};d.prototype.GetVertex2=function(){return this.m_v2};d.prototype.GetCoreVertex1=
function(){return this.m_coreV1};d.prototype.GetCoreVertex2=function(){return this.m_coreV2};d.prototype.GetNormalVector=function(){return this.m_normal};d.prototype.GetDirectionVector=function(){return this.m_direction};d.prototype.GetCorner1Vector=function(){return this.m_cornerDir1};d.prototype.GetCorner2Vector=function(){return this.m_cornerDir2};d.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1};d.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2};d.prototype.GetFirstVertex=
function(b){var a=b.R;return new z(b.position.x+(a.col1.x*this.m_coreV1.x+a.col2.x*this.m_coreV1.y),b.position.y+(a.col1.y*this.m_coreV1.x+a.col2.y*this.m_coreV1.y))};d.prototype.GetNextEdge=function(){return this.m_nextEdge};d.prototype.GetPrevEdge=function(){return this.m_prevEdge};d.prototype.Support=function(b,a,d){void 0===a&&(a=0);void 0===d&&(d=0);var e=b.R,f=b.position.x+(e.col1.x*this.m_coreV1.x+e.col2.x*this.m_coreV1.y),k=b.position.y+(e.col1.y*this.m_coreV1.x+e.col2.y*this.m_coreV1.y),
l=b.position.x+(e.col1.x*this.m_coreV2.x+e.col2.x*this.m_coreV2.y);b=b.position.y+(e.col1.y*this.m_coreV2.x+e.col2.y*this.m_coreV2.y);f*a+k*d>l*a+b*d?(this.s_supportVec.x=f,this.s_supportVec.y=k):(this.s_supportVec.x=l,this.s_supportVec.y=b);return this.s_supportVec};d.prototype.b2EdgeShape=function(b,d){this.__super.b2Shape.call(this);this.m_type=p.e_edgeShape;this.m_nextEdge=this.m_prevEdge=null;this.m_v1=b;this.m_v2=d;this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y);this.m_length=
this.m_direction.Normalize();this.m_normal.Set(this.m_direction.y,-this.m_direction.x);this.m_coreV1.Set(-a.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-a.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y);this.m_coreV2.Set(-a.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-a.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y);this.m_cornerDir1=this.m_normal;this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)};d.prototype.SetPrevEdge=function(b,
a,d,e){this.m_prevEdge=b;this.m_coreV1=a;this.m_cornerDir1=d;this.m_cornerConvex1=e};d.prototype.SetNextEdge=function(b,a,d,e){this.m_nextEdge=b;this.m_coreV2=a;this.m_cornerDir2=d;this.m_cornerConvex2=e};e.b2MassData=function(){this.mass=0;this.center=new z(0,0);this.I=0};Box2D.inherit(k,Box2D.Collision.Shapes.b2Shape);k.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;k.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)};k.prototype.Copy=function(){var b=
new k;b.Set(this);return b};k.prototype.Set=function(b){this.__super.Set.call(this,b);if(Box2D.is(b,k)){b=b instanceof k?b:null;this.m_centroid.SetV(b.m_centroid);this.m_vertexCount=b.m_vertexCount;this.Reserve(this.m_vertexCount);for(var a=0;a<this.m_vertexCount;a++)this.m_vertices[a].SetV(b.m_vertices[a]),this.m_normals[a].SetV(b.m_normals[a])}};k.prototype.SetAsArray=function(b,a){void 0===a&&(a=0);for(var d=new Vector,e=0,f,e=0;e<b.length;++e)f=b[e],d.push(f);this.SetAsVector(d,a)};k.AsArray=
function(b,a){void 0===a&&(a=0);var d=new k;d.SetAsArray(b,a);return d};k.prototype.SetAsVector=function(b,d){void 0===d&&(d=0);0==d&&(d=b.length);a.b2Assert(2<=d);this.m_vertexCount=d;this.Reserve(d);for(var e=0,e=0;e<this.m_vertexCount;e++)this.m_vertices[e].SetV(b[e]);for(e=0;e<this.m_vertexCount;++e){var f=parseInt(e),l=parseInt(e+1<this.m_vertexCount?e+1:0),f=q.SubtractVV(this.m_vertices[l],this.m_vertices[f]);a.b2Assert(f.LengthSquared()>Number.MIN_VALUE);this.m_normals[e].SetV(q.CrossVF(f,
1));this.m_normals[e].Normalize()}this.m_centroid=k.ComputeCentroid(this.m_vertices,this.m_vertexCount)};k.AsVector=function(b,a){void 0===a&&(a=0);var d=new k;d.SetAsVector(b,a);return d};k.prototype.SetAsBox=function(b,a){void 0===b&&(b=0);void 0===a&&(a=0);this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-b,-a);this.m_vertices[1].Set(b,-a);this.m_vertices[2].Set(b,a);this.m_vertices[3].Set(-b,a);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,
0);this.m_centroid.SetZero()};k.AsBox=function(b,a){void 0===b&&(b=0);void 0===a&&(a=0);var d=new k;d.SetAsBox(b,a);return d};k.prototype.SetAsOrientedBox=function(b,a,d,e){void 0===b&&(b=0);void 0===a&&(a=0);void 0===d&&(d=null);void 0===e&&(e=0);this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-b,-a);this.m_vertices[1].Set(b,-a);this.m_vertices[2].Set(b,a);this.m_vertices[3].Set(-b,a);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,
0);this.m_centroid=d;b=new n;b.position=d;b.R.Set(e);for(d=0;d<this.m_vertexCount;++d)this.m_vertices[d]=q.MulX(b,this.m_vertices[d]),this.m_normals[d]=q.MulMV(b.R,this.m_normals[d])};k.AsOrientedBox=function(b,a,d,e){void 0===b&&(b=0);void 0===a&&(a=0);void 0===d&&(d=null);void 0===e&&(e=0);var f=new k;f.SetAsOrientedBox(b,a,d,e);return f};k.prototype.SetAsEdge=function(b,a){this.m_vertexCount=2;this.Reserve(2);this.m_vertices[0].SetV(b);this.m_vertices[1].SetV(a);this.m_centroid.x=.5*(b.x+a.x);
this.m_centroid.y=.5*(b.y+a.y);this.m_normals[0]=q.CrossVF(q.SubtractVV(a,b),1);this.m_normals[0].Normalize();this.m_normals[1].x=-this.m_normals[0].x;this.m_normals[1].y=-this.m_normals[0].y};k.AsEdge=function(b,a){var d=new k;d.SetAsEdge(b,a);return d};k.prototype.TestPoint=function(b,a){var d;d=b.R;for(var e=a.x-b.position.x,f=a.y-b.position.y,k=e*d.col1.x+f*d.col1.y,l=e*d.col2.x+f*d.col2.y,q=0;q<this.m_vertexCount;++q)if(d=this.m_vertices[q],e=k-d.x,f=l-d.y,d=this.m_normals[q],0<d.x*e+d.y*f)return!1;
return!0};k.prototype.RayCast=function(b,a,d){var e=0,f=a.maxFraction,k=0,l=0,q,n,k=a.p1.x-d.position.x,l=a.p1.y-d.position.y;q=d.R;var v=k*q.col1.x+l*q.col1.y,x=k*q.col2.x+l*q.col2.y,k=a.p2.x-d.position.x,l=a.p2.y-d.position.y;q=d.R;a=k*q.col1.x+l*q.col1.y-v;q=k*q.col2.x+l*q.col2.y-x;for(var u=-1,g=0;g<this.m_vertexCount;++g){n=this.m_vertices[g];k=n.x-v;l=n.y-x;n=this.m_normals[g];k=n.x*k+n.y*l;l=n.x*a+n.y*q;if(0==l){if(0>k)return!1}else 0>l&&k<e*l?(e=k/l,u=g):0<l&&k<f*l&&(f=k/l);if(f<e-Number.MIN_VALUE)return!1}return 0<=
u?(b.fraction=e,q=d.R,n=this.m_normals[u],b.normal.x=q.col1.x*n.x+q.col2.x*n.y,b.normal.y=q.col1.y*n.x+q.col2.y*n.y,!0):!1};k.prototype.ComputeAABB=function(b,a){for(var d=a.R,e=this.m_vertices[0],f=a.position.x+(d.col1.x*e.x+d.col2.x*e.y),k=a.position.y+(d.col1.y*e.x+d.col2.y*e.y),l=f,q=k,n=1;n<this.m_vertexCount;++n)var e=this.m_vertices[n],v=a.position.x+(d.col1.x*e.x+d.col2.x*e.y),e=a.position.y+(d.col1.y*e.x+d.col2.y*e.y),f=f<v?f:v,k=k<e?k:e,l=l>v?l:v,q=q>e?q:e;b.lowerBound.x=f-this.m_radius;
b.lowerBound.y=k-this.m_radius;b.upperBound.x=l+this.m_radius;b.upperBound.y=q+this.m_radius};k.prototype.ComputeMass=function(b,a){void 0===a&&(a=0);if(2==this.m_vertexCount)b.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),b.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),b.mass=0,b.I=0;else{for(var d=0,e=0,f=0,k=0,l=1/3,q=0;q<this.m_vertexCount;++q)var n=this.m_vertices[q],v=q+1<this.m_vertexCount?this.m_vertices[parseInt(q+1)]:this.m_vertices[0],x=n.x-0,u=n.y-0,g=v.x-0,r=v.y-0,
w=x*r-u*g,t=.5*w,f=f+t,d=d+t*l*(0+n.x+v.x),e=e+t*l*(0+n.y+v.y),n=x,k=k+w*(l*(.25*(n*n+g*n+g*g)+(0*n+0*g))+0+(l*(.25*(u*u+r*u+r*r)+(0*u+0*r))+0));b.mass=a*f;b.center.Set(1/f*d,1/f*e);b.I=a*k}};k.prototype.ComputeSubmergedArea=function(b,a,d,f){void 0===a&&(a=0);var k=q.MulTMV(d.R,b),l=a-q.Dot(b,d.position),n=new Vector_a2j_Number,v=0,x=-1;a=-1;var u=!1;for(b=b=0;b<this.m_vertexCount;++b){n[b]=q.Dot(k,this.m_vertices[b])-l;var p=n[b]<-Number.MIN_VALUE;0<b&&(p?u||(x=b-1,v++):u&&(a=b-1,v++));u=p}switch(v){case 0:return u?
(b=new e,this.ComputeMass(b,1),f.SetV(q.MulX(d,b.center)),b.mass):0;case 1:-1==x?x=this.m_vertexCount-1:a=this.m_vertexCount-1}b=parseInt((x+1)%this.m_vertexCount);k=parseInt((a+1)%this.m_vertexCount);l=(0-n[x])/(n[b]-n[x]);n=(0-n[a])/(n[k]-n[a]);x=new z(this.m_vertices[x].x*(1-l)+this.m_vertices[b].x*l,this.m_vertices[x].y*(1-l)+this.m_vertices[b].y*l);a=new z(this.m_vertices[a].x*(1-n)+this.m_vertices[k].x*n,this.m_vertices[a].y*(1-n)+this.m_vertices[k].y*n);n=0;l=new z;for(v=this.m_vertices[b];b!=
k;)b=(b+1)%this.m_vertexCount,u=b==k?a:this.m_vertices[b],p=.5*((v.x-x.x)*(u.y-x.y)-(v.y-x.y)*(u.x-x.x)),n+=p,l.x+=p*(x.x+v.x+u.x)/3,l.y+=p*(x.y+v.y+u.y)/3,v=u;l.Multiply(1/n);f.SetV(q.MulX(d,l));return n};k.prototype.GetVertexCount=function(){return this.m_vertexCount};k.prototype.GetVertices=function(){return this.m_vertices};k.prototype.GetNormals=function(){return this.m_normals};k.prototype.GetSupport=function(b){for(var a=0,d=this.m_vertices[0].x*b.x+this.m_vertices[0].y*b.y,e=1;e<this.m_vertexCount;++e){var f=
this.m_vertices[e].x*b.x+this.m_vertices[e].y*b.y;f>d&&(a=e,d=f)}return a};k.prototype.GetSupportVertex=function(b){for(var a=0,d=this.m_vertices[0].x*b.x+this.m_vertices[0].y*b.y,e=1;e<this.m_vertexCount;++e){var f=this.m_vertices[e].x*b.x+this.m_vertices[e].y*b.y;f>d&&(a=e,d=f)}return this.m_vertices[a]};k.prototype.Validate=function(){return!1};k.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this);this.m_type=p.e_polygonShape;this.m_centroid=new z;this.m_vertices=new Vector;this.m_normals=
new Vector};k.prototype.Reserve=function(b){void 0===b&&(b=0);for(var a=parseInt(this.m_vertices.length);a<b;a++)this.m_vertices[a]=new z,this.m_normals[a]=new z};k.ComputeCentroid=function(b,a){void 0===a&&(a=0);for(var d=new z,e=0,f=1/3,k=0;k<a;++k){var l=b[k],q=k+1<a?b[parseInt(k+1)]:b[0],n=.5*((l.x-0)*(q.y-0)-(l.y-0)*(q.x-0)),e=e+n;d.x+=n*f*(0+l.x+q.x);d.y+=n*f*(0+l.y+q.y)}d.x*=1/e;d.y*=1/e;return d};k.ComputeOBB=function(b,a,d){void 0===d&&(d=0);for(var e=0,f=new Vector(d+1),e=0;e<d;++e)f[e]=
a[e];f[d]=f[0];a=Number.MAX_VALUE;for(e=1;e<=d;++e){for(var k=f[parseInt(e-1)],l=f[e].x-k.x,q=f[e].y-k.y,n=Math.sqrt(l*l+q*q),l=l/n,q=q/n,v=-q,x=l,u=n=Number.MAX_VALUE,g=-Number.MAX_VALUE,r=-Number.MAX_VALUE,w=0;w<d;++w){var t=f[w].x-k.x,F=f[w].y-k.y,L=l*t+q*F,t=v*t+x*F;L<n&&(n=L);t<u&&(u=t);L>g&&(g=L);t>r&&(r=t)}w=(g-n)*(r-u);w<.95*a&&(a=w,b.R.col1.x=l,b.R.col1.y=q,b.R.col2.x=v,b.R.col2.y=x,l=.5*(n+g),q=.5*(u+r),v=b.R,b.center.x=k.x+(v.col1.x*l+v.col2.x*q),b.center.y=k.y+(v.col1.y*l+v.col2.y*q),
b.extents.x=.5*(g-n),b.extents.y=.5*(r-u))}};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2PolygonShape.s_mat=new b});p.b2Shape=function(){};p.prototype.Copy=function(){return null};p.prototype.Set=function(b){this.m_radius=b.m_radius};p.prototype.GetType=function(){return this.m_type};p.prototype.TestPoint=function(b,a){return!1};p.prototype.RayCast=function(b,a,d){return!1};p.prototype.ComputeAABB=function(b,a){};p.prototype.ComputeMass=function(b,a){};p.prototype.ComputeSubmergedArea=
function(b,a,d,e){return 0};p.TestOverlap=function(b,a,d,e){var f=new x;f.proxyA=new B;f.proxyA.Set(b);f.proxyB=new B;f.proxyB.Set(d);f.transformA=a;f.transformB=e;f.useRadii=!0;b=new A;b.count=0;a=new v;u.Distance(a,b,f);return a.distance<10*Number.MIN_VALUE};p.prototype.b2Shape=function(){this.m_type=p.e_unknownShape;this.m_radius=a.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=-1;Box2D.Collision.Shapes.b2Shape.e_circleShape=0;Box2D.Collision.Shapes.b2Shape.e_polygonShape=
1;Box2D.Collision.Shapes.b2Shape.e_edgeShape=2;Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount=3;Box2D.Collision.Shapes.b2Shape.e_hitCollide=1;Box2D.Collision.Shapes.b2Shape.e_missCollide=0;Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=-1})})();
(function(){var a=Box2D.Common.b2Color,l=Box2D.Common.b2Settings,f=Box2D.Common.Math.b2Math;a.b2Color=function(){this._b=this._g=this._r=0};a.prototype.b2Color=function(a,e,k){void 0===a&&(a=0);void 0===e&&(e=0);void 0===k&&(k=0);this._r=Box2D.parseUInt(255*f.Clamp(a,0,1));this._g=Box2D.parseUInt(255*f.Clamp(e,0,1));this._b=Box2D.parseUInt(255*f.Clamp(k,0,1))};a.prototype.Set=function(a,e,k){void 0===a&&(a=0);void 0===e&&(e=0);void 0===k&&(k=0);this._r=Box2D.parseUInt(255*f.Clamp(a,0,1));this._g=
Box2D.parseUInt(255*f.Clamp(e,0,1));this._b=Box2D.parseUInt(255*f.Clamp(k,0,1))};Object.defineProperty(a.prototype,"r",{enumerable:!1,configurable:!0,set:function(a){void 0===a&&(a=0);this._r=Box2D.parseUInt(255*f.Clamp(a,0,1))}});Object.defineProperty(a.prototype,"g",{enumerable:!1,configurable:!0,set:function(a){void 0===a&&(a=0);this._g=Box2D.parseUInt(255*f.Clamp(a,0,1))}});Object.defineProperty(a.prototype,"b",{enumerable:!1,configurable:!0,set:function(a){void 0===a&&(a=0);this._b=Box2D.parseUInt(255*
f.Clamp(a,0,1))}});Object.defineProperty(a.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<16|this._g<<8|this._b}});l.b2Settings=function(){};l.b2MixFriction=function(a,e){void 0===a&&(a=0);void 0===e&&(e=0);return Math.sqrt(a*e)};l.b2MixRestitution=function(a,e){void 0===a&&(a=0);void 0===e&&(e=0);return a>e?a:e};l.b2Assert=function(a){if(!a)throw"Assertion Failed";};Box2D.postDefs.push(function(){Box2D.Common.b2Settings.VERSION="2.1alpha";Box2D.Common.b2Settings.USHRT_MAX=
65535;Box2D.Common.b2Settings.b2_pi=Math.PI;Box2D.Common.b2Settings.b2_maxManifoldPoints=2;Box2D.Common.b2Settings.b2_aabbExtension=.1;Box2D.Common.b2Settings.b2_aabbMultiplier=2;Box2D.Common.b2Settings.b2_polygonRadius=2*l.b2_linearSlop;Box2D.Common.b2Settings.b2_linearSlop=.005;Box2D.Common.b2Settings.b2_angularSlop=2/180*l.b2_pi;Box2D.Common.b2Settings.b2_toiSlop=8*l.b2_linearSlop;Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32;Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32;Box2D.Common.b2Settings.b2_velocityThreshold=
1;Box2D.Common.b2Settings.b2_maxLinearCorrection=.2;Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*l.b2_pi;Box2D.Common.b2Settings.b2_maxTranslation=2;Box2D.Common.b2Settings.b2_maxTranslationSquared=l.b2_maxTranslation*l.b2_maxTranslation;Box2D.Common.b2Settings.b2_maxRotation=.5*l.b2_pi;Box2D.Common.b2Settings.b2_maxRotationSquared=l.b2_maxRotation*l.b2_maxRotation;Box2D.Common.b2Settings.b2_contactBaumgarte=.2;Box2D.Common.b2Settings.b2_timeToSleep=.5;Box2D.Common.b2Settings.b2_linearSleepTolerance=
.01;Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*l.b2_pi})})();
(function(){var a=Box2D.Common.Math.b2Mat22,l=Box2D.Common.Math.b2Mat33,f=Box2D.Common.Math.b2Math,d=Box2D.Common.Math.b2Sweep,e=Box2D.Common.Math.b2Transform,k=Box2D.Common.Math.b2Vec2,p=Box2D.Common.Math.b2Vec3;a.b2Mat22=function(){this.col1=new k;this.col2=new k};a.prototype.b2Mat22=function(){this.SetIdentity()};a.FromAngle=function(b){void 0===b&&(b=0);var d=new a;d.Set(b);return d};a.FromVV=function(b,d){var e=new a;e.SetVV(b,d);return e};a.prototype.Set=function(b){void 0===b&&(b=0);var a=
Math.cos(b);b=Math.sin(b);this.col1.x=a;this.col2.x=-b;this.col1.y=b;this.col2.y=a};a.prototype.SetVV=function(b,a){this.col1.SetV(b);this.col2.SetV(a)};a.prototype.Copy=function(){var b=new a;b.SetM(this);return b};a.prototype.SetM=function(b){this.col1.SetV(b.col1);this.col2.SetV(b.col2)};a.prototype.AddM=function(b){this.col1.x+=b.col1.x;this.col1.y+=b.col1.y;this.col2.x+=b.col2.x;this.col2.y+=b.col2.y};a.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col1.y=0;this.col2.y=1};
a.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col1.y=0;this.col2.y=0};a.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)};a.prototype.GetInverse=function(b){var a=this.col1.x,d=this.col2.x,e=this.col1.y,f=this.col2.y,k=a*f-d*e;0!=k&&(k=1/k);b.col1.x=k*f;b.col2.x=-k*d;b.col1.y=-k*e;b.col2.y=k*a;return b};a.prototype.Solve=function(b,a,d){void 0===a&&(a=0);void 0===d&&(d=0);var e=this.col1.x,f=this.col2.x,k=this.col1.y,l=this.col2.y,p=e*l-f*k;0!=p&&(p=1/p);
b.x=p*(l*a-f*d);b.y=p*(e*d-k*a);return b};a.prototype.Abs=function(){this.col1.Abs();this.col2.Abs()};l.b2Mat33=function(){this.col1=new p;this.col2=new p;this.col3=new p};l.prototype.b2Mat33=function(b,a,d){void 0===b&&(b=null);void 0===a&&(a=null);void 0===d&&(d=null);b||a||d?(this.col1.SetV(b),this.col2.SetV(a),this.col3.SetV(d)):(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero())};l.prototype.SetVVV=function(b,a,d){this.col1.SetV(b);this.col2.SetV(a);this.col3.SetV(d)};l.prototype.Copy=
function(){return new l(this.col1,this.col2,this.col3)};l.prototype.SetM=function(b){this.col1.SetV(b.col1);this.col2.SetV(b.col2);this.col3.SetV(b.col3)};l.prototype.AddM=function(b){this.col1.x+=b.col1.x;this.col1.y+=b.col1.y;this.col1.z+=b.col1.z;this.col2.x+=b.col2.x;this.col2.y+=b.col2.y;this.col2.z+=b.col2.z;this.col3.x+=b.col3.x;this.col3.y+=b.col3.y;this.col3.z+=b.col3.z};l.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=1;this.col3.y=0;
this.col1.z=0;this.col2.z=0;this.col3.z=1};l.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=0;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=0};l.prototype.Solve22=function(b,a,d){void 0===a&&(a=0);void 0===d&&(d=0);var e=this.col1.x,f=this.col2.x,k=this.col1.y,l=this.col2.y,p=e*l-f*k;0!=p&&(p=1/p);b.x=p*(l*a-f*d);b.y=p*(e*d-k*a);return b};l.prototype.Solve33=function(b,a,d,e){void 0===a&&(a=0);void 0===d&&(d=0);void 0===e&&(e=0);var f=this.col1.x,
k=this.col1.y,l=this.col1.z,p=this.col2.x,A=this.col2.y,h=this.col2.z,E=this.col3.x,I=this.col3.y,N=this.col3.z,H=f*(A*N-h*I)+k*(h*E-p*N)+l*(p*I-A*E);0!=H&&(H=1/H);b.x=H*(a*(A*N-h*I)+d*(h*E-p*N)+e*(p*I-A*E));b.y=H*(f*(d*N-e*I)+k*(e*E-a*N)+l*(a*I-d*E));b.z=H*(f*(A*e-h*d)+k*(h*a-p*e)+l*(p*d-A*a));return b};f.b2Math=function(){};f.IsValid=function(b){void 0===b&&(b=0);return isFinite(b)};f.Dot=function(b,a){return b.x*a.x+b.y*a.y};f.CrossVV=function(b,a){return b.x*a.y-b.y*a.x};f.CrossVF=function(b,
a){void 0===a&&(a=0);return new k(a*b.y,-a*b.x)};f.CrossFV=function(b,a){void 0===b&&(b=0);return new k(-b*a.y,b*a.x)};f.MulMV=function(b,a){return new k(b.col1.x*a.x+b.col2.x*a.y,b.col1.y*a.x+b.col2.y*a.y)};f.MulTMV=function(b,a){return new k(f.Dot(a,b.col1),f.Dot(a,b.col2))};f.MulX=function(b,a){var d=f.MulMV(b.R,a);d.x+=b.position.x;d.y+=b.position.y;return d};f.MulXT=function(b,a){var d=f.SubtractVV(a,b.position),e=d.x*b.R.col1.x+d.y*b.R.col1.y;d.y=d.x*b.R.col2.x+d.y*b.R.col2.y;d.x=e;return d};
f.AddVV=function(b,a){return new k(b.x+a.x,b.y+a.y)};f.SubtractVV=function(b,a){return new k(b.x-a.x,b.y-a.y)};f.Distance=function(b,a){var d=b.x-a.x,e=b.y-a.y;return Math.sqrt(d*d+e*e)};f.DistanceSquared=function(b,a){var d=b.x-a.x,e=b.y-a.y;return d*d+e*e};f.MulFV=function(b,a){void 0===b&&(b=0);return new k(b*a.x,b*a.y)};f.AddMM=function(b,d){return a.FromVV(f.AddVV(b.col1,d.col1),f.AddVV(b.col2,d.col2))};f.MulMM=function(b,d){return a.FromVV(f.MulMV(b,d.col1),f.MulMV(b,d.col2))};f.MulTMM=function(b,
d){var e=new k(f.Dot(b.col1,d.col1),f.Dot(b.col2,d.col1)),l=new k(f.Dot(b.col1,d.col2),f.Dot(b.col2,d.col2));return a.FromVV(e,l)};f.Abs=function(b){void 0===b&&(b=0);return 0<b?b:-b};f.AbsV=function(b){return new k(f.Abs(b.x),f.Abs(b.y))};f.AbsM=function(b){return a.FromVV(f.AbsV(b.col1),f.AbsV(b.col2))};f.Min=function(b,a){void 0===b&&(b=0);void 0===a&&(a=0);return b<a?b:a};f.MinV=function(a,d){return new k(f.Min(a.x,d.x),f.Min(a.y,d.y))};f.Max=function(a,d){void 0===a&&(a=0);void 0===d&&(d=0);
return a>d?a:d};f.MaxV=function(a,d){return new k(f.Max(a.x,d.x),f.Max(a.y,d.y))};f.Clamp=function(a,d,e){void 0===a&&(a=0);void 0===d&&(d=0);void 0===e&&(e=0);return a<d?d:a>e?e:a};f.ClampV=function(a,d,e){return f.MaxV(d,f.MinV(a,e))};f.Swap=function(a,d){var e=a[0];a[0]=d[0];d[0]=e};f.Random=function(){return 2*Math.random()-1};f.RandomRange=function(a,d){void 0===a&&(a=0);void 0===d&&(d=0);return(d-a)*Math.random()+a};f.NextPowerOfTwo=function(a){void 0===a&&(a=0);a|=a>>1&2147483647;a|=a>>2&1073741823;
a|=a>>4&268435455;a|=a>>8&16777215;return(a|a>>16&65535)+1};f.IsPowerOfTwo=function(a){void 0===a&&(a=0);return 0<a&&0==(a&a-1)};Box2D.postDefs.push(function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new k(0,0);Box2D.Common.Math.b2Math.b2Mat22_identity=a.FromVV(new k(1,0),new k(0,1));Box2D.Common.Math.b2Math.b2Transform_identity=new e(f.b2Vec2_zero,f.b2Mat22_identity)});d.b2Sweep=function(){this.localCenter=new k;this.c0=new k;this.c=new k};d.prototype.Set=function(a){this.localCenter.SetV(a.localCenter);
this.c0.SetV(a.c0);this.c.SetV(a.c);this.a0=a.a0;this.a=a.a;this.t0=a.t0};d.prototype.Copy=function(){var a=new d;a.localCenter.SetV(this.localCenter);a.c0.SetV(this.c0);a.c.SetV(this.c);a.a0=this.a0;a.a=this.a;a.t0=this.t0;return a};d.prototype.GetTransform=function(a,d){void 0===d&&(d=0);a.position.x=(1-d)*this.c0.x+d*this.c.x;a.position.y=(1-d)*this.c0.y+d*this.c.y;a.R.Set((1-d)*this.a0+d*this.a);var e=a.R;a.position.x-=e.col1.x*this.localCenter.x+e.col2.x*this.localCenter.y;a.position.y-=e.col1.y*
this.localCenter.x+e.col2.y*this.localCenter.y};d.prototype.Advance=function(a){void 0===a&&(a=0);if(this.t0<a&&1-this.t0>Number.MIN_VALUE){var d=(a-this.t0)/(1-this.t0);this.c0.x=(1-d)*this.c0.x+d*this.c.x;this.c0.y=(1-d)*this.c0.y+d*this.c.y;this.a0=(1-d)*this.a0+d*this.a;this.t0=a}};e.b2Transform=function(){this.position=new k;this.R=new a};e.prototype.b2Transform=function(a,d){void 0===a&&(a=null);void 0===d&&(d=null);a&&(this.position.SetV(a),this.R.SetM(d))};e.prototype.Initialize=function(a,
d){this.position.SetV(a);this.R.SetM(d)};e.prototype.SetIdentity=function(){this.position.SetZero();this.R.SetIdentity()};e.prototype.Set=function(a){this.position.SetV(a.position);this.R.SetM(a.R)};e.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)};k.b2Vec2=function(){};k.prototype.b2Vec2=function(a,d){void 0===a&&(a=0);void 0===d&&(d=0);this.x=a;this.y=d};k.prototype.SetZero=function(){this.y=this.x=0};k.prototype.Set=function(a,d){void 0===a&&(a=0);void 0===d&&(d=0);
this.x=a;this.y=d};k.prototype.SetV=function(a){this.x=a.x;this.y=a.y};k.prototype.GetNegative=function(){return new k(-this.x,-this.y)};k.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y};k.Make=function(a,d){void 0===a&&(a=0);void 0===d&&(d=0);return new k(a,d)};k.prototype.Copy=function(){return new k(this.x,this.y)};k.prototype.Add=function(a){this.x+=a.x;this.y+=a.y};k.prototype.Subtract=function(a){this.x-=a.x;this.y-=a.y};k.prototype.Multiply=function(a){void 0===a&&(a=0);this.x*=
a;this.y*=a};k.prototype.MulM=function(a){var d=this.x;this.x=a.col1.x*d+a.col2.x*this.y;this.y=a.col1.y*d+a.col2.y*this.y};k.prototype.MulTM=function(a){var d=f.Dot(this,a.col1);this.y=f.Dot(this,a.col2);this.x=d};k.prototype.CrossVF=function(a){void 0===a&&(a=0);var d=this.x;this.x=a*this.y;this.y=-a*d};k.prototype.CrossFV=function(a){void 0===a&&(a=0);var d=this.x;this.x=-a*this.y;this.y=a*d};k.prototype.MinV=function(a){this.x=this.x<a.x?this.x:a.x;this.y=this.y<a.y?this.y:a.y};k.prototype.MaxV=
function(a){this.x=this.x>a.x?this.x:a.x;this.y=this.y>a.y?this.y:a.y};k.prototype.Abs=function(){0>this.x&&(this.x=-this.x);0>this.y&&(this.y=-this.y)};k.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};k.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y};k.prototype.Normalize=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);if(a<Number.MIN_VALUE)return 0;var d=1/a;this.x*=d;this.y*=d;return a};k.prototype.IsValid=function(){return f.IsValid(this.x)&&
f.IsValid(this.y)};p.b2Vec3=function(){};p.prototype.b2Vec3=function(a,d,e){void 0===a&&(a=0);void 0===d&&(d=0);void 0===e&&(e=0);this.x=a;this.y=d;this.z=e};p.prototype.SetZero=function(){this.x=this.y=this.z=0};p.prototype.Set=function(a,d,e){void 0===a&&(a=0);void 0===d&&(d=0);void 0===e&&(e=0);this.x=a;this.y=d;this.z=e};p.prototype.SetV=function(a){this.x=a.x;this.y=a.y;this.z=a.z};p.prototype.GetNegative=function(){return new p(-this.x,-this.y,-this.z)};p.prototype.NegativeSelf=function(){this.x=
-this.x;this.y=-this.y;this.z=-this.z};p.prototype.Copy=function(){return new p(this.x,this.y,this.z)};p.prototype.Add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z};p.prototype.Subtract=function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z};p.prototype.Multiply=function(a){void 0===a&&(a=0);this.x*=a;this.y*=a;this.z*=a}})();
(function(){var a=Box2D.Common.Math.b2Math,l=Box2D.Common.Math.b2Sweep,f=Box2D.Common.Math.b2Transform,d=Box2D.Common.Math.b2Vec2,e=Box2D.Common.b2Color,k=Box2D.Common.b2Settings,p=Box2D.Collision.b2AABB,b=Box2D.Collision.b2ContactPoint,q=Box2D.Collision.b2DynamicTreeBroadPhase,n=Box2D.Collision.b2RayCastInput,z=Box2D.Collision.b2RayCastOutput,u=Box2D.Collision.Shapes.b2CircleShape,x=Box2D.Collision.Shapes.b2EdgeShape,v=Box2D.Collision.Shapes.b2MassData,B=Box2D.Collision.Shapes.b2PolygonShape,A=Box2D.Collision.Shapes.b2Shape,
h=Box2D.Dynamics.b2Body,E=Box2D.Dynamics.b2BodyDef,I=Box2D.Dynamics.b2ContactFilter,N=Box2D.Dynamics.b2ContactImpulse,H=Box2D.Dynamics.b2ContactListener,M=Box2D.Dynamics.b2ContactManager,G=Box2D.Dynamics.b2DebugDraw,Q=Box2D.Dynamics.b2DestructionListener,J=Box2D.Dynamics.b2FilterData,K=Box2D.Dynamics.b2Fixture,R=Box2D.Dynamics.b2FixtureDef,O=Box2D.Dynamics.b2Island,g=Box2D.Dynamics.b2TimeStep,r=Box2D.Dynamics.b2World,w=Box2D.Dynamics.Contacts.b2Contact,t=Box2D.Dynamics.Contacts.b2ContactFactory,F=
Box2D.Dynamics.Contacts.b2ContactSolver,L=Box2D.Dynamics.Joints.b2Joint,C=Box2D.Dynamics.Joints.b2PulleyJoint;h.b2Body=function(){this.m_xf=new f;this.m_sweep=new l;this.m_linearVelocity=new d;this.m_force=new d};h.prototype.connectEdges=function(c,m,g){void 0===g&&(g=0);var b=Math.atan2(m.GetDirectionVector().y,m.GetDirectionVector().x);g=a.MulFV(Math.tan(.5*(b-g)),m.GetDirectionVector());g=a.SubtractVV(g,m.GetNormalVector());g=a.MulFV(k.b2_toiSlop,g);g=a.AddVV(g,m.GetVertex1());var d=a.AddVV(c.GetDirectionVector(),
m.GetDirectionVector());d.Normalize();var t=0<a.Dot(c.GetDirectionVector(),m.GetNormalVector());c.SetNextEdge(m,g,d,t);m.SetPrevEdge(c,g,d,t);return b};h.prototype.CreateFixture=function(c){if(1==this.m_world.IsLocked())return null;var a=new K;a.Create(this,this.m_xf,c);this.m_flags&h.e_activeFlag&&a.CreateProxy(this.m_world.m_contactManager.m_broadPhase,this.m_xf);a.m_next=this.m_fixtureList;this.m_fixtureList=a;++this.m_fixtureCount;a.m_body=this;0<a.m_density&&this.ResetMassData();this.m_world.m_flags|=
r.e_newFixture;return a};h.prototype.CreateFixture2=function(c,a){void 0===a&&(a=0);var g=new R;g.shape=c;g.density=a;return this.CreateFixture(g)};h.prototype.DestroyFixture=function(c){if(1!=this.m_world.IsLocked()){for(var a=this.m_fixtureList,g=null;null!=a;){if(a==c){g?g.m_next=c.m_next:this.m_fixtureList=c.m_next;break}g=a;a=a.m_next}for(a=this.m_contactList;a;){var g=a.contact,a=a.next,b=g.GetFixtureA(),d=g.GetFixtureB();c!=b&&c!=d||this.m_world.m_contactManager.Destroy(g)}this.m_flags&h.e_activeFlag&&
c.DestroyProxy(this.m_world.m_contactManager.m_broadPhase);c.Destroy();c.m_body=null;c.m_next=null;--this.m_fixtureCount;this.ResetMassData()}};h.prototype.SetPositionAndAngle=function(c,a){void 0===a&&(a=0);var g;if(1!=this.m_world.IsLocked()){this.m_xf.R.Set(a);this.m_xf.position.SetV(c);g=this.m_xf.R;var b=this.m_sweep.localCenter;this.m_sweep.c.x=g.col1.x*b.x+g.col2.x*b.y;this.m_sweep.c.y=g.col1.y*b.x+g.col2.y*b.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);
this.m_sweep.a0=this.m_sweep.a=a;b=this.m_world.m_contactManager.m_broadPhase;for(g=this.m_fixtureList;g;g=g.m_next)g.Synchronize(b,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}};h.prototype.SetTransform=function(c){this.SetPositionAndAngle(c.position,c.GetAngle())};h.prototype.GetTransform=function(){return this.m_xf};h.prototype.GetPosition=function(){return this.m_xf.position};h.prototype.SetPosition=function(c){this.SetPositionAndAngle(c,this.GetAngle())};h.prototype.GetAngle=
function(){return this.m_sweep.a};h.prototype.SetAngle=function(c){void 0===c&&(c=0);this.SetPositionAndAngle(this.GetPosition(),c)};h.prototype.GetWorldCenter=function(){return this.m_sweep.c};h.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter};h.prototype.SetLinearVelocity=function(c){this.m_type!=h.b2_staticBody&&this.m_linearVelocity.SetV(c)};h.prototype.GetLinearVelocity=function(){return this.m_linearVelocity};h.prototype.SetAngularVelocity=function(c){void 0===c&&(c=0);this.m_type!=
h.b2_staticBody&&(this.m_angularVelocity=c)};h.prototype.GetAngularVelocity=function(){return this.m_angularVelocity};h.prototype.GetDefinition=function(){var c=new E;c.type=this.GetType();c.allowSleep=(this.m_flags&h.e_allowSleepFlag)==h.e_allowSleepFlag;c.angle=this.GetAngle();c.angularDamping=this.m_angularDamping;c.angularVelocity=this.m_angularVelocity;c.fixedRotation=(this.m_flags&h.e_fixedRotationFlag)==h.e_fixedRotationFlag;c.bullet=(this.m_flags&h.e_bulletFlag)==h.e_bulletFlag;c.awake=(this.m_flags&
h.e_awakeFlag)==h.e_awakeFlag;c.linearDamping=this.m_linearDamping;c.linearVelocity.SetV(this.GetLinearVelocity());c.position=this.GetPosition();c.userData=this.GetUserData();return c};h.prototype.ApplyForce=function(c,a){this.m_type==h.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_force.x+=c.x,this.m_force.y+=c.y,this.m_torque+=(a.x-this.m_sweep.c.x)*c.y-(a.y-this.m_sweep.c.y)*c.x)};h.prototype.ApplyTorque=function(c){void 0===c&&(c=0);this.m_type==h.b2_dynamicBody&&(0==this.IsAwake()&&
this.SetAwake(!0),this.m_torque+=c)};h.prototype.ApplyImpulse=function(c,a){this.m_type==h.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*c.x,this.m_linearVelocity.y+=this.m_invMass*c.y,this.m_angularVelocity+=this.m_invI*((a.x-this.m_sweep.c.x)*c.y-(a.y-this.m_sweep.c.y)*c.x))};h.prototype.Split=function(c){for(var g=this.GetLinearVelocity().Copy(),b=this.GetAngularVelocity(),d=this.GetWorldCenter(),t=this.m_world.CreateBody(this.GetDefinition()),r,
e=this.m_fixtureList;e;)if(c(e)){var w=e.m_next;r?r.m_next=w:this.m_fixtureList=w;this.m_fixtureCount--;e.m_next=t.m_fixtureList;t.m_fixtureList=e;t.m_fixtureCount++;e.m_body=t;e=w}else r=e,e=e.m_next;this.ResetMassData();t.ResetMassData();r=this.GetWorldCenter();c=t.GetWorldCenter();r=a.AddVV(g,a.CrossFV(b,a.SubtractVV(r,d)));g=a.AddVV(g,a.CrossFV(b,a.SubtractVV(c,d)));this.SetLinearVelocity(r);t.SetLinearVelocity(g);this.SetAngularVelocity(b);t.SetAngularVelocity(b);this.SynchronizeFixtures();t.SynchronizeFixtures();
return t};h.prototype.Merge=function(c){var a;for(a=c.m_fixtureList;a;){var g=a.m_next;c.m_fixtureCount--;a.m_next=this.m_fixtureList;this.m_fixtureList=a;this.m_fixtureCount++;a.m_body=d;a=g}b.m_fixtureCount=0;var b=this,d=c;b.GetWorldCenter();d.GetWorldCenter();b.GetLinearVelocity().Copy();d.GetLinearVelocity().Copy();b.GetAngularVelocity();d.GetAngularVelocity();b.ResetMassData();this.SynchronizeFixtures()};h.prototype.GetMass=function(){return this.m_mass};h.prototype.GetInertia=function(){return this.m_I};
h.prototype.GetMassData=function(c){c.mass=this.m_mass;c.I=this.m_I;c.center.SetV(this.m_sweep.localCenter)};h.prototype.SetMassData=function(c){k.b2Assert(0==this.m_world.IsLocked());if(1!=this.m_world.IsLocked()&&this.m_type==h.b2_dynamicBody){this.m_invI=this.m_I=this.m_invMass=0;this.m_mass=c.mass;0>=this.m_mass&&(this.m_mass=1);this.m_invMass=1/this.m_mass;0<c.I&&0==(this.m_flags&h.e_fixedRotationFlag)&&(this.m_I=c.I-this.m_mass*(c.center.x*c.center.x+c.center.y*c.center.y),this.m_invI=1/this.m_I);
var g=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(c.center);this.m_sweep.c0.SetV(a.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-g.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-g.x)}};h.prototype.ResetMassData=function(){this.m_invI=this.m_I=this.m_invMass=this.m_mass=0;this.m_sweep.localCenter.SetZero();if(this.m_type!=h.b2_staticBody&&this.m_type!=h.b2_kinematicBody){for(var c=
d.Make(0,0),g=this.m_fixtureList;g;g=g.m_next)if(0!=g.m_density){var b=g.GetMassData();this.m_mass+=b.mass;c.x+=b.center.x*b.mass;c.y+=b.center.y*b.mass;this.m_I+=b.I}0<this.m_mass?(this.m_invMass=1/this.m_mass,c.x*=this.m_invMass,c.y*=this.m_invMass):this.m_invMass=this.m_mass=1;0<this.m_I&&0==(this.m_flags&h.e_fixedRotationFlag)?(this.m_I-=this.m_mass*(c.x*c.x+c.y*c.y),this.m_I*=this.m_inertiaScale,k.b2Assert(0<this.m_I),this.m_invI=1/this.m_I):this.m_invI=this.m_I=0;g=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(c);
this.m_sweep.c0.SetV(a.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-g.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-g.x)}};h.prototype.GetWorldPoint=function(c){var a=this.m_xf.R;c=new d(a.col1.x*c.x+a.col2.x*c.y,a.col1.y*c.x+a.col2.y*c.y);c.x+=this.m_xf.position.x;c.y+=this.m_xf.position.y;return c};h.prototype.GetWorldVector=function(c){return a.MulMV(this.m_xf.R,c)};h.prototype.GetLocalPoint=
function(c){return a.MulXT(this.m_xf,c)};h.prototype.GetLocalVector=function(c){return a.MulTMV(this.m_xf.R,c)};h.prototype.GetLinearVelocityFromWorldPoint=function(c){return new d(this.m_linearVelocity.x-this.m_angularVelocity*(c.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(c.x-this.m_sweep.c.x))};h.prototype.GetLinearVelocityFromLocalPoint=function(c){var a=this.m_xf.R;c=new d(a.col1.x*c.x+a.col2.x*c.y,a.col1.y*c.x+a.col2.y*c.y);c.x+=this.m_xf.position.x;c.y+=this.m_xf.position.y;
return new d(this.m_linearVelocity.x-this.m_angularVelocity*(c.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(c.x-this.m_sweep.c.x))};h.prototype.GetLinearDamping=function(){return this.m_linearDamping};h.prototype.SetLinearDamping=function(c){void 0===c&&(c=0);this.m_linearDamping=c};h.prototype.GetAngularDamping=function(){return this.m_angularDamping};h.prototype.SetAngularDamping=function(c){void 0===c&&(c=0);this.m_angularDamping=c};h.prototype.SetType=function(c){void 0===
c&&(c=0);if(this.m_type!=c)for(this.m_type=c,this.ResetMassData(),this.m_type==h.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0,c=this.m_contactList;c;c=c.next)c.contact.FlagForFiltering()};h.prototype.GetType=function(){return this.m_type};h.prototype.SetBullet=function(c){this.m_flags=c?this.m_flags|h.e_bulletFlag:this.m_flags&~h.e_bulletFlag};h.prototype.IsBullet=function(){return(this.m_flags&h.e_bulletFlag)==
h.e_bulletFlag};h.prototype.SetSleepingAllowed=function(c){c?this.m_flags|=h.e_allowSleepFlag:(this.m_flags&=~h.e_allowSleepFlag,this.SetAwake(!0))};h.prototype.SetAwake=function(c){c?(this.m_flags|=h.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~h.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)};h.prototype.IsAwake=function(){return(this.m_flags&h.e_awakeFlag)==h.e_awakeFlag};h.prototype.SetFixedRotation=function(c){this.m_flags=
c?this.m_flags|h.e_fixedRotationFlag:this.m_flags&~h.e_fixedRotationFlag;this.ResetMassData()};h.prototype.IsFixedRotation=function(){return(this.m_flags&h.e_fixedRotationFlag)==h.e_fixedRotationFlag};h.prototype.SetActive=function(c){if(c!=this.IsActive()){var a;if(c)for(this.m_flags|=h.e_activeFlag,c=this.m_world.m_contactManager.m_broadPhase,a=this.m_fixtureList;a;a=a.m_next)a.CreateProxy(c,this.m_xf);else{this.m_flags&=~h.e_activeFlag;c=this.m_world.m_contactManager.m_broadPhase;for(a=this.m_fixtureList;a;a=
a.m_next)a.DestroyProxy(c);for(c=this.m_contactList;c;)a=c,c=c.next,this.m_world.m_contactManager.Destroy(a.contact);this.m_contactList=null}}};h.prototype.IsActive=function(){return(this.m_flags&h.e_activeFlag)==h.e_activeFlag};h.prototype.IsSleepingAllowed=function(){return(this.m_flags&h.e_allowSleepFlag)==h.e_allowSleepFlag};h.prototype.GetFixtureList=function(){return this.m_fixtureList};h.prototype.GetJointList=function(){return this.m_jointList};h.prototype.GetControllerList=function(){return this.m_controllerList};
h.prototype.GetContactList=function(){return this.m_contactList};h.prototype.GetNext=function(){return this.m_next};h.prototype.GetUserData=function(){return this.m_userData};h.prototype.SetUserData=function(c){this.m_userData=c};h.prototype.GetWorld=function(){return this.m_world};h.prototype.b2Body=function(c,a){this.m_flags=0;c.bullet&&(this.m_flags|=h.e_bulletFlag);c.fixedRotation&&(this.m_flags|=h.e_fixedRotationFlag);c.allowSleep&&(this.m_flags|=h.e_allowSleepFlag);c.awake&&(this.m_flags|=h.e_awakeFlag);
c.active&&(this.m_flags|=h.e_activeFlag);this.m_world=a;this.m_xf.position.SetV(c.position);this.m_xf.R.Set(c.angle);this.m_sweep.localCenter.SetZero();this.m_sweep.t0=1;this.m_sweep.a0=this.m_sweep.a=c.angle;var g=this.m_xf.R,b=this.m_sweep.localCenter;this.m_sweep.c.x=g.col1.x*b.x+g.col2.x*b.y;this.m_sweep.c.y=g.col1.y*b.x+g.col2.y*b.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_contactList=this.m_controllerList=this.m_jointList=
null;this.m_controllerCount=0;this.m_next=this.m_prev=null;this.m_linearVelocity.SetV(c.linearVelocity);this.m_angularVelocity=c.angularVelocity;this.m_linearDamping=c.linearDamping;this.m_angularDamping=c.angularDamping;this.m_force.Set(0,0);this.m_sleepTime=this.m_torque=0;this.m_type=c.type;this.m_invMass=this.m_type==h.b2_dynamicBody?this.m_mass=1:this.m_mass=0;this.m_invI=this.m_I=0;this.m_inertiaScale=c.inertiaScale;this.m_userData=c.userData;this.m_fixtureList=null;this.m_fixtureCount=0};h.prototype.SynchronizeFixtures=
function(){var c=h.s_xf1;c.R.Set(this.m_sweep.a0);var a=c.R,g=this.m_sweep.localCenter;c.position.x=this.m_sweep.c0.x-(a.col1.x*g.x+a.col2.x*g.y);c.position.y=this.m_sweep.c0.y-(a.col1.y*g.x+a.col2.y*g.y);g=this.m_world.m_contactManager.m_broadPhase;for(a=this.m_fixtureList;a;a=a.m_next)a.Synchronize(g,c,this.m_xf)};h.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var c=this.m_xf.R,a=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(c.col1.x*a.x+c.col2.x*a.y);
this.m_xf.position.y=this.m_sweep.c.y-(c.col1.y*a.x+c.col2.y*a.y)};h.prototype.ShouldCollide=function(c){if(this.m_type!=h.b2_dynamicBody&&c.m_type!=h.b2_dynamicBody)return!1;for(var a=this.m_jointList;a;a=a.next)if(a.other==c&&0==a.joint.m_collideConnected)return!1;return!0};h.prototype.Advance=function(c){void 0===c&&(c=0);this.m_sweep.Advance(c);this.m_sweep.c.SetV(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.SynchronizeTransform()};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Body.s_xf1=
new f;Box2D.Dynamics.b2Body.e_islandFlag=1;Box2D.Dynamics.b2Body.e_awakeFlag=2;Box2D.Dynamics.b2Body.e_allowSleepFlag=4;Box2D.Dynamics.b2Body.e_bulletFlag=8;Box2D.Dynamics.b2Body.e_fixedRotationFlag=16;Box2D.Dynamics.b2Body.e_activeFlag=32;Box2D.Dynamics.b2Body.b2_staticBody=0;Box2D.Dynamics.b2Body.b2_kinematicBody=1;Box2D.Dynamics.b2Body.b2_dynamicBody=2});E.b2BodyDef=function(){this.position=new d;this.linearVelocity=new d};E.prototype.b2BodyDef=function(){this.userData=null;this.position.Set(0,
0);this.angle=0;this.linearVelocity.Set(0,0);this.angularDamping=this.linearDamping=this.angularVelocity=0;this.awake=this.allowSleep=!0;this.bullet=this.fixedRotation=!1;this.type=h.b2_staticBody;this.active=!0;this.inertiaScale=1};I.b2ContactFilter=function(){};I.prototype.ShouldCollide=function(c,a){var g=c.GetFilterData(),b=a.GetFilterData();return g.groupIndex==b.groupIndex&&0!=g.groupIndex?0<g.groupIndex:0!=(g.maskBits&b.categoryBits)&&0!=(g.categoryBits&b.maskBits)};I.prototype.RayCollide=
function(c,a){return c?this.ShouldCollide(c instanceof K?c:null,a):!0};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new I});N.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(k.b2_maxManifoldPoints);this.tangentImpulses=new Vector_a2j_Number(k.b2_maxManifoldPoints)};H.b2ContactListener=function(){};H.prototype.BeginContact=function(c){};H.prototype.EndContact=function(c){};H.prototype.PreSolve=function(c,a){};H.prototype.PostSolve=function(c,
a){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=new H});M.b2ContactManager=function(){};M.prototype.b2ContactManager=function(){this.m_world=null;this.m_contactCount=0;this.m_contactFilter=I.b2_defaultFilter;this.m_contactListener=H.b2_defaultListener;this.m_contactFactory=new t(this.m_allocator);this.m_broadPhase=new q};M.prototype.AddPair=function(c,a){var g=c instanceof K?c:null,b=a instanceof K?a:null,d=g.GetBody(),t=b.GetBody();if(d!=t){for(var r=t.GetContactList();r;){if(r.other==
d){var e=r.contact.GetFixtureA(),w=r.contact.GetFixtureB();if(e==g&&w==b||e==b&&w==g)return}r=r.next}0!=t.ShouldCollide(d)&&0!=this.m_contactFilter.ShouldCollide(g,b)&&(r=this.m_contactFactory.Create(g,b),g=r.GetFixtureA(),b=r.GetFixtureB(),d=g.m_body,t=b.m_body,r.m_prev=null,r.m_next=this.m_world.m_contactList,null!=this.m_world.m_contactList&&(this.m_world.m_contactList.m_prev=r),this.m_world.m_contactList=r,r.m_nodeA.contact=r,r.m_nodeA.other=t,r.m_nodeA.prev=null,r.m_nodeA.next=d.m_contactList,
null!=d.m_contactList&&(d.m_contactList.prev=r.m_nodeA),d.m_contactList=r.m_nodeA,r.m_nodeB.contact=r,r.m_nodeB.other=d,r.m_nodeB.prev=null,r.m_nodeB.next=t.m_contactList,null!=t.m_contactList&&(t.m_contactList.prev=r.m_nodeB),t.m_contactList=r.m_nodeB,++this.m_world.m_contactCount)}};M.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))};M.prototype.Destroy=function(c){var a=c.GetFixtureA(),g=c.GetFixtureB(),a=a.GetBody(),g=g.GetBody();c.IsTouching()&&
this.m_contactListener.EndContact(c);c.m_prev&&(c.m_prev.m_next=c.m_next);c.m_next&&(c.m_next.m_prev=c.m_prev);c==this.m_world.m_contactList&&(this.m_world.m_contactList=c.m_next);c.m_nodeA.prev&&(c.m_nodeA.prev.next=c.m_nodeA.next);c.m_nodeA.next&&(c.m_nodeA.next.prev=c.m_nodeA.prev);c.m_nodeA==a.m_contactList&&(a.m_contactList=c.m_nodeA.next);c.m_nodeB.prev&&(c.m_nodeB.prev.next=c.m_nodeB.next);c.m_nodeB.next&&(c.m_nodeB.next.prev=c.m_nodeB.prev);c.m_nodeB==g.m_contactList&&(g.m_contactList=c.m_nodeB.next);
this.m_contactFactory.Destroy(c);--this.m_contactCount};M.prototype.Collide=function(){for(var c=this.m_world.m_contactList;c;){var a=c.GetFixtureA(),g=c.GetFixtureB(),b=a.GetBody(),d=g.GetBody();if(0==b.IsAwake()&&0==d.IsAwake())c=c.GetNext();else{if(c.m_flags&w.e_filterFlag){if(0==d.ShouldCollide(b)){a=c;c=a.GetNext();this.Destroy(a);continue}if(0==this.m_contactFilter.ShouldCollide(a,g)){a=c;c=a.GetNext();this.Destroy(a);continue}c.m_flags&=~w.e_filterFlag}0==this.m_broadPhase.TestOverlap(a.m_proxy,
g.m_proxy)?(a=c,c=a.GetNext(),this.Destroy(a)):(c.Update(this.m_contactListener),c=c.GetNext())}}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactManager.s_evalCP=new b});G.b2DebugDraw=function(){};G.prototype.b2DebugDraw=function(){};G.prototype.SetFlags=function(c){};G.prototype.GetFlags=function(){};G.prototype.AppendFlags=function(c){};G.prototype.ClearFlags=function(c){};G.prototype.SetSprite=function(c){};G.prototype.GetSprite=function(){};G.prototype.SetDrawScale=function(c){};G.prototype.GetDrawScale=
function(){};G.prototype.SetLineThickness=function(c){};G.prototype.GetLineThickness=function(){};G.prototype.SetAlpha=function(c){};G.prototype.GetAlpha=function(){};G.prototype.SetFillAlpha=function(c){};G.prototype.GetFillAlpha=function(){};G.prototype.SetXFormScale=function(c){};G.prototype.GetXFormScale=function(){};G.prototype.DrawPolygon=function(c,a,g){};G.prototype.DrawSolidPolygon=function(c,a,g){};G.prototype.DrawCircle=function(c,a,g){};G.prototype.DrawSolidCircle=function(c,a,g,b){};
G.prototype.DrawSegment=function(c,a,g){};G.prototype.DrawTransform=function(c){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2DebugDraw.e_shapeBit=1;Box2D.Dynamics.b2DebugDraw.e_jointBit=2;Box2D.Dynamics.b2DebugDraw.e_aabbBit=4;Box2D.Dynamics.b2DebugDraw.e_pairBit=8;Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16;Box2D.Dynamics.b2DebugDraw.e_controllerBit=32});Q.b2DestructionListener=function(){};Q.prototype.SayGoodbyeJoint=function(c){};Q.prototype.SayGoodbyeFixture=function(c){};J.b2FilterData=
function(){this.categoryBits=1;this.maskBits=65535;this.groupIndex=0};J.prototype.Copy=function(){var c=new J;c.categoryBits=this.categoryBits;c.maskBits=this.maskBits;c.groupIndex=this.groupIndex;return c};K.b2Fixture=function(){this.m_filter=new J};K.prototype.GetType=function(){return this.m_shape.GetType()};K.prototype.GetShape=function(){return this.m_shape};K.prototype.SetSensor=function(c){if(this.m_isSensor!=c&&(this.m_isSensor=c,null!=this.m_body))for(c=this.m_body.GetContactList();c;){var a=
c.contact,g=a.GetFixtureA(),b=a.GetFixtureB();g!=this&&b!=this||a.SetSensor(g.IsSensor()||b.IsSensor());c=c.next}};K.prototype.IsSensor=function(){return this.m_isSensor};K.prototype.SetFilterData=function(c){this.m_filter=c.Copy();if(!this.m_body)for(c=this.m_body.GetContactList();c;){var a=c.contact,g=a.GetFixtureA(),b=a.GetFixtureB();g!=this&&b!=this||a.FlagForFiltering();c=c.next}};K.prototype.GetFilterData=function(){return this.m_filter.Copy()};K.prototype.GetBody=function(){return this.m_body};
K.prototype.GetNext=function(){return this.m_next};K.prototype.GetUserData=function(){return this.m_userData};K.prototype.SetUserData=function(c){this.m_userData=c};K.prototype.TestPoint=function(c){return this.m_shape.TestPoint(this.m_body.GetTransform(),c)};K.prototype.RayCast=function(c,a){return this.m_shape.RayCast(c,a,this.m_body.GetTransform())};K.prototype.GetMassData=function(c){void 0===c&&(c=null);null==c&&(c=new v);this.m_shape.ComputeMass(c,this.m_density);return c};K.prototype.SetDensity=
function(c){void 0===c&&(c=0);this.m_density=c};K.prototype.GetDensity=function(){return this.m_density};K.prototype.GetFriction=function(){return this.m_friction};K.prototype.SetFriction=function(c){void 0===c&&(c=0);this.m_friction=c};K.prototype.GetRestitution=function(){return this.m_restitution};K.prototype.SetRestitution=function(c){void 0===c&&(c=0);this.m_restitution=c};K.prototype.GetAABB=function(){return this.m_aabb};K.prototype.b2Fixture=function(){this.m_aabb=new p;this.m_shape=this.m_next=
this.m_body=this.m_userData=null;this.m_restitution=this.m_friction=this.m_density=0};K.prototype.Create=function(c,a,g){this.m_userData=g.userData;this.m_friction=g.friction;this.m_restitution=g.restitution;this.m_body=c;this.m_next=null;this.m_filter=g.filter.Copy();this.m_isSensor=g.isSensor;this.m_shape=g.shape.Copy();this.m_density=g.density};K.prototype.Destroy=function(){this.m_shape=null};K.prototype.CreateProxy=function(c,a){this.m_shape.ComputeAABB(this.m_aabb,a);this.m_proxy=c.CreateProxy(this.m_aabb,
this)};K.prototype.DestroyProxy=function(c){null!=this.m_proxy&&(c.DestroyProxy(this.m_proxy),this.m_proxy=null)};K.prototype.Synchronize=function(c,g,b){if(this.m_proxy){var d=new p,r=new p;this.m_shape.ComputeAABB(d,g);this.m_shape.ComputeAABB(r,b);this.m_aabb.Combine(d,r);g=a.SubtractVV(b.position,g.position);c.MoveProxy(this.m_proxy,this.m_aabb,g)}};R.b2FixtureDef=function(){this.filter=new J};R.prototype.b2FixtureDef=function(){this.userData=this.shape=null;this.friction=.2;this.density=this.restitution=
0;this.filter.categoryBits=1;this.filter.maskBits=65535;this.filter.groupIndex=0;this.isSensor=!1};O.b2Island=function(){};O.prototype.b2Island=function(){this.m_bodies=new Vector;this.m_contacts=new Vector;this.m_joints=new Vector};O.prototype.Initialize=function(c,a,g,b,d,r){void 0===c&&(c=0);void 0===a&&(a=0);void 0===g&&(g=0);var t=0;this.m_bodyCapacity=c;this.m_contactCapacity=a;this.m_jointCapacity=g;this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;this.m_allocator=b;this.m_listener=
d;this.m_contactSolver=r;for(t=this.m_bodies.length;t<c;t++)this.m_bodies[t]=null;for(t=this.m_contacts.length;t<a;t++)this.m_contacts[t]=null;for(t=this.m_joints.length;t<g;t++)this.m_joints[t]=null};O.prototype.Clear=function(){this.m_jointCount=this.m_contactCount=this.m_bodyCount=0};O.prototype.Solve=function(c,g,b){for(var d=0,t=0,r,d=0;d<this.m_bodyCount;++d)t=this.m_bodies[d],t.GetType()==h.b2_dynamicBody&&(t.m_linearVelocity.x+=c.dt*(g.x+t.m_invMass*t.m_force.x),t.m_linearVelocity.y+=c.dt*
(g.y+t.m_invMass*t.m_force.y),t.m_angularVelocity+=c.dt*t.m_invI*t.m_torque,t.m_linearVelocity.Multiply(a.Clamp(1-c.dt*t.m_linearDamping,0,1)),t.m_angularVelocity*=a.Clamp(1-c.dt*t.m_angularDamping,0,1));this.m_contactSolver.Initialize(c,this.m_contacts,this.m_contactCount,this.m_allocator);g=this.m_contactSolver;g.InitVelocityConstraints(c);for(d=0;d<this.m_jointCount;++d)r=this.m_joints[d],r.InitVelocityConstraints(c);for(d=0;d<c.velocityIterations;++d){for(t=0;t<this.m_jointCount;++t)r=this.m_joints[t],
r.SolveVelocityConstraints(c);g.SolveVelocityConstraints()}for(d=0;d<this.m_jointCount;++d)r=this.m_joints[d],r.FinalizeVelocityConstraints();g.FinalizeVelocityConstraints();for(d=0;d<this.m_bodyCount;++d)if(t=this.m_bodies[d],t.GetType()!=h.b2_staticBody){var e=c.dt*t.m_linearVelocity.x,w=c.dt*t.m_linearVelocity.y;e*e+w*w>k.b2_maxTranslationSquared&&(t.m_linearVelocity.Normalize(),t.m_linearVelocity.x=t.m_linearVelocity.x*k.b2_maxTranslation*c.inv_dt,t.m_linearVelocity.y=t.m_linearVelocity.y*k.b2_maxTranslation*
c.inv_dt);e=c.dt*t.m_angularVelocity;e*e>k.b2_maxRotationSquared&&(t.m_angularVelocity=0>t.m_angularVelocity?-k.b2_maxRotation*c.inv_dt:k.b2_maxRotation*c.inv_dt);t.m_sweep.c0.SetV(t.m_sweep.c);t.m_sweep.a0=t.m_sweep.a;t.m_sweep.c.x+=c.dt*t.m_linearVelocity.x;t.m_sweep.c.y+=c.dt*t.m_linearVelocity.y;t.m_sweep.a+=c.dt*t.m_angularVelocity;t.SynchronizeTransform()}for(d=0;d<c.positionIterations;++d){e=g.SolvePositionConstraints(k.b2_contactBaumgarte);w=!0;for(t=0;t<this.m_jointCount;++t)r=this.m_joints[t],
r=r.SolvePositionConstraints(k.b2_contactBaumgarte),w=w&&r;if(e&&w)break}this.Report(g.m_constraints);if(b){b=Number.MAX_VALUE;g=k.b2_linearSleepTolerance*k.b2_linearSleepTolerance;e=k.b2_angularSleepTolerance*k.b2_angularSleepTolerance;for(d=0;d<this.m_bodyCount;++d)t=this.m_bodies[d],t.GetType()!=h.b2_staticBody&&(0==(t.m_flags&h.e_allowSleepFlag)&&(b=t.m_sleepTime=0),0==(t.m_flags&h.e_allowSleepFlag)||t.m_angularVelocity*t.m_angularVelocity>e||a.Dot(t.m_linearVelocity,t.m_linearVelocity)>g?b=t.m_sleepTime=
0:(t.m_sleepTime+=c.dt,b=a.Min(b,t.m_sleepTime)));if(b>=k.b2_timeToSleep)for(d=0;d<this.m_bodyCount;++d)t=this.m_bodies[d],t.SetAwake(!1)}};O.prototype.SolveTOI=function(c){var a=0,g=0;this.m_contactSolver.Initialize(c,this.m_contacts,this.m_contactCount,this.m_allocator);for(var b=this.m_contactSolver,a=0;a<this.m_jointCount;++a)this.m_joints[a].InitVelocityConstraints(c);for(a=0;a<c.velocityIterations;++a)for(b.SolveVelocityConstraints(),g=0;g<this.m_jointCount;++g)this.m_joints[g].SolveVelocityConstraints(c);
for(a=0;a<this.m_bodyCount;++a)if(g=this.m_bodies[a],g.GetType()!=h.b2_staticBody){var d=c.dt*g.m_linearVelocity.x,t=c.dt*g.m_linearVelocity.y;d*d+t*t>k.b2_maxTranslationSquared&&(g.m_linearVelocity.Normalize(),g.m_linearVelocity.x=g.m_linearVelocity.x*k.b2_maxTranslation*c.inv_dt,g.m_linearVelocity.y=g.m_linearVelocity.y*k.b2_maxTranslation*c.inv_dt);d=c.dt*g.m_angularVelocity;d*d>k.b2_maxRotationSquared&&(g.m_angularVelocity=0>g.m_angularVelocity?-k.b2_maxRotation*c.inv_dt:k.b2_maxRotation*c.inv_dt);
g.m_sweep.c0.SetV(g.m_sweep.c);g.m_sweep.a0=g.m_sweep.a;g.m_sweep.c.x+=c.dt*g.m_linearVelocity.x;g.m_sweep.c.y+=c.dt*g.m_linearVelocity.y;g.m_sweep.a+=c.dt*g.m_angularVelocity;g.SynchronizeTransform()}for(a=0;a<c.positionIterations;++a){d=b.SolvePositionConstraints(.75);t=!0;for(g=0;g<this.m_jointCount;++g)var r=this.m_joints[g].SolvePositionConstraints(k.b2_contactBaumgarte),t=t&&r;if(d&&t)break}this.Report(b.m_constraints)};O.prototype.Report=function(c){if(null!=this.m_listener)for(var a=0;a<this.m_contactCount;++a){for(var g=
this.m_contacts[a],b=c[a],d=0;d<b.pointCount;++d)O.s_impulse.normalImpulses[d]=b.points[d].normalImpulse,O.s_impulse.tangentImpulses[d]=b.points[d].tangentImpulse;this.m_listener.PostSolve(g,O.s_impulse)}};O.prototype.AddBody=function(c){c.m_islandIndex=this.m_bodyCount;this.m_bodies[this.m_bodyCount++]=c};O.prototype.AddContact=function(c){this.m_contacts[this.m_contactCount++]=c};O.prototype.AddJoint=function(c){this.m_joints[this.m_jointCount++]=c};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Island.s_impulse=
new N});g.b2TimeStep=function(){};g.prototype.Set=function(c){this.dt=c.dt;this.inv_dt=c.inv_dt;this.positionIterations=c.positionIterations;this.velocityIterations=c.velocityIterations;this.warmStarting=c.warmStarting};r.b2World=function(){this.s_stack=new Vector;this.m_contactManager=new M;this.m_contactSolver=new F;this.m_island=new O};r.prototype.b2World=function(c,a){this.m_controllerList=this.m_jointList=this.m_contactList=this.m_bodyList=this.m_debugDraw=this.m_destructionListener=null;this.m_controllerCount=
this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;r.m_warmStarting=!0;r.m_continuousPhysics=!0;this.m_allowSleep=a;this.m_gravity=c;this.m_inv_dt0=0;this.m_contactManager.m_world=this;var g=new E;this.m_groundBody=this.CreateBody(g)};r.prototype.SetDestructionListener=function(c){this.m_destructionListener=c};r.prototype.SetContactFilter=function(c){this.m_contactManager.m_contactFilter=c};r.prototype.SetContactListener=function(c){this.m_contactManager.m_contactListener=c};r.prototype.SetDebugDraw=
function(c){this.m_debugDraw=c};r.prototype.SetBroadPhase=function(c){var a=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=c;for(var g=this.m_bodyList;g;g=g.m_next)for(var b=g.m_fixtureList;b;b=b.m_next)b.m_proxy=c.CreateProxy(a.GetFatAABB(b.m_proxy),b)};r.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()};r.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()};r.prototype.CreateBody=function(c){if(1==this.IsLocked())return null;
c=new h(c,this);c.m_prev=null;if(c.m_next=this.m_bodyList)this.m_bodyList.m_prev=c;this.m_bodyList=c;++this.m_bodyCount;return c};r.prototype.DestroyBody=function(c){if(1!=this.IsLocked()){for(var a=c.m_jointList;a;){var g=a,a=a.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(g.joint);this.DestroyJoint(g.joint)}for(a=c.m_controllerList;a;)g=a,a=a.nextController,g.controller.RemoveBody(c);for(a=c.m_contactList;a;)g=a,a=a.next,this.m_contactManager.Destroy(g.contact);c.m_contactList=
null;for(a=c.m_fixtureList;a;)g=a,a=a.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(g),g.DestroyProxy(this.m_contactManager.m_broadPhase),g.Destroy();c.m_fixtureList=null;c.m_fixtureCount=0;c.m_prev&&(c.m_prev.m_next=c.m_next);c.m_next&&(c.m_next.m_prev=c.m_prev);c==this.m_bodyList&&(this.m_bodyList=c.m_next);--this.m_bodyCount}};r.prototype.CreateJoint=function(c){var a=L.Create(c,null);a.m_prev=null;if(a.m_next=this.m_jointList)this.m_jointList.m_prev=a;this.m_jointList=
a;++this.m_jointCount;a.m_edgeA.joint=a;a.m_edgeA.other=a.m_bodyB;a.m_edgeA.prev=null;if(a.m_edgeA.next=a.m_bodyA.m_jointList)a.m_bodyA.m_jointList.prev=a.m_edgeA;a.m_bodyA.m_jointList=a.m_edgeA;a.m_edgeB.joint=a;a.m_edgeB.other=a.m_bodyA;a.m_edgeB.prev=null;if(a.m_edgeB.next=a.m_bodyB.m_jointList)a.m_bodyB.m_jointList.prev=a.m_edgeB;a.m_bodyB.m_jointList=a.m_edgeB;var g=c.bodyA,b=c.bodyB;if(0==c.collideConnected)for(c=b.GetContactList();c;)c.other==g&&c.contact.FlagForFiltering(),c=c.next;return a};
r.prototype.DestroyJoint=function(c){var a=c.m_collideConnected;c.m_prev&&(c.m_prev.m_next=c.m_next);c.m_next&&(c.m_next.m_prev=c.m_prev);c==this.m_jointList&&(this.m_jointList=c.m_next);var g=c.m_bodyA,b=c.m_bodyB;g.SetAwake(!0);b.SetAwake(!0);c.m_edgeA.prev&&(c.m_edgeA.prev.next=c.m_edgeA.next);c.m_edgeA.next&&(c.m_edgeA.next.prev=c.m_edgeA.prev);c.m_edgeA==g.m_jointList&&(g.m_jointList=c.m_edgeA.next);c.m_edgeA.prev=null;c.m_edgeA.next=null;c.m_edgeB.prev&&(c.m_edgeB.prev.next=c.m_edgeB.next);
c.m_edgeB.next&&(c.m_edgeB.next.prev=c.m_edgeB.prev);c.m_edgeB==b.m_jointList&&(b.m_jointList=c.m_edgeB.next);c.m_edgeB.prev=null;c.m_edgeB.next=null;L.Destroy(c,null);--this.m_jointCount;if(0==a)for(c=b.GetContactList();c;)c.other==g&&c.contact.FlagForFiltering(),c=c.next};r.prototype.AddController=function(c){c.m_next=this.m_controllerList;c.m_prev=null;this.m_controllerList=c;c.m_world=this;this.m_controllerCount++;return c};r.prototype.RemoveController=function(c){c.m_prev&&(c.m_prev.m_next=c.m_next);
c.m_next&&(c.m_next.m_prev=c.m_prev);this.m_controllerList==c&&(this.m_controllerList=c.m_next);this.m_controllerCount--};r.prototype.CreateController=function(c){if(c.m_world!=this)throw Error("Controller can only be a member of one world");c.m_next=this.m_controllerList;c.m_prev=null;this.m_controllerList&&(this.m_controllerList.m_prev=c);this.m_controllerList=c;++this.m_controllerCount;c.m_world=this;return c};r.prototype.DestroyController=function(c){c.Clear();c.m_next&&(c.m_next.m_prev=c.m_prev);
c.m_prev&&(c.m_prev.m_next=c.m_next);c==this.m_controllerList&&(this.m_controllerList=c.m_next);--this.m_controllerCount};r.prototype.SetWarmStarting=function(c){r.m_warmStarting=c};r.prototype.SetContinuousPhysics=function(c){r.m_continuousPhysics=c};r.prototype.GetBodyCount=function(){return this.m_bodyCount};r.prototype.GetJointCount=function(){return this.m_jointCount};r.prototype.GetContactCount=function(){return this.m_contactCount};r.prototype.SetGravity=function(c){this.m_gravity=c};r.prototype.GetGravity=
function(){return this.m_gravity};r.prototype.GetGroundBody=function(){return this.m_groundBody};r.prototype.Step=function(c,a,g){void 0===c&&(c=0);void 0===a&&(a=0);void 0===g&&(g=0);this.m_flags&r.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~r.e_newFixture);this.m_flags|=r.e_locked;var b=r.s_timestep2;b.dt=c;b.velocityIterations=a;b.positionIterations=g;b.inv_dt=0<c?1/c:0;b.dtRatio=this.m_inv_dt0*c;b.warmStarting=r.m_warmStarting;this.m_contactManager.Collide();0<b.dt&&
this.Solve(b);r.m_continuousPhysics&&0<b.dt&&this.SolveTOI(b);0<b.dt&&(this.m_inv_dt0=b.inv_dt);this.m_flags&=~r.e_locked};r.prototype.ClearForces=function(){for(var c=this.m_bodyList;c;c=c.m_next)c.m_force.SetZero(),c.m_torque=0};r.prototype.DrawDebugData=function(){if(null!=this.m_debugDraw){this.m_debugDraw.m_sprite.graphics.clear();var c=this.m_debugDraw.GetFlags(),a,g,b;new d;new d;new d;var t;new p;new p;t=[new d,new d,new d,new d];var w=new e(0,0,0);if(c&G.e_shapeBit)for(a=this.m_bodyList;a;a=
a.m_next)for(t=a.m_xf,g=a.GetFixtureList();g;g=g.m_next)b=g.GetShape(),0==a.IsActive()?w.Set(.5,.5,.3):a.GetType()==h.b2_staticBody?w.Set(.5,.9,.5):a.GetType()==h.b2_kinematicBody?w.Set(.5,.5,.9):0==a.IsAwake()?w.Set(.6,.6,.6):w.Set(.9,.7,.7),this.DrawShape(b,t,w);if(c&G.e_jointBit)for(a=this.m_jointList;a;a=a.m_next)this.DrawJoint(a);if(c&G.e_controllerBit)for(a=this.m_controllerList;a;a=a.m_next)a.Draw(this.m_debugDraw);if(c&G.e_pairBit)for(w.Set(.3,.9,.9),a=this.m_contactManager.m_contactList;a;a=
a.GetNext())b=a.GetFixtureA(),g=a.GetFixtureB(),b=b.GetAABB().GetCenter(),g=g.GetAABB().GetCenter(),this.m_debugDraw.DrawSegment(b,g,w);if(c&G.e_aabbBit)for(b=this.m_contactManager.m_broadPhase,t=[new d,new d,new d,new d],a=this.m_bodyList;a;a=a.GetNext())if(0!=a.IsActive())for(g=a.GetFixtureList();g;g=g.GetNext()){var f=b.GetFatAABB(g.m_proxy);t[0].Set(f.lowerBound.x,f.lowerBound.y);t[1].Set(f.upperBound.x,f.lowerBound.y);t[2].Set(f.upperBound.x,f.upperBound.y);t[3].Set(f.lowerBound.x,f.upperBound.y);
this.m_debugDraw.DrawPolygon(t,4,w)}if(c&G.e_centerOfMassBit)for(a=this.m_bodyList;a;a=a.m_next)t=r.s_xf,t.R=a.m_xf.R,t.position=a.GetWorldCenter(),this.m_debugDraw.DrawTransform(t)}};r.prototype.QueryAABB=function(c,a){var g=this.m_contactManager.m_broadPhase;g.Query(function(a){return c(g.GetUserData(a))},a)};r.prototype.QueryShape=function(c,a,g){void 0===g&&(g=null);null==g&&(g=new f,g.SetIdentity());var b=this.m_contactManager.m_broadPhase,d=new p;a.ComputeAABB(d,g);b.Query(function(d){d=b.GetUserData(d)instanceof
K?b.GetUserData(d):null;return A.TestOverlap(a,g,d.GetShape(),d.GetBody().GetTransform())?c(d):!0},d)};r.prototype.QueryPoint=function(c,a){var g=this.m_contactManager.m_broadPhase,b=new p;b.lowerBound.Set(a.x-k.b2_linearSlop,a.y-k.b2_linearSlop);b.upperBound.Set(a.x+k.b2_linearSlop,a.y+k.b2_linearSlop);g.Query(function(b){b=g.GetUserData(b)instanceof K?g.GetUserData(b):null;return b.TestPoint(a)?c(b):!0},b)};r.prototype.RayCast=function(c,a,g){var b=this.m_contactManager.m_broadPhase,t=new z,r=new n(a,
g);b.RayCast(function(r,e){var w=b.GetUserData(e),w=w instanceof K?w:null;if(w.RayCast(t,r)){var f=t.fraction,h=new d((1-f)*a.x+f*g.x,(1-f)*a.y+f*g.y);return c(w,h,t.normal,f)}return r.maxFraction},r)};r.prototype.RayCastOne=function(c,a){var g;this.RayCast(function(c,a,b,d){void 0===d&&(d=0);g=c;return d},c,a);return g};r.prototype.RayCastAll=function(c,a){var g=new Vector;this.RayCast(function(c,a,b,d){g[g.length]=c;return 1},c,a);return g};r.prototype.GetBodyList=function(){return this.m_bodyList};
r.prototype.GetJointList=function(){return this.m_jointList};r.prototype.GetContactList=function(){return this.m_contactList};r.prototype.IsLocked=function(){return 0<(this.m_flags&r.e_locked)};r.prototype.Solve=function(c){for(var a,g=this.m_controllerList;g;g=g.m_next)g.Step(c);g=this.m_island;g.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(a=this.m_bodyList;a;a=a.m_next)a.m_flags&=~h.e_islandFlag;for(var b=
this.m_contactList;b;b=b.m_next)b.m_flags&=~w.e_islandFlag;for(b=this.m_jointList;b;b=b.m_next)b.m_islandFlag=!1;parseInt(this.m_bodyCount);for(var b=this.s_stack,d=this.m_bodyList;d;d=d.m_next)if(!(d.m_flags&h.e_islandFlag)&&0!=d.IsAwake()&&0!=d.IsActive()&&d.GetType()!=h.b2_staticBody){g.Clear();var t=0;b[t++]=d;for(d.m_flags|=h.e_islandFlag;0<t;)if(a=b[--t],g.AddBody(a),0==a.IsAwake()&&a.SetAwake(!0),a.GetType()!=h.b2_staticBody){for(var r,e=a.m_contactList;e;e=e.next)e.contact.m_flags&w.e_islandFlag||
1==e.contact.IsSensor()||0==e.contact.IsEnabled()||0==e.contact.IsTouching()||(g.AddContact(e.contact),e.contact.m_flags|=w.e_islandFlag,r=e.other,r.m_flags&h.e_islandFlag||(b[t++]=r,r.m_flags|=h.e_islandFlag));for(a=a.m_jointList;a;a=a.next)1!=a.joint.m_islandFlag&&(r=a.other,0!=r.IsActive()&&(g.AddJoint(a.joint),a.joint.m_islandFlag=!0,r.m_flags&h.e_islandFlag||(b[t++]=r,r.m_flags|=h.e_islandFlag)))}g.Solve(c,this.m_gravity,this.m_allowSleep);for(t=0;t<g.m_bodyCount;++t)a=g.m_bodies[t],a.GetType()==
h.b2_staticBody&&(a.m_flags&=~h.e_islandFlag)}for(t=0;t<b.length&&b[t];++t)b[t]=null;for(a=this.m_bodyList;a;a=a.m_next)0!=a.IsAwake()&&0!=a.IsActive()&&a.GetType()!=h.b2_staticBody&&a.SynchronizeFixtures();this.m_contactManager.FindNewContacts()};r.prototype.SolveTOI=function(c){var a,g,b,d=this.m_island;d.Initialize(this.m_bodyCount,k.b2_maxTOIContactsPerIsland,k.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var t=r.s_queue;for(a=this.m_bodyList;a;a=
a.m_next)a.m_flags&=~h.e_islandFlag,a.m_sweep.t0=0;for(b=this.m_contactList;b;b=b.m_next)b.m_flags&=~(w.e_toiFlag|w.e_islandFlag);for(b=this.m_jointList;b;b=b.m_next)b.m_islandFlag=!1;for(;;){var e=null,f=1;for(b=this.m_contactList;b;b=b.m_next)if(1!=b.IsSensor()&&0!=b.IsEnabled()&&0!=b.IsContinuous()){a=1;if(b.m_flags&w.e_toiFlag)a=b.m_toi;else{a=b.m_fixtureA;g=b.m_fixtureB;a=a.m_body;g=g.m_body;if(!(a.GetType()==h.b2_dynamicBody&&0!=a.IsAwake()||g.GetType()==h.b2_dynamicBody&&0!=g.IsAwake()))continue;
var C=a.m_sweep.t0;a.m_sweep.t0<g.m_sweep.t0?(C=g.m_sweep.t0,a.m_sweep.Advance(C)):g.m_sweep.t0<a.m_sweep.t0&&(C=a.m_sweep.t0,g.m_sweep.Advance(C));a=b.ComputeTOI(a.m_sweep,g.m_sweep);k.b2Assert(0<=a&&1>=a);0<a&&1>a&&(a=(1-a)*C+a,1<a&&(a=1));b.m_toi=a;b.m_flags|=w.e_toiFlag}Number.MIN_VALUE<a&&a<f&&(e=b,f=a)}if(null==e||1-100*Number.MIN_VALUE<f)break;a=e.m_fixtureA;g=e.m_fixtureB;a=a.m_body;g=g.m_body;r.s_backupA.Set(a.m_sweep);r.s_backupB.Set(g.m_sweep);a.Advance(f);g.Advance(f);e.Update(this.m_contactManager.m_contactListener);
e.m_flags&=~w.e_toiFlag;if(1==e.IsSensor()||0==e.IsEnabled())a.m_sweep.Set(r.s_backupA),g.m_sweep.Set(r.s_backupB),a.SynchronizeTransform(),g.SynchronizeTransform();else if(0!=e.IsTouching()){a.GetType()!=h.b2_dynamicBody&&(a=g);d.Clear();e=b=0;t[b+e++]=a;for(a.m_flags|=h.e_islandFlag;0<e;)if(a=t[b++],--e,d.AddBody(a),0==a.IsAwake()&&a.SetAwake(!0),a.GetType()==h.b2_dynamicBody){for(g=a.m_contactList;g&&d.m_contactCount!=d.m_contactCapacity;g=g.next)g.contact.m_flags&w.e_islandFlag||1==g.contact.IsSensor()||
0==g.contact.IsEnabled()||0==g.contact.IsTouching()||(d.AddContact(g.contact),g.contact.m_flags|=w.e_islandFlag,C=g.other,C.m_flags&h.e_islandFlag||(C.GetType()!=h.b2_staticBody&&(C.Advance(f),C.SetAwake(!0)),t[b+e]=C,++e,C.m_flags|=h.e_islandFlag));for(a=a.m_jointList;a;a=a.next)d.m_jointCount!=d.m_jointCapacity&&1!=a.joint.m_islandFlag&&(C=a.other,0!=C.IsActive()&&(d.AddJoint(a.joint),a.joint.m_islandFlag=!0,C.m_flags&h.e_islandFlag||(C.GetType()!=h.b2_staticBody&&(C.Advance(f),C.SetAwake(!0)),
t[b+e]=C,++e,C.m_flags|=h.e_islandFlag)))}b=r.s_timestep;b.warmStarting=!1;b.dt=(1-f)*c.dt;b.inv_dt=1/b.dt;b.dtRatio=0;b.velocityIterations=c.velocityIterations;b.positionIterations=c.positionIterations;d.SolveTOI(b);for(f=f=0;f<d.m_bodyCount;++f)if(a=d.m_bodies[f],a.m_flags&=~h.e_islandFlag,0!=a.IsAwake()&&a.GetType()==h.b2_dynamicBody)for(a.SynchronizeFixtures(),g=a.m_contactList;g;g=g.next)g.contact.m_flags&=~w.e_toiFlag;for(f=0;f<d.m_contactCount;++f)b=d.m_contacts[f],b.m_flags&=~(w.e_toiFlag|
w.e_islandFlag);for(f=0;f<d.m_jointCount;++f)b=d.m_joints[f],b.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}};r.prototype.DrawJoint=function(a){var g=a.GetBodyA(),b=a.GetBodyB(),d=g.m_xf.position,t=b.m_xf.position,e=a.GetAnchorA(),w=a.GetAnchorB(),f=r.s_jointColor;switch(a.m_type){case L.e_distanceJoint:this.m_debugDraw.DrawSegment(e,w,f);break;case L.e_pulleyJoint:g=a instanceof C?a:null;a=g.GetGroundAnchorA();g=g.GetGroundAnchorB();this.m_debugDraw.DrawSegment(a,e,f);this.m_debugDraw.DrawSegment(g,
w,f);this.m_debugDraw.DrawSegment(a,g,f);break;case L.e_mouseJoint:this.m_debugDraw.DrawSegment(e,w,f);break;default:g!=this.m_groundBody&&this.m_debugDraw.DrawSegment(d,e,f),this.m_debugDraw.DrawSegment(e,w,f),b!=this.m_groundBody&&this.m_debugDraw.DrawSegment(t,w,f)}};r.prototype.DrawShape=function(c,g,b){switch(c.m_type){case A.e_circleShape:var d=c instanceof u?c:null;c=a.MulX(g,d.m_p);this.m_debugDraw.DrawSolidCircle(c,d.m_radius,g.R.col1,b);break;case A.e_polygonShape:d=0;d=c instanceof B?c:
null;c=parseInt(d.GetVertexCount());for(var t=d.GetVertices(),r=new Vector(c),d=0;d<c;++d)r[d]=a.MulX(g,t[d]);this.m_debugDraw.DrawSolidPolygon(r,c,b);break;case A.e_edgeShape:d=c instanceof x?c:null,this.m_debugDraw.DrawSegment(a.MulX(g,d.GetVertex1()),a.MulX(g,d.GetVertex2()),b)}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2World.s_timestep2=new g;Box2D.Dynamics.b2World.s_xf=new f;Box2D.Dynamics.b2World.s_backupA=new l;Box2D.Dynamics.b2World.s_backupB=new l;Box2D.Dynamics.b2World.s_timestep=
new g;Box2D.Dynamics.b2World.s_queue=new Vector;Box2D.Dynamics.b2World.s_jointColor=new e(.5,.8,.8);Box2D.Dynamics.b2World.e_newFixture=1;Box2D.Dynamics.b2World.e_locked=2})})();
(function(){var a=Box2D.Collision.Shapes.b2CircleShape,l=Box2D.Collision.Shapes.b2EdgeShape,f=Box2D.Collision.Shapes.b2PolygonShape,d=Box2D.Collision.Shapes.b2Shape,e=Box2D.Dynamics.Contacts.b2CircleContact,k=Box2D.Dynamics.Contacts.b2Contact,p=Box2D.Dynamics.Contacts.b2ContactConstraint,b=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,q=Box2D.Dynamics.Contacts.b2ContactEdge,n=Box2D.Dynamics.Contacts.b2ContactFactory,z=Box2D.Dynamics.Contacts.b2ContactRegister,u=Box2D.Dynamics.Contacts.b2ContactResult,
x=Box2D.Dynamics.Contacts.b2ContactSolver,v=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,B=Box2D.Dynamics.Contacts.b2NullContact,A=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,h=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,E=Box2D.Dynamics.Contacts.b2PolygonContact,I=Box2D.Dynamics.Contacts.b2PositionSolverManifold,N=Box2D.Dynamics.b2Body,H=Box2D.Dynamics.b2TimeStep,M=Box2D.Common.b2Settings,G=Box2D.Common.Math.b2Mat22,Q=Box2D.Common.Math.b2Math,J=Box2D.Common.Math.b2Vec2,K=Box2D.Collision.b2Collision,
R=Box2D.Collision.b2ContactID,O=Box2D.Collision.b2Manifold,g=Box2D.Collision.b2TimeOfImpact,r=Box2D.Collision.b2TOIInput,w=Box2D.Collision.b2WorldManifold;Box2D.inherit(e,Box2D.Dynamics.Contacts.b2Contact);e.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;e.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};e.Create=function(a){return new e};e.Destroy=function(a,g){};e.prototype.Reset=function(a,g){this.__super.Reset.call(this,a,g)};e.prototype.Evaluate=
function(){var g=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();K.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof a?this.m_fixtureA.GetShape():null,g.m_xf,this.m_fixtureB.GetShape()instanceof a?this.m_fixtureB.GetShape():null,b.m_xf)};k.b2Contact=function(){this.m_nodeA=new q;this.m_nodeB=new q;this.m_manifold=new O;this.m_oldManifold=new O};k.prototype.GetManifold=function(){return this.m_manifold};k.prototype.GetWorldManifold=function(a){var g=this.m_fixtureA.GetBody(),
b=this.m_fixtureB.GetBody(),d=this.m_fixtureA.GetShape(),c=this.m_fixtureB.GetShape();a.Initialize(this.m_manifold,g.GetTransform(),d.m_radius,b.GetTransform(),c.m_radius)};k.prototype.IsTouching=function(){return(this.m_flags&k.e_touchingFlag)==k.e_touchingFlag};k.prototype.IsContinuous=function(){return(this.m_flags&k.e_continuousFlag)==k.e_continuousFlag};k.prototype.SetSensor=function(a){this.m_flags=a?this.m_flags|k.e_sensorFlag:this.m_flags&~k.e_sensorFlag};k.prototype.IsSensor=function(){return(this.m_flags&
k.e_sensorFlag)==k.e_sensorFlag};k.prototype.SetEnabled=function(a){this.m_flags=a?this.m_flags|k.e_enabledFlag:this.m_flags&~k.e_enabledFlag};k.prototype.IsEnabled=function(){return(this.m_flags&k.e_enabledFlag)==k.e_enabledFlag};k.prototype.GetNext=function(){return this.m_next};k.prototype.GetFixtureA=function(){return this.m_fixtureA};k.prototype.GetFixtureB=function(){return this.m_fixtureB};k.prototype.FlagForFiltering=function(){this.m_flags|=k.e_filterFlag};k.prototype.b2Contact=function(){};
k.prototype.Reset=function(a,g){void 0===a&&(a=null);void 0===g&&(g=null);this.m_flags=k.e_enabledFlag;if(a&&g){if(a.IsSensor()||g.IsSensor())this.m_flags|=k.e_sensorFlag;var b=a.GetBody(),d=g.GetBody();if(b.GetType()!=N.b2_dynamicBody||b.IsBullet()||d.GetType()!=N.b2_dynamicBody||d.IsBullet())this.m_flags|=k.e_continuousFlag;this.m_fixtureA=a;this.m_fixtureB=g;this.m_manifold.m_pointCount=0;this.m_next=this.m_prev=null;this.m_nodeA.contact=null;this.m_nodeA.prev=null;this.m_nodeA.next=null;this.m_nodeA.other=
null;this.m_nodeB.contact=null;this.m_nodeB.prev=null;this.m_nodeB.next=null;this.m_nodeB.other=null}else this.m_fixtureB=this.m_fixtureA=null};k.prototype.Update=function(a){var g=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=g;this.m_flags|=k.e_enabledFlag;var b=!1,g=(this.m_flags&k.e_touchingFlag)==k.e_touchingFlag,r=this.m_fixtureA.m_body,c=this.m_fixtureB.m_body,e=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&k.e_sensorFlag)e&&(b=this.m_fixtureA.GetShape(),
e=this.m_fixtureB.GetShape(),r=r.GetTransform(),c=c.GetTransform(),b=d.TestOverlap(b,r,e,c)),this.m_manifold.m_pointCount=0;else{r.GetType()!=N.b2_dynamicBody||r.IsBullet()||c.GetType()!=N.b2_dynamicBody||c.IsBullet()?this.m_flags|=k.e_continuousFlag:this.m_flags&=~k.e_continuousFlag;if(e)for(this.Evaluate(),b=0<this.m_manifold.m_pointCount,e=0;e<this.m_manifold.m_pointCount;++e){var w=this.m_manifold.m_points[e];w.m_normalImpulse=0;w.m_tangentImpulse=0;for(var f=w.m_id,h=0;h<this.m_oldManifold.m_pointCount;++h){var l=
this.m_oldManifold.m_points[h];if(l.m_id.key==f.key){w.m_normalImpulse=l.m_normalImpulse;w.m_tangentImpulse=l.m_tangentImpulse;break}}}else this.m_manifold.m_pointCount=0;b!=g&&(r.SetAwake(!0),c.SetAwake(!0))}this.m_flags=b?this.m_flags|k.e_touchingFlag:this.m_flags&~k.e_touchingFlag;0==g&&1==b&&a.BeginContact(this);1==g&&0==b&&a.EndContact(this);0==(this.m_flags&k.e_sensorFlag)&&a.PreSolve(this,this.m_oldManifold)};k.prototype.Evaluate=function(){};k.prototype.ComputeTOI=function(a,b){k.s_input.proxyA.Set(this.m_fixtureA.GetShape());
k.s_input.proxyB.Set(this.m_fixtureB.GetShape());k.s_input.sweepA=a;k.s_input.sweepB=b;k.s_input.tolerance=M.b2_linearSlop;return g.TimeOfImpact(k.s_input)};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag=1;Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag=2;Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=4;Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=8;Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=16;Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=32;Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=
64;Box2D.Dynamics.Contacts.b2Contact.s_input=new r});p.b2ContactConstraint=function(){this.localPlaneNormal=new J;this.localPoint=new J;this.normal=new J;this.normalMass=new G;this.K=new G};p.prototype.b2ContactConstraint=function(){this.points=new Vector(M.b2_maxManifoldPoints);for(var a=0;a<M.b2_maxManifoldPoints;a++)this.points[a]=new b};b.b2ContactConstraintPoint=function(){this.localPoint=new J;this.rA=new J;this.rB=new J};q.b2ContactEdge=function(){};n.b2ContactFactory=function(){};n.prototype.b2ContactFactory=
function(a){this.m_allocator=a;this.InitializeRegisters()};n.prototype.AddType=function(a,g,b,d){void 0===b&&(b=0);void 0===d&&(d=0);this.m_registers[b][d].createFcn=a;this.m_registers[b][d].destroyFcn=g;this.m_registers[b][d].primary=!0;b!=d&&(this.m_registers[d][b].createFcn=a,this.m_registers[d][b].destroyFcn=g,this.m_registers[d][b].primary=!1)};n.prototype.InitializeRegisters=function(){this.m_registers=new Vector(d.e_shapeTypeCount);for(var a=0;a<d.e_shapeTypeCount;a++){this.m_registers[a]=
new Vector(d.e_shapeTypeCount);for(var g=0;g<d.e_shapeTypeCount;g++)this.m_registers[a][g]=new z}this.AddType(e.Create,e.Destroy,d.e_circleShape,d.e_circleShape);this.AddType(A.Create,A.Destroy,d.e_polygonShape,d.e_circleShape);this.AddType(E.Create,E.Destroy,d.e_polygonShape,d.e_polygonShape);this.AddType(v.Create,v.Destroy,d.e_edgeShape,d.e_circleShape);this.AddType(h.Create,h.Destroy,d.e_polygonShape,d.e_edgeShape)};n.prototype.Create=function(a,g){var b=parseInt(a.GetType()),d=parseInt(g.GetType()),
b=this.m_registers[b][d];if(b.pool)return d=b.pool,b.pool=d.m_next,b.poolCount--,d.Reset(a,g),d;d=b.createFcn;return null!=d?(b.primary?(d=d(this.m_allocator),d.Reset(a,g)):(d=d(this.m_allocator),d.Reset(g,a)),d):null};n.prototype.Destroy=function(a){0<a.m_manifold.m_pointCount&&(a.m_fixtureA.m_body.SetAwake(!0),a.m_fixtureB.m_body.SetAwake(!0));var g=parseInt(a.m_fixtureA.GetType()),b=parseInt(a.m_fixtureB.GetType()),g=this.m_registers[g][b];g.poolCount++;a.m_next=g.pool;g.pool=a;g=g.destroyFcn;
g(a,this.m_allocator)};z.b2ContactRegister=function(){};u.b2ContactResult=function(){this.position=new J;this.normal=new J;this.id=new R};x.b2ContactSolver=function(){this.m_step=new H;this.m_constraints=new Vector};x.prototype.b2ContactSolver=function(){};x.prototype.Initialize=function(a,g,b,d){void 0===b&&(b=0);var c;this.m_step.Set(a);this.m_allocator=d;a=0;for(this.m_constraintCount=b;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new p;for(a=
0;a<b;++a){c=g[a];d=c.m_fixtureA;var r=c.m_fixtureB,e=d.m_shape.m_radius,w=r.m_shape.m_radius,f=d.m_body,h=r.m_body,k=c.GetManifold(),l=M.b2MixFriction(d.GetFriction(),r.GetFriction()),v=M.b2MixRestitution(d.GetRestitution(),r.GetRestitution()),n=f.m_linearVelocity.x,q=f.m_linearVelocity.y,u=h.m_linearVelocity.x,z=h.m_linearVelocity.y,A=f.m_angularVelocity,B=h.m_angularVelocity;M.b2Assert(0<k.m_pointCount);x.s_worldManifold.Initialize(k,f.m_xf,e,h.m_xf,w);r=x.s_worldManifold.m_normal.x;c=x.s_worldManifold.m_normal.y;
d=this.m_constraints[a];d.bodyA=f;d.bodyB=h;d.manifold=k;d.normal.x=r;d.normal.y=c;d.pointCount=k.m_pointCount;d.friction=l;d.restitution=v;d.localPlaneNormal.x=k.m_localPlaneNormal.x;d.localPlaneNormal.y=k.m_localPlaneNormal.y;d.localPoint.x=k.m_localPoint.x;d.localPoint.y=k.m_localPoint.y;d.radius=e+w;d.type=k.m_type;for(e=0;e<d.pointCount;++e){l=k.m_points[e];w=d.points[e];w.normalImpulse=l.m_normalImpulse;w.tangentImpulse=l.m_tangentImpulse;w.localPoint.SetV(l.m_localPoint);var l=w.rA.x=x.s_worldManifold.m_points[e].x-
f.m_sweep.c.x,v=w.rA.y=x.s_worldManifold.m_points[e].y-f.m_sweep.c.y,E=w.rB.x=x.s_worldManifold.m_points[e].x-h.m_sweep.c.x,I=w.rB.y=x.s_worldManifold.m_points[e].y-h.m_sweep.c.y,H=l*c-v*r,G=E*c-I*r,H=H*H,G=G*G;w.normalMass=1/(f.m_invMass+h.m_invMass+f.m_invI*H+h.m_invI*G);var J=f.m_mass*f.m_invMass+h.m_mass*h.m_invMass,J=J+(f.m_mass*f.m_invI*H+h.m_mass*h.m_invI*G);w.equalizedMass=1/J;G=c;J=-r;H=l*J-v*G;G=E*J-I*G;H*=H;G*=G;w.tangentMass=1/(f.m_invMass+h.m_invMass+f.m_invI*H+h.m_invI*G);w.velocityBias=
0;l=d.normal.x*(u+-B*I-n- -A*v)+d.normal.y*(z+B*E-q-A*l);l<-M.b2_velocityThreshold&&(w.velocityBias+=-d.restitution*l)}2==d.pointCount&&(z=d.points[0],u=d.points[1],k=f.m_invMass,f=f.m_invI,n=h.m_invMass,h=h.m_invI,q=z.rA.x*c-z.rA.y*r,z=z.rB.x*c-z.rB.y*r,A=u.rA.x*c-u.rA.y*r,u=u.rB.x*c-u.rB.y*r,r=k+n+f*q*q+h*z*z,c=k+n+f*A*A+h*u*u,h=k+n+f*q*A+h*z*u,r*r<100*(r*c-h*h)?(d.K.col1.Set(r,h),d.K.col2.Set(h,c),d.K.GetInverse(d.normalMass)):d.pointCount=1)}};x.prototype.InitVelocityConstraints=function(a){for(var g=
0;g<this.m_constraintCount;++g){var b=this.m_constraints[g],d=b.bodyA,c=b.bodyB,r=d.m_invMass,e=d.m_invI,w=c.m_invMass,f=c.m_invI,h=b.normal.x,k=b.normal.y,l=k,v=-h,n=0,q=0;if(a.warmStarting)for(q=b.pointCount,n=0;n<q;++n){var u=b.points[n];u.normalImpulse*=a.dtRatio;u.tangentImpulse*=a.dtRatio;var p=u.normalImpulse*h+u.tangentImpulse*l,x=u.normalImpulse*k+u.tangentImpulse*v;d.m_angularVelocity-=e*(u.rA.x*x-u.rA.y*p);d.m_linearVelocity.x-=r*p;d.m_linearVelocity.y-=r*x;c.m_angularVelocity+=f*(u.rB.x*
x-u.rB.y*p);c.m_linearVelocity.x+=w*p;c.m_linearVelocity.y+=w*x}else for(q=b.pointCount,n=0;n<q;++n)d=b.points[n],d.normalImpulse=0,d.tangentImpulse=0}};x.prototype.SolveVelocityConstraints=function(){for(var a=0,g,b=0,d=0,c=0,r=d=d=b=b=0,e=b=b=0,w=b=c=0,f=0,h,k=0;k<this.m_constraintCount;++k){var c=this.m_constraints[k],l=c.bodyA,v=c.bodyB,n=l.m_angularVelocity,u=v.m_angularVelocity,q=l.m_linearVelocity,p=v.m_linearVelocity,x=l.m_invMass,z=l.m_invI,A=v.m_invMass,B=v.m_invI,w=c.normal.x,E=f=c.normal.y;
h=-w;e=c.friction;for(a=0;a<c.pointCount;a++)g=c.points[a],b=p.x-u*g.rB.y-q.x+n*g.rA.y,d=p.y+u*g.rB.x-q.y-n*g.rA.x,b=b*E+d*h,b=g.tangentMass*-b,d=e*g.normalImpulse,d=Q.Clamp(g.tangentImpulse+b,-d,d),b=d-g.tangentImpulse,r=b*E,b*=h,q.x-=x*r,q.y-=x*b,n-=z*(g.rA.x*b-g.rA.y*r),p.x+=A*r,p.y+=A*b,u+=B*(g.rB.x*b-g.rB.y*r),g.tangentImpulse=d;parseInt(c.pointCount);if(1==c.pointCount)g=c.points[0],b=p.x+-u*g.rB.y-q.x- -n*g.rA.y,d=p.y+u*g.rB.x-q.y-n*g.rA.x,c=b*w+d*f,b=-g.normalMass*(c-g.velocityBias),d=g.normalImpulse+
b,d=0<d?d:0,b=d-g.normalImpulse,r=b*w,b*=f,q.x-=x*r,q.y-=x*b,n-=z*(g.rA.x*b-g.rA.y*r),p.x+=A*r,p.y+=A*b,u+=B*(g.rB.x*b-g.rB.y*r),g.normalImpulse=d;else{g=c.points[0];var a=c.points[1],b=g.normalImpulse,e=a.normalImpulse,I=(p.x-u*g.rB.y-q.x+n*g.rA.y)*w+(p.y+u*g.rB.x-q.y-n*g.rA.x)*f,H=(p.x-u*a.rB.y-q.x+n*a.rA.y)*w+(p.y+u*a.rB.x-q.y-n*a.rA.x)*f,d=I-g.velocityBias,r=H-a.velocityBias;h=c.K;d-=h.col1.x*b+h.col2.x*e;for(r-=h.col1.y*b+h.col2.y*e;;){h=c.normalMass;E=-(h.col1.x*d+h.col2.x*r);h=-(h.col1.y*d+
h.col2.y*r);if(0<=E&&0<=h){b=E-b;e=h-e;c=b*w;b*=f;w*=e;f*=e;q.x-=x*(c+w);q.y-=x*(b+f);n-=z*(g.rA.x*b-g.rA.y*c+a.rA.x*f-a.rA.y*w);p.x+=A*(c+w);p.y+=A*(b+f);u+=B*(g.rB.x*b-g.rB.y*c+a.rB.x*f-a.rB.y*w);g.normalImpulse=E;a.normalImpulse=h;break}E=-g.normalMass*d;h=0;H=c.K.col1.y*E+r;if(0<=E&&0<=H){b=E-b;e=h-e;c=b*w;b*=f;w*=e;f*=e;q.x-=x*(c+w);q.y-=x*(b+f);n-=z*(g.rA.x*b-g.rA.y*c+a.rA.x*f-a.rA.y*w);p.x+=A*(c+w);p.y+=A*(b+f);u+=B*(g.rB.x*b-g.rB.y*c+a.rB.x*f-a.rB.y*w);g.normalImpulse=E;a.normalImpulse=h;
break}E=0;h=-a.normalMass*r;I=c.K.col2.x*h+d;if(0<=h&&0<=I){b=E-b;e=h-e;c=b*w;b*=f;w*=e;f*=e;q.x-=x*(c+w);q.y-=x*(b+f);n-=z*(g.rA.x*b-g.rA.y*c+a.rA.x*f-a.rA.y*w);p.x+=A*(c+w);p.y+=A*(b+f);u+=B*(g.rB.x*b-g.rB.y*c+a.rB.x*f-a.rB.y*w);g.normalImpulse=E;a.normalImpulse=h;break}h=E=0;I=d;H=r;if(0<=I&&0<=H){b=E-b;e=h-e;c=b*w;b*=f;w*=e;f*=e;q.x-=x*(c+w);q.y-=x*(b+f);n-=z*(g.rA.x*b-g.rA.y*c+a.rA.x*f-a.rA.y*w);p.x+=A*(c+w);p.y+=A*(b+f);u+=B*(g.rB.x*b-g.rB.y*c+a.rB.x*f-a.rB.y*w);g.normalImpulse=E;a.normalImpulse=
h;break}break}}l.m_angularVelocity=n;v.m_angularVelocity=u}};x.prototype.FinalizeVelocityConstraints=function(){for(var a=0;a<this.m_constraintCount;++a)for(var g=this.m_constraints[a],b=g.manifold,d=0;d<g.pointCount;++d){var c=b.m_points[d],r=g.points[d];c.m_normalImpulse=r.normalImpulse;c.m_tangentImpulse=r.tangentImpulse}};x.prototype.SolvePositionConstraints=function(a){void 0===a&&(a=0);for(var g=0,b=0;b<this.m_constraintCount;b++){var d=this.m_constraints[b],c=d.bodyA,r=d.bodyB,e=c.m_mass*c.m_invMass,
w=c.m_mass*c.m_invI,f=r.m_mass*r.m_invMass,h=r.m_mass*r.m_invI;x.s_psm.Initialize(d);for(var k=x.s_psm.m_normal,l=0;l<d.pointCount;l++){var v=d.points[l],n=x.s_psm.m_points[l],q=x.s_psm.m_separations[l],u=n.x-c.m_sweep.c.x,p=n.y-c.m_sweep.c.y,z=n.x-r.m_sweep.c.x,n=n.y-r.m_sweep.c.y,g=g<q?g:q,q=Q.Clamp(a*(q+M.b2_linearSlop),-M.b2_maxLinearCorrection,0),q=-v.equalizedMass*q,v=q*k.x,q=q*k.y;c.m_sweep.c.x-=e*v;c.m_sweep.c.y-=e*q;c.m_sweep.a-=w*(u*q-p*v);c.SynchronizeTransform();r.m_sweep.c.x+=f*v;r.m_sweep.c.y+=
f*q;r.m_sweep.a+=h*(z*q-n*v);r.SynchronizeTransform()}}return g>-1.5*M.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new w;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new I});Box2D.inherit(v,Box2D.Dynamics.Contacts.b2Contact);v.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;v.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};v.Create=function(a){return new v};v.Destroy=function(a,
g){};v.prototype.Reset=function(a,g){this.__super.Reset.call(this,a,g)};v.prototype.Evaluate=function(){var g=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof l?this.m_fixtureA.GetShape():null,g.m_xf,this.m_fixtureB.GetShape()instanceof a?this.m_fixtureB.GetShape():null,b.m_xf)};v.prototype.b2CollideEdgeAndCircle=function(a,g,b,d,c){};Box2D.inherit(B,Box2D.Dynamics.Contacts.b2Contact);B.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;
B.b2NullContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};B.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)};B.prototype.Evaluate=function(){};Box2D.inherit(A,Box2D.Dynamics.Contacts.b2Contact);A.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;A.b2PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};A.Create=function(a){return new A};A.Destroy=function(a,g){};A.prototype.Reset=function(a,
g){this.__super.Reset.call(this,a,g);M.b2Assert(a.GetType()==d.e_polygonShape);M.b2Assert(g.GetType()==d.e_circleShape)};A.prototype.Evaluate=function(){var g=this.m_fixtureA.m_body,b=this.m_fixtureB.m_body;K.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof f?this.m_fixtureA.GetShape():null,g.m_xf,this.m_fixtureB.GetShape()instanceof a?this.m_fixtureB.GetShape():null,b.m_xf)};Box2D.inherit(h,Box2D.Dynamics.Contacts.b2Contact);h.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;
h.b2PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};h.Create=function(a){return new h};h.Destroy=function(a,g){};h.prototype.Reset=function(a,g){this.__super.Reset.call(this,a,g);M.b2Assert(a.GetType()==d.e_polygonShape);M.b2Assert(g.GetType()==d.e_edgeShape)};h.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),g=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof f?this.m_fixtureA.GetShape():
null,a.m_xf,this.m_fixtureB.GetShape()instanceof l?this.m_fixtureB.GetShape():null,g.m_xf)};h.prototype.b2CollidePolyAndEdge=function(a,g,b,d,c){};Box2D.inherit(E,Box2D.Dynamics.Contacts.b2Contact);E.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;E.b2PolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};E.Create=function(a){return new E};E.Destroy=function(a,g){};E.prototype.Reset=function(a,g){this.__super.Reset.call(this,a,g)};E.prototype.Evaluate=
function(){var a=this.m_fixtureA.GetBody(),g=this.m_fixtureB.GetBody();K.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof f?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof f?this.m_fixtureB.GetShape():null,g.m_xf)};I.b2PositionSolverManifold=function(){};I.prototype.b2PositionSolverManifold=function(){this.m_normal=new J;this.m_separations=new Vector_a2j_Number(M.b2_maxManifoldPoints);this.m_points=new Vector(M.b2_maxManifoldPoints);for(var a=0;a<M.b2_maxManifoldPoints;a++)this.m_points[a]=
new J};I.prototype.Initialize=function(a){M.b2Assert(0<a.pointCount);var g=0,b=0,d=0,c,r=0,e=0;switch(a.type){case O.e_circles:c=a.bodyA.m_xf.R;d=a.localPoint;g=a.bodyA.m_xf.position.x+(c.col1.x*d.x+c.col2.x*d.y);b=a.bodyA.m_xf.position.y+(c.col1.y*d.x+c.col2.y*d.y);c=a.bodyB.m_xf.R;d=a.points[0].localPoint;r=a.bodyB.m_xf.position.x+(c.col1.x*d.x+c.col2.x*d.y);c=a.bodyB.m_xf.position.y+(c.col1.y*d.x+c.col2.y*d.y);var d=r-g,e=c-b,w=d*d+e*e;w>Number.MIN_VALUE*Number.MIN_VALUE?(w=Math.sqrt(w),this.m_normal.x=
d/w,this.m_normal.y=e/w):(this.m_normal.x=1,this.m_normal.y=0);this.m_points[0].x=.5*(g+r);this.m_points[0].y=.5*(b+c);this.m_separations[0]=d*this.m_normal.x+e*this.m_normal.y-a.radius;break;case O.e_faceA:c=a.bodyA.m_xf.R;d=a.localPlaneNormal;this.m_normal.x=c.col1.x*d.x+c.col2.x*d.y;this.m_normal.y=c.col1.y*d.x+c.col2.y*d.y;c=a.bodyA.m_xf.R;d=a.localPoint;r=a.bodyA.m_xf.position.x+(c.col1.x*d.x+c.col2.x*d.y);e=a.bodyA.m_xf.position.y+(c.col1.y*d.x+c.col2.y*d.y);c=a.bodyB.m_xf.R;for(g=0;g<a.pointCount;++g)d=
a.points[g].localPoint,b=a.bodyB.m_xf.position.x+(c.col1.x*d.x+c.col2.x*d.y),d=a.bodyB.m_xf.position.y+(c.col1.y*d.x+c.col2.y*d.y),this.m_separations[g]=(b-r)*this.m_normal.x+(d-e)*this.m_normal.y-a.radius,this.m_points[g].x=b,this.m_points[g].y=d;break;case O.e_faceB:c=a.bodyB.m_xf.R;d=a.localPlaneNormal;this.m_normal.x=c.col1.x*d.x+c.col2.x*d.y;this.m_normal.y=c.col1.y*d.x+c.col2.y*d.y;c=a.bodyB.m_xf.R;d=a.localPoint;r=a.bodyB.m_xf.position.x+(c.col1.x*d.x+c.col2.x*d.y);e=a.bodyB.m_xf.position.y+
(c.col1.y*d.x+c.col2.y*d.y);c=a.bodyA.m_xf.R;for(g=0;g<a.pointCount;++g)d=a.points[g].localPoint,b=a.bodyA.m_xf.position.x+(c.col1.x*d.x+c.col2.x*d.y),d=a.bodyA.m_xf.position.y+(c.col1.y*d.x+c.col2.y*d.y),this.m_separations[g]=(b-r)*this.m_normal.x+(d-e)*this.m_normal.y-a.radius,this.m_points[g].Set(b,d);this.m_normal.x*=-1;this.m_normal.y*=-1}};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new J;Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=
new J})})();
(function(){var a=Box2D.Common.Math.b2Mat22,l=Box2D.Common.Math.b2Math,f=Box2D.Common.Math.b2Vec2,d=Box2D.Common.b2Color,e=Box2D.Dynamics.Controllers.b2BuoyancyController,k=Box2D.Dynamics.Controllers.b2ConstantAccelController,p=Box2D.Dynamics.Controllers.b2ConstantForceController,b=Box2D.Dynamics.Controllers.b2Controller,q=Box2D.Dynamics.Controllers.b2ControllerEdge,n=Box2D.Dynamics.Controllers.b2GravityController,z=Box2D.Dynamics.Controllers.b2TensorDampingController;Box2D.inherit(e,Box2D.Dynamics.Controllers.b2Controller);
e.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;e.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.normal=new f(0,-1);this.density=this.offset=0;this.velocity=new f(0,0);this.linearDrag=2;this.angularDrag=1;this.useDensity=!1;this.useWorldGravity=!0;this.gravity=null};e.prototype.Step=function(a){if(this.m_bodyList)for(this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy()),a=this.m_bodyList;a;a=
a.nextBody){var b=a.body;if(0!=b.IsAwake()){for(var d=new f,e=new f,k=0,h=0,l=b.GetFixtureList();l;l=l.GetNext()){var n=new f,q=l.GetShape().ComputeSubmergedArea(this.normal,this.offset,b.GetTransform(),n),k=k+q;d.x+=q*n.x;d.y+=q*n.y;var p=0,p=1,h=h+q*p;e.x+=q*n.x*p;e.y+=q*n.y*p}d.x/=k;d.y/=k;e.x/=h;e.y/=h;k<Number.MIN_VALUE||(h=this.gravity.GetNegative(),h.Multiply(this.density*k),b.ApplyForce(h,e),e=b.GetLinearVelocityFromWorldPoint(d),e.Subtract(this.velocity),e.Multiply(-this.linearDrag*k),b.ApplyForce(e,
d),b.ApplyTorque(-b.GetInertia()/b.GetMass()*k*b.GetAngularVelocity()*this.angularDrag))}}};e.prototype.Draw=function(a){var b=new f,e=new f;b.x=this.normal.x*this.offset+1E3*this.normal.y;b.y=this.normal.y*this.offset-1E3*this.normal.x;e.x=this.normal.x*this.offset-1E3*this.normal.y;e.y=this.normal.y*this.offset+1E3*this.normal.x;var k=new d(0,0,1);a.DrawSegment(b,e,k)};Box2D.inherit(k,Box2D.Dynamics.Controllers.b2Controller);k.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;
k.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.A=new f(0,0)};k.prototype.Step=function(a){a=new f(this.A.x*a.dt,this.A.y*a.dt);for(var b=this.m_bodyList;b;b=b.nextBody){var d=b.body;d.IsAwake()&&d.SetLinearVelocity(new f(d.GetLinearVelocity().x+a.x,d.GetLinearVelocity().y+a.y))}};Box2D.inherit(p,Box2D.Dynamics.Controllers.b2Controller);p.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;p.b2ConstantForceController=
function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.F=new f(0,0)};p.prototype.Step=function(a){for(a=this.m_bodyList;a;a=a.nextBody){var b=a.body;b.IsAwake()&&b.ApplyForce(this.F,b.GetWorldCenter())}};b.b2Controller=function(){};b.prototype.Step=function(a){};b.prototype.Draw=function(a){};b.prototype.AddBody=function(a){var b=new q;b.controller=this;b.body=a;b.nextBody=this.m_bodyList;b.prevBody=null;this.m_bodyList=b;b.nextBody&&(b.nextBody.prevBody=b);this.m_bodyCount++;
b.nextController=a.m_controllerList;b.prevController=null;a.m_controllerList=b;b.nextController&&(b.nextController.prevController=b);a.m_controllerCount++};b.prototype.RemoveBody=function(a){for(var b=a.m_controllerList;b&&b.controller!=this;)b=b.nextController;b.prevBody&&(b.prevBody.nextBody=b.nextBody);b.nextBody&&(b.nextBody.prevBody=b.prevBody);b.nextController&&(b.nextController.prevController=b.prevController);b.prevController&&(b.prevController.nextController=b.nextController);this.m_bodyList==
b&&(this.m_bodyList=b.nextBody);a.m_controllerList==b&&(a.m_controllerList=b.nextController);a.m_controllerCount--;this.m_bodyCount--};b.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)};b.prototype.GetNext=function(){return this.m_next};b.prototype.GetWorld=function(){return this.m_world};b.prototype.GetBodyList=function(){return this.m_bodyList};q.b2ControllerEdge=function(){};Box2D.inherit(n,Box2D.Dynamics.Controllers.b2Controller);n.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;
n.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.G=1;this.invSqr=!0};n.prototype.Step=function(a){var b=a=null,d=null,e=0,k=null,h=null,l=null,n=0,q=0,p=0,n=null;if(this.invSqr)for(a=this.m_bodyList;a;a=a.nextBody)for(b=a.body,d=b.GetWorldCenter(),e=b.GetMass(),k=this.m_bodyList;k!=a;k=k.nextBody)h=k.body,l=h.GetWorldCenter(),n=l.x-d.x,q=l.y-d.y,p=n*n+q*q,p<Number.MIN_VALUE||(n=new f(n,q),n.Multiply(this.G/p/Math.sqrt(p)*e*h.GetMass()),
b.IsAwake()&&b.ApplyForce(n,d),n.Multiply(-1),h.IsAwake()&&h.ApplyForce(n,l));else for(a=this.m_bodyList;a;a=a.nextBody)for(b=a.body,d=b.GetWorldCenter(),e=b.GetMass(),k=this.m_bodyList;k!=a;k=k.nextBody)h=k.body,l=h.GetWorldCenter(),n=l.x-d.x,q=l.y-d.y,p=n*n+q*q,p<Number.MIN_VALUE||(n=new f(n,q),n.Multiply(this.G/p*e*h.GetMass()),b.IsAwake()&&b.ApplyForce(n,d),n.Multiply(-1),h.IsAwake()&&h.ApplyForce(n,l))};Box2D.inherit(z,Box2D.Dynamics.Controllers.b2Controller);z.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;
z.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.T=new a;this.maxTimestep=0};z.prototype.SetAxisAligned=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);this.T.col1.x=-a;this.T.col1.y=0;this.T.col2.x=0;this.T.col2.y=-b;this.maxTimestep=0<a||0<b?1/Math.max(a,b):0};z.prototype.Step=function(a){a=a.dt;if(!(a<=Number.MIN_VALUE)){a>this.maxTimestep&&0<this.maxTimestep&&(a=this.maxTimestep);for(var b=this.m_bodyList;b;b=b.nextBody){var d=
b.body;if(d.IsAwake()){var e=d.GetWorldVector(l.MulMV(this.T,d.GetLocalVector(d.GetLinearVelocity())));d.SetLinearVelocity(new f(d.GetLinearVelocity().x+e.x*a,d.GetLinearVelocity().y+e.y*a))}}}}})();
(function(){var a=Box2D.Common.b2Settings,l=Box2D.Common.Math.b2Mat22,f=Box2D.Common.Math.b2Mat33,d=Box2D.Common.Math.b2Math,e=Box2D.Common.Math.b2Vec2,k=Box2D.Common.Math.b2Vec3,p=Box2D.Dynamics.Joints.b2DistanceJoint,b=Box2D.Dynamics.Joints.b2DistanceJointDef,q=Box2D.Dynamics.Joints.b2FrictionJoint,n=Box2D.Dynamics.Joints.b2FrictionJointDef,z=Box2D.Dynamics.Joints.b2GearJoint,u=Box2D.Dynamics.Joints.b2GearJointDef,x=Box2D.Dynamics.Joints.b2Jacobian,v=Box2D.Dynamics.Joints.b2Joint,B=Box2D.Dynamics.Joints.b2JointDef,
A=Box2D.Dynamics.Joints.b2JointEdge,h=Box2D.Dynamics.Joints.b2LineJoint,E=Box2D.Dynamics.Joints.b2LineJointDef,I=Box2D.Dynamics.Joints.b2MouseJoint,N=Box2D.Dynamics.Joints.b2MouseJointDef,H=Box2D.Dynamics.Joints.b2PrismaticJoint,M=Box2D.Dynamics.Joints.b2PrismaticJointDef,G=Box2D.Dynamics.Joints.b2PulleyJoint,Q=Box2D.Dynamics.Joints.b2PulleyJointDef,J=Box2D.Dynamics.Joints.b2RevoluteJoint,K=Box2D.Dynamics.Joints.b2RevoluteJointDef,R=Box2D.Dynamics.Joints.b2WeldJoint,O=Box2D.Dynamics.Joints.b2WeldJointDef;
Box2D.inherit(p,Box2D.Dynamics.Joints.b2Joint);p.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;p.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new e;this.m_localAnchor2=new e;this.m_u=new e};p.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};p.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};p.prototype.GetReactionForce=function(a){void 0===a&&(a=0);
return new e(a*this.m_impulse*this.m_u.x,a*this.m_impulse*this.m_u.y)};p.prototype.GetReactionTorque=function(a){return 0};p.prototype.GetLength=function(){return this.m_length};p.prototype.SetLength=function(a){void 0===a&&(a=0);this.m_length=a};p.prototype.GetFrequency=function(){return this.m_frequencyHz};p.prototype.SetFrequency=function(a){void 0===a&&(a=0);this.m_frequencyHz=a};p.prototype.GetDampingRatio=function(){return this.m_dampingRatio};p.prototype.SetDampingRatio=function(a){void 0===
a&&(a=0);this.m_dampingRatio=a};p.prototype.b2DistanceJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);this.m_length=a.length;this.m_frequencyHz=a.frequencyHz;this.m_dampingRatio=a.dampingRatio;this.m_bias=this.m_gamma=this.m_impulse=0};p.prototype.InitVelocityConstraints=function(g){var b,d=0,e=this.m_bodyA,f=this.m_bodyB;b=e.m_xf.R;var h=this.m_localAnchor1.x-e.m_sweep.localCenter.x,k=this.m_localAnchor1.y-e.m_sweep.localCenter.y,
d=b.col1.x*h+b.col2.x*k,k=b.col1.y*h+b.col2.y*k,h=d;b=f.m_xf.R;var c=this.m_localAnchor2.x-f.m_sweep.localCenter.x,m=this.m_localAnchor2.y-f.m_sweep.localCenter.y,d=b.col1.x*c+b.col2.x*m,m=b.col1.y*c+b.col2.y*m,c=d;this.m_u.x=f.m_sweep.c.x+c-e.m_sweep.c.x-h;this.m_u.y=f.m_sweep.c.y+m-e.m_sweep.c.y-k;d=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);d>a.b2_linearSlop?this.m_u.Multiply(1/d):this.m_u.SetZero();b=h*this.m_u.y-k*this.m_u.x;var l=c*this.m_u.y-m*this.m_u.x;b=e.m_invMass+e.m_invI*
b*b+f.m_invMass+f.m_invI*l*l;this.m_mass=0!=b?1/b:0;if(0<this.m_frequencyHz){var d=d-this.m_length,l=2*Math.PI*this.m_frequencyHz,n=this.m_mass*l*l;this.m_gamma=g.dt*(2*this.m_mass*this.m_dampingRatio*l+g.dt*n);this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0;this.m_bias=d*g.dt*n*this.m_gamma;this.m_mass=b+this.m_gamma;this.m_mass=0!=this.m_mass?1/this.m_mass:0}g.warmStarting?(this.m_impulse*=g.dtRatio,g=this.m_impulse*this.m_u.x,b=this.m_impulse*this.m_u.y,e.m_linearVelocity.x-=e.m_invMass*g,e.m_linearVelocity.y-=
e.m_invMass*b,e.m_angularVelocity-=e.m_invI*(h*b-k*g),f.m_linearVelocity.x+=f.m_invMass*g,f.m_linearVelocity.y+=f.m_invMass*b,f.m_angularVelocity+=f.m_invI*(c*b-m*g)):this.m_impulse=0};p.prototype.SolveVelocityConstraints=function(a){var b;a=this.m_bodyA;var d=this.m_bodyB;b=a.m_xf.R;var e=this.m_localAnchor1.x-a.m_sweep.localCenter.x,f=this.m_localAnchor1.y-a.m_sweep.localCenter.y,h=b.col1.x*e+b.col2.x*f,f=b.col1.y*e+b.col2.y*f,e=h;b=d.m_xf.R;var k=this.m_localAnchor2.x-d.m_sweep.localCenter.x,c=
this.m_localAnchor2.y-d.m_sweep.localCenter.y,h=b.col1.x*k+b.col2.x*c,c=b.col1.y*k+b.col2.y*c,k=h,h=-this.m_mass*(this.m_u.x*(d.m_linearVelocity.x+-d.m_angularVelocity*c-(a.m_linearVelocity.x+-a.m_angularVelocity*f))+this.m_u.y*(d.m_linearVelocity.y+d.m_angularVelocity*k-(a.m_linearVelocity.y+a.m_angularVelocity*e))+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=h;b=h*this.m_u.x;h*=this.m_u.y;a.m_linearVelocity.x-=a.m_invMass*b;a.m_linearVelocity.y-=a.m_invMass*h;a.m_angularVelocity-=a.m_invI*
(e*h-f*b);d.m_linearVelocity.x+=d.m_invMass*b;d.m_linearVelocity.y+=d.m_invMass*h;d.m_angularVelocity+=d.m_invI*(k*h-c*b)};p.prototype.SolvePositionConstraints=function(g){var b;if(0<this.m_frequencyHz)return!0;g=this.m_bodyA;var e=this.m_bodyB;b=g.m_xf.R;var t=this.m_localAnchor1.x-g.m_sweep.localCenter.x,f=this.m_localAnchor1.y-g.m_sweep.localCenter.y,h=b.col1.x*t+b.col2.x*f,f=b.col1.y*t+b.col2.y*f,t=h;b=e.m_xf.R;var k=this.m_localAnchor2.x-e.m_sweep.localCenter.x,c=this.m_localAnchor2.y-e.m_sweep.localCenter.y,
h=b.col1.x*k+b.col2.x*c,c=b.col1.y*k+b.col2.y*c,k=h,h=e.m_sweep.c.x+k-g.m_sweep.c.x-t,m=e.m_sweep.c.y+c-g.m_sweep.c.y-f;b=Math.sqrt(h*h+m*m);h/=b;m/=b;b-=this.m_length;b=d.Clamp(b,-a.b2_maxLinearCorrection,a.b2_maxLinearCorrection);var l=-this.m_mass*b;this.m_u.Set(h,m);h=l*this.m_u.x;m=l*this.m_u.y;g.m_sweep.c.x-=g.m_invMass*h;g.m_sweep.c.y-=g.m_invMass*m;g.m_sweep.a-=g.m_invI*(t*m-f*h);e.m_sweep.c.x+=e.m_invMass*h;e.m_sweep.c.y+=e.m_invMass*m;e.m_sweep.a+=e.m_invI*(k*m-c*h);g.SynchronizeTransform();
e.SynchronizeTransform();return d.Abs(b)<a.b2_linearSlop};Box2D.inherit(b,Box2D.Dynamics.Joints.b2JointDef);b.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;b.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new e;this.localAnchorB=new e};b.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_distanceJoint;this.length=1;this.dampingRatio=this.frequencyHz=0};b.prototype.Initialize=function(a,
b,d,e){this.bodyA=a;this.bodyB=b;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(d));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(e));a=e.x-d.x;d=e.y-d.y;this.length=Math.sqrt(a*a+d*d);this.dampingRatio=this.frequencyHz=0};Box2D.inherit(q,Box2D.Dynamics.Joints.b2Joint);q.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;q.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new e;this.m_localAnchorB=new e;this.m_linearMass=new l;this.m_linearImpulse=
new e};q.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};q.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};q.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new e(a*this.m_linearImpulse.x,a*this.m_linearImpulse.y)};q.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);return a*this.m_angularImpulse};q.prototype.SetMaxForce=function(a){void 0===a&&(a=0);this.m_maxForce=a};q.prototype.GetMaxForce=function(){return this.m_maxForce};
q.prototype.SetMaxTorque=function(a){void 0===a&&(a=0);this.m_maxTorque=a};q.prototype.GetMaxTorque=function(){return this.m_maxTorque};q.prototype.b2FrictionJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchorA.SetV(a.localAnchorA);this.m_localAnchorB.SetV(a.localAnchorB);this.m_linearMass.SetZero();this.m_angularMass=0;this.m_linearImpulse.SetZero();this.m_angularImpulse=0;this.m_maxForce=a.maxForce;this.m_maxTorque=a.maxTorque};q.prototype.InitVelocityConstraints=function(a){var b,
d=0,e=this.m_bodyA,f=this.m_bodyB;b=e.m_xf.R;var h=this.m_localAnchorA.x-e.m_sweep.localCenter.x,k=this.m_localAnchorA.y-e.m_sweep.localCenter.y,d=b.col1.x*h+b.col2.x*k,k=b.col1.y*h+b.col2.y*k,h=d;b=f.m_xf.R;var c=this.m_localAnchorB.x-f.m_sweep.localCenter.x,m=this.m_localAnchorB.y-f.m_sweep.localCenter.y,d=b.col1.x*c+b.col2.x*m,m=b.col1.y*c+b.col2.y*m,c=d;b=e.m_invMass;var d=f.m_invMass,n=e.m_invI,q=f.m_invI,p=new l;p.col1.x=b+d;p.col2.x=0;p.col1.y=0;p.col2.y=b+d;p.col1.x+=n*k*k;p.col2.x+=-n*h*
k;p.col1.y+=-n*h*k;p.col2.y+=n*h*h;p.col1.x+=q*m*m;p.col2.x+=-q*c*m;p.col1.y+=-q*c*m;p.col2.y+=q*c*c;p.GetInverse(this.m_linearMass);this.m_angularMass=n+q;0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass);a.warmStarting?(this.m_linearImpulse.x*=a.dtRatio,this.m_linearImpulse.y*=a.dtRatio,this.m_angularImpulse*=a.dtRatio,a=this.m_linearImpulse,e.m_linearVelocity.x-=b*a.x,e.m_linearVelocity.y-=b*a.y,e.m_angularVelocity-=n*(h*a.y-k*a.x+this.m_angularImpulse),f.m_linearVelocity.x+=d*a.x,
f.m_linearVelocity.y+=d*a.y,f.m_angularVelocity+=q*(c*a.y-m*a.x+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0)};q.prototype.SolveVelocityConstraints=function(a){var b,f=0,t=this.m_bodyA,h=this.m_bodyB,k=t.m_linearVelocity,l=t.m_angularVelocity,c=h.m_linearVelocity,m=h.m_angularVelocity,n=t.m_invMass,q=h.m_invMass,p=t.m_invI,v=h.m_invI;b=t.m_xf.R;var u=this.m_localAnchorA.x-t.m_sweep.localCenter.x,z=this.m_localAnchorA.y-t.m_sweep.localCenter.y,f=b.col1.x*u+b.col2.x*
z,z=b.col1.y*u+b.col2.y*z,u=f;b=h.m_xf.R;var x=this.m_localAnchorB.x-h.m_sweep.localCenter.x,A=this.m_localAnchorB.y-h.m_sweep.localCenter.y,f=b.col1.x*x+b.col2.x*A,A=b.col1.y*x+b.col2.y*A,x=f;b=0;var f=-this.m_angularMass*(m-l),B=this.m_angularImpulse;b=a.dt*this.m_maxTorque;this.m_angularImpulse=d.Clamp(this.m_angularImpulse+f,-b,b);f=this.m_angularImpulse-B;l-=p*f;m+=v*f;b=d.MulMV(this.m_linearMass,new e(-(c.x-m*A-k.x+l*z),-(c.y+m*x-k.y-l*u)));f=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(b);
b=a.dt*this.m_maxForce;this.m_linearImpulse.LengthSquared()>b*b&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(b));b=d.SubtractVV(this.m_linearImpulse,f);k.x-=n*b.x;k.y-=n*b.y;l-=p*(u*b.y-z*b.x);c.x+=q*b.x;c.y+=q*b.y;m+=v*(x*b.y-A*b.x);t.m_angularVelocity=l;h.m_angularVelocity=m};q.prototype.SolvePositionConstraints=function(a){return!0};Box2D.inherit(n,Box2D.Dynamics.Joints.b2JointDef);n.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;n.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,
arguments);this.localAnchorA=new e;this.localAnchorB=new e};n.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_frictionJoint;this.maxTorque=this.maxForce=0};n.prototype.Initialize=function(a,b,d){this.bodyA=a;this.bodyB=b;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(d));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(d))};Box2D.inherit(z,Box2D.Dynamics.Joints.b2Joint);z.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;z.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,
arguments);this.m_groundAnchor1=new e;this.m_groundAnchor2=new e;this.m_localAnchor1=new e;this.m_localAnchor2=new e;this.m_J=new x};z.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};z.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};z.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new e(a*this.m_impulse*this.m_J.linearB.x,a*this.m_impulse*this.m_J.linearB.y)};z.prototype.GetReactionTorque=function(a){void 0===
a&&(a=0);var b=this.m_bodyB.m_xf.R,d=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,e=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,f=b.col1.x*d+b.col2.x*e,e=b.col1.y*d+b.col2.y*e;return a*(this.m_impulse*this.m_J.angularB-f*this.m_impulse*this.m_J.linearB.y+e*this.m_impulse*this.m_J.linearB.x)};z.prototype.GetRatio=function(){return this.m_ratio};z.prototype.SetRatio=function(a){void 0===a&&(a=0);this.m_ratio=a};z.prototype.b2GearJoint=function(a){this.__super.b2Joint.call(this,
a);var b=parseInt(a.joint1.m_type),d=parseInt(a.joint2.m_type);this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null;var e=0,f=0;this.m_ground1=a.joint1.GetBodyA();this.m_bodyA=a.joint1.GetBodyB();b==v.e_revoluteJoint?(this.m_revolute1=a.joint1 instanceof J?a.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),e=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=a.joint1 instanceof H?a.joint1:null,
this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),e=this.m_prismatic1.GetJointTranslation());this.m_ground2=a.joint2.GetBodyA();this.m_bodyB=a.joint2.GetBodyB();d==v.e_revoluteJoint?(this.m_revolute2=a.joint2 instanceof J?a.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),f=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=a.joint2 instanceof H?a.joint2:
null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),f=this.m_prismatic2.GetJointTranslation());this.m_ratio=a.ratio;this.m_constant=e+this.m_ratio*f;this.m_impulse=0};z.prototype.InitVelocityConstraints=function(a){var b=this.m_ground1,d=this.m_ground2,e=this.m_bodyA,f=this.m_bodyB,h=0,k=0,c=0,m=0,l=c=0,n=0;this.m_J.SetZero();this.m_revolute1?(this.m_J.angularA=-1,n+=e.m_invI):(b=b.m_xf.R,k=this.m_prismatic1.m_localXAxis1,h=b.col1.x*
k.x+b.col2.x*k.y,k=b.col1.y*k.x+b.col2.y*k.y,b=e.m_xf.R,c=this.m_localAnchor1.x-e.m_sweep.localCenter.x,m=this.m_localAnchor1.y-e.m_sweep.localCenter.y,l=b.col1.x*c+b.col2.x*m,m=b.col1.y*c+b.col2.y*m,c=l*k-m*h,this.m_J.linearA.Set(-h,-k),this.m_J.angularA=-c,n+=e.m_invMass+e.m_invI*c*c);this.m_revolute2?(this.m_J.angularB=-this.m_ratio,n+=this.m_ratio*this.m_ratio*f.m_invI):(b=d.m_xf.R,k=this.m_prismatic2.m_localXAxis1,h=b.col1.x*k.x+b.col2.x*k.y,k=b.col1.y*k.x+b.col2.y*k.y,b=f.m_xf.R,c=this.m_localAnchor2.x-
f.m_sweep.localCenter.x,m=this.m_localAnchor2.y-f.m_sweep.localCenter.y,l=b.col1.x*c+b.col2.x*m,m=b.col1.y*c+b.col2.y*m,c=l*k-m*h,this.m_J.linearB.Set(-this.m_ratio*h,-this.m_ratio*k),this.m_J.angularB=-this.m_ratio*c,n+=this.m_ratio*this.m_ratio*(f.m_invMass+f.m_invI*c*c));this.m_mass=0<n?1/n:0;a.warmStarting?(e.m_linearVelocity.x+=e.m_invMass*this.m_impulse*this.m_J.linearA.x,e.m_linearVelocity.y+=e.m_invMass*this.m_impulse*this.m_J.linearA.y,e.m_angularVelocity+=e.m_invI*this.m_impulse*this.m_J.angularA,
f.m_linearVelocity.x+=f.m_invMass*this.m_impulse*this.m_J.linearB.x,f.m_linearVelocity.y+=f.m_invMass*this.m_impulse*this.m_J.linearB.y,f.m_angularVelocity+=f.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0};z.prototype.SolveVelocityConstraints=function(a){a=this.m_bodyA;var b=this.m_bodyB,d=this.m_J.Compute(a.m_linearVelocity,a.m_angularVelocity,b.m_linearVelocity,b.m_angularVelocity),d=-this.m_mass*d;this.m_impulse+=d;a.m_linearVelocity.x+=a.m_invMass*d*this.m_J.linearA.x;a.m_linearVelocity.y+=
a.m_invMass*d*this.m_J.linearA.y;a.m_angularVelocity+=a.m_invI*d*this.m_J.angularA;b.m_linearVelocity.x+=b.m_invMass*d*this.m_J.linearB.x;b.m_linearVelocity.y+=b.m_invMass*d*this.m_J.linearB.y;b.m_angularVelocity+=b.m_invI*d*this.m_J.angularB};z.prototype.SolvePositionConstraints=function(b){b=this.m_bodyA;var d=this.m_bodyB,e=0,f=0,e=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),f=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation(),
e=-this.m_mass*(this.m_constant-(e+this.m_ratio*f));b.m_sweep.c.x+=b.m_invMass*e*this.m_J.linearA.x;b.m_sweep.c.y+=b.m_invMass*e*this.m_J.linearA.y;b.m_sweep.a+=b.m_invI*e*this.m_J.angularA;d.m_sweep.c.x+=d.m_invMass*e*this.m_J.linearB.x;d.m_sweep.c.y+=d.m_invMass*e*this.m_J.linearB.y;d.m_sweep.a+=d.m_invI*e*this.m_J.angularB;b.SynchronizeTransform();d.SynchronizeTransform();return 0<a.b2_linearSlop};Box2D.inherit(u,Box2D.Dynamics.Joints.b2JointDef);u.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;
u.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)};u.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_gearJoint;this.joint2=this.joint1=null;this.ratio=1};x.b2Jacobian=function(){this.linearA=new e;this.linearB=new e};x.prototype.SetZero=function(){this.linearA.SetZero();this.angularA=0;this.linearB.SetZero();this.angularB=0};x.prototype.Set=function(a,b,d,e){void 0===b&&(b=0);void 0===e&&(e=0);this.linearA.SetV(a);this.angularA=
b;this.linearB.SetV(d);this.angularB=e};x.prototype.Compute=function(a,b,d,e){void 0===b&&(b=0);void 0===e&&(e=0);return this.linearA.x*a.x+this.linearA.y*a.y+this.angularA*b+(this.linearB.x*d.x+this.linearB.y*d.y)+this.angularB*e};v.b2Joint=function(){this.m_edgeA=new A;this.m_edgeB=new A;this.m_localCenterA=new e;this.m_localCenterB=new e};v.prototype.GetType=function(){return this.m_type};v.prototype.GetAnchorA=function(){return null};v.prototype.GetAnchorB=function(){return null};v.prototype.GetReactionForce=
function(a){return null};v.prototype.GetReactionTorque=function(a){return 0};v.prototype.GetBodyA=function(){return this.m_bodyA};v.prototype.GetBodyB=function(){return this.m_bodyB};v.prototype.GetNext=function(){return this.m_next};v.prototype.GetUserData=function(){return this.m_userData};v.prototype.SetUserData=function(a){this.m_userData=a};v.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};v.Create=function(a,d){var e=null;switch(a.type){case v.e_distanceJoint:e=
new p(a instanceof b?a:null);break;case v.e_mouseJoint:e=new I(a instanceof N?a:null);break;case v.e_prismaticJoint:e=new H(a instanceof M?a:null);break;case v.e_revoluteJoint:e=new J(a instanceof K?a:null);break;case v.e_pulleyJoint:e=new G(a instanceof Q?a:null);break;case v.e_gearJoint:e=new z(a instanceof u?a:null);break;case v.e_lineJoint:e=new h(a instanceof E?a:null);break;case v.e_weldJoint:e=new R(a instanceof O?a:null);break;case v.e_frictionJoint:e=new q(a instanceof n?a:null)}return e};
v.Destroy=function(a,b){};v.prototype.b2Joint=function(b){a.b2Assert(b.bodyA!=b.bodyB);this.m_type=b.type;this.m_next=this.m_prev=null;this.m_bodyA=b.bodyA;this.m_bodyB=b.bodyB;this.m_collideConnected=b.collideConnected;this.m_islandFlag=!1;this.m_userData=b.userData};v.prototype.InitVelocityConstraints=function(a){};v.prototype.SolveVelocityConstraints=function(a){};v.prototype.FinalizeVelocityConstraints=function(){};v.prototype.SolvePositionConstraints=function(a){return!1};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=
0;Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1;Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2;Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3;Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4;Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5;Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6;Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7;Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8;Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9;Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0;Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=
1;Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2;Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3});B.b2JointDef=function(){};B.prototype.b2JointDef=function(){this.type=v.e_unknownJoint;this.bodyB=this.bodyA=this.userData=null;this.collideConnected=!1};A.b2JointEdge=function(){};Box2D.inherit(h,Box2D.Dynamics.Joints.b2Joint);h.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;h.b2LineJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new e;this.m_localAnchor2=
new e;this.m_localXAxis1=new e;this.m_localYAxis1=new e;this.m_axis=new e;this.m_perp=new e;this.m_K=new l;this.m_impulse=new e};h.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};h.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};h.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new e(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+
(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))};h.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);return a*this.m_impulse.y};h.prototype.GetJointTranslation=function(){var a=this.m_bodyA,b=this.m_bodyB,d=a.GetWorldPoint(this.m_localAnchor1),e=b.GetWorldPoint(this.m_localAnchor2),b=e.x-d.x,d=e.y-d.y,a=a.GetWorldVector(this.m_localXAxis1);return a.x*b+a.y*d};h.prototype.GetJointSpeed=function(){var a=this.m_bodyA,b=this.m_bodyB,d;d=a.m_xf.R;var e=this.m_localAnchor1.x-a.m_sweep.localCenter.x,
f=this.m_localAnchor1.y-a.m_sweep.localCenter.y,h=d.col1.x*e+d.col2.x*f,f=d.col1.y*e+d.col2.y*f,e=h;d=b.m_xf.R;var k=this.m_localAnchor2.x-b.m_sweep.localCenter.x,c=this.m_localAnchor2.y-b.m_sweep.localCenter.y,h=d.col1.x*k+d.col2.x*c,c=d.col1.y*k+d.col2.y*c,k=h;d=b.m_sweep.c.x+k-(a.m_sweep.c.x+e);var h=b.m_sweep.c.y+c-(a.m_sweep.c.y+f),m=a.GetWorldVector(this.m_localXAxis1),l=a.m_linearVelocity,n=b.m_linearVelocity,a=a.m_angularVelocity,b=b.m_angularVelocity;return d*-a*m.y+h*a*m.x+(m.x*(n.x+-b*
c-l.x- -a*f)+m.y*(n.y+b*k-l.y-a*e))};h.prototype.IsLimitEnabled=function(){return this.m_enableLimit};h.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableLimit=a};h.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};h.prototype.GetUpperLimit=function(){return this.m_upperTranslation};h.prototype.SetLimits=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_lowerTranslation=a;this.m_upperTranslation=
b};h.prototype.IsMotorEnabled=function(){return this.m_enableMotor};h.prototype.EnableMotor=function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=a};h.prototype.SetMotorSpeed=function(a){void 0===a&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=a};h.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};h.prototype.SetMaxMotorForce=function(a){void 0===a&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorForce=
a};h.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce};h.prototype.GetMotorForce=function(){return this.m_motorImpulse};h.prototype.b2LineJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);this.m_localXAxis1.SetV(a.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_impulse.SetZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=a.lowerTranslation;
this.m_upperTranslation=a.upperTranslation;this.m_maxMotorForce=a.maxMotorForce;this.m_motorSpeed=a.motorSpeed;this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor;this.m_limitState=v.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};h.prototype.InitVelocityConstraints=function(b){var e=this.m_bodyA,f=this.m_bodyB,h,k=0;this.m_localCenterA.SetV(e.GetLocalCenter());this.m_localCenterB.SetV(f.GetLocalCenter());var l=e.GetTransform();f.GetTransform();h=e.m_xf.R;var n=this.m_localAnchor1.x-
this.m_localCenterA.x,c=this.m_localAnchor1.y-this.m_localCenterA.y,k=h.col1.x*n+h.col2.x*c,c=h.col1.y*n+h.col2.y*c,n=k;h=f.m_xf.R;var m=this.m_localAnchor2.x-this.m_localCenterB.x,y=this.m_localAnchor2.y-this.m_localCenterB.y,k=h.col1.x*m+h.col2.x*y,y=h.col1.y*m+h.col2.y*y,m=k;h=f.m_sweep.c.x+m-e.m_sweep.c.x-n;k=f.m_sweep.c.y+y-e.m_sweep.c.y-c;this.m_invMassA=e.m_invMass;this.m_invMassB=f.m_invMass;this.m_invIA=e.m_invI;this.m_invIB=f.m_invI;this.m_axis.SetV(d.MulMV(l.R,this.m_localXAxis1));this.m_a1=
(h+n)*this.m_axis.y-(k+c)*this.m_axis.x;this.m_a2=m*this.m_axis.y-y*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0;this.m_perp.SetV(d.MulMV(l.R,this.m_localYAxis1));this.m_s1=(h+n)*this.m_perp.y-(k+c)*this.m_perp.x;this.m_s2=m*this.m_perp.y-y*this.m_perp.x;l=this.m_invMassA;n=this.m_invMassB;c=this.m_invIA;m=this.m_invIB;this.m_K.col1.x=l+n+c*this.m_s1*
this.m_s1+m*this.m_s2*this.m_s2;this.m_K.col1.y=c*this.m_s1*this.m_a1+m*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=l+n+c*this.m_a1*this.m_a1+m*this.m_a2*this.m_a2;this.m_enableLimit?(h=this.m_axis.x*h+this.m_axis.y*k,d.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*a.b2_linearSlop?this.m_limitState=v.e_equalLimits:h<=this.m_lowerTranslation?this.m_limitState!=v.e_atLowerLimit&&(this.m_limitState=v.e_atLowerLimit,this.m_impulse.y=0):h>=this.m_upperTranslation?this.m_limitState!=
v.e_atUpperLimit&&(this.m_limitState=v.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=v.e_inactiveLimit,this.m_impulse.y=0)):this.m_limitState=v.e_inactiveLimit;0==this.m_enableMotor&&(this.m_motorImpulse=0);b.warmStarting?(this.m_impulse.x*=b.dtRatio,this.m_impulse.y*=b.dtRatio,this.m_motorImpulse*=b.dtRatio,b=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,h=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,k=this.m_impulse.x*
this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,l=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2,e.m_linearVelocity.x-=this.m_invMassA*b,e.m_linearVelocity.y-=this.m_invMassA*h,e.m_angularVelocity-=this.m_invIA*k,f.m_linearVelocity.x+=this.m_invMassB*b,f.m_linearVelocity.y+=this.m_invMassB*h,f.m_angularVelocity+=this.m_invIB*l):(this.m_impulse.SetZero(),this.m_motorImpulse=0)};h.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,f=this.m_bodyB,
h=b.m_linearVelocity,k=b.m_angularVelocity,l=f.m_linearVelocity,n=f.m_angularVelocity,c=0,m=0,y=0,q=0;this.m_enableMotor&&this.m_limitState!=v.e_equalLimits&&(q=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(l.x-h.x)+this.m_axis.y*(l.y-h.y)+this.m_a2*n-this.m_a1*k)),c=this.m_motorImpulse,m=a.dt*this.m_maxMotorForce,this.m_motorImpulse=d.Clamp(this.m_motorImpulse+q,-m,m),q=this.m_motorImpulse-c,c=q*this.m_axis.x,m=q*this.m_axis.y,y=q*this.m_a1,q*=this.m_a2,h.x-=this.m_invMassA*c,h.y-=this.m_invMassA*
m,k-=this.m_invIA*y,l.x+=this.m_invMassB*c,l.y+=this.m_invMassB*m,n+=this.m_invIB*q);m=this.m_perp.x*(l.x-h.x)+this.m_perp.y*(l.y-h.y)+this.m_s2*n-this.m_s1*k;this.m_enableLimit&&this.m_limitState!=v.e_inactiveLimit?(y=this.m_axis.x*(l.x-h.x)+this.m_axis.y*(l.y-h.y)+this.m_a2*n-this.m_a1*k,c=this.m_impulse.Copy(),a=this.m_K.Solve(new e,-m,-y),this.m_impulse.Add(a),this.m_limitState==v.e_atLowerLimit?this.m_impulse.y=d.Max(this.m_impulse.y,0):this.m_limitState==v.e_atUpperLimit&&(this.m_impulse.y=
d.Min(this.m_impulse.y,0)),m=-m-(this.m_impulse.y-c.y)*this.m_K.col2.x,y=0,y=0!=this.m_K.col1.x?m/this.m_K.col1.x+c.x:c.x,this.m_impulse.x=y,a.x=this.m_impulse.x-c.x,a.y=this.m_impulse.y-c.y,c=a.x*this.m_perp.x+a.y*this.m_axis.x,m=a.x*this.m_perp.y+a.y*this.m_axis.y,y=a.x*this.m_s1+a.y*this.m_a1,q=a.x*this.m_s2+a.y*this.m_a2):(a=0,a=0!=this.m_K.col1.x?-m/this.m_K.col1.x:0,this.m_impulse.x+=a,c=a*this.m_perp.x,m=a*this.m_perp.y,y=a*this.m_s1,q=a*this.m_s2);h.x-=this.m_invMassA*c;h.y-=this.m_invMassA*
m;k-=this.m_invIA*y;l.x+=this.m_invMassB*c;l.y+=this.m_invMassB*m;n+=this.m_invIB*q;b.m_linearVelocity.SetV(h);b.m_angularVelocity=k;f.m_linearVelocity.SetV(l);f.m_angularVelocity=n};h.prototype.SolvePositionConstraints=function(b){b=this.m_bodyA;var f=this.m_bodyB,h=b.m_sweep.c,k=b.m_sweep.a,n=f.m_sweep.c,q=f.m_sweep.a,p,c=0,m=0,y=0,v=0,u=p=0,z=0,m=!1,x=0,A=l.FromAngle(k),y=l.FromAngle(q);p=A;var z=this.m_localAnchor1.x-this.m_localCenterA.x,B=this.m_localAnchor1.y-this.m_localCenterA.y,c=p.col1.x*
z+p.col2.x*B,B=p.col1.y*z+p.col2.y*B,z=c;p=y;y=this.m_localAnchor2.x-this.m_localCenterB.x;v=this.m_localAnchor2.y-this.m_localCenterB.y;c=p.col1.x*y+p.col2.x*v;v=p.col1.y*y+p.col2.y*v;y=c;p=n.x+y-h.x-z;c=n.y+v-h.y-B;if(this.m_enableLimit){this.m_axis=d.MulMV(A,this.m_localXAxis1);this.m_a1=(p+z)*this.m_axis.y-(c+B)*this.m_axis.x;this.m_a2=y*this.m_axis.y-v*this.m_axis.x;var E=this.m_axis.x*p+this.m_axis.y*c;d.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*a.b2_linearSlop?(x=d.Clamp(E,-a.b2_maxLinearCorrection,
a.b2_maxLinearCorrection),u=d.Abs(E),m=!0):E<=this.m_lowerTranslation?(x=d.Clamp(E-this.m_lowerTranslation+a.b2_linearSlop,-a.b2_maxLinearCorrection,0),u=this.m_lowerTranslation-E,m=!0):E>=this.m_upperTranslation&&(x=d.Clamp(E-this.m_upperTranslation+a.b2_linearSlop,0,a.b2_maxLinearCorrection),u=E-this.m_upperTranslation,m=!0)}this.m_perp=d.MulMV(A,this.m_localYAxis1);this.m_s1=(p+z)*this.m_perp.y-(c+B)*this.m_perp.x;this.m_s2=y*this.m_perp.y-v*this.m_perp.x;A=new e;B=this.m_perp.x*p+this.m_perp.y*
c;u=d.Max(u,d.Abs(B));z=0;m?(m=this.m_invMassA,y=this.m_invMassB,v=this.m_invIA,p=this.m_invIB,this.m_K.col1.x=m+y+v*this.m_s1*this.m_s1+p*this.m_s2*this.m_s2,this.m_K.col1.y=v*this.m_s1*this.m_a1+p*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=m+y+v*this.m_a1*this.m_a1+p*this.m_a2*this.m_a2,this.m_K.Solve(A,-B,-x)):(m=this.m_invMassA,y=this.m_invMassB,v=this.m_invIA,p=this.m_invIB,x=m+y+v*this.m_s1*this.m_s1+p*this.m_s2*this.m_s2,A.x=0!=x?-B/x:0,A.y=0);x=A.x*this.m_perp.x+A.y*
this.m_axis.x;m=A.x*this.m_perp.y+A.y*this.m_axis.y;B=A.x*this.m_s1+A.y*this.m_a1;A=A.x*this.m_s2+A.y*this.m_a2;h.x-=this.m_invMassA*x;h.y-=this.m_invMassA*m;k-=this.m_invIA*B;n.x+=this.m_invMassB*x;n.y+=this.m_invMassB*m;q+=this.m_invIB*A;b.m_sweep.a=k;f.m_sweep.a=q;b.SynchronizeTransform();f.SynchronizeTransform();return u<=a.b2_linearSlop&&z<=a.b2_angularSlop};Box2D.inherit(E,Box2D.Dynamics.Joints.b2JointDef);E.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;E.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,
arguments);this.localAnchorA=new e;this.localAnchorB=new e;this.localAxisA=new e};E.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_lineJoint;this.localAxisA.Set(1,0);this.enableLimit=!1;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=!1;this.motorSpeed=this.maxMotorForce=0};E.prototype.Initialize=function(a,b,d,e){this.bodyA=a;this.bodyB=b;this.localAnchorA=this.bodyA.GetLocalPoint(d);this.localAnchorB=this.bodyB.GetLocalPoint(d);this.localAxisA=
this.bodyA.GetLocalVector(e)};Box2D.inherit(I,Box2D.Dynamics.Joints.b2Joint);I.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;I.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new l;this.K1=new l;this.K2=new l;this.m_localAnchor=new e;this.m_target=new e;this.m_impulse=new e;this.m_mass=new l;this.m_C=new e};I.prototype.GetAnchorA=function(){return this.m_target};I.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)};
I.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new e(a*this.m_impulse.x,a*this.m_impulse.y)};I.prototype.GetReactionTorque=function(a){return 0};I.prototype.GetTarget=function(){return this.m_target};I.prototype.SetTarget=function(a){0==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0);this.m_target=a};I.prototype.GetMaxForce=function(){return this.m_maxForce};I.prototype.SetMaxForce=function(a){void 0===a&&(a=0);this.m_maxForce=a};I.prototype.GetFrequency=function(){return this.m_frequencyHz};
I.prototype.SetFrequency=function(a){void 0===a&&(a=0);this.m_frequencyHz=a};I.prototype.GetDampingRatio=function(){return this.m_dampingRatio};I.prototype.SetDampingRatio=function(a){void 0===a&&(a=0);this.m_dampingRatio=a};I.prototype.b2MouseJoint=function(a){this.__super.b2Joint.call(this,a);this.m_target.SetV(a.target);var b=this.m_target.x-this.m_bodyB.m_xf.position.x,d=this.m_target.y-this.m_bodyB.m_xf.position.y,e=this.m_bodyB.m_xf.R;this.m_localAnchor.x=b*e.col1.x+d*e.col1.y;this.m_localAnchor.y=
b*e.col2.x+d*e.col2.y;this.m_maxForce=a.maxForce;this.m_impulse.SetZero();this.m_frequencyHz=a.frequencyHz;this.m_dampingRatio=a.dampingRatio;this.m_gamma=this.m_beta=0};I.prototype.InitVelocityConstraints=function(a){var b=this.m_bodyB,d=b.GetMass(),e=2*Math.PI*this.m_frequencyHz,f=d*e*e;this.m_gamma=a.dt*(2*d*this.m_dampingRatio*e+a.dt*f);this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0;this.m_beta=a.dt*f*this.m_gamma;var f=b.m_xf.R,d=this.m_localAnchor.x-b.m_sweep.localCenter.x,e=this.m_localAnchor.y-
b.m_sweep.localCenter.y,h=f.col1.x*d+f.col2.x*e,e=f.col1.y*d+f.col2.y*e,d=h,f=b.m_invMass,h=b.m_invI;this.K1.col1.x=f;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=f;this.K2.col1.x=h*e*e;this.K2.col2.x=-h*d*e;this.K2.col1.y=-h*d*e;this.K2.col2.y=h*d*d;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;this.K.GetInverse(this.m_mass);this.m_C.x=b.m_sweep.c.x+d-this.m_target.x;this.m_C.y=b.m_sweep.c.y+e-this.m_target.y;b.m_angularVelocity*=.98;this.m_impulse.x*=
a.dtRatio;this.m_impulse.y*=a.dtRatio;b.m_linearVelocity.x+=f*this.m_impulse.x;b.m_linearVelocity.y+=f*this.m_impulse.y;b.m_angularVelocity+=h*(d*this.m_impulse.y-e*this.m_impulse.x)};I.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyB,d,e=0,f=0;d=b.m_xf.R;var h=this.m_localAnchor.x-b.m_sweep.localCenter.x,k=this.m_localAnchor.y-b.m_sweep.localCenter.y,e=d.col1.x*h+d.col2.x*k,k=d.col1.y*h+d.col2.y*k,h=e,e=b.m_linearVelocity.x+-b.m_angularVelocity*k,c=b.m_linearVelocity.y+b.m_angularVelocity*
h;d=this.m_mass;e=e+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x;f=c+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;c=-(d.col1.x*e+d.col2.x*f);f=-(d.col1.y*e+d.col2.y*f);d=this.m_impulse.x;e=this.m_impulse.y;this.m_impulse.x+=c;this.m_impulse.y+=f;a=a.dt*this.m_maxForce;this.m_impulse.LengthSquared()>a*a&&this.m_impulse.Multiply(a/this.m_impulse.Length());c=this.m_impulse.x-d;f=this.m_impulse.y-e;b.m_linearVelocity.x+=b.m_invMass*c;b.m_linearVelocity.y+=b.m_invMass*f;b.m_angularVelocity+=
b.m_invI*(h*f-k*c)};I.prototype.SolvePositionConstraints=function(a){return!0};Box2D.inherit(N,Box2D.Dynamics.Joints.b2JointDef);N.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;N.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.target=new e};N.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=.7};Box2D.inherit(H,Box2D.Dynamics.Joints.b2Joint);
H.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;H.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new e;this.m_localAnchor2=new e;this.m_localXAxis1=new e;this.m_localYAxis1=new e;this.m_axis=new e;this.m_perp=new e;this.m_K=new f;this.m_impulse=new k};H.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};H.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};
H.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new e(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))};H.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);return a*this.m_impulse.y};H.prototype.GetJointTranslation=function(){var a=this.m_bodyA,b=this.m_bodyB,d=a.GetWorldPoint(this.m_localAnchor1),e=b.GetWorldPoint(this.m_localAnchor2),b=e.x-d.x,
d=e.y-d.y,a=a.GetWorldVector(this.m_localXAxis1);return a.x*b+a.y*d};H.prototype.GetJointSpeed=function(){var a=this.m_bodyA,b=this.m_bodyB,d;d=a.m_xf.R;var e=this.m_localAnchor1.x-a.m_sweep.localCenter.x,f=this.m_localAnchor1.y-a.m_sweep.localCenter.y,h=d.col1.x*e+d.col2.x*f,f=d.col1.y*e+d.col2.y*f,e=h;d=b.m_xf.R;var k=this.m_localAnchor2.x-b.m_sweep.localCenter.x,c=this.m_localAnchor2.y-b.m_sweep.localCenter.y,h=d.col1.x*k+d.col2.x*c,c=d.col1.y*k+d.col2.y*c,k=h;d=b.m_sweep.c.x+k-(a.m_sweep.c.x+
e);var h=b.m_sweep.c.y+c-(a.m_sweep.c.y+f),m=a.GetWorldVector(this.m_localXAxis1),l=a.m_linearVelocity,n=b.m_linearVelocity,a=a.m_angularVelocity,b=b.m_angularVelocity;return d*-a*m.y+h*a*m.x+(m.x*(n.x+-b*c-l.x- -a*f)+m.y*(n.y+b*k-l.y-a*e))};H.prototype.IsLimitEnabled=function(){return this.m_enableLimit};H.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableLimit=a};H.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};H.prototype.GetUpperLimit=
function(){return this.m_upperTranslation};H.prototype.SetLimits=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_lowerTranslation=a;this.m_upperTranslation=b};H.prototype.IsMotorEnabled=function(){return this.m_enableMotor};H.prototype.EnableMotor=function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=a};H.prototype.SetMotorSpeed=function(a){void 0===a&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);
this.m_motorSpeed=a};H.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};H.prototype.SetMaxMotorForce=function(a){void 0===a&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorForce=a};H.prototype.GetMotorForce=function(){return this.m_motorImpulse};H.prototype.b2PrismaticJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);this.m_localXAxis1.SetV(a.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;
this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_refAngle=a.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=a.lowerTranslation;this.m_upperTranslation=a.upperTranslation;this.m_maxMotorForce=a.maxMotorForce;this.m_motorSpeed=a.motorSpeed;this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor;this.m_limitState=v.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};H.prototype.InitVelocityConstraints=function(b){var e=this.m_bodyA,
f=this.m_bodyB,h,k=0;this.m_localCenterA.SetV(e.GetLocalCenter());this.m_localCenterB.SetV(f.GetLocalCenter());var l=e.GetTransform();f.GetTransform();h=e.m_xf.R;var n=this.m_localAnchor1.x-this.m_localCenterA.x,c=this.m_localAnchor1.y-this.m_localCenterA.y,k=h.col1.x*n+h.col2.x*c,c=h.col1.y*n+h.col2.y*c,n=k;h=f.m_xf.R;var m=this.m_localAnchor2.x-this.m_localCenterB.x,q=this.m_localAnchor2.y-this.m_localCenterB.y,k=h.col1.x*m+h.col2.x*q,q=h.col1.y*m+h.col2.y*q,m=k;h=f.m_sweep.c.x+m-e.m_sweep.c.x-
n;k=f.m_sweep.c.y+q-e.m_sweep.c.y-c;this.m_invMassA=e.m_invMass;this.m_invMassB=f.m_invMass;this.m_invIA=e.m_invI;this.m_invIB=f.m_invI;this.m_axis.SetV(d.MulMV(l.R,this.m_localXAxis1));this.m_a1=(h+n)*this.m_axis.y-(k+c)*this.m_axis.x;this.m_a2=m*this.m_axis.y-q*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass);this.m_perp.SetV(d.MulMV(l.R,this.m_localYAxis1));
this.m_s1=(h+n)*this.m_perp.y-(k+c)*this.m_perp.x;this.m_s2=m*this.m_perp.y-q*this.m_perp.x;l=this.m_invMassA;n=this.m_invMassB;c=this.m_invIA;m=this.m_invIB;this.m_K.col1.x=l+n+c*this.m_s1*this.m_s1+m*this.m_s2*this.m_s2;this.m_K.col1.y=c*this.m_s1+m*this.m_s2;this.m_K.col1.z=c*this.m_s1*this.m_a1+m*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=c+m;this.m_K.col2.z=c*this.m_a1+m*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=l+n+c*this.m_a1*
this.m_a1+m*this.m_a2*this.m_a2;this.m_enableLimit?(h=this.m_axis.x*h+this.m_axis.y*k,d.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*a.b2_linearSlop?this.m_limitState=v.e_equalLimits:h<=this.m_lowerTranslation?this.m_limitState!=v.e_atLowerLimit&&(this.m_limitState=v.e_atLowerLimit,this.m_impulse.z=0):h>=this.m_upperTranslation?this.m_limitState!=v.e_atUpperLimit&&(this.m_limitState=v.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=v.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=
v.e_inactiveLimit;0==this.m_enableMotor&&(this.m_motorImpulse=0);b.warmStarting?(this.m_impulse.x*=b.dtRatio,this.m_impulse.y*=b.dtRatio,this.m_motorImpulse*=b.dtRatio,b=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,h=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,k=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,l=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+
this.m_impulse.z)*this.m_a2,e.m_linearVelocity.x-=this.m_invMassA*b,e.m_linearVelocity.y-=this.m_invMassA*h,e.m_angularVelocity-=this.m_invIA*k,f.m_linearVelocity.x+=this.m_invMassB*b,f.m_linearVelocity.y+=this.m_invMassB*h,f.m_angularVelocity+=this.m_invIB*l):(this.m_impulse.SetZero(),this.m_motorImpulse=0)};H.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,f=this.m_bodyB,h=b.m_linearVelocity,l=b.m_angularVelocity,n=f.m_linearVelocity,q=f.m_angularVelocity,c=0,m=0,p=0,u=0;this.m_enableMotor&&
this.m_limitState!=v.e_equalLimits&&(u=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(n.x-h.x)+this.m_axis.y*(n.y-h.y)+this.m_a2*q-this.m_a1*l)),c=this.m_motorImpulse,a=a.dt*this.m_maxMotorForce,this.m_motorImpulse=d.Clamp(this.m_motorImpulse+u,-a,a),u=this.m_motorImpulse-c,c=u*this.m_axis.x,m=u*this.m_axis.y,p=u*this.m_a1,u*=this.m_a2,h.x-=this.m_invMassA*c,h.y-=this.m_invMassA*m,l-=this.m_invIA*p,n.x+=this.m_invMassB*c,n.y+=this.m_invMassB*m,q+=this.m_invIB*u);p=this.m_perp.x*(n.x-h.x)+this.m_perp.y*
(n.y-h.y)+this.m_s2*q-this.m_s1*l;m=q-l;this.m_enableLimit&&this.m_limitState!=v.e_inactiveLimit?(a=this.m_axis.x*(n.x-h.x)+this.m_axis.y*(n.y-h.y)+this.m_a2*q-this.m_a1*l,c=this.m_impulse.Copy(),a=this.m_K.Solve33(new k,-p,-m,-a),this.m_impulse.Add(a),this.m_limitState==v.e_atLowerLimit?this.m_impulse.z=d.Max(this.m_impulse.z,0):this.m_limitState==v.e_atUpperLimit&&(this.m_impulse.z=d.Min(this.m_impulse.z,0)),p=-p-(this.m_impulse.z-c.z)*this.m_K.col3.x,m=-m-(this.m_impulse.z-c.z)*this.m_K.col3.y,
m=this.m_K.Solve22(new e,p,m),m.x+=c.x,m.y+=c.y,this.m_impulse.x=m.x,this.m_impulse.y=m.y,a.x=this.m_impulse.x-c.x,a.y=this.m_impulse.y-c.y,a.z=this.m_impulse.z-c.z,c=a.x*this.m_perp.x+a.z*this.m_axis.x,m=a.x*this.m_perp.y+a.z*this.m_axis.y,p=a.x*this.m_s1+a.y+a.z*this.m_a1,u=a.x*this.m_s2+a.y+a.z*this.m_a2):(a=this.m_K.Solve22(new e,-p,-m),this.m_impulse.x+=a.x,this.m_impulse.y+=a.y,c=a.x*this.m_perp.x,m=a.x*this.m_perp.y,p=a.x*this.m_s1+a.y,u=a.x*this.m_s2+a.y);h.x-=this.m_invMassA*c;h.y-=this.m_invMassA*
m;l-=this.m_invIA*p;n.x+=this.m_invMassB*c;n.y+=this.m_invMassB*m;q+=this.m_invIB*u;b.m_linearVelocity.SetV(h);b.m_angularVelocity=l;f.m_linearVelocity.SetV(n);f.m_angularVelocity=q};H.prototype.SolvePositionConstraints=function(b){b=this.m_bodyA;var f=this.m_bodyB,h=b.m_sweep.c,t=b.m_sweep.a,n=f.m_sweep.c,q=f.m_sweep.a,p,c=0,m=0,y=0,v=c=p=0,u=0,m=!1,z=0,x=l.FromAngle(t),A=l.FromAngle(q);p=x;var u=this.m_localAnchor1.x-this.m_localCenterA.x,B=this.m_localAnchor1.y-this.m_localCenterA.y,c=p.col1.x*
u+p.col2.x*B,B=p.col1.y*u+p.col2.y*B,u=c;p=A;A=this.m_localAnchor2.x-this.m_localCenterB.x;y=this.m_localAnchor2.y-this.m_localCenterB.y;c=p.col1.x*A+p.col2.x*y;y=p.col1.y*A+p.col2.y*y;A=c;p=n.x+A-h.x-u;c=n.y+y-h.y-B;if(this.m_enableLimit){this.m_axis=d.MulMV(x,this.m_localXAxis1);this.m_a1=(p+u)*this.m_axis.y-(c+B)*this.m_axis.x;this.m_a2=A*this.m_axis.y-y*this.m_axis.x;var E=this.m_axis.x*p+this.m_axis.y*c;d.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*a.b2_linearSlop?(z=d.Clamp(E,-a.b2_maxLinearCorrection,
a.b2_maxLinearCorrection),v=d.Abs(E),m=!0):E<=this.m_lowerTranslation?(z=d.Clamp(E-this.m_lowerTranslation+a.b2_linearSlop,-a.b2_maxLinearCorrection,0),v=this.m_lowerTranslation-E,m=!0):E>=this.m_upperTranslation&&(z=d.Clamp(E-this.m_upperTranslation+a.b2_linearSlop,0,a.b2_maxLinearCorrection),v=E-this.m_upperTranslation,m=!0)}this.m_perp=d.MulMV(x,this.m_localYAxis1);this.m_s1=(p+u)*this.m_perp.y-(c+B)*this.m_perp.x;this.m_s2=A*this.m_perp.y-y*this.m_perp.x;x=new k;B=this.m_perp.x*p+this.m_perp.y*
c;A=q-t-this.m_refAngle;v=d.Max(v,d.Abs(B));u=d.Abs(A);m?(m=this.m_invMassA,y=this.m_invMassB,p=this.m_invIA,c=this.m_invIB,this.m_K.col1.x=m+y+p*this.m_s1*this.m_s1+c*this.m_s2*this.m_s2,this.m_K.col1.y=p*this.m_s1+c*this.m_s2,this.m_K.col1.z=p*this.m_s1*this.m_a1+c*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=p+c,this.m_K.col2.z=p*this.m_a1+c*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=m+y+p*this.m_a1*this.m_a1+c*this.m_a2*this.m_a2,
this.m_K.Solve33(x,-B,-A,-z)):(m=this.m_invMassA,y=this.m_invMassB,p=this.m_invIA,c=this.m_invIB,z=p*this.m_s1+c*this.m_s2,E=p+c,this.m_K.col1.Set(m+y+p*this.m_s1*this.m_s1+c*this.m_s2*this.m_s2,z,0),this.m_K.col2.Set(z,E,0),z=this.m_K.Solve22(new e,-B,-A),x.x=z.x,x.y=z.y,x.z=0);z=x.x*this.m_perp.x+x.z*this.m_axis.x;m=x.x*this.m_perp.y+x.z*this.m_axis.y;B=x.x*this.m_s1+x.y+x.z*this.m_a1;x=x.x*this.m_s2+x.y+x.z*this.m_a2;h.x-=this.m_invMassA*z;h.y-=this.m_invMassA*m;t-=this.m_invIA*B;n.x+=this.m_invMassB*
z;n.y+=this.m_invMassB*m;q+=this.m_invIB*x;b.m_sweep.a=t;f.m_sweep.a=q;b.SynchronizeTransform();f.SynchronizeTransform();return v<=a.b2_linearSlop&&u<=a.b2_angularSlop};Box2D.inherit(M,Box2D.Dynamics.Joints.b2JointDef);M.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;M.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new e;this.localAnchorB=new e;this.localAxisA=new e};M.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this);
this.type=v.e_prismaticJoint;this.localAxisA.Set(1,0);this.referenceAngle=0;this.enableLimit=!1;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=!1;this.motorSpeed=this.maxMotorForce=0};M.prototype.Initialize=function(a,b,d,e){this.bodyA=a;this.bodyB=b;this.localAnchorA=this.bodyA.GetLocalPoint(d);this.localAnchorB=this.bodyB.GetLocalPoint(d);this.localAxisA=this.bodyA.GetLocalVector(e);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(G,Box2D.Dynamics.Joints.b2Joint);
G.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;G.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new e;this.m_groundAnchor2=new e;this.m_localAnchor1=new e;this.m_localAnchor2=new e;this.m_u1=new e;this.m_u2=new e};G.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};G.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};G.prototype.GetReactionForce=function(a){void 0===
a&&(a=0);return new e(a*this.m_impulse*this.m_u2.x,a*this.m_impulse*this.m_u2.y)};G.prototype.GetReactionTorque=function(a){return 0};G.prototype.GetGroundAnchorA=function(){var a=this.m_ground.m_xf.position.Copy();a.Add(this.m_groundAnchor1);return a};G.prototype.GetGroundAnchorB=function(){var a=this.m_ground.m_xf.position.Copy();a.Add(this.m_groundAnchor2);return a};G.prototype.GetLength1=function(){var a=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),b=a.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),
a=a.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y);return Math.sqrt(b*b+a*a)};G.prototype.GetLength2=function(){var a=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),b=a.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x),a=a.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y);return Math.sqrt(b*b+a*a)};G.prototype.GetRatio=function(){return this.m_ratio};G.prototype.b2PulleyJoint=function(a){this.__super.b2Joint.call(this,a);this.m_ground=this.m_bodyA.m_world.m_groundBody;this.m_groundAnchor1.x=
a.groundAnchorA.x-this.m_ground.m_xf.position.x;this.m_groundAnchor1.y=a.groundAnchorA.y-this.m_ground.m_xf.position.y;this.m_groundAnchor2.x=a.groundAnchorB.x-this.m_ground.m_xf.position.x;this.m_groundAnchor2.y=a.groundAnchorB.y-this.m_ground.m_xf.position.y;this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);this.m_ratio=a.ratio;this.m_constant=a.lengthA+this.m_ratio*a.lengthB;this.m_maxLength1=d.Min(a.maxLengthA,this.m_constant-this.m_ratio*G.b2_minPulleyLength);
this.m_maxLength2=d.Min(a.maxLengthB,(this.m_constant-G.b2_minPulleyLength)/this.m_ratio);this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0};G.prototype.InitVelocityConstraints=function(b){var d=this.m_bodyA,e=this.m_bodyB,f;f=d.m_xf.R;var h=this.m_localAnchor1.x-d.m_sweep.localCenter.x,k=this.m_localAnchor1.y-d.m_sweep.localCenter.y,l=f.col1.x*h+f.col2.x*k,k=f.col1.y*h+f.col2.y*k,h=l;f=e.m_xf.R;var c=this.m_localAnchor2.x-e.m_sweep.localCenter.x,m=this.m_localAnchor2.y-e.m_sweep.localCenter.y,
l=f.col1.x*c+f.col2.x*m,m=f.col1.y*c+f.col2.y*m,c=l;f=e.m_sweep.c.x+c;var l=e.m_sweep.c.y+m,n=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,p=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(d.m_sweep.c.x+h-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),d.m_sweep.c.y+k-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y));this.m_u2.Set(f-n,l-p);f=this.m_u1.Length();l=this.m_u2.Length();f>a.b2_linearSlop?this.m_u1.Multiply(1/f):this.m_u1.SetZero();l>a.b2_linearSlop?
this.m_u2.Multiply(1/l):this.m_u2.SetZero();0<this.m_constant-f-this.m_ratio*l?(this.m_state=v.e_inactiveLimit,this.m_impulse=0):this.m_state=v.e_atUpperLimit;f<this.m_maxLength1?(this.m_limitState1=v.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=v.e_atUpperLimit;l<this.m_maxLength2?(this.m_limitState2=v.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=v.e_atUpperLimit;f=h*this.m_u1.y-k*this.m_u1.x;l=c*this.m_u2.y-m*this.m_u2.x;this.m_limitMass1=d.m_invMass+d.m_invI*f*f;this.m_limitMass2=
e.m_invMass+e.m_invI*l*l;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1/this.m_limitMass1;this.m_limitMass2=1/this.m_limitMass2;this.m_pulleyMass=1/this.m_pulleyMass;b.warmStarting?(this.m_impulse*=b.dtRatio,this.m_limitImpulse1*=b.dtRatio,this.m_limitImpulse2*=b.dtRatio,b=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,f=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,l=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,n=(-this.m_ratio*
this.m_impulse-this.m_limitImpulse2)*this.m_u2.y,d.m_linearVelocity.x+=d.m_invMass*b,d.m_linearVelocity.y+=d.m_invMass*f,d.m_angularVelocity+=d.m_invI*(h*f-k*b),e.m_linearVelocity.x+=e.m_invMass*l,e.m_linearVelocity.y+=e.m_invMass*n,e.m_angularVelocity+=e.m_invI*(c*n-m*l)):this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0};G.prototype.SolveVelocityConstraints=function(a){a=this.m_bodyA;var b=this.m_bodyB,e;e=a.m_xf.R;var f=this.m_localAnchor1.x-a.m_sweep.localCenter.x,h=this.m_localAnchor1.y-
a.m_sweep.localCenter.y,k=e.col1.x*f+e.col2.x*h,h=e.col1.y*f+e.col2.y*h,f=k;e=b.m_xf.R;var l=this.m_localAnchor2.x-b.m_sweep.localCenter.x,c=this.m_localAnchor2.y-b.m_sweep.localCenter.y,k=e.col1.x*l+e.col2.x*c,c=e.col1.y*l+e.col2.y*c,l=k,m=k=e=0,n=0;e=n=e=n=m=k=e=0;this.m_state==v.e_atUpperLimit&&(e=a.m_linearVelocity.x+-a.m_angularVelocity*h,k=a.m_linearVelocity.y+a.m_angularVelocity*f,m=b.m_linearVelocity.x+-b.m_angularVelocity*c,n=b.m_linearVelocity.y+b.m_angularVelocity*l,e=-(this.m_u1.x*e+this.m_u1.y*
k)-this.m_ratio*(this.m_u2.x*m+this.m_u2.y*n),n=this.m_pulleyMass*-e,e=this.m_impulse,this.m_impulse=d.Max(0,this.m_impulse+n),n=this.m_impulse-e,e=-n*this.m_u1.x,k=-n*this.m_u1.y,m=-this.m_ratio*n*this.m_u2.x,n=-this.m_ratio*n*this.m_u2.y,a.m_linearVelocity.x+=a.m_invMass*e,a.m_linearVelocity.y+=a.m_invMass*k,a.m_angularVelocity+=a.m_invI*(f*k-h*e),b.m_linearVelocity.x+=b.m_invMass*m,b.m_linearVelocity.y+=b.m_invMass*n,b.m_angularVelocity+=b.m_invI*(l*n-c*m));this.m_limitState1==v.e_atUpperLimit&&
(e=a.m_linearVelocity.x+-a.m_angularVelocity*h,k=a.m_linearVelocity.y+a.m_angularVelocity*f,e=-(this.m_u1.x*e+this.m_u1.y*k),n=-this.m_limitMass1*e,e=this.m_limitImpulse1,this.m_limitImpulse1=d.Max(0,this.m_limitImpulse1+n),n=this.m_limitImpulse1-e,e=-n*this.m_u1.x,k=-n*this.m_u1.y,a.m_linearVelocity.x+=a.m_invMass*e,a.m_linearVelocity.y+=a.m_invMass*k,a.m_angularVelocity+=a.m_invI*(f*k-h*e));this.m_limitState2==v.e_atUpperLimit&&(m=b.m_linearVelocity.x+-b.m_angularVelocity*c,n=b.m_linearVelocity.y+
b.m_angularVelocity*l,e=-(this.m_u2.x*m+this.m_u2.y*n),n=-this.m_limitMass2*e,e=this.m_limitImpulse2,this.m_limitImpulse2=d.Max(0,this.m_limitImpulse2+n),n=this.m_limitImpulse2-e,m=-n*this.m_u2.x,n=-n*this.m_u2.y,b.m_linearVelocity.x+=b.m_invMass*m,b.m_linearVelocity.y+=b.m_invMass*n,b.m_angularVelocity+=b.m_invI*(l*n-c*m))};G.prototype.SolvePositionConstraints=function(b){b=this.m_bodyA;var e=this.m_bodyB,f,h=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,k=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,
l=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,n=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,c=0,m=0,p=0,q=0,u=f=0,z=0,x=0,A=u=x=f=u=f=0;this.m_state==v.e_atUpperLimit&&(f=b.m_xf.R,c=this.m_localAnchor1.x-b.m_sweep.localCenter.x,m=this.m_localAnchor1.y-b.m_sweep.localCenter.y,u=f.col1.x*c+f.col2.x*m,m=f.col1.y*c+f.col2.y*m,c=u,f=e.m_xf.R,p=this.m_localAnchor2.x-e.m_sweep.localCenter.x,q=this.m_localAnchor2.y-e.m_sweep.localCenter.y,u=f.col1.x*p+f.col2.x*q,q=f.col1.y*p+f.col2.y*q,
p=u,f=b.m_sweep.c.x+c,u=b.m_sweep.c.y+m,z=e.m_sweep.c.x+p,x=e.m_sweep.c.y+q,this.m_u1.Set(f-h,u-k),this.m_u2.Set(z-l,x-n),f=this.m_u1.Length(),u=this.m_u2.Length(),f>a.b2_linearSlop?this.m_u1.Multiply(1/f):this.m_u1.SetZero(),u>a.b2_linearSlop?this.m_u2.Multiply(1/u):this.m_u2.SetZero(),f=this.m_constant-f-this.m_ratio*u,A=d.Max(A,-f),f=d.Clamp(f+a.b2_linearSlop,-a.b2_maxLinearCorrection,0),x=-this.m_pulleyMass*f,f=-x*this.m_u1.x,u=-x*this.m_u1.y,z=-this.m_ratio*x*this.m_u2.x,x=-this.m_ratio*x*this.m_u2.y,
b.m_sweep.c.x+=b.m_invMass*f,b.m_sweep.c.y+=b.m_invMass*u,b.m_sweep.a+=b.m_invI*(c*u-m*f),e.m_sweep.c.x+=e.m_invMass*z,e.m_sweep.c.y+=e.m_invMass*x,e.m_sweep.a+=e.m_invI*(p*x-q*z),b.SynchronizeTransform(),e.SynchronizeTransform());this.m_limitState1==v.e_atUpperLimit&&(f=b.m_xf.R,c=this.m_localAnchor1.x-b.m_sweep.localCenter.x,m=this.m_localAnchor1.y-b.m_sweep.localCenter.y,u=f.col1.x*c+f.col2.x*m,m=f.col1.y*c+f.col2.y*m,c=u,f=b.m_sweep.c.x+c,u=b.m_sweep.c.y+m,this.m_u1.Set(f-h,u-k),f=this.m_u1.Length(),
f>a.b2_linearSlop?(this.m_u1.x*=1/f,this.m_u1.y*=1/f):this.m_u1.SetZero(),f=this.m_maxLength1-f,A=d.Max(A,-f),f=d.Clamp(f+a.b2_linearSlop,-a.b2_maxLinearCorrection,0),x=-this.m_limitMass1*f,f=-x*this.m_u1.x,u=-x*this.m_u1.y,b.m_sweep.c.x+=b.m_invMass*f,b.m_sweep.c.y+=b.m_invMass*u,b.m_sweep.a+=b.m_invI*(c*u-m*f),b.SynchronizeTransform());this.m_limitState2==v.e_atUpperLimit&&(f=e.m_xf.R,p=this.m_localAnchor2.x-e.m_sweep.localCenter.x,q=this.m_localAnchor2.y-e.m_sweep.localCenter.y,u=f.col1.x*p+f.col2.x*
q,q=f.col1.y*p+f.col2.y*q,p=u,z=e.m_sweep.c.x+p,x=e.m_sweep.c.y+q,this.m_u2.Set(z-l,x-n),u=this.m_u2.Length(),u>a.b2_linearSlop?(this.m_u2.x*=1/u,this.m_u2.y*=1/u):this.m_u2.SetZero(),f=this.m_maxLength2-u,A=d.Max(A,-f),f=d.Clamp(f+a.b2_linearSlop,-a.b2_maxLinearCorrection,0),x=-this.m_limitMass2*f,z=-x*this.m_u2.x,x=-x*this.m_u2.y,e.m_sweep.c.x+=e.m_invMass*z,e.m_sweep.c.y+=e.m_invMass*x,e.m_sweep.a+=e.m_invI*(p*x-q*z),e.SynchronizeTransform());return A<a.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=
2});Box2D.inherit(Q,Box2D.Dynamics.Joints.b2JointDef);Q.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;Q.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.groundAnchorA=new e;this.groundAnchorB=new e;this.localAnchorA=new e;this.localAnchorB=new e};Q.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_pulleyJoint;this.groundAnchorA.Set(-1,1);this.groundAnchorB.Set(1,1);this.localAnchorA.Set(-1,0);this.localAnchorB.Set(1,
0);this.maxLengthB=this.lengthB=this.maxLengthA=this.lengthA=0;this.ratio=1;this.collideConnected=!0};Q.prototype.Initialize=function(a,b,d,e,f,h,k){void 0===k&&(k=0);this.bodyA=a;this.bodyB=b;this.groundAnchorA.SetV(d);this.groundAnchorB.SetV(e);this.localAnchorA=this.bodyA.GetLocalPoint(f);this.localAnchorB=this.bodyB.GetLocalPoint(h);a=f.x-d.x;d=f.y-d.y;this.lengthA=Math.sqrt(a*a+d*d);d=h.x-e.x;e=h.y-e.y;this.lengthB=Math.sqrt(d*d+e*e);this.ratio=k;k=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=
k-this.ratio*G.b2_minPulleyLength;this.maxLengthB=(k-G.b2_minPulleyLength)/this.ratio};Box2D.inherit(J,Box2D.Dynamics.Joints.b2Joint);J.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;J.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new l;this.K1=new l;this.K2=new l;this.K3=new l;this.impulse3=new k;this.impulse2=new e;this.reduced=new e;this.m_localAnchor1=new e;this.m_localAnchor2=new e;this.m_impulse=new k;this.m_mass=new f};J.prototype.GetAnchorA=
function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};J.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};J.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new e(a*this.m_impulse.x,a*this.m_impulse.y)};J.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);return a*this.m_impulse.z};J.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle};J.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-
this.m_bodyA.m_angularVelocity};J.prototype.IsLimitEnabled=function(){return this.m_enableLimit};J.prototype.EnableLimit=function(a){this.m_enableLimit=a};J.prototype.GetLowerLimit=function(){return this.m_lowerAngle};J.prototype.GetUpperLimit=function(){return this.m_upperAngle};J.prototype.SetLimits=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);this.m_lowerAngle=a;this.m_upperAngle=b};J.prototype.IsMotorEnabled=function(){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);return this.m_enableMotor};
J.prototype.EnableMotor=function(a){this.m_enableMotor=a};J.prototype.SetMotorSpeed=function(a){void 0===a&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=a};J.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};J.prototype.SetMaxMotorTorque=function(a){void 0===a&&(a=0);this.m_maxMotorTorque=a};J.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque};J.prototype.b2RevoluteJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA);
this.m_localAnchor2.SetV(a.localAnchorB);this.m_referenceAngle=a.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=0;this.m_lowerAngle=a.lowerAngle;this.m_upperAngle=a.upperAngle;this.m_maxMotorTorque=a.maxMotorTorque;this.m_motorSpeed=a.motorSpeed;this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor;this.m_limitState=v.e_inactiveLimit};J.prototype.InitVelocityConstraints=function(b){var e=this.m_bodyA,f=this.m_bodyB,h,k=0;h=e.m_xf.R;var l=this.m_localAnchor1.x-e.m_sweep.localCenter.x,
n=this.m_localAnchor1.y-e.m_sweep.localCenter.y,k=h.col1.x*l+h.col2.x*n,n=h.col1.y*l+h.col2.y*n,l=k;h=f.m_xf.R;var c=this.m_localAnchor2.x-f.m_sweep.localCenter.x,m=this.m_localAnchor2.y-f.m_sweep.localCenter.y,k=h.col1.x*c+h.col2.x*m,m=h.col1.y*c+h.col2.y*m,c=k;h=e.m_invMass;var k=f.m_invMass,p=e.m_invI,q=f.m_invI;this.m_mass.col1.x=h+k+n*n*p+m*m*q;this.m_mass.col2.x=-n*l*p-m*c*q;this.m_mass.col3.x=-n*p-m*q;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=h+k+l*l*p+c*c*q;this.m_mass.col3.y=
l*p+c*q;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=p+q;this.m_motorMass=1/(p+q);0==this.m_enableMotor&&(this.m_motorImpulse=0);if(this.m_enableLimit){var u=f.m_sweep.a-e.m_sweep.a-this.m_referenceAngle;d.Abs(this.m_upperAngle-this.m_lowerAngle)<2*a.b2_angularSlop?this.m_limitState=v.e_equalLimits:u<=this.m_lowerAngle?(this.m_limitState!=v.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=v.e_atLowerLimit):u>=this.m_upperAngle?(this.m_limitState!=
v.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=v.e_atUpperLimit):(this.m_limitState=v.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=v.e_inactiveLimit;b.warmStarting?(this.m_impulse.x*=b.dtRatio,this.m_impulse.y*=b.dtRatio,this.m_motorImpulse*=b.dtRatio,b=this.m_impulse.x,u=this.m_impulse.y,e.m_linearVelocity.x-=h*b,e.m_linearVelocity.y-=h*u,e.m_angularVelocity-=p*(l*u-n*b+this.m_motorImpulse+this.m_impulse.z),f.m_linearVelocity.x+=k*b,f.m_linearVelocity.y+=k*u,f.m_angularVelocity+=
q*(c*u-m*b+this.m_motorImpulse+this.m_impulse.z)):(this.m_impulse.SetZero(),this.m_motorImpulse=0)};J.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,e=this.m_bodyB,f=0,h=f=0,k=0,l=0,c=0,m=b.m_linearVelocity,n=b.m_angularVelocity,p=e.m_linearVelocity,q=e.m_angularVelocity,u=b.m_invMass,z=e.m_invMass,x=b.m_invI,A=e.m_invI;this.m_enableMotor&&this.m_limitState!=v.e_equalLimits&&(h=this.m_motorMass*-(q-n-this.m_motorSpeed),k=this.m_motorImpulse,l=a.dt*this.m_maxMotorTorque,this.m_motorImpulse=
d.Clamp(this.m_motorImpulse+h,-l,l),h=this.m_motorImpulse-k,n-=x*h,q+=A*h);if(this.m_enableLimit&&this.m_limitState!=v.e_inactiveLimit){a=b.m_xf.R;h=this.m_localAnchor1.x-b.m_sweep.localCenter.x;k=this.m_localAnchor1.y-b.m_sweep.localCenter.y;f=a.col1.x*h+a.col2.x*k;k=a.col1.y*h+a.col2.y*k;h=f;a=e.m_xf.R;l=this.m_localAnchor2.x-e.m_sweep.localCenter.x;c=this.m_localAnchor2.y-e.m_sweep.localCenter.y;f=a.col1.x*l+a.col2.x*c;c=a.col1.y*l+a.col2.y*c;l=f;a=p.x+-q*c-m.x- -n*k;var B=p.y+q*l-m.y-n*h;this.m_mass.Solve33(this.impulse3,
-a,-B,-(q-n));this.m_limitState==v.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==v.e_atLowerLimit?(f=this.m_impulse.z+this.impulse3.z,0>f&&(this.m_mass.Solve22(this.reduced,-a,-B),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==v.e_atUpperLimit&&(f=this.m_impulse.z+this.impulse3.z,0<f&&(this.m_mass.Solve22(this.reduced,-a,-B),
this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0));m.x-=u*this.impulse3.x;m.y-=u*this.impulse3.y;n-=x*(h*this.impulse3.y-k*this.impulse3.x+this.impulse3.z);p.x+=z*this.impulse3.x;p.y+=z*this.impulse3.y;q+=A*(l*this.impulse3.y-c*this.impulse3.x+this.impulse3.z)}else a=b.m_xf.R,h=this.m_localAnchor1.x-b.m_sweep.localCenter.x,k=this.m_localAnchor1.y-b.m_sweep.localCenter.y,
f=a.col1.x*h+a.col2.x*k,k=a.col1.y*h+a.col2.y*k,h=f,a=e.m_xf.R,l=this.m_localAnchor2.x-e.m_sweep.localCenter.x,c=this.m_localAnchor2.y-e.m_sweep.localCenter.y,f=a.col1.x*l+a.col2.x*c,c=a.col1.y*l+a.col2.y*c,l=f,this.m_mass.Solve22(this.impulse2,-(p.x+-q*c-m.x- -n*k),-(p.y+q*l-m.y-n*h)),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,m.x-=u*this.impulse2.x,m.y-=u*this.impulse2.y,n-=x*(h*this.impulse2.y-k*this.impulse2.x),p.x+=z*this.impulse2.x,p.y+=z*this.impulse2.y,q+=A*(l*this.impulse2.y-
c*this.impulse2.x);b.m_linearVelocity.SetV(m);b.m_angularVelocity=n;e.m_linearVelocity.SetV(p);e.m_angularVelocity=q};J.prototype.SolvePositionConstraints=function(b){var e=0,f;b=this.m_bodyA;var h=this.m_bodyB,k=0,l=f=0,n=0,c=0;if(this.m_enableLimit&&this.m_limitState!=v.e_inactiveLimit){var e=h.m_sweep.a-b.m_sweep.a-this.m_referenceAngle,m=0;this.m_limitState==v.e_equalLimits?(e=d.Clamp(e-this.m_lowerAngle,-a.b2_maxAngularCorrection,a.b2_maxAngularCorrection),m=-this.m_motorMass*e,k=d.Abs(e)):this.m_limitState==
v.e_atLowerLimit?(e-=this.m_lowerAngle,k=-e,e=d.Clamp(e+a.b2_angularSlop,-a.b2_maxAngularCorrection,0),m=-this.m_motorMass*e):this.m_limitState==v.e_atUpperLimit&&(k=e-=this.m_upperAngle,e=d.Clamp(e-a.b2_angularSlop,0,a.b2_maxAngularCorrection),m=-this.m_motorMass*e);b.m_sweep.a-=b.m_invI*m;h.m_sweep.a+=h.m_invI*m;b.SynchronizeTransform();h.SynchronizeTransform()}f=b.m_xf.R;m=this.m_localAnchor1.x-b.m_sweep.localCenter.x;e=this.m_localAnchor1.y-b.m_sweep.localCenter.y;l=f.col1.x*m+f.col2.x*e;e=f.col1.y*
m+f.col2.y*e;m=l;f=h.m_xf.R;var p=this.m_localAnchor2.x-h.m_sweep.localCenter.x,q=this.m_localAnchor2.y-h.m_sweep.localCenter.y,l=f.col1.x*p+f.col2.x*q,q=f.col1.y*p+f.col2.y*q,p=l,n=h.m_sweep.c.x+p-b.m_sweep.c.x-m,c=h.m_sweep.c.y+q-b.m_sweep.c.y-e,u=n*n+c*c;f=Math.sqrt(u);var l=b.m_invMass,z=h.m_invMass,x=b.m_invI,A=h.m_invI,B=10*a.b2_linearSlop;u>B*B&&(u=1/(l+z),n=u*-n,c=u*-c,b.m_sweep.c.x-=.5*l*n,b.m_sweep.c.y-=.5*l*c,h.m_sweep.c.x+=.5*z*n,h.m_sweep.c.y+=.5*z*c,n=h.m_sweep.c.x+p-b.m_sweep.c.x-m,
c=h.m_sweep.c.y+q-b.m_sweep.c.y-e);this.K1.col1.x=l+z;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=l+z;this.K2.col1.x=x*e*e;this.K2.col2.x=-x*m*e;this.K2.col1.y=-x*m*e;this.K2.col2.y=x*m*m;this.K3.col1.x=A*q*q;this.K3.col2.x=-A*p*q;this.K3.col1.y=-A*p*q;this.K3.col2.y=A*p*p;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(J.tImpulse,-n,-c);n=J.tImpulse.x;c=J.tImpulse.y;b.m_sweep.c.x-=b.m_invMass*n;b.m_sweep.c.y-=b.m_invMass*c;b.m_sweep.a-=b.m_invI*(m*c-e*n);h.m_sweep.c.x+=
h.m_invMass*n;h.m_sweep.c.y+=h.m_invMass*c;h.m_sweep.a+=h.m_invI*(p*c-q*n);b.SynchronizeTransform();h.SynchronizeTransform();return f<=a.b2_linearSlop&&k<=a.b2_angularSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=new e});Box2D.inherit(K,Box2D.Dynamics.Joints.b2JointDef);K.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;K.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new e;this.localAnchorB=
new e};K.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_revoluteJoint;this.localAnchorA.Set(0,0);this.localAnchorB.Set(0,0);this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0;this.enableMotor=this.enableLimit=!1};K.prototype.Initialize=function(a,b,d){this.bodyA=a;this.bodyB=b;this.localAnchorA=this.bodyA.GetLocalPoint(d);this.localAnchorB=this.bodyB.GetLocalPoint(d);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};
Box2D.inherit(R,Box2D.Dynamics.Joints.b2Joint);R.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;R.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new e;this.m_localAnchorB=new e;this.m_impulse=new k;this.m_mass=new f};R.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};R.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};R.prototype.GetReactionForce=function(a){void 0===
a&&(a=0);return new e(a*this.m_impulse.x,a*this.m_impulse.y)};R.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);return a*this.m_impulse.z};R.prototype.b2WeldJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchorA.SetV(a.localAnchorA);this.m_localAnchorB.SetV(a.localAnchorB);this.m_referenceAngle=a.referenceAngle;this.m_impulse.SetZero();this.m_mass=new f};R.prototype.InitVelocityConstraints=function(a){var b,d=0,e=this.m_bodyA,f=this.m_bodyB;b=e.m_xf.R;var h=this.m_localAnchorA.x-
e.m_sweep.localCenter.x,k=this.m_localAnchorA.y-e.m_sweep.localCenter.y,d=b.col1.x*h+b.col2.x*k,k=b.col1.y*h+b.col2.y*k,h=d;b=f.m_xf.R;var c=this.m_localAnchorB.x-f.m_sweep.localCenter.x,l=this.m_localAnchorB.y-f.m_sweep.localCenter.y,d=b.col1.x*c+b.col2.x*l,l=b.col1.y*c+b.col2.y*l,c=d;b=e.m_invMass;var d=f.m_invMass,n=e.m_invI,p=f.m_invI;this.m_mass.col1.x=b+d+k*k*n+l*l*p;this.m_mass.col2.x=-k*h*n-l*c*p;this.m_mass.col3.x=-k*n-l*p;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=b+d+h*h*
n+c*c*p;this.m_mass.col3.y=h*n+c*p;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=n+p;a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_impulse.z*=a.dtRatio,e.m_linearVelocity.x-=b*this.m_impulse.x,e.m_linearVelocity.y-=b*this.m_impulse.y,e.m_angularVelocity-=n*(h*this.m_impulse.y-k*this.m_impulse.x+this.m_impulse.z),f.m_linearVelocity.x+=d*this.m_impulse.x,f.m_linearVelocity.y+=d*this.m_impulse.y,f.m_angularVelocity+=p*
(c*this.m_impulse.y-l*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()};R.prototype.SolveVelocityConstraints=function(a){var b,d=0;a=this.m_bodyA;var e=this.m_bodyB,f=a.m_linearVelocity,h=a.m_angularVelocity,l=e.m_linearVelocity,c=e.m_angularVelocity,m=a.m_invMass,n=e.m_invMass,p=a.m_invI,q=e.m_invI;b=a.m_xf.R;var v=this.m_localAnchorA.x-a.m_sweep.localCenter.x,u=this.m_localAnchorA.y-a.m_sweep.localCenter.y,d=b.col1.x*v+b.col2.x*u,u=b.col1.y*v+b.col2.y*u,v=d;b=e.m_xf.R;var z=this.m_localAnchorB.x-
e.m_sweep.localCenter.x,x=this.m_localAnchorB.y-e.m_sweep.localCenter.y,d=b.col1.x*z+b.col2.x*x,x=b.col1.y*z+b.col2.y*x,z=d;b=l.x-c*x-f.x+h*u;var d=l.y+c*z-f.y-h*v,A=c-h,B=new k;this.m_mass.Solve33(B,-b,-d,-A);this.m_impulse.Add(B);f.x-=m*B.x;f.y-=m*B.y;h-=p*(v*B.y-u*B.x+B.z);l.x+=n*B.x;l.y+=n*B.y;c+=q*(z*B.y-x*B.x+B.z);a.m_angularVelocity=h;e.m_angularVelocity=c};R.prototype.SolvePositionConstraints=function(b){var e,f=0;b=this.m_bodyA;var h=this.m_bodyB;e=b.m_xf.R;var l=this.m_localAnchorA.x-b.m_sweep.localCenter.x,
n=this.m_localAnchorA.y-b.m_sweep.localCenter.y,f=e.col1.x*l+e.col2.x*n,n=e.col1.y*l+e.col2.y*n,l=f;e=h.m_xf.R;var p=this.m_localAnchorB.x-h.m_sweep.localCenter.x,c=this.m_localAnchorB.y-h.m_sweep.localCenter.y,f=e.col1.x*p+e.col2.x*c,c=e.col1.y*p+e.col2.y*c,p=f;e=b.m_invMass;var f=h.m_invMass,m=b.m_invI,q=h.m_invI,v=h.m_sweep.c.x+p-b.m_sweep.c.x-l,u=h.m_sweep.c.y+c-b.m_sweep.c.y-n,z=h.m_sweep.a-b.m_sweep.a-this.m_referenceAngle,x=10*a.b2_linearSlop,A=Math.sqrt(v*v+u*u),B=d.Abs(z);A>x&&(m*=1,q*=1);
this.m_mass.col1.x=e+f+n*n*m+c*c*q;this.m_mass.col2.x=-n*l*m-c*p*q;this.m_mass.col3.x=-n*m-c*q;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=e+f+l*l*m+p*p*q;this.m_mass.col3.y=l*m+p*q;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=m+q;x=new k;this.m_mass.Solve33(x,-v,-u,-z);b.m_sweep.c.x-=e*x.x;b.m_sweep.c.y-=e*x.y;b.m_sweep.a-=m*(l*x.y-n*x.x+x.z);h.m_sweep.c.x+=f*x.x;h.m_sweep.c.y+=f*x.y;h.m_sweep.a+=q*(p*x.y-c*x.x+x.z);b.SynchronizeTransform();
h.SynchronizeTransform();return A<=a.b2_linearSlop&&B<=a.b2_angularSlop};Box2D.inherit(O,Box2D.Dynamics.Joints.b2JointDef);O.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;O.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new e;this.localAnchorB=new e};O.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_weldJoint;this.referenceAngle=0};O.prototype.Initialize=function(a,b,d){this.bodyA=a;
this.bodyB=b;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(d));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(d));this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}})();
(function(){var a=Box2D.Dynamics.b2DebugDraw;a.b2DebugDraw=function(){this.m_xformScale=this.m_fillAlpha=this.m_alpha=this.m_lineThickness=this.m_drawScale=1;var a=this;this.m_sprite={graphics:{clear:function(){a.m_ctx.clearRect(0,0,a.m_ctx.canvas.width,a.m_ctx.canvas.height)}}}};a.prototype._color=function(a,f){return"rgba("+((a&16711680)>>16)+","+((a&65280)>>8)+","+(a&255)+","+f+")"};a.prototype.b2DebugDraw=function(){this.m_drawFlags=0};a.prototype.SetFlags=function(a){void 0===a&&(a=0);this.m_drawFlags=
a};a.prototype.GetFlags=function(){return this.m_drawFlags};a.prototype.AppendFlags=function(a){void 0===a&&(a=0);this.m_drawFlags|=a};a.prototype.ClearFlags=function(a){void 0===a&&(a=0);this.m_drawFlags&=~a};a.prototype.SetSprite=function(a){this.m_ctx=a};a.prototype.GetSprite=function(){return this.m_ctx};a.prototype.SetDrawScale=function(a){void 0===a&&(a=0);this.m_drawScale=a};a.prototype.GetDrawScale=function(){return this.m_drawScale};a.prototype.SetLineThickness=function(a){void 0===a&&(a=
0);this.m_lineThickness=a;this.m_ctx.strokeWidth=a};a.prototype.GetLineThickness=function(){return this.m_lineThickness};a.prototype.SetAlpha=function(a){void 0===a&&(a=0);this.m_alpha=a};a.prototype.GetAlpha=function(){return this.m_alpha};a.prototype.SetFillAlpha=function(a){void 0===a&&(a=0);this.m_fillAlpha=a};a.prototype.GetFillAlpha=function(){return this.m_fillAlpha};a.prototype.SetXFormScale=function(a){void 0===a&&(a=0);this.m_xformScale=a};a.prototype.GetXFormScale=function(){return this.m_xformScale};
a.prototype.DrawPolygon=function(a,f,d){if(f){var e=this.m_ctx,k=this.m_drawScale;e.beginPath();e.strokeStyle=this._color(d.color,this.m_alpha);e.moveTo(a[0].x*k,a[0].y*k);for(d=1;d<f;d++)e.lineTo(a[d].x*k,a[d].y*k);e.lineTo(a[0].x*k,a[0].y*k);e.closePath();e.stroke()}};a.prototype.DrawSolidPolygon=function(a,f,d){if(f){var e=this.m_ctx,k=this.m_drawScale;e.beginPath();e.strokeStyle=this._color(d.color,this.m_alpha);e.fillStyle=this._color(d.color,this.m_fillAlpha);e.moveTo(a[0].x*k,a[0].y*k);for(d=
1;d<f;d++)e.lineTo(a[d].x*k,a[d].y*k);e.lineTo(a[0].x*k,a[0].y*k);e.closePath();e.fill();e.stroke()}};a.prototype.DrawCircle=function(a,f,d){if(f){var e=this.m_ctx,k=this.m_drawScale;e.beginPath();e.strokeStyle=this._color(d.color,this.m_alpha);e.arc(a.x*k,a.y*k,f*k,0,2*Math.PI,!0);e.closePath();e.stroke()}};a.prototype.DrawSolidCircle=function(a,f,d,e){if(f){var k=this.m_ctx,p=this.m_drawScale,b=a.x*p,q=a.y*p;k.moveTo(0,0);k.beginPath();k.strokeStyle=this._color(e.color,this.m_alpha);k.fillStyle=
this._color(e.color,this.m_fillAlpha);k.arc(b,q,f*p,0,2*Math.PI,!0);k.moveTo(b,q);k.lineTo((a.x+d.x*f)*p,(a.y+d.y*f)*p);k.closePath();k.fill();k.stroke()}};a.prototype.DrawSegment=function(a,f,d){var e=this.m_ctx,k=this.m_drawScale;e.strokeStyle=this._color(d.color,this.m_alpha);e.beginPath();e.moveTo(a.x*k,a.y*k);e.lineTo(f.x*k,f.y*k);e.closePath();e.stroke()};a.prototype.DrawTransform=function(a){var f=this.m_ctx,d=this.m_drawScale;f.beginPath();f.strokeStyle=this._color(16711680,this.m_alpha);
f.moveTo(a.position.x*d,a.position.y*d);f.lineTo((a.position.x+this.m_xformScale*a.R.col1.x)*d,(a.position.y+this.m_xformScale*a.R.col1.y)*d);f.strokeStyle=this._color(65280,this.m_alpha);f.moveTo(a.position.x*d,a.position.y*d);f.lineTo((a.position.x+this.m_xformScale*a.R.col2.x)*d,(a.position.y+this.m_xformScale*a.R.col2.y)*d);f.closePath();f.stroke()}})();var i;for(i=0;i<Box2D.postDefs.length;++i)Box2D.postDefs[i]();delete Box2D.postDefs;
function CHelp(){var a=this,l,f,d,e,k,p,b,q,n;this._init=function(){l=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));s_oStage.addChild(l);var a=new createjs.Shape;a.graphics.beginFill("#000000").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);a.alpha=.7;s_oStage.addChild(a);f=new createjs.Container;f.y=CANVAS_WIDTH;f.alpha=0;l=createBitmap(s_oSpriteLibrary.getSprite("msg_box"));f.addChild(l);p=new createjs.Text(""," 25px "+FONT,"#000");p.x=CANVAS_WIDTH/2+2;p.y=CANVAS_HEIGHT/2-113;p.textAlign="center";
p.textBaseline="alphabetic";p.lineWidth=400;f.addChild(p);b=new createjs.Text(""," 25px "+FONT,"#ffc949");b.x=CANVAS_WIDTH/2;b.y=CANVAS_HEIGHT/2-115;b.textAlign="center";b.textBaseline="alphabetic";b.lineWidth=400;f.addChild(b);q=new createjs.Text(""," 25px "+FONT,"#000");q.x=CANVAS_WIDTH/2+2;q.y=CANVAS_HEIGHT/2+52;q.textAlign="center";q.textBaseline="alphabetic";q.lineWidth=400;f.addChild(q);n=new createjs.Text(""," 25px "+FONT,"#ffc949");n.x=CANVAS_WIDTH/2;n.y=CANVAS_HEIGHT/2+50;n.textAlign="center";
n.textBaseline="alphabetic";n.lineWidth=400;f.addChild(n);e=new createjs.Container;e.x=150;e.y=440;f.addChild(e);a=createBitmap(s_oSpriteLibrary.getSprite("player"));e.addChild(a);a=createBitmap(s_oSpriteLibrary.getSprite("cursor_help"));a.x=8;a.y=20;e.addChild(a);k=new createjs.Container;k.x=250;k.y=600;f.addChild(k);a=createBitmap(s_oSpriteLibrary.getSprite("target"));a.scaleX=a.scaleY=.6;k.addChild(a);a=new createjs.Text("12/30"," 25px "+FONT,"#000");a.x=37;a.y=25;a.textAlign="left";a.textBaseline=
"alphabetic";a.lineWidth=650;k.addChild(a);a=new createjs.Text("12/30"," 25px "+FONT,"#ffc949");a.x=35;a.y=23;a.textAlign="left";a.textBaseline="alphabetic";a.lineWidth=650;k.addChild(a);s_oStage.addChild(f);d=createBitmap(s_oSpriteLibrary.getSprite("but_next"));d.x=CANVAS_WIDTH/2-45;d.y=CANVAS_HEIGHT/2+190;d.cursor="pointer";f.addChild(d);this.show();this.startCursorAnimationRight()};this._initListener=function(){d.addEventListener("click",this._onExit)};this.show=function(){p.text=TEXT_HELP_PANEL_MOVE;
b.text=TEXT_HELP_PANEL_MOVE;q.text=TEXT_HELP_PANEL_RELEASE;n.text=TEXT_HELP_PANEL_RELEASE;createjs.Tween.get(f).to({alpha:1},500).call(function(){a._initListener()});createjs.Tween.get(f).to({y:0},500,createjs.Ease.quadOut).call(function(){})};this.startCursorAnimationRight=function(){createjs.Tween.get(e).to({x:450},2E3).call(function(){a.startCursorAnimationLeft()})};this.startCursorAnimationLeft=function(){createjs.Tween.get(e).to({x:150},2E3).call(function(){a.startCursorAnimationRight()})};this._onExit=
function(){playSound("press_button",1,0);a.unload();s_oMain.gotoGame(0)};this.unload=function(){createjs.Tween.removeAllTweens();s_oStage.removeAllChildren()};this._init();return this}
function CEndPanel(a){var l,f,d,e,k,p,b,q,n,z,u,x,v=[],B=this;this._init=function(a){f=createBitmap(a);f.x=0;f.y=0;u=new createjs.Shape;u.graphics.beginFill("#000000").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);u.alpha=.7;u.on("mousedown",this._onClick);s_oStage.addChild(u);e=new createjs.Text(""," 40px "+FONT,"#000");e.x=CANVAS_WIDTH/2+2;e.y=CANVAS_HEIGHT/2-48;e.textAlign="center";e.textBaseline="alphabetic";e.lineWidth=400;k=new createjs.Text(""," 40px "+FONT,"#ffc949");k.x=CANVAS_WIDTH/2;k.y=CANVAS_HEIGHT/
2-50;k.textAlign="center";k.textBaseline="alphabetic";k.lineWidth=400;p=new createjs.Text(""," 30px "+FONT,"#000");p.x=CANVAS_WIDTH/2+2;p.y=CANVAS_HEIGHT/2+84;p.textAlign="center";p.textBaseline="alphabetic";p.lineWidth=400;b=new createjs.Text(""," 30px "+FONT,"#ffc949");b.x=CANVAS_WIDTH/2;b.y=CANVAS_HEIGHT/2+82;b.textAlign="center";b.textBaseline="alphabetic";b.lineWidth=400;d=new createjs.Container;d.y=CANVAS_HEIGHT;d.visible=!1;d.addChild(f,p,b,e,k);s_oStage.addChild(d);for(a=1;87>a;a++)v.push(createBitmap(s_oSpriteLibrary.getSprite("msg_box_animation_"+
a))),s_oStage.addChild(v[a-1]),v[a-1].visible=!1;this.playAnimation(0)};this.playAnimation=function(a){0===a&&(v[v.length-1].visible=!1,v[a].visible=!0);0<a&&(v[a-1].visible=!1,v[a].visible=!0);l=a<v.length-1?setTimeout(function(){B.playAnimation(a+1)},100):setTimeout(function(){B.playAnimation(0)},100)};this.unloadExit=function(){z.unload();q.unload();clearTimeout(l)};this.unloadNextLevel=function(){z.unload();q.unload();n.unload();clearTimeout(l)};this._initListener=function(){z.addEventListener(ON_MOUSE_UP,
this._onExit,this);q.addEventListener(ON_MOUSE_UP,this._onRestartExit,this)};this._initListenerNextLevel=function(){z.addEventListener(ON_MOUSE_UP,this._onExit,this);q.addEventListener(ON_MOUSE_UP,this._onRestartNextLevel,this);n.addEventListener(ON_MOUSE_UP,this._onNextLevel,this)};this.show=function(a){setVolume(s_oSoundtrack,0);x=playSound("game_over",1,0);e.text=TEXT_GAMEOVER;k.text=TEXT_GAMEOVER;p.text=TEXT_SCORE+a;b.text=TEXT_SCORE+a;d.visible=!0;z=new CGfxButton(CANVAS_WIDTH/2-40,CANVAS_HEIGHT/
2+160,s_oSpriteLibrary.getSprite("but_home"),d);q=new CGfxButton(CANVAS_WIDTH/2+45,CANVAS_HEIGHT/2+160,s_oSpriteLibrary.getSprite("but_restart"),d);q.pulseAnimation();createjs.Tween.get(d).to({y:0},500,createjs.Ease.quadOut).call(function(){B._initListener()});$(s_oMain).trigger("share_event",[a]);$(s_oMain).trigger("save_score",[a])};this.nextLevel=function(a){setVolume(s_oSoundtrack,0);x=playSound("next_level",1,0);e.text=TEXT_LEVEL_COMPLETED;k.text=TEXT_LEVEL_COMPLETED;p.text=TEXT_SCORE+a;b.text=
TEXT_SCORE+a;d.visible=!0;z=new CGfxButton(CANVAS_WIDTH/2-80,CANVAS_HEIGHT/2+160,s_oSpriteLibrary.getSprite("but_home"),d);q=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT/2+160,s_oSpriteLibrary.getSprite("but_restart"),d);n=new CGfxButton(CANVAS_WIDTH/2+75,CANVAS_HEIGHT/2+160,s_oSpriteLibrary.getSprite("but_next"),d);n.pulseAnimation();createjs.Tween.get(d).to({y:0},500,createjs.Ease.quadOut).call(function(){B._initListenerNextLevel()});$(s_oMain).trigger("share_event",[a]);$(s_oMain).trigger("save_score",
[a])};this._onExit=function(){B.unloadExit();playSound("press_button",1,0);s_oStage.removeChild(u);s_oStage.removeChild(d);s_oGame.onExit();stopSound(x);s_oSoundPlayerDead&&stopSound(s_oSoundPlayerDead)};this._onNextLevel=function(){B.unloadNextLevel();playSound("press_button",1,0);s_oStage.removeChild(d);s_oGame.onNextLevel()};this._onRestartExit=function(){B.unloadExit();playSound("press_button",1,0);s_oStage.removeChild(d);s_oGame.onRestart();stopSound(x)};this._onClick=function(){};this._onRestartNextLevel=
function(){B.unloadNextLevel();playSound("press_button",1,0);s_oStage.removeChild(d);s_oGame.onRestart();stopSound(x)};this._init(a);return this}
function CPhysicsController(){var a=Box2D.Common.Math.b2Vec2,l=Box2D.Dynamics.b2World,f=Box2D.Dynamics.b2DebugDraw,d,e,k=this,p=document.getElementById("canvas").getContext("2d");this.init=function(){d=new a(0,9.8);e=new l(d,!0);var b=new f;b.SetSprite(p);b.SetDrawScale(WORLD_SCALE);b.SetFillAlpha(.5);b.SetLineThickness(1);b.SetFlags(f.e_shapeBit);e.SetDebugDraw(b);this.createAContactListener()};this.createAContactListener=function(){var a=new Box2D.Dynamics.b2ContactListener;a.BeginContact=function(a){a=
a.GetFixtureA().GetBody();playSound("hit_obstacles");a.GetPosition().y*WORLD_SCALE>=BASKET_Y&&(playSound("hit_basket"),s_oGame.moveBasket())};e.SetContactListener(a)};this.startComputing=function(a){a.GetBody().SetActive(!0)};this.movePlayer=function(a,d,e){d={x:d/WORLD_SCALE,y:e/WORLD_SCALE};a.GetBody().SetPosition(d)};this.applyImpulse=function(a){a.GetBody().ApplyImpulse({x:.8,y:1},a.GetBody().GetWorldCenter())};this.decreaseSpeedRotation=function(a){var d=.99*a.GetBody().GetAngularVelocity();
a.GetBody().SetAngularVelocity(d)};this.getSpeedRotation=function(a){return a.GetBody().GetAngularVelocity()};this.moveObject=function(a,d,e){d={x:d/WORLD_SCALE,y:e/WORLD_SCALE};a.GetBody().SetPosition(d)};this.destroyBody=function(a){e.DestroyBody(a.GetBody())};this.getInstance=function(){null===k&&(k=new CPhysicsController);return k};this.update=function(){e.Step(.025,3,3);e.DrawDebugData();e.ClearForces()};this.getWorld=function(){return e};this.getElementPosition=function(a){var d=a.GetBody().GetPosition();
return{x:d.x*WORLD_SCALE,y:d.y*WORLD_SCALE,angle:180*a.GetBody().GetAngle()/Math.PI}};this.getElementAngle=function(a){return 180*a.GetBody().GetAngle()/Math.PI};this.init()}
function CPhysicsObject(){var a=Box2D.Common.Math.b2Vec2,l=Box2D.Dynamics.b2BodyDef,f=Box2D.Dynamics.b2Body,d=Box2D.Dynamics.b2FixtureDef,e=Box2D.Collision.Shapes.b2PolygonShape,k=Box2D.Collision.Shapes.b2CircleShape,p=Box2D.Dynamics.Joints.b2RevoluteJointDef,b,q;this.init=function(){q=s_oPhysicsController.getInstance();b=q.getWorld()};this.addWall=function(a,k,p,q,v,B,A,h){var E=new d;E.density=B;E.friction=A;E.restitution=h;B=new l;B.type=f.b2_staticBody;E.shape=new e;E.shape.SetAsBox(a/WORLD_SCALE,
k/WORLD_SCALE);B.position.Set(p/WORLD_SCALE,q/WORLD_SCALE);B.angle=v*Math.PI/180;b.CreateBody(B).CreateFixture(E)};this.addPoligon=function(k,p,q,x,v,B,A){var h=new d;h.density=v;h.friction=B;h.restitution=A;v=new l;v.type=f.b2_staticBody;h.shape=new e;B=[];for(A=0;A<POLIGON_POINTS[q].length;A++){var E=new a;E.Set(POLIGON_POINTS[q][A].x/WORLD_SCALE,POLIGON_POINTS[q][A].y/WORLD_SCALE);B.push(E)}h.shape.SetAsArray(B,B.length);v.position.Set(k/WORLD_SCALE,p/WORLD_SCALE);v.angle=x*Math.PI/180;b.CreateBody(v).CreateFixture(h);
if(q===BASKET){q+=1;h=new d;h.density=3;h.friction=1;h.restitution=.5;v=new l;v.type=f.b2_staticBody;h.shape=new e;B=[];for(A=0;A<POLIGON_POINTS[q].length;A++)E=new a,E.Set(POLIGON_POINTS[q][A].x/WORLD_SCALE,POLIGON_POINTS[q][A].y/WORLD_SCALE),B.push(E);h.shape.SetAsArray(B,B.length);v.position.Set(k/WORLD_SCALE,p/WORLD_SCALE);v.angle=x*Math.PI/180;b.CreateBody(v).CreateFixture(h)}};this.addPlayer=function(a,e,p,q,v,B){var A=new d;A.density=q;A.friction=v;A.restitution=B;q=new l;q.type=f.b2_dynamicBody;
A.shape=new k(a/WORLD_SCALE);q.allowSleep=!1;q.position.x=e/WORLD_SCALE;q.position.y=p/WORLD_SCALE;a=b.CreateBody(q).CreateFixture(A);a.GetBody().SetActive(!1);return a};this.addCircle=function(a,e,p,q,v,B){var A=new d;A.density=q;A.friction=v;A.restitution=B;q=new l;q.type=f.b2_dynamicBody;A.shape=new k(a/WORLD_SCALE);q.position.x=e/WORLD_SCALE;q.position.y=p/WORLD_SCALE;return b.CreateBody(q).CreateFixture(A)};this.addStaticCircle=function(a,e,p,q,v,B){var A=new d;A.density=q;A.friction=v;A.restitution=
B;q=new l;q.type=f.b2_staticBody;A.shape=new k(a/WORLD_SCALE);q.position.x=e/WORLD_SCALE;q.position.y=p/WORLD_SCALE;return b.CreateBody(q).CreateFixture(A)};this.addRevoluteRectangle=function(a,q,u,x,v,B,A,h){var E=new d;E.density=v;E.friction=B;E.restitution=A;v=new l;v.type=f.b2_dynamicBody;h&&(v.angularVelocity=3);E.shape=new e;E.shape.SetAsBox(a/WORLD_SCALE,q/WORLD_SCALE);v.position.Set(u/WORLD_SCALE,x/WORLD_SCALE);a=b.CreateBody(v);E=a.CreateFixture(E);q=new d;q.density=3;q.friction=1;q.restitution=
.1;h=new l;h.type=f.b2_staticBody;q.shape=new k(10/WORLD_SCALE);h.position.Set(u/WORLD_SCALE,x/WORLD_SCALE);u=b.CreateBody(h);x=u.CreateFixture(q);q=new p;q.Initialize(a,u,a.GetWorldCenter());b.CreateJoint(q);return{fixture1:E,fixture2:x}};this.addRectangle=function(a,k,p,q,v,B,A,h){var E=new d;E.density=B;E.friction=A;E.restitution=h;B=new l;B.type=f.b2_staticBody;E.shape=new e;E.shape.SetAsBox(a/WORLD_SCALE,k/WORLD_SCALE);B.position.Set(p/WORLD_SCALE,q/WORLD_SCALE);B.angle=v*Math.PI/180;return b.CreateBody(B).CreateFixture(E)};
this.setRotation=function(a){this.rotation=a};this.hitten=function(a){};this._update=function(a){};this.init()}
function CBasket(a,l,f){var d=(new Date).getTime(),e,k,p,b,q,n,z,u,x,v,B=l+8;this.init=function(){e=new CPhysicsObject;e.addPoligon(a,B,BASKET,0);var b=s_oSpriteLibrary.getSprite("basket_back");k=createBitmap(b);k.x=a;k.y=B;k.regX=b.width/2;k.regY=b.height;f.addChild(k)};this.spawnFront=function(){var b=s_oSpriteLibrary.getSprite("basket_front");p=createBitmap(b);p.x=a;p.y=B;p.regX=b.width/2;p.regY=b.height;f.addChild(p)};this.spawnBasketMultiplier=function(d){d=s_oSpriteLibrary.getSprite("multiplier_"+
d);b=createBitmap(d);b.x=a;b.y=B-8;b.regX=d.width/2;b.regY=d.width/2;f.addChild(b)};this.setMultiplier=function(b,d){q=b;u=new createjs.Container;f.addChild(u);switch(q){case 25:n=s_oSpriteLibrary.getSprite("unhappy");v=B-k.regY-100;break;case 50:n=s_oSpriteLibrary.getSprite("almost_happy");v=B-k.regY-150;break;case 100:n=s_oSpriteLibrary.getSprite("happy"),v=B-k.regY-200}x=B-k.regY-10;z=createBitmap(n);z.x=a-k.regX;z.y=x;z.visible=!1;d.addChild(z)};this.getMultiplier=function(){return q};this.applyTremble=
function(){var a=(new Date).getTime();if(500<a-d){var b=Math.round(3*Math.random())+1;createjs.Tween.get(k).to({rotation:b},100).call(function(){createjs.Tween.get(k).to({rotation:-b},100).call(function(){createjs.Tween.get(k).to({rotation:0},100).call(function(){})})});createjs.Tween.get(p).to({rotation:b},100).call(function(){createjs.Tween.get(p).to({rotation:-b},100).call(function(){createjs.Tween.get(p).to({rotation:0},100).call(function(){})})});d=a}};this.applyScaleMultiplier=function(){createjs.Tween.get(b).to({scaleX:2,
scaleY:2},200,createjs.Ease.cubicOut).call(function(){createjs.Tween.get(b).to({scaleX:1,scaleY:1},200,createjs.Ease.cubicIn).call(function(){})});this._playExultation()};this._playExultation=function(){z.visible=!0;createjs.Tween.get(z).to({y:v},850,createjs.Ease.cubicOut).to({y:x},650,createjs.Ease.cubicIn).call(function(){z.visible=!1})};this.init()}
function CPlayer(a,l,f,d,e,k,p,b){var q,n,z;this.init=function(){q=b.addPlayer(a.width/2-5,l,f,d,e,k);var u=s_oPhysicsController.getElementPosition(q);n=createBitmap(a);n.x=u.x;n.y=u.y;n.rotation=u.angle;n.regX=a.width/2;n.regY=a.height/2;p.addChild(n);z=new createjs.Rectangle(l-a.width/2,f-a.height/2,a.width,a.height)};this.refreshPosition=function(){var b=s_oPhysicsController.getElementPosition(q);n.x=b.x;n.y=b.y;n.rotation=b.angle;z.setValues(n.x-a.width/2,n.y-a.height/2,a.width,a.height)};this.movePlayer=
function(a){s_oPhysicsController.movePlayer(q,a,f)};this.activatePlayer=function(){s_oPhysicsController.startComputing(q)};this.checkIfPlayerHasStopped=function(a){return Math.abs(q.GetBody().GetLinearVelocity().y)<=EPSILON&&a&&n.y>=BASKET_Y-20?!0:!1};this.unload=function(){p.removeAllChildren();s_oPhysicsController.destroyBody(q)};this.getX=function(){return n.x};this.getRectangle=function(){return z};this.init()}
function CObjectToPick(a,l,f,d){var e,k,p=[],b=[],q=[];this.init=function(){var b=s_oSpriteLibrary.getSprite("object_to_pick"),p=new createjs.SpriteSheet({images:[b],frames:{width:b.width/NUM_OBJ_TO_PICK_IN_ROW,height:b.height,regX:0,regY:0},animations:{obj_0:[0],obj_1:[1],obj_2:[2],obj_3:[3],obj_4:[4],obj_5:[5]}});e=createSprite(p,"obj_"+f,0,0,b.width/NUM_OBJ_TO_PICK_IN_ROW,b.height);e.x=a;e.y=l;d.addChild(e);k=new createjs.Rectangle(a,l,b.width/NUM_OBJ_TO_PICK_IN_ROW,b.height)};this.checkIfPlayerHasCollided=
function(a){return k.intersects(a)?!0:!1};this.addEventListener=function(a,d,e){p[a]=d;b[a]=e};this.addEventListenerWithParams=function(a,d,e,f){p[a]=d;b[a]=e;q=f};this.tweenEnded=function(){p[ON_TWEEN_ENDED]&&p[ON_TWEEN_ENDED].call(b[ON_TWEEN_ENDED],q)};this.moveToGUI=function(a,b){var d=this;createjs.Tween.get(e).to({x:CANVAS_WIDTH/2-280},1E3,createjs.Ease.quadOut).call(function(){d.unload(a);d.tweenEnded(b)});createjs.Tween.get(e).to({y:e.y+50},300,createjs.Ease.quadOut).call(function(){createjs.Tween.get(e).to({y:a},
700,createjs.Ease.quadOut).call(function(){})})};this.unload=function(a){d.removeChild(e);k=null};this.getRectangle=function(){return k};this.init()}
function CLevelMenu(){var a,l,f,d,e,k,p,b=[],q,n,z,u=this,x=[];this._init=function(){q=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));s_oStage.addChild(q);var e=new createjs.Shape;e.graphics.beginFill("#000").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);e.alpha=.7;s_oStage.addChild(e);k=new createjs.Container;k.y=CANVAS_HEIGHT;s_oStage.addChild(k);q=createBitmap(s_oSpriteLibrary.getSprite("msg_box"));k.addChild(q);p=new createjs.Text(TEXT_LEVEL," 40px "+FONT,"#000");p.x=CANVAS_WIDTH/2+2;p.y=372;
p.textAlign="center";p.textBaseline="alphabetic";p.lineWidth=1E3;k.addChild(p);p=new createjs.Text(TEXT_LEVEL," 40px "+FONT,"#ffc949");p.x=CANVAS_WIDTH/2;p.y=370;p.textAlign="center";p.textBaseline="alphabetic";p.lineWidth=1E3;k.addChild(p);for(var e=CANVAS_WIDTH/2+70,u=0,A=0,h=0;h<LEVEL_NUM;h++,u+=90)300<u&&(u=0,A+=90),h<s_iLevelReached?(b.push(new CLevelBut(e-200+u,460+A,s_oSpriteLibrary.getSprite("level_sprite"),!0,h+1,k)),h===s_iLevelReached-1&&b[h].pulseAnimation()):b.push(new CLevelBut(e-200+
u,460+A,s_oSpriteLibrary.getSprite("level_sprite"),!1,h+1,k)),0===h?b[h].addEventListenerWithParams(ON_MOUSE_UP,this._onClickHelp,this,h):b[h].addEventListenerWithParams(ON_MOUSE_UP,this._onClick,this,h),s_bFirstTime=!0;e=s_oSpriteLibrary.getSprite("but_exit");f=CANVAS_WIDTH-e.height/2-10;d=e.height/2+10;n=new CGfxButton(f,d,e,s_oStage);n.addEventListener(ON_MOUSE_UP,this._onExit,this);a=CANVAS_WIDTH-e.width/2-80;l=e.height/2+10;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)e=s_oSpriteLibrary.getSprite("audio_icon"),
z=new CToggle(a,l,e,s_bAudioActive),z.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);for(h=1;87>h;h++)x.push(createBitmap(s_oSpriteLibrary.getSprite("msg_box_animation_"+h))),s_oStage.addChild(x[h-1]),x[h-1].visible=!1;this.playAnimation(0);createjs.Tween.get(k).to({y:0},500,createjs.Ease.quadOut).call(function(){});this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.playAnimation=function(a){0===a&&(x[x.length-1].visible=!1,x[a].visible=!0);0<a&&(x[a-1].visible=!1,x[a].visible=!0);e=a<x.length-
1?setTimeout(function(){u.playAnimation(a+1)},100):setTimeout(function(){u.playAnimation(0)},100)};this.unload=function(){s_oStage.removeAllChildren();for(var a=0;a<LEVEL_NUM;a++)b[a].unload();clearTimeout(e);s_oLevelMenu=null};this.refreshButtonPos=function(b,e){n.setPosition(f-b,e+d);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||z.setPosition(a-b,e+l)};this._onNumModeToggle=function(a){a===NUM_ACTIVE?((void 0).setActive(!1),(void 0).setActive(!0)):((void 0).setActive(!0),(void 0).setActive(!1))};this._onAudioToggle=
function(){createjs.Sound.setMute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this.doUnload=function(a,b){createjs.Tween.get(k).to({y:CANVAS_HEIGHT},500).call(function(){s_oLevelMenu.unload();switch(b){case 0:s_oMain.gotoHelp(a);break;case 1:s_oMain.gotoGame(a);break;case 2:s_oMain.gotoMenu()}})};this._onClickHelp=function(a){playSound("press_button",1,0);b[a].ifClickable()&&this.doUnload(a,0)};this._onClick=function(a){playSound("press_button",1,0);b[a].ifClickable()&&this.doUnload(a,1)};this._onExit=
function(){$(s_oMain).trigger("show_interlevel_ad");$(s_oMain).trigger("end_session");this.doUnload(0,2)};s_oLevelMenu=this;this._init()}var s_oLevelMenu=null;
function CLevelBut(a,l,f,d,e,k){var p,b,q,n=[],z=[],u,x;this._init=function(a,d,f,l){b=[];q=[];var v=new createjs.SpriteSheet({images:[f],frames:{width:l?f.width/2-5:f.width/2,height:f.height,regX:f.width/2/2,regY:f.height/2},animations:{state_true:[0],state_false:[1]}});p=l;u=createSprite(v,"state_"+p,f.width/2/2,f.height/2,f.width/2,f.height);u.mouseEnabled=l;u.x=a;u.y=d;u.cursor="pointer";u.stop();k.addChild(u);n.push(u);f=new createjs.Text(e,"bold 30px "+FONT,"#000000");f.x=a-3;f.y=d+7;f.textAlign=
"center";f.textBaseline="alphabetic";f.lineWidth=200;k.addChild(f);f=new createjs.Text(e,"bold 30px "+FONT,"#f6de9b");f.x=a-5;f.y=d+5;f.textAlign="center";f.textBaseline="alphabetic";f.lineWidth=200;k.addChild(f);this._initListener()};this.unload=function(){u.off("mousedown",this.buttonDown);u.off("pressup",this.buttonRelease);x&&createjs.Tween.removeTweens(x);k.removeChild(u)};this._initListener=function(){u.on("mousedown",this.buttonDown);u.on("pressup",this.buttonRelease)};this.viewBut=function(a){k.addChild(a)};
this.addEventListener=function(a,d,e){b[a]=d;q[a]=e};this.addEventListenerWithParams=function(a,d,e,f){b[a]=d;q[a]=e;z=f};this.pulseAnimation=function(){x=createjs.Tween.get(u).to({scaleX:.9,scaleY:.9},850,createjs.Ease.quadOut).to({scaleX:1,scaleY:1},650,createjs.Ease.quadIn).call(function(){v.pulseAnimation()})};this.ifClickable=function(){return!0===u.mouseEnabled?1:0};this.setActive=function(a,b){p=b;n[a].gotoAndStop("state_"+p);n[a].mouseEnabled=!0};this.buttonRelease=function(){u.scaleX=1;u.scaleY=
1;!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||createjs.Sound.play("click");p=!p;u.gotoAndStop("state_"+p);b[ON_MOUSE_UP]&&b[ON_MOUSE_UP].call(q[ON_MOUSE_UP],z)};this.buttonDown=function(){u.scaleX=.9;u.scaleY=.9;b[ON_MOUSE_DOWN]&&b[ON_MOUSE_DOWN].call(q[ON_MOUSE_DOWN],z)};this.setPosition=function(a,b){u.x=a;u.y=b};this.setVisible=function(a){u.visible=a};var v=this;this._init(a,l,f,d)}
function CConfirmPanel(a,l){var f=-90,d=150,e=this,k=[],p=[],b=[],q,n,z=CANVAS_WIDTH/2,u=CANVAS_HEIGHT/2,x,v,B,A;this._init=function(){l===CONFIRMATION_EXIT&&(f=-20,d=80);n=new createjs.Container;n.x=z;n.y=1.5*CANVAS_HEIGHT;v=new createjs.Shape;v.graphics.beginFill("#000000").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);v.alpha=.7;v.on("mousedown",this._onClick);s_oStage.addChild(v);var b=s_oSpriteLibrary.getSprite("msg_box");q=createBitmap(b);q.regX=b.width/2;q.regY=b.height/2;n.addChild(q);x=new createjs.Text(a,
" 30px "+FONT,"#000");x.x=2;x.y=f+12;x.textAlign="center";x.textBaseline="alphabetic";x.lineWidth=300;n.addChild(x);x=new createjs.Text(a," 30px "+FONT,"#ffc949");x.x=0;x.y=f+10;x.textAlign="center";x.textBaseline="alphabetic";x.lineWidth=300;n.addChild(x);B=new CGfxButton(-50,d,s_oSpriteLibrary.getSprite("but_exit"),n);B.pulseAnimation();A=new CGfxButton(50,d,s_oSpriteLibrary.getSprite("but_next"),n);s_oStage.addChild(n);this.show()};this._initListener=function(){B.addEventListener(ON_MOUSE_DOWN,
this.buttonNoDown,this);A.addEventListener(ON_MOUSE_DOWN,this.buttonYesDown,this)};this.addEventListener=function(a,b,d){k[a]=b;p[a]=d};this.buttonNoDown=function(){playSound("press_button",1,0);k[ON_BUT_NO_DOWN]&&k[ON_BUT_NO_DOWN].call(p[ON_BUT_NO_DOWN],b)};this.buttonYesDown=function(){playSound("press_button",1,0);k[ON_BUT_YES_DOWN]&&k[ON_BUT_YES_DOWN].call(p[ON_BUT_YES_DOWN],b)};this._onClick=function(){};this.show=function(){createjs.Tween.get(n).to({y:u},500,createjs.Ease.quadOut).call(function(){e._initListener()})};
this.unload=function(){createjs.Tween.get(n).to({y:1.5*CANVAS_HEIGHT},500).call(function(){s_oStage.removeChild(n)});createjs.Tween.get(v).to({alpha:0},500).call(function(){s_oStage.removeChild(v)})};this._init();s_oVariousHelp=this;return this}var s_oVariousHelp=null;
function CCreditsPanel(){var a,l,f,d,e,k,p;this._init=function(){k=new createjs.Shape;k.graphics.beginFill("#000").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);k.alpha=.7;k.on("click",this._onLogoButRelease);s_oStage.addChild(k);l=createBitmap(s_oSpriteLibrary.getSprite("msg_box"));s_oStage.addChild(l);var b=s_oSpriteLibrary.getSprite("but_exit");a=CANVAS_WIDTH-b.height/2-110;d=new CGfxButton(a,270,b,s_oStage);d.addEventListener(ON_MOUSE_UP,this.unload,this);e=new CFormatText(CANVAS_WIDTH/2,430,TEXT_CREDITS_DEVELOPED,
"#ffc949",s_oStage,"#000",40);b=s_oSpriteLibrary.getSprite("logo_credits");f=createBitmap(b);f.regX=b.width/2;f.regY=b.height/2;f.x=CANVAS_WIDTH/2;f.y=520;s_oStage.addChild(f);p=new CFormatText(CANVAS_WIDTH/2,600,TEXT_LINK1,"#ffc949",s_oStage,"#000",30)};this.unload=function(){k.off("click",this._onLogoButRelease);d.unload();d=null;e.unload();p.unload();s_oStage.removeChild(l);s_oStage.removeChild(f);s_oStage.removeChild(k)};this._onLogoButRelease=function(){window.open("http://www.codethislab.com/index.php?&l=en")};
this._init()}
function CFormatText(a,l,f,d,e,k,p){var b,q,n,z,u,x;this._init=function(a,d,e,f,k,l,p){b=e;z=new createjs.Container;z.x=a;z.y=d;k.addChild(z);a=p+"px";q=new createjs.Text;q.text=b;q.font="bold "+a+" "+FONT;q.color=l;q.textAlign="center";q.textBaseline="middle";q.lineWidth=600;q.outline=4;z.addChild(q);n=new createjs.Text;n.text=b;n.font="bold "+a+" "+FONT;n.color=f;n.textAlign="center";n.textBaseline="middle";n.lineWidth=600;z.addChild(n)};this.unload=function(){e.removeChild(z)};this.disableOutline=function(){z.removeChild(q)};
this.setVisible=function(a){z.visible=a};this.isVisible=function(){return z.visible};this.setOutline=function(a){q.outline=a};this.setShadow=function(a){q.shadow=a?new createjs.Shadow("#333333",2,2,6):null};this.setAlign=function(a){q.textAlign=a;n.textAlign=a};this.setWidth=function(a){q.lineWidth=a;n.lineWidth=a};this.setText=function(a){n.text=a;q.text=a};this.setColor=function(a,b){n.color=a;q.color=b};this.setFont=function(a){var b=p+"px";n.font="bold "+b+" "+a;q.font="bold "+b+" "+a};this.getText=
function(){return z};this.setPos=function(a){z.y=a};this.getPos=function(){return{x:z.x,y:z.y}};this.playText=function(){u="";this.setText("");this._slideText(0)};this._slideText=function(a){u+=f[a];this.setText(u);a<f.length-1&&setTimeout(function(){x._slideText(a+1)},40)};this.setPosition=function(a,b){z.x=a;z.y=b};x=this;this._init(a,l,f,d,e,k,p)}
function CRollingTextController(a,l,f,d,e){var k,p,b,q,n,z,u,x,v,B,A;this._init=function(a,b,d,e,f){x=[];v=[];n=e;this.setUpdateInfo(d);u=f;B=a;A=b};this.setUpdateInfo=function(d){b=parseFloat(a.text);q=b+d;k=0;p=Math.round(n/FPS);z=0};this.addEventListener=function(a,b,d){x[a]=b;v[a]=d};this.increaseValue=function(a){z=a};this.getTarget=function(){return B};this.update=function(){k++;if(k>p)k=0,B.text=q.toFixed(0),null!==A&&(A.text=q.toFixed(0)),null!==x[ON_CONTROLLER_END]&&x[ON_CONTROLLER_END].call(v[ON_CONTROLLER_END],
this),0<z?this.setUpdateInfo(z):x[ON_CONTROLLER_REMOVE].call(v[ON_CONTROLLER_REMOVE],this);else{var a;switch(u){case EASE_BACKIN:a=s_oTweenController.easeInBack(k,0,1,p);break;case EASE_BACKOUT:a=s_oTweenController.easeOutBack(k,0,1,p);break;case EASE_CUBIC_IN:a=s_oTweenController.easeInCubic(k,0,1,p);break;case EASE_CUBIC_OUT:a=s_oTweenController.easeOutCubic(k,0,1,p);break;case EASE_ELASTIC_OUT:a=s_oTweenController.easeOutElastic(k,0,1,p);break;case EASE_LINEAR:a=s_oTweenController.easeLinear(k,
0,1,p);break;case EASE_QUART_BACKIN:a=s_oTweenController.easeBackInQuart(k,0,1,p);break;default:a=s_oTweenController.easeLinear(k,0,1,p)}a=s_oTweenController.tweenValue(b,q,a);B.text=a.toFixed(0);null!==A&&(A.text=a.toFixed(0))}};this._init(a,l,f,d,e)}
function CRollingTextManager(){var a=[],l=[];s_oTweenController=new CTweenController;this.add=function(f,d,e,k,l,b,q){var n=this._checkIfControllerExist(f);-1===n?(f=new CRollingTextController(f,d,e,k,l),f.addEventListener(ON_CONTROLLER_END,b,q),f.addEventListener(ON_CONTROLLER_REMOVE,this._onRemoveController,this),a.push(f)):a[n].increaseValue(e)};this._checkIfControllerExist=function(f){for(var d=0;d<a.length;d++)if(a[d].getTarget()===f)return d;return-1};this._onRemoveController=function(a){l.push(a)};
this.update=function(){for(var f=0;f<a.length;f++)a[f].update();for(f=0;f<l.length;f++)for(var d=0;d<a.length;d++)if(l[f]===a[d]){a.splice(d,1);break}l=[]}}var s_oTweenController,EASE_LINEAR=0,EASE_CUBIC_IN=1,EASE_QUART_BACKIN=2,EASE_BACKIN=3,EASE_CUBIC_OUT=4,EASE_ELASTIC_OUT=5,EASE_BACKOUT=6;
function CTweenController(){this.tweenValue=function(a,l,f){return a+f*(l-a)};this.easeLinear=function(a,l,f,d){return f*a/d+l};this.easeInCubic=function(a,l,f,d){d=(a/=d)*a*a;return l+f*d};this.easeBackInQuart=function(a,l,f,d){d=(a/=d)*a;return l+f*(2*d*d+2*d*a+-3*d)};this.easeInBack=function(a,l,f,d){return f*(a/=d)*a*(2.70158*a-1.70158)+l};this.easeOutCubic=function(a,l,f,d){return f*((a=a/d-1)*a*a+1)+l};this.easeOutElastic=function(a,l,f,d){var e;if(0===a)return l;if(1===(a/=d))return l+f;e=
.3*d;return f*Math.pow(2,-10*a)*Math.sin(2*(a*d-e/4)*Math.PI/e)+f+l};this.easeOutBack=function(a,l,f,d){return f*((a=a/d-1)*a*(2.70158*a+1.70158)+1)+l}};
