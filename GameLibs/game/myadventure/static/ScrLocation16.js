!function(){var e=function(){this.initialize(),this.init()};e.prototype=new createjs.Container,e.prototype.init=function(){this.face_mc=new createjs.Container,this.game_mc=new createjs.Container,this.cells_mc=new createjs.Container,this._gameOver,this._startBalance=!1,this.pressLeft=!1,this.pressRight=!1,this.arButtons=[],this.arItems=[],this.arBgInvent=[],this.levelObj={},this.curObj,this.vector=1,this.speedArrow=3,this.timeArrow=2e3,this.startTime=getTimer(),login_obj.location=16;var e=preload.getResult("location2_8");this.bgGame=new createjs.Bitmap(e),this.bgGame.scaleX=scaleGraphics,this.bgGame.scaleY=scaleGraphics,this.addChild(this.bgGame),this.addChild(this.game_mc),this.addChild(this.face_mc),this.face_mc.addChild(this.cells_mc),this.loadLevel(),this.touchHandler=this.touchHandler.bind(this),this.addEventListener("mousedown",this.touchHandler),this.addEventListener("pressmove",this.touchHandler),this.addEventListener("pressup",this.touchHandler),createjs.Ticker.on("tick",this.turnHandler,this),createjs.Ticker.setInterval(25),createjs.Ticker.setFPS(40)},e.prototype.loadLevel=function(){var e=this.addObj("l2_8_ladder",485,415);this.game_mc.addChild(e),this.Arrow1=this.addObj("Strelka7",80,420),this.Arrow1.name="Arrow1",this.Arrow1._selected=!1,this.game_mc.addChild(this.Arrow1),this.Arrow2=this.addObj("Strelka5",870,500),this.Arrow2.name="Arrow2",this.Arrow2._selected=!1,this.Arrow2.visible=!1,this.game_mc.addChild(this.Arrow2),this.Arrow3=this.addObj("Strelka3",250,420),this.Arrow3.name="Arrow3",this.Arrow3._selected=!1,this.game_mc.addChild(this.Arrow3),this.btnLeft=this.addObj("btnDown",200,510),this.btnLeft.name="btnLeft",this.btnLeft.rotation=90,this.btnLeft._selected=!1,this.face_mc.addChild(this.btnLeft),this.arButtons.push(this.btnLeft),this.arItems.push(this.btnLeft),this.btnRight=this.addObj("btnUp",800,510),this.btnRight.name="btnRight",this.btnRight.rotation=90,this.btnRight._selected=!1,this.face_mc.addChild(this.btnRight),this.arButtons.push(this.btnRight),this.arItems.push(this.btnRight),this.btnLeft.visible=!1,this.btnRight.visible=!1;var t=this.addObj("l2_5_stella",900,245);if(this.game_mc.addChild(t),this.cBalane=_WO/2-25*scaleGraphics,this.balance=this.addObj("l2_8_balance",_WO/2-25,80),this.face_mc.addChild(this.balance),this.arrowRed=this.addObj("arrowRed",0,0),this.balance.addChild(this.arrowRed),this.wBalance=Math.floor((this.balance.w-30)/scaleGraphics),login_obj.l2_8_stellaFire){var s=new ItemAnima("animFire");s.scaleX=scaleGraphics,s.scaleY=scaleGraphics,s.x=925*scaleGraphics,s.y=125*scaleGraphics,s.sprite.gotoAndPlay("one"),this.game_mc.addChild(s)}else this.arItems.push(t);this.arItems.push(this.Arrow1),this.arButtons.push(this.Arrow1),this.arItems.push(this.Arrow2),this.arButtons.push(this.Arrow2),this.arItems.push(this.Arrow3),this.arButtons.push(this.Arrow3),this.hero=new ItemHero,this.hero._parent=this,this.hero.scaleY=scaleGraphics,this.game_mc.addChild(this.hero),login_obj.l2_8_stellaFire&&15==login_obj.prevLoc?(this.hero.scaleX=1*scaleGraphics,this.hero.x=150*scaleGraphics,this.hero.y=300*scaleGraphics):login_obj.l2_8_stellaFire?(this.hero.scaleX=-1*scaleGraphics,this.hero.x=850*scaleGraphics,this.hero.y=360*scaleGraphics,this.Arrow3.visible=!1,this.Arrow2.visible=!0):(this.hero.scaleX=1*scaleGraphics,this.hero.x=150*scaleGraphics,this.hero.y=300*scaleGraphics),this.textHero=new ItemText,this.textHero._parent=this,this.textHero.scaleX=scaleGraphics,this.textHero.scaleY=scaleGraphics,this.textHero.y=this.hero.y-100*scaleGraphics,this.hero.x<300*scaleGraphics?(this.textHero.oblachko.scaleX=-1,this.textHero.x=this.hero.x+200*scaleGraphics):this.textHero.x=this.hero.x-200*scaleGraphics,this.game_mc.addChild(this.textHero),15==login_obj.prevLoc||(this.hero.showText(),this.textHero.showText("emergence_2_8")),this.createCells(),this.loadInvent()},e.prototype.createCells=function(){var e,t=0;for(t=0;8>t;t++){var e=this.addObj("Cell",944-120*t,688);e.alpha=0,e.empty=!0,this.cells_mc.addChild(e),this.arBgInvent.push(e)}},e.prototype.addObj=function(e,t,s,i,r){i||(i=1),r||(r=1);var h=new createjs.Container,a=preload.getResult(e),o=new createjs.Bitmap(a);return o.x=-(o.image.width/2),o.y=-(o.image.height/2),h.addChild(o),h.scaleX=scaleGraphics*i,h.scaleY=scaleGraphics*r,h.x=t*scaleGraphics,h.y=s*scaleGraphics,h.w=o.image.width*h.scaleX,h.h=o.image.height*h.scaleY,h.name=e,h.w<50&&(h.w=50),h.h<50&&(h.h=50),h},e.prototype.pushObj=function(e){if(e){var t,s=0;for(s=0;s<this.arBgInvent.length&&(t=this.arBgInvent[s],!t.empty);s++);t&&(createjs.Tween.get(t).to({alpha:1},200),createjs.Tween.get(e).to({x:t.x,y:t.y},300).call(function(){}))}},e.prototype.startBalance=function(){var e=this;this._startBalance=!0;var t={x:760*scaleGraphics,y:360*scaleGraphics};this.hero.speed=1,this.hero.initMove(t,null),this.hero.initMove(t,function(){e.hero.speed=4,e.Arrow2.visible=!0,e.btnLeft.visible=!1,e.btnRight.visible=!1,e._startBalance=!1,e.balance.visible=!1,com.funtomic.GameOps.reportEvent("minigame_ended",{story_id:lvlNumber,location_id:locNumber,minigame_id:4,minigame_name:"Balance"})}),com.funtomic.GameOps.reportEvent("minigame_started",{story_id:lvlNumber,location_id:locNumber,minigame_id:4,minigame_name:"Balance"})},e.prototype.showBalance=function(){this.btnLeft.visible=!0,this.btnRight.visible=!0;var e=this,t=this.addObj("l2_8_ready",485,215);t.alpha=0,this.game_mc.addChild(t),createjs.Tween.get(t).to({alpha:1,y:200*scaleGraphics},300).wait(500).to({alpha:0,y:185*scaleGraphics},200),createjs.Tween.get({}).to({},1e3).call(function(){e.startBalance()})},e.prototype.clickObj=function(e){var t=e.name,s=this,i={x:e.x,y:e.y-60*scaleGraphics};if(e._selected&&(e.scaleX=scaleGraphics,e.scaleY=scaleGraphics,e._selected=!1),this.curObj){if("l2_5_stella"==t&&"i_l2_3_lamp"==this.curObj.name&&this.hero.x>750*scaleGraphics){var r=new ItemAnima("animFire");r.scaleX=scaleGraphics,r.scaleY=scaleGraphics,r.x=925*scaleGraphics,r.y=125*scaleGraphics,r.sprite.gotoAndPlay("one"),this.game_mc.addChild(r),this.removeFromArray(this.arItems,t),login_obj.l2_8_stellaFire=!0,login_obj.l2_5_stellaFire&&login_obj.l2_8_stellaFire&&login_obj.l2_10_stellaFire&&this.removeFromArray(invent_obj2,"i_l2_3_lamp",!0),this.refreshInvent()}}else{if("Arrow1"==t)return this._gameOver=!0,e.visible=!1,this.hero.speed=4,void this.hero.initMove(i,function(){s.removeAllListener(),showGame(15),saveData()});if("Arrow2"==t)return this.hero.speed=4,this._gameOver=!0,e.visible=!1,void this.hero.initMove(e,function(){s.removeAllListener(),showGame(17),saveData()});if("Arrow3"==t)return e.visible=!1,void this.hero.initMove(i,function(){s.showBalance()})}this.curObj&&this.refreshInvent()},e.prototype.loadInvent=function(){invent_obj2=[];for(var e=0;e<login_obj.arInvent2.length;e++){var t=login_obj.arInvent2[e];if(t){var s=this.addObj(t,0,0);invent_obj2.push(s)}}this.refreshInvent()},e.prototype.refreshInvent=function(){var e,t,s=0;for(s=0;s<this.arBgInvent.length;s++){if(t=this.arBgInvent[s],t.empty=!0,invent_obj2&&(e=invent_obj2[s])){t.empty=!1;var i=e.name,r=i.indexOf("i_");-1==r&&(this.face_mc.removeChild(e),e=this.addObj("i_"+i,0,0),invent_obj2[s]=e),e.x=t.x,e.y=t.y,this.face_mc.addChild(e)}t.empty&&1==t.alpha&&createjs.Tween.get(t).to({alpha:0},200),0==t.empty&&0==t.alpha&&createjs.Tween.get(t).to({alpha:1},200)}saveData()},e.prototype.removeFromArray=function(e,t,s){var i,r=0;for(r=0;r<e.length;r++)if(i=e[r],i.name==t){s&&this.face_mc.removeChild(i),e.splice(r,1);break}},e.prototype.resetTimer=function(){this.startTime=getTimer()},e.prototype.turnHandler=function(e){if(!options_pause){if(this._gameOver)return void e.remove();var t=getTimer()-this.startTime;this._startBalance&&(this.timeArrow-=t,this.timeArrow<0&&(this.timeArrow=1e3,this.vector=Math.random()>.5?1:-1,this.speedArrow=Math.random()+3),this.arrowRed.x+=this.speedArrow*this.vector,this.pressLeft?this.arrowRed.x-=4:this.pressRight&&(this.arrowRed.x+=4),Math.abs(this.arrowRed.x)>=this.wBalance/2&&(this._gameOver=!0,this.removeAllListener(),this.hero.sprite.stop(),createjs.Tween.get(this.hero).to({y:650*scaleGraphics,rotation:-90},500).call(function(){showGame(16)})),this.arrowRed.x=Math.max(-this.wBalance/2,this.arrowRed.x),this.arrowRed.x=Math.min(this.wBalance/2,this.arrowRed.x)),this.startTime=getTimer()}},e.prototype.checkInvent=function(e){for(var t=e.stageX,s=e.stageY,i=null,r=0;r<invent_obj2.length;r++){var h=invent_obj2[r];if(hit_test_rec(h,h.w,h.h,t,s)){i=h;break}}return i},e.prototype.checkButtons=function(e){for(var t=e.stageX,s=e.stageY,i=0;i<this.arButtons.length;i++){var r=this.arButtons[i];hit_test_rec(r,r.w,r.h,t,s)?r.visible&&0==r._selected&&(r._selected=!0,r.scaleX=1.2*scaleGraphics,r.scaleY=1.2*scaleGraphics):r._selected&&(r.scaleX=scaleGraphics,r.scaleY=scaleGraphics,r._selected=!1)}},e.prototype.touchHandler=function(e){if(this._gameOver)return void e.remove();var t,s,i=e.type,r=e.stageX,h=e.stageY,a=0;if("mousedown"==i){for(this.curObj=this.checkInvent(e),null==this.curObj&&this.checkButtons(e),a=0;a<this.arButtons.length;a++)if(t=this.arButtons[a],t._selected)return void("btnLeft"==t.name?this.pressLeft=!0:"btnRight"==t.name&&(this.pressRight=!0))}else if("pressmove"==i)this.checkButtons(e),this.curObj?(this.curObj.x=r,this.curObj.y=h):this.checkButtons(e);else if("pressup"==i){if(0==this._startBalance)for(a=0;a<this.arItems.length;a++)if(t=this.arItems[a],hit_test_rec(t,t.w,t.h,r,h)&&t.visible)return void this.clickObj(t);for(this.pressLeft=!1,this.pressRight=!1,a=0;a<this.arButtons.length;a++)t=this.arButtons[a],t._selected&&(t.scaleX=scaleGraphics,t.scaleY=scaleGraphics,t._selected=!1);s=getDD(this.hero.x,this.hero.y,r,h),s<hitHero*scaleGraphics?this.hero.say?(this.hero.hideText(),this.textHero.hideText()):(this.hero.showText(),this.textHero.showText()):(this.hero.hideText(),this.textHero.hideText()),this.curObj&&this.refreshInvent()}},e.prototype.removeAllListener=function(){this.hero&&this.hero.removeAllListener(),this._resultGame=!0,this.removeEventListener("mousedown",this.touchHandler),this.removeEventListener("pressmove",this.touchHandler),this.removeEventListener("pressup",this.touchHandler)},window.ScrLocation16=e}();